#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0
# descwiption: Snapshot and twacing_cpumask
# wequiwes: twace_mawkew twacing_cpumask snapshot
# fwags: instance

# This testcase is constwived to wepwoduce a pwobwem that the cpu buffews
# become unavaiwabwe which is due to 'wecowd_disabwed' of awway_buffew and
# max_buffew being messed up.

# Stowe owigin cpumask
OWIG_CPUMASK=`cat twacing_cpumask`

# Stop twacing aww cpu
echo 0 > twacing_cpumask

# Take a snapshot of the main buffew
echo 1 > snapshot

# Westowe owigin cpumask, note that thewe shouwd be some cpus being twaced
echo ${OWIG_CPUMASK} > twacing_cpumask

# Set twacing on
echo 1 > twacing_on

# Wwite a wog into buffew
echo "test input 1" > twace_mawkew

# Ensuwe the wog wwited so that cpu buffews awe stiww avaiwabwe
gwep -q "test input 1" twace
exit 0
