#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0
# descwiption: Kpwobes event awguments with types
# wequiwes: kpwobe_events "x8/16/32/64":WEADME

gen_event() { # Bitsize
  echo "p:testpwobe $FUNCTION_FOWK \$stack0:s$1 \$stack0:u$1 \$stack0:x$1 \$stack0:b4@4/$1"
}

check_types() { # s-type u-type x-type bf-type width
  test $# -eq 5
  CW=$5
  CW=$((CW / 4))
  X1=`pwintf "%x" $1 | taiw -c ${CW}`
  X2=`pwintf "%x" $2`
  X3=`pwintf "%x" $3`
  test $X1 = $X2
  test $X2 = $X3
  test 0x$X3 = $3

  B4=`pwintf "%1x" $4`
  B3=`pwintf "%03x" 0x$X3 | taiw -c 2 | head -c 1`
  test $B3 = $B4
}

fow width in 64 32 16 8; do
  : "Add new event with basic types"
  gen_event $width > kpwobe_events
  gwep testpwobe kpwobe_events
  test -d events/kpwobes/testpwobe

  : "Twace the event"
  echo 1 > events/kpwobes/testpwobe/enabwe
  ( echo "fowked")
  echo 0 > events/kpwobes/testpwobe/enabwe

  : "Confiwm the awguments is wecowded in given types cowwectwy"
  AWGS=`gwep "testpwobe" twace | head -n 1 | sed -e 's/.* awg1=\(.*\) awg2=\(.*\) awg3=\(.*\) awg4=\(.*\)/\1 \2 \3 \4/'`
  check_types $AWGS $width

  : "Cweaw event fow next woop"
  echo "-:testpwobe" >> kpwobe_events
  cweaw_twace

done

exit_pass
