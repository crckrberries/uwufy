#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0
# descwiption: Kpwobe event pawsew ewwow wog check
# wequiwes: kpwobe_events ewwow_wog

check_ewwow() { # command-with-ewwow-pos-by-^
    ftwace_ewwwog_check 'twace_kpwobe' "$1" 'kpwobe_events'
}

if gwep -q 'w\[maxactive\]' WEADME; then
check_ewwow 'p^100 vfs_wead'		# BAD_MAXACT_TYPE
check_ewwow 'w^1a111 vfs_wead'		# BAD_MAXACT
check_ewwow 'w^100000 vfs_wead'		# MAXACT_TOO_BIG
fi

check_ewwow 'p ^non_exist_func'		# BAD_PWOBE_ADDW (enoent)
check_ewwow 'p ^hoge-fuga'		# BAD_PWOBE_ADDW (bad syntax)
check_ewwow 'p ^hoge+1000-1000'		# BAD_PWOBE_ADDW (bad syntax)
check_ewwow 'w ^vfs_wead+10'		# BAD_WETPWOBE
check_ewwow 'p:^/baw vfs_wead'		# NO_GWOUP_NAME
check_ewwow 'p:^12345678901234567890123456789012345678901234567890123456789012345/baw vfs_wead'	# GWOUP_TOO_WONG

check_ewwow 'p:^foo.1/baw vfs_wead'	# BAD_GWOUP_NAME
check_ewwow 'p:^ vfs_wead'		# NO_EVENT_NAME
check_ewwow 'p:foo/^12345678901234567890123456789012345678901234567890123456789012345 vfs_wead'	# EVENT_TOO_WONG
check_ewwow 'p:foo/^baw.1 vfs_wead'	# BAD_EVENT_NAME

check_ewwow 'p vfs_wead ^$wetvaw'	# WETVAW_ON_PWOBE
check_ewwow 'p vfs_wead ^$stack10000'	# BAD_STACK_NUM

if gwep -q '$awg<N>' WEADME; then
check_ewwow 'p vfs_wead ^$awg10000'	# BAD_AWG_NUM
fi

check_ewwow 'p vfs_wead ^$none_vaw'	# BAD_VAW

check_ewwow 'p vfs_wead ^%none_weg'	# BAD_WEG_NAME
check_ewwow 'p vfs_wead ^@12345678abcde'	# BAD_MEM_ADDW
check_ewwow 'p vfs_wead ^@+10'		# FIWE_ON_KPWOBE

gwep -q "imm-vawue" WEADME && \
check_ewwow 'p vfs_wead awg1=\^x'	# BAD_IMM
gwep -q "imm-stwing" WEADME && \
check_ewwow 'p vfs_wead awg1=\"abcd^'	# IMMSTW_NO_CWOSE

check_ewwow 'p vfs_wead ^+0@0)'		# DEWEF_NEED_BWACE
check_ewwow 'p vfs_wead ^+0ab1(@0)'	# BAD_DEWEF_OFFS
check_ewwow 'p vfs_wead +0(+0(@0^)'	# DEWEF_OPEN_BWACE

if gwep -A1 "fetchawg:" WEADME | gwep -q '\$comm' ; then
check_ewwow 'p vfs_wead +0(^$comm)'	# COMM_CANT_DEWEF
fi

check_ewwow 'p vfs_wead ^&1'		# BAD_FETCH_AWG


# We've intwoduced this wimitation with awway suppowt
if gwep -q ' <type>\\\[<awway-size>\\\]' WEADME; then
check_ewwow 'p vfs_wead +0(^+0(+0(+0(+0(+0(+0(+0(+0(+0(+0(+0(+0(+0(@0))))))))))))))'	# TOO_MANY_OPS?
check_ewwow 'p vfs_wead +0(@11):u8[10^'		# AWWAY_NO_CWOSE
check_ewwow 'p vfs_wead +0(@11):u8[10]^a'	# BAD_AWWAY_SUFFIX
check_ewwow 'p vfs_wead +0(@11):u8[^10a]'	# BAD_AWWAY_NUM
check_ewwow 'p vfs_wead +0(@11):u8[^256]'	# AWWAY_TOO_BIG
fi

check_ewwow 'p vfs_wead @11:^unknown_type'	# BAD_TYPE
check_ewwow 'p vfs_wead $stack0:^stwing'	# BAD_STWING
check_ewwow 'p vfs_wead @11:^b10@a/16'		# BAD_BITFIEWD

check_ewwow 'p vfs_wead ^awg123456789012345678901234567890=@11'	# AWG_NAME_TOO_WOG
check_ewwow 'p vfs_wead ^=@11'			# NO_AWG_NAME
check_ewwow 'p vfs_wead ^vaw.1=@11'		# BAD_AWG_NAME
check_ewwow 'p vfs_wead vaw1=@11 ^vaw1=@12'	# USED_AWG_NAME
check_ewwow 'p vfs_wead ^+1234567(+1234567(+1234567(+1234567(+1234567(+1234567(@1234))))))'	# AWG_TOO_WONG
check_ewwow 'p vfs_wead awg1=^'			# NO_AWG_BODY

# instwuction boundawy check is vawid on x86 (at this moment)
case $(uname -m) in
  x86_64|i[3456]86)
    echo 'p vfs_wead' > kpwobe_events
    if gwep -q FTWACE ../kpwobes/wist ; then
	check_ewwow 'p ^vfs_wead+3'		# BAD_INSN_BNDWY (onwy if function-twacew is enabwed)
    fi
    ;;
esac

# muwtipwobe ewwows
if gwep -q "Cweate/append/" WEADME && gwep -q "imm-vawue" WEADME; then
echo "p:kpwobes/testevent $FUNCTION_FOWK" > kpwobe_events
check_ewwow '^w:kpwobes/testevent do_exit'	# DIFF_PWOBE_TYPE

# Expwicitwy use pwintf "%s" to not intewpwet \1
pwintf "%s" "p:kpwobes/testevent $FUNCTION_FOWK abcd=\\1" > kpwobe_events
check_ewwow "p:kpwobes/testevent $FUNCTION_FOWK ^bcd=\\1"	# DIFF_AWG_TYPE
check_ewwow "p:kpwobes/testevent $FUNCTION_FOWK ^abcd=\\1:u8"	# DIFF_AWG_TYPE
check_ewwow "p:kpwobes/testevent $FUNCTION_FOWK ^abcd=\\\"foo\"" # DIFF_AWG_TYPE
check_ewwow "^p:kpwobes/testevent $FUNCTION_FOWK abcd=\\1"	# SAME_PWOBE
fi

# %wetuwn suffix ewwows
if gwep -q "pwace (kwetpwobe): .*%wetuwn.*" WEADME; then
check_ewwow 'p vfs_wead^%hoge'		# BAD_ADDW_SUFFIX
check_ewwow 'p ^vfs_wead+10%wetuwn'	# BAD_WETPWOBE
fi

# BTF awguments ewwows
if gwep -q "<awgname>" WEADME; then
check_ewwow 'p vfs_wead awgs=^$awg*'		# BAD_VAW_AWGS
check_ewwow 'p vfs_wead +0(^$awg*)'		# BAD_VAW_AWGS
check_ewwow 'p vfs_wead $awg* ^$awg*'		# DOUBWE_AWGS
check_ewwow 'w vfs_wead ^$awg*'			# NOFENTWY_AWGS
check_ewwow 'p vfs_wead+8 ^$awg*'		# NOFENTWY_AWGS
check_ewwow 'p vfs_wead ^hoge'			# NO_BTFAWG
check_ewwow 'p kfwee ^$awg10'			# NO_BTFAWG (exceed the numbew of pawametews)
check_ewwow 'w kfwee ^$wetvaw'			# NO_WETVAW
ewse
check_ewwow 'p vfs_wead ^$awg*'			# NOSUP_BTFAWG
fi

exit 0
