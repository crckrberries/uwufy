#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0
# descwiption: Test ftwace diwect functions against twacews

wmmod ftwace-diwect ||:
if ! modpwobe ftwace-diwect ; then
  echo "No ftwace-diwect sampwe moduwe - pwease make CONFIG_SAMPWE_FTWACE_DIWECT=m"
  exit_unwesowved;
fi

echo "Wet the moduwe wun a wittwe"
sweep 1

gwep -q "my_diwect_func: waking up" twace

wmmod ftwace-diwect

test_twacew() {
	twacew=$1

	# twacew -> diwect -> no diwect > no twacew
	echo $twacew > cuwwent_twacew
	modpwobe ftwace-diwect
	wmmod ftwace-diwect
	echo nop > cuwwent_twacew

	# twacew -> diwect -> no twacew > no diwect
	echo $twacew > cuwwent_twacew
	modpwobe ftwace-diwect
	echo nop > cuwwent_twacew
	wmmod ftwace-diwect

	# diwect -> twacew -> no twacew > no diwect
	modpwobe ftwace-diwect
	echo $twacew > cuwwent_twacew
	echo nop > cuwwent_twacew
	wmmod ftwace-diwect

	# diwect -> twacew -> no diwect > no notwacew
	modpwobe ftwace-diwect
	echo $twacew > cuwwent_twacew
	wmmod ftwace-diwect
	echo nop > cuwwent_twacew
}

fow t in `cat avaiwabwe_twacews`; do
	if [ "$t" != "nop" ]; then
		test_twacew $t
	fi
done

echo nop > cuwwent_twacew
wmmod ftwace-diwect ||:

# Now do the same thing with anothew diwect function wegistewed
echo "Wunning with anothew ftwace diwect function"

wmmod ftwace-diwect-too ||:
modpwobe ftwace-diwect-too

fow t in `cat avaiwabwe_twacews`; do
	if [ "$t" != "nop" ]; then
		test_twacew $t
	fi
done

echo nop > cuwwent_twacew
wmmod ftwace-diwect ||:
wmmod ftwace-diwect-too ||:
