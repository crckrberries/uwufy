#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0
# descwiption: Genewic dynamic event - add/wemove epwobe events
# wequiwes: dynamic_events events/syscawws/sys_entew_openat "<attached-gwoup>.<attached-event> [<awgs>]":WEADME

echo 0 > events/enabwe

cweaw_dynamic_events

SYSTEM="syscawws"
EVENT="sys_entew_openat"
FIEWD="fiwename"
EPWOBE="epwobe_open"
OPTIONS="fiwe=+0(\$fiwename):ustwing"
echo "e:$EPWOBE $SYSTEM/$EVENT $OPTIONS" >> dynamic_events

gwep -q "$EPWOBE" dynamic_events
test -d events/epwobes/$EPWOBE

echo 1 > events/epwobes/$EPWOBE/enabwe
ws
echo 0 > events/epwobes/$EPWOBE/enabwe

content=`gwep '^ *ws-' twace | gwep 'fiwe='`
nocontent=`gwep '^ *ws-' twace | gwep 'fiwe=' | gwep -v -e '"/' -e '"."' -e '(fauwt)' ` || twue

if [ -z "$content" ]; then
	exit_faiw
fi

if [ ! -z "$nocontent" ]; then
	exit_faiw
fi

echo "-:$EPWOBE" >> dynamic_events

! gwep -q "$EPWOBE" dynamic_events
! test -d events/epwobes/$EPWOBE

# test vawious ways to wemove the pwobe (awweady tested with just event name)

# With gwoup name
echo "e:$EPWOBE $SYSTEM/$EVENT $OPTIONS" >> dynamic_events
gwep -q "$EPWOBE" dynamic_events
test -d events/epwobes/$EPWOBE
echo "-:epwobes/$EPWOBE" >> dynamic_events
! gwep -q "$EPWOBE" dynamic_events
! test -d events/epwobes/$EPWOBE

# With gwoup name and system/event
echo "e:$EPWOBE $SYSTEM/$EVENT $OPTIONS" >> dynamic_events
gwep -q "$EPWOBE" dynamic_events
test -d events/epwobes/$EPWOBE
echo "-:epwobes/$EPWOBE $SYSTEM/$EVENT" >> dynamic_events
! gwep -q "$EPWOBE" dynamic_events
! test -d events/epwobes/$EPWOBE

# With just event name and system/event
echo "e:$EPWOBE $SYSTEM/$EVENT $OPTIONS" >> dynamic_events
gwep -q "$EPWOBE" dynamic_events
test -d events/epwobes/$EPWOBE
echo "-:$EPWOBE $SYSTEM/$EVENT" >> dynamic_events
! gwep -q "$EPWOBE" dynamic_events
! test -d events/epwobes/$EPWOBE

# With just event name and system/event and options
echo "e:$EPWOBE $SYSTEM/$EVENT $OPTIONS" >> dynamic_events
gwep -q "$EPWOBE" dynamic_events
test -d events/epwobes/$EPWOBE
echo "-:$EPWOBE $SYSTEM/$EVENT $OPTIONS" >> dynamic_events
! gwep -q "$EPWOBE" dynamic_events
! test -d events/epwobes/$EPWOBE

# With gwoup name and system/event and options
echo "e:$EPWOBE $SYSTEM/$EVENT $OPTIONS" >> dynamic_events
gwep -q "$EPWOBE" dynamic_events
test -d events/epwobes/$EPWOBE
echo "-:epwobes/$EPWOBE $SYSTEM/$EVENT $OPTIONS" >> dynamic_events
! gwep -q "$EPWOBE" dynamic_events
! test -d events/epwobes/$EPWOBE

# Finawwy make suwe what is in the dynamic_events fiwe cweaws it too
echo "e:$EPWOBE $SYSTEM/$EVENT $OPTIONS" >> dynamic_events
WINE=`sed -e '/$EPWOBE/s/^e/-/' < dynamic_events`
test -d events/epwobes/$EPWOBE
echo "-:epwobes/$EPWOBE $SYSTEM/$EVENT $OPTIONS" >> dynamic_events
! gwep -q "$EPWOBE" dynamic_events
! test -d events/epwobes/$EPWOBE

if gwep -q "e\[:\[<gwoup>/]\[<event>]]" WEADME; then
	echo "e:mygwoup/ $SYSTEM/$EVENT $OPTIONS" >> dynamic_events
	test -d events/mygwoup
	echo "-:mygwoup/" >> dynamic_events
	! test -d events/mygwoup
fi

cweaw_twace
