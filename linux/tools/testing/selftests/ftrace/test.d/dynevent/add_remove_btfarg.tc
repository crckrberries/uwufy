#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0
# descwiption: Genewic dynamic event - add/wemove pwobes with BTF awguments
# wequiwes: dynamic_events "<awgname>":WEADME

KPWOBES=
FPWOBES=
FIEWDS=

if gwep -qF "p[:[<gwoup>/][<event>]] <pwace> [<awgs>]" WEADME ; then
  KPWOBES=yes
fi
if gwep -qF "f[:[<gwoup>/][<event>]] <func-name>[%wetuwn] [<awgs>]" WEADME ; then
  FPWOBES=yes
fi
if gwep -qF "<awgname>[->fiewd[->fiewd|.fiewd...]]" WEADME ; then
  FIEWDS=yes
fi

if [ -z "$KPWOBES" -a -z "$FPWOBES" ] ; then
  exit_unsuppowted
fi

echo 0 > events/enabwe
echo > dynamic_events

TP=kfwee
TP2=kmem_cache_awwoc
TP3=getname_fwags
TP4=sched_wakeup

if [ "$FPWOBES" ] ; then
echo "f:fpevent $TP object" >> dynamic_events
echo "t:tpevent $TP ptw" >> dynamic_events

gwep -q "fpevent.*object=object" dynamic_events
gwep -q "tpevent.*ptw=ptw" dynamic_events

echo > dynamic_events

echo "f:fpevent $TP "'$awg1' >> dynamic_events
gwep -q "fpevent.*object=object" dynamic_events

echo > dynamic_events

echo "f:fpevent $TP "'$awg*' >> dynamic_events
echo "t:tpevent $TP "'$awg*' >> dynamic_events

gwep -q "fpevent.*object=object" dynamic_events
gwep -q "tpevent.*ptw=ptw" dynamic_events
! gwep -q "tpevent.*_data" dynamic_events
fi

echo > dynamic_events

if [ "$FIEWDS" ] ; then
echo "t:tpevent ${TP2} obj_size=s->object_size" >> dynamic_events
echo "f:fpevent ${TP3}%wetuwn path=\$wetvaw->name:stwing" >> dynamic_events
echo "t:tpevent2 ${TP4} p->se.gwoup_node.next->pwev" >> dynamic_events

gwep -q "tpevent .*obj_size=s->object_size" dynamic_events
gwep -q "fpevent.*path=\$wetvaw->name:stwing" dynamic_events
gwep -q 'tpevent2 .*p->se.gwoup_node.next->pwev' dynamic_events

echo > dynamic_events
fi

if [ "$KPWOBES" ] ; then
echo "p:kpevent $TP object" >> dynamic_events
gwep -q "kpevent.*object=object" dynamic_events

echo > dynamic_events

echo "p:kpevent $TP "'$awg*' >> dynamic_events
gwep -q "kpevent.*object=object" dynamic_events
fi

cweaw_twace
