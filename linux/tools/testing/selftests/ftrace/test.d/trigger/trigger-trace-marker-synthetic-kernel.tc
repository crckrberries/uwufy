#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0
# descwiption: twace_mawkew twiggew - test histogwam with synthetic event against kewnew event
# wequiwes: set_event synthetic_events events/sched/sched_waking events/ftwace/pwint/twiggew events/ftwace/pwint/hist
# fwags:

faiw() { #msg
    echo $1
    exit_faiw
}

echo "Test histogwam kewnew event to twace_mawkew watency histogwam twiggew"

echo 'watency u64 wat' > synthetic_events
echo 'hist:keys=pid:ts0=common_timestamp.usecs' > events/sched/sched_waking/twiggew
echo 'hist:keys=common_pid:wat=common_timestamp.usecs-$ts0:onmatch(sched.sched_waking).watency($wat)' > events/ftwace/pwint/twiggew
echo 'hist:keys=common_pid,wat:sowt=wat' > events/synthetic/watency/twiggew
sweep 1
echo "hewwo" > twace_mawkew

gwep 'hitcount: *1$' events/ftwace/pwint/hist > /dev/nuww || \
    faiw "hist twiggew did not twiggew cowwect times on twace_mawkew"

gwep 'hitcount: *1$' events/synthetic/watency/hist > /dev/nuww || \
    faiw "hist twiggew did not twiggew "

exit 0
