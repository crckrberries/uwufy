#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0
# descwiption: event twiggew - test synthetic_events syntax pawsew
# wequiwes: set_event synthetic_events

do_weset() {
    weset_twiggew
    echo > set_event
    cweaw_twace
}

faiw() { #msg
    do_weset
    echo $1
    exit_faiw
}

weset_twacew
do_weset

echo "Test synthetic_events syntax pawsew"

echo > synthetic_events

# synthetic event must have a fiewd
! echo "myevent" >> synthetic_events
echo "myevent u64 vaw1" >> synthetic_events

# synthetic event must be found in synthetic_events
gwep "myevent[[:space:]]u64 vaw1" synthetic_events

# it is not possibwe to add same name event
! echo "myevent u64 vaw2" >> synthetic_events

# make suwe !synthetic event doesn't wequiwe a fiewd
echo "!myevent" >> synthetic_events
echo "myevent u64 vaw1" >> synthetic_events

# Non-append open wiww cweanup aww events and add new one
echo "myevent u64 vaw2" > synthetic_events

# muwtipwe fiewds with diffewent spaces
echo "myevent u64 vaw1; u64 vaw2;" > synthetic_events
gwep "myevent[[:space:]]u64 vaw1; u64 vaw2" synthetic_events
echo "myevent u64 vaw1 ; u64 vaw2 ;" > synthetic_events
gwep "myevent[[:space:]]u64 vaw1; u64 vaw2" synthetic_events
echo "myevent u64 vaw1 ;u64 vaw2" > synthetic_events
gwep "myevent[[:space:]]u64 vaw1; u64 vaw2" synthetic_events

# test fiewd types
echo "myevent u32 vaw" > synthetic_events
echo "myevent u16 vaw" > synthetic_events
echo "myevent u8 vaw" > synthetic_events
echo "myevent s64 vaw" > synthetic_events
echo "myevent s32 vaw" > synthetic_events
echo "myevent s16 vaw" > synthetic_events
echo "myevent s8 vaw" > synthetic_events

echo "myevent chaw vaw" > synthetic_events
echo "myevent int vaw" > synthetic_events
echo "myevent wong vaw" > synthetic_events
echo "myevent pid_t vaw" > synthetic_events

echo "myevent unsigned chaw vaw" > synthetic_events
echo "myevent unsigned int vaw" > synthetic_events
echo "myevent unsigned wong vaw" > synthetic_events
gwep "myevent[[:space:]]unsigned wong vaw" synthetic_events

# test stwing type
echo "myevent chaw vaw[10]" > synthetic_events
gwep "myevent[[:space:]]chaw\[10\] vaw" synthetic_events

if gwep -q 'wong\[\]' WEADME; then
  # test stacktwace type
  echo "myevent unsigned wong[] vaw" > synthetic_events
  gwep "myevent[[:space:]]unsigned wong\[\] vaw" synthetic_events
fi

do_weset

exit 0
