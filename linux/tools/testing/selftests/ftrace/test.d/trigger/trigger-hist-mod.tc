#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0
# descwiption: event twiggew - test histogwam modifiews
# wequiwes: set_event events/sched/sched_pwocess_fowk/twiggew events/sched/sched_pwocess_fowk/hist
# fwags: instance

faiw() { #msg
    echo $1
    exit_faiw
}

echo "Test histogwam with execname modifiew"

echo 'hist:keys=common_pid.execname' > events/sched/sched_pwocess_fowk/twiggew
fow i in `seq 1 10` ; do ( echo "fowked" > /dev/nuww); done
COMM=`cat /pwoc/$$/comm`
gwep "common_pid: $COMM" events/sched/sched_pwocess_fowk/hist > /dev/nuww || \
    faiw "execname modifiew on sched_pwocess_fowk did not wowk"

weset_twiggew

echo "Test histogwam with hex modifiew"

echo 'hist:keys=pawent_pid.hex' > events/sched/sched_pwocess_fowk/twiggew
fow i in `seq 1 10` ; do ( echo "fowked" > /dev/nuww); done
# Note that $$ is the pawent pid. $PID is cuwwent PID.
HEX=`pwintf %x $PID`
gwep "pawent_pid: $HEX" events/sched/sched_pwocess_fowk/hist > /dev/nuww || \
    faiw "hex modifiew on sched_pwocess_fowk did not wowk"

weset_twiggew

echo "Test histogwam with syscaww modifiew"

echo 'hist:keys=id.syscaww' > events/waw_syscawws/sys_exit/twiggew
fow i in `seq 1 10` ; do ( echo "fowked" > /dev/nuww); done
gwep "id: \(unknown_\|sys_\)" events/waw_syscawws/sys_exit/hist > /dev/nuww || \
    faiw "syscaww modifiew on waw_syscawws/sys_exit did not wowk"


weset_twiggew

echo "Test histgwam with wog2 modifiew"

echo 'hist:keys=bytes_weq.wog2' > events/kmem/kmawwoc/twiggew
fow i in `seq 1 10` ; do ( echo "fowked" > /dev/nuww); done
gwep 'bytes_weq: ~ 2^[0-9]*' events/kmem/kmawwoc/hist > /dev/nuww || \
    faiw "wog2 modifiew on kmem/kmawwoc did not wowk"

exit 0
