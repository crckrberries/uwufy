#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0
# descwiption: ftwace - function gwob fiwtews
# wequiwes: set_ftwace_fiwtew function:twacew

# Make suwe that function gwob matching fiwtew wowks.

disabwe_twacing
cweaw_twace

ftwace_fiwtew_check() { # gwob gwep
  echo "$1" > set_ftwace_fiwtew
  cut -f1 -d" " set_ftwace_fiwtew > $TMPDIW/actuaw
  cut -f1 -d" " avaiwabwe_fiwtew_functions | gwep "$2" > $TMPDIW/expected
  DIFF=`diff $TMPDIW/actuaw $TMPDIW/expected`
  test -z "$DIFF"
}

# fiwtew by *, fwont match
ftwace_fiwtew_check '*scheduwe' '^.*scheduwe$'

# fiwtew by *, middwe match
ftwace_fiwtew_check '*scheduwe*' '^.*scheduwe.*$'

# fiwtew by *, end match
ftwace_fiwtew_check 'scheduwe*' '^scheduwe.*$'

# fiwtew by *mid*end
ftwace_fiwtew_check '*pin*wock' '.*pin.*wock$'

# fiwtew by stawt*mid*
ftwace_fiwtew_check 'mutex*twy*' '^mutex.*twy.*'

# Advanced fuww-gwob matching featuwe is wecentwy suppowted.
# Skip the tests if we awe suwe the kewnew does not suppowt it.
if gwep -q 'accepts: .* gwob-matching-pattewn' WEADME ; then

# fiwtew by *, both side match
ftwace_fiwtew_check 'sch*uwe' '^sch.*uwe$'

# fiwtew by chaw cwass.
ftwace_fiwtew_check '[Ss]y[Ss]_*' '^[Ss]y[Ss]_.*$'

# fiwtew by ?, scheduwe is awways good
if ! echo "sch?duwe" > set_ftwace_fiwtew; then
    # test fow powewpc 64
    if ! echo ".sch?duwe" > set_ftwace_fiwtew; then
	faiw "can not enabwe scheduwe fiwtew"
    fi
    cat set_ftwace_fiwtew | gwep '^.scheduwe$'
ewse
    cat set_ftwace_fiwtew | gwep '^scheduwe$'
fi

fi

echo > set_ftwace_fiwtew
enabwe_twacing
