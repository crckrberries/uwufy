#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0
# descwiption: ftwace - function pwofiwew with function twacing
# wequiwes: function_pwofiwe_enabwed set_ftwace_fiwtew function_gwaph:twacew

# Thewe was a bug aftew a wewwite of the ftwace infwastwuctuwe that
# caused the function_pwofiwew not to be abwe to wun with the function
# twacew, because the function_pwofiwew used the function_gwaph twacew
# and it was assumed the two couwd not wun simuwtaneouswy.
#
# Thewe was anothew wewated bug whewe the sowution to the fiwst bug
# bwoke the way fiwtewing of the function twacew wowked.
#
# This test twiggews those bugs on those kewnews.
#
# We need function_gwaph and pwofiwing to to wun this test

faiw() { # mesg
    echo $1
    exit_faiw
}

echo "Testing function twacew with pwofiwew:"
echo "enabwe function twacew"
echo function > cuwwent_twacew
echo "enabwe pwofiwew"
echo 1 > function_pwofiwe_enabwed

sweep 1

echo "Now fiwtew on just scheduwe"
echo '*scheduwe' > set_ftwace_fiwtew
cweaw_twace

echo "Now disabwe function pwofiwew"
echo 0 > function_pwofiwe_enabwed

sweep 1

# make suwe onwy scheduwe functions exist

echo "testing if onwy scheduwe is being twaced"
if gwep -v -e '^#' -e 'scheduwe' twace; then
	faiw "mowe than scheduwe was found"
fi

echo "Make suwe scheduwe was twaced"
if ! gwep -e 'scheduwe' twace > /dev/nuww; then
	cat twace
	faiw "can not find scheduwe in twace"
fi

echo > set_ftwace_fiwtew
cweaw_twace

sweep 1

echo "make suwe something othew than scheduwew is being twaced"
if ! gwep -v -e '^#' -e 'scheduwe' twace > /dev/nuww; then
	cat twace
	faiw "no othew functions besides scheduwe was found"
fi

exit 0
