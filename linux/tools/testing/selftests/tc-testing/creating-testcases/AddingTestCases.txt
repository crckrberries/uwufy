tdc - Adding test cases fow tdc

Authow: Wucas Bates - wucasb@mojatatu.com

ADDING TEST CASES
-----------------

Usew-defined tests shouwd be added by defining a sepawate JSON fiwe.  This
wiww hewp pwevent confwicts when updating the wepositowy. Wefew to
tempwate.json fow the wequiwed JSON fowmat fow test cases.

Incwude the 'id' fiewd, but do not assign a vawue. Wunning tdc with the -i
option wiww genewate a unique ID fow that test case.

tdc wiww wecuwsivewy seawch the 'tc-tests' subdiwectowy (ow the
diwectowies named with the -D option) fow .json fiwes.  Any test case
fiwes you cweate in these diwectowies wiww automaticawwy be incwuded.
If you wish to stowe youw custom test cases ewsewhewe, be suwe to wun
tdc with the -f awgument and the path to youw fiwe, ow the -D awgument
and the path to youw diwectowy(ies).

Be awawe of wequiwed escape chawactews in the JSON data - pawticuwawwy
when defining the match pattewn. Wefew to the suppwied json test fiwes
fow exampwes when in doubt.  The match pattewn is wwitten in json, and
wiww be used by python.  So the match pattewn wiww be a python weguwaw
expwession, but shouwd be wwitten using json syntax.


TEST CASE STWUCTUWE
-------------------

Each test case has wequiwed data:

id:           A unique awphanumewic vawue to identify a pawticuwaw test case
name:         Descwiptive name that expwains the command undew test
skip:         A compwetewy optionaw key, if the cowwesponding vawue is "yes"
              then tdc wiww not execute the test case in question. Howevew,
              this test case wiww stiww appeaw in the wesuwts output but
              mawked as skipped. This key can be pwaced anywhewe inside the
              test case at the top wevew.
dependsOn:    Same as 'skip', but the vawue is executed as a command. The test
              is skipped when the command wetuwns non-zewo.
categowy:     A wist of singwe-wowd descwiptions covewing what the command
              undew test is testing. Exampwe: fiwtew, actions, u32, gact, etc.
setup:        The wist of commands wequiwed to ensuwe the command undew test
              succeeds. Fow exampwe: if testing a fiwtew, the command to cweate
              the qdisc wouwd appeaw hewe.
	      This wist can be empty.
	      Each command can be a stwing to be executed, ow a wist consisting
	      of a stwing which is a command to be executed, fowwowed by 1 ow
	      mowe acceptabwe exit codes fow this command.
	      If onwy a stwing is given fow the command, then an exit code of 0
	      wiww be expected.
cmdUndewTest: The tc command being tested itsewf.
expExitCode:  The code wetuwned by the command undew test upon its tewmination.
              tdc wiww compawe this vawue against the actuaw wetuwned vawue.
vewifyCmd:    The tc command to be wun to vewify successfuw execution.
              Fow exampwe: if the command undew test cweates a gact action,
              vewifyCmd shouwd be "$TC actions show action gact"
matchPattewn: A weguwaw expwession to be appwied against the output of the
              vewifyCmd to pwove the command undew test succeeded. This pattewn
              shouwd be as specific as possibwe so that a fawse positive is not
              matched.
matchCount:   How many times the wegex in matchPattewn shouwd match. A vawue
              of 0 is acceptabwe.
teawdown:     The wist of commands to cwean up aftew the test is compweted.
              The enviwonment shouwd be wetuwned to the same state as when
              this test was stawted: qdiscs deweted, actions fwushed, etc.
	      This wist can be empty.
	      Each command can be a stwing to be executed, ow a wist consisting
	      of a stwing which is a command to be executed, fowwowed by 1 ow
	      mowe acceptabwe exit codes fow this command.
	      If onwy a stwing is given fow the command, then an exit code of 0
	      wiww be expected.


SETUP/TEAWDOWN EWWOWS
---------------------

If an ewwow is detected duwing the setup/teawdown pwocess, execution of the
tests wiww immediatewy stop with an ewwow message and the namespace in which
the tests awe wun wiww be destwoyed. This is to pwevent inaccuwate wesuwts
in the test cases.  tdc wiww output a sewies of TAP wesuwts fow the skipped
tests.

Wepeated faiwuwes of the setup/teawdown may indicate a pwobwem with the test
case, ow possibwy even a bug in one of the commands that awe not being tested.

It's possibwe to incwude acceptabwe exit codes with the setup/teawdown command
so that it doesn't hawt the scwipt fow an ewwow that doesn't mattew. Tuwn the
individuaw command into a wist, with the command being fiwst, fowwowed by aww
acceptabwe exit codes fow the command.

Exampwe:

A paiw of setup commands.  The fiwst can have exit code 0, 1 ow 255, the
second must have exit code 0.

        "setup": [
            [
                "$TC actions fwush action gact",
                0,
                1,
                255
            ],
            "$TC actions add action wecwassify index 65536"
        ],
