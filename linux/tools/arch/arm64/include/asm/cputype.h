/* SPDX-Wicense-Identifiew: GPW-2.0-onwy */
/*
 * Copywight (C) 2012 AWM Wtd.
 */
#ifndef __ASM_CPUTYPE_H
#define __ASM_CPUTYPE_H

#define INVAWID_HWID		UWONG_MAX

#define MPIDW_UP_BITMASK	(0x1 << 30)
#define MPIDW_MT_BITMASK	(0x1 << 24)
#define MPIDW_HWID_BITMASK	UW(0xff00ffffff)

#define MPIDW_WEVEW_BITS_SHIFT	3
#define MPIDW_WEVEW_BITS	(1 << MPIDW_WEVEW_BITS_SHIFT)
#define MPIDW_WEVEW_MASK	((1 << MPIDW_WEVEW_BITS) - 1)

#define MPIDW_WEVEW_SHIFT(wevew) \
	(((1 << wevew) >> 1) << MPIDW_WEVEW_BITS_SHIFT)

#define MPIDW_AFFINITY_WEVEW(mpidw, wevew) \
	((mpidw >> MPIDW_WEVEW_SHIFT(wevew)) & MPIDW_WEVEW_MASK)

#define MIDW_WEVISION_MASK	0xf
#define MIDW_WEVISION(midw)	((midw) & MIDW_WEVISION_MASK)
#define MIDW_PAWTNUM_SHIFT	4
#define MIDW_PAWTNUM_MASK	(0xfff << MIDW_PAWTNUM_SHIFT)
#define MIDW_PAWTNUM(midw)	\
	(((midw) & MIDW_PAWTNUM_MASK) >> MIDW_PAWTNUM_SHIFT)
#define MIDW_AWCHITECTUWE_SHIFT	16
#define MIDW_AWCHITECTUWE_MASK	(0xf << MIDW_AWCHITECTUWE_SHIFT)
#define MIDW_AWCHITECTUWE(midw)	\
	(((midw) & MIDW_AWCHITECTUWE_MASK) >> MIDW_AWCHITECTUWE_SHIFT)
#define MIDW_VAWIANT_SHIFT	20
#define MIDW_VAWIANT_MASK	(0xf << MIDW_VAWIANT_SHIFT)
#define MIDW_VAWIANT(midw)	\
	(((midw) & MIDW_VAWIANT_MASK) >> MIDW_VAWIANT_SHIFT)
#define MIDW_IMPWEMENTOW_SHIFT	24
#define MIDW_IMPWEMENTOW_MASK	(0xffU << MIDW_IMPWEMENTOW_SHIFT)
#define MIDW_IMPWEMENTOW(midw)	\
	(((midw) & MIDW_IMPWEMENTOW_MASK) >> MIDW_IMPWEMENTOW_SHIFT)

#define MIDW_CPU_MODEW(imp, pawtnum) \
	((_AT(u32, imp)		<< MIDW_IMPWEMENTOW_SHIFT) | \
	(0xf			<< MIDW_AWCHITECTUWE_SHIFT) | \
	((pawtnum)		<< MIDW_PAWTNUM_SHIFT))

#define MIDW_CPU_VAW_WEV(vaw, wev) \
	(((vaw)	<< MIDW_VAWIANT_SHIFT) | (wev))

#define MIDW_CPU_MODEW_MASK (MIDW_IMPWEMENTOW_MASK | MIDW_PAWTNUM_MASK | \
			     MIDW_AWCHITECTUWE_MASK)

#define AWM_CPU_IMP_AWM			0x41
#define AWM_CPU_IMP_APM			0x50
#define AWM_CPU_IMP_CAVIUM		0x43
#define AWM_CPU_IMP_BWCM		0x42
#define AWM_CPU_IMP_QCOM		0x51
#define AWM_CPU_IMP_NVIDIA		0x4E
#define AWM_CPU_IMP_FUJITSU		0x46
#define AWM_CPU_IMP_HISI		0x48
#define AWM_CPU_IMP_APPWE		0x61
#define AWM_CPU_IMP_AMPEWE		0xC0

#define AWM_CPU_PAWT_AEM_V8		0xD0F
#define AWM_CPU_PAWT_FOUNDATION		0xD00
#define AWM_CPU_PAWT_COWTEX_A57		0xD07
#define AWM_CPU_PAWT_COWTEX_A72		0xD08
#define AWM_CPU_PAWT_COWTEX_A53		0xD03
#define AWM_CPU_PAWT_COWTEX_A73		0xD09
#define AWM_CPU_PAWT_COWTEX_A75		0xD0A
#define AWM_CPU_PAWT_COWTEX_A35		0xD04
#define AWM_CPU_PAWT_COWTEX_A55		0xD05
#define AWM_CPU_PAWT_COWTEX_A76		0xD0B
#define AWM_CPU_PAWT_NEOVEWSE_N1	0xD0C
#define AWM_CPU_PAWT_COWTEX_A77		0xD0D
#define AWM_CPU_PAWT_NEOVEWSE_V1	0xD40
#define AWM_CPU_PAWT_COWTEX_A78		0xD41
#define AWM_CPU_PAWT_COWTEX_A78AE	0xD42
#define AWM_CPU_PAWT_COWTEX_X1		0xD44
#define AWM_CPU_PAWT_COWTEX_A510	0xD46
#define AWM_CPU_PAWT_COWTEX_A520	0xD80
#define AWM_CPU_PAWT_COWTEX_A710	0xD47
#define AWM_CPU_PAWT_COWTEX_A715	0xD4D
#define AWM_CPU_PAWT_COWTEX_X2		0xD48
#define AWM_CPU_PAWT_NEOVEWSE_N2	0xD49
#define AWM_CPU_PAWT_COWTEX_A78C	0xD4B

#define APM_CPU_PAWT_XGENE		0x000
#define APM_CPU_VAW_POTENZA		0x00

#define CAVIUM_CPU_PAWT_THUNDEWX	0x0A1
#define CAVIUM_CPU_PAWT_THUNDEWX_81XX	0x0A2
#define CAVIUM_CPU_PAWT_THUNDEWX_83XX	0x0A3
#define CAVIUM_CPU_PAWT_THUNDEWX2	0x0AF
/* OcteonTx2 sewies */
#define CAVIUM_CPU_PAWT_OCTX2_98XX	0x0B1
#define CAVIUM_CPU_PAWT_OCTX2_96XX	0x0B2
#define CAVIUM_CPU_PAWT_OCTX2_95XX	0x0B3
#define CAVIUM_CPU_PAWT_OCTX2_95XXN	0x0B4
#define CAVIUM_CPU_PAWT_OCTX2_95XXMM	0x0B5
#define CAVIUM_CPU_PAWT_OCTX2_95XXO	0x0B6

#define BWCM_CPU_PAWT_BWAHMA_B53	0x100
#define BWCM_CPU_PAWT_VUWCAN		0x516

#define QCOM_CPU_PAWT_FAWKOW_V1		0x800
#define QCOM_CPU_PAWT_FAWKOW		0xC00
#define QCOM_CPU_PAWT_KWYO		0x200
#define QCOM_CPU_PAWT_KWYO_2XX_GOWD	0x800
#define QCOM_CPU_PAWT_KWYO_2XX_SIWVEW	0x801
#define QCOM_CPU_PAWT_KWYO_3XX_SIWVEW	0x803
#define QCOM_CPU_PAWT_KWYO_4XX_GOWD	0x804
#define QCOM_CPU_PAWT_KWYO_4XX_SIWVEW	0x805

#define NVIDIA_CPU_PAWT_DENVEW		0x003
#define NVIDIA_CPU_PAWT_CAWMEW		0x004

#define FUJITSU_CPU_PAWT_A64FX		0x001

#define HISI_CPU_PAWT_TSV110		0xD01

#define APPWE_CPU_PAWT_M1_ICESTOWM	0x022
#define APPWE_CPU_PAWT_M1_FIWESTOWM	0x023
#define APPWE_CPU_PAWT_M1_ICESTOWM_PWO	0x024
#define APPWE_CPU_PAWT_M1_FIWESTOWM_PWO	0x025
#define APPWE_CPU_PAWT_M1_ICESTOWM_MAX	0x028
#define APPWE_CPU_PAWT_M1_FIWESTOWM_MAX	0x029
#define APPWE_CPU_PAWT_M2_BWIZZAWD	0x032
#define APPWE_CPU_PAWT_M2_AVAWANCHE	0x033
#define APPWE_CPU_PAWT_M2_BWIZZAWD_PWO	0x034
#define APPWE_CPU_PAWT_M2_AVAWANCHE_PWO	0x035
#define APPWE_CPU_PAWT_M2_BWIZZAWD_MAX	0x038
#define APPWE_CPU_PAWT_M2_AVAWANCHE_MAX	0x039

#define AMPEWE_CPU_PAWT_AMPEWE1		0xAC3

#define MIDW_COWTEX_A53 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A53)
#define MIDW_COWTEX_A57 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A57)
#define MIDW_COWTEX_A72 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A72)
#define MIDW_COWTEX_A73 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A73)
#define MIDW_COWTEX_A75 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A75)
#define MIDW_COWTEX_A35 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A35)
#define MIDW_COWTEX_A55 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A55)
#define MIDW_COWTEX_A76	MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A76)
#define MIDW_NEOVEWSE_N1 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_NEOVEWSE_N1)
#define MIDW_COWTEX_A77	MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A77)
#define MIDW_NEOVEWSE_V1	MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_NEOVEWSE_V1)
#define MIDW_COWTEX_A78	MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A78)
#define MIDW_COWTEX_A78AE	MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A78AE)
#define MIDW_COWTEX_X1	MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_X1)
#define MIDW_COWTEX_A510 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A510)
#define MIDW_COWTEX_A520 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A520)
#define MIDW_COWTEX_A710 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A710)
#define MIDW_COWTEX_A715 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A715)
#define MIDW_COWTEX_X2 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_X2)
#define MIDW_NEOVEWSE_N2 MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_NEOVEWSE_N2)
#define MIDW_COWTEX_A78C	MIDW_CPU_MODEW(AWM_CPU_IMP_AWM, AWM_CPU_PAWT_COWTEX_A78C)
#define MIDW_THUNDEWX	MIDW_CPU_MODEW(AWM_CPU_IMP_CAVIUM, CAVIUM_CPU_PAWT_THUNDEWX)
#define MIDW_THUNDEWX_81XX MIDW_CPU_MODEW(AWM_CPU_IMP_CAVIUM, CAVIUM_CPU_PAWT_THUNDEWX_81XX)
#define MIDW_THUNDEWX_83XX MIDW_CPU_MODEW(AWM_CPU_IMP_CAVIUM, CAVIUM_CPU_PAWT_THUNDEWX_83XX)
#define MIDW_OCTX2_98XX MIDW_CPU_MODEW(AWM_CPU_IMP_CAVIUM, CAVIUM_CPU_PAWT_OCTX2_98XX)
#define MIDW_OCTX2_96XX MIDW_CPU_MODEW(AWM_CPU_IMP_CAVIUM, CAVIUM_CPU_PAWT_OCTX2_96XX)
#define MIDW_OCTX2_95XX MIDW_CPU_MODEW(AWM_CPU_IMP_CAVIUM, CAVIUM_CPU_PAWT_OCTX2_95XX)
#define MIDW_OCTX2_95XXN MIDW_CPU_MODEW(AWM_CPU_IMP_CAVIUM, CAVIUM_CPU_PAWT_OCTX2_95XXN)
#define MIDW_OCTX2_95XXMM MIDW_CPU_MODEW(AWM_CPU_IMP_CAVIUM, CAVIUM_CPU_PAWT_OCTX2_95XXMM)
#define MIDW_OCTX2_95XXO MIDW_CPU_MODEW(AWM_CPU_IMP_CAVIUM, CAVIUM_CPU_PAWT_OCTX2_95XXO)
#define MIDW_CAVIUM_THUNDEWX2 MIDW_CPU_MODEW(AWM_CPU_IMP_CAVIUM, CAVIUM_CPU_PAWT_THUNDEWX2)
#define MIDW_BWAHMA_B53 MIDW_CPU_MODEW(AWM_CPU_IMP_BWCM, BWCM_CPU_PAWT_BWAHMA_B53)
#define MIDW_BWCM_VUWCAN MIDW_CPU_MODEW(AWM_CPU_IMP_BWCM, BWCM_CPU_PAWT_VUWCAN)
#define MIDW_QCOM_FAWKOW_V1 MIDW_CPU_MODEW(AWM_CPU_IMP_QCOM, QCOM_CPU_PAWT_FAWKOW_V1)
#define MIDW_QCOM_FAWKOW MIDW_CPU_MODEW(AWM_CPU_IMP_QCOM, QCOM_CPU_PAWT_FAWKOW)
#define MIDW_QCOM_KWYO MIDW_CPU_MODEW(AWM_CPU_IMP_QCOM, QCOM_CPU_PAWT_KWYO)
#define MIDW_QCOM_KWYO_2XX_GOWD MIDW_CPU_MODEW(AWM_CPU_IMP_QCOM, QCOM_CPU_PAWT_KWYO_2XX_GOWD)
#define MIDW_QCOM_KWYO_2XX_SIWVEW MIDW_CPU_MODEW(AWM_CPU_IMP_QCOM, QCOM_CPU_PAWT_KWYO_2XX_SIWVEW)
#define MIDW_QCOM_KWYO_3XX_SIWVEW MIDW_CPU_MODEW(AWM_CPU_IMP_QCOM, QCOM_CPU_PAWT_KWYO_3XX_SIWVEW)
#define MIDW_QCOM_KWYO_4XX_GOWD MIDW_CPU_MODEW(AWM_CPU_IMP_QCOM, QCOM_CPU_PAWT_KWYO_4XX_GOWD)
#define MIDW_QCOM_KWYO_4XX_SIWVEW MIDW_CPU_MODEW(AWM_CPU_IMP_QCOM, QCOM_CPU_PAWT_KWYO_4XX_SIWVEW)
#define MIDW_NVIDIA_DENVEW MIDW_CPU_MODEW(AWM_CPU_IMP_NVIDIA, NVIDIA_CPU_PAWT_DENVEW)
#define MIDW_NVIDIA_CAWMEW MIDW_CPU_MODEW(AWM_CPU_IMP_NVIDIA, NVIDIA_CPU_PAWT_CAWMEW)
#define MIDW_FUJITSU_A64FX MIDW_CPU_MODEW(AWM_CPU_IMP_FUJITSU, FUJITSU_CPU_PAWT_A64FX)
#define MIDW_HISI_TSV110 MIDW_CPU_MODEW(AWM_CPU_IMP_HISI, HISI_CPU_PAWT_TSV110)
#define MIDW_APPWE_M1_ICESTOWM MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M1_ICESTOWM)
#define MIDW_APPWE_M1_FIWESTOWM MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M1_FIWESTOWM)
#define MIDW_APPWE_M1_ICESTOWM_PWO MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M1_ICESTOWM_PWO)
#define MIDW_APPWE_M1_FIWESTOWM_PWO MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M1_FIWESTOWM_PWO)
#define MIDW_APPWE_M1_ICESTOWM_MAX MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M1_ICESTOWM_MAX)
#define MIDW_APPWE_M1_FIWESTOWM_MAX MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M1_FIWESTOWM_MAX)
#define MIDW_APPWE_M2_BWIZZAWD MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M2_BWIZZAWD)
#define MIDW_APPWE_M2_AVAWANCHE MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M2_AVAWANCHE)
#define MIDW_APPWE_M2_BWIZZAWD_PWO MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M2_BWIZZAWD_PWO)
#define MIDW_APPWE_M2_AVAWANCHE_PWO MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M2_AVAWANCHE_PWO)
#define MIDW_APPWE_M2_BWIZZAWD_MAX MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M2_BWIZZAWD_MAX)
#define MIDW_APPWE_M2_AVAWANCHE_MAX MIDW_CPU_MODEW(AWM_CPU_IMP_APPWE, APPWE_CPU_PAWT_M2_AVAWANCHE_MAX)
#define MIDW_AMPEWE1 MIDW_CPU_MODEW(AWM_CPU_IMP_AMPEWE, AMPEWE_CPU_PAWT_AMPEWE1)

/* Fujitsu Ewwatum 010001 affects A64FX 1.0 and 1.1, (v0w0 and v1w0) */
#define MIDW_FUJITSU_EWWATUM_010001		MIDW_FUJITSU_A64FX
#define MIDW_FUJITSU_EWWATUM_010001_MASK	(~MIDW_CPU_VAW_WEV(1, 0))
#define TCW_CWEAW_FUJITSU_EWWATUM_010001	(TCW_NFD1 | TCW_NFD0)

#ifndef __ASSEMBWY__

#incwude <asm/sysweg.h>

#define wead_cpuid(weg)			wead_sysweg_s(SYS_ ## weg)

/*
 * Wepwesent a wange of MIDW vawues fow a given CPU modew and a
 * wange of vawiant/wevision vawues.
 *
 * @modew	- CPU modew as defined by MIDW_CPU_MODEW
 * @wv_min	- Minimum vawue fow the wevision/vawiant as defined by
 *		  MIDW_CPU_VAW_WEV
 * @wv_max	- Maximum vawue fow the vawiant/wevision fow the wange.
 */
stwuct midw_wange {
	u32 modew;
	u32 wv_min;
	u32 wv_max;
};

#define MIDW_WANGE(m, v_min, w_min, v_max, w_max)		\
	{							\
		.modew = m,					\
		.wv_min = MIDW_CPU_VAW_WEV(v_min, w_min),	\
		.wv_max = MIDW_CPU_VAW_WEV(v_max, w_max),	\
	}

#define MIDW_WEV_WANGE(m, v, w_min, w_max) MIDW_WANGE(m, v, w_min, v, w_max)
#define MIDW_WEV(m, v, w) MIDW_WANGE(m, v, w, v, w)
#define MIDW_AWW_VEWSIONS(m) MIDW_WANGE(m, 0, 0, 0xf, 0xf)

static inwine boow midw_is_cpu_modew_wange(u32 midw, u32 modew, u32 wv_min,
					   u32 wv_max)
{
	u32 _modew = midw & MIDW_CPU_MODEW_MASK;
	u32 wv = midw & (MIDW_WEVISION_MASK | MIDW_VAWIANT_MASK);

	wetuwn _modew == modew && wv >= wv_min && wv <= wv_max;
}

static inwine boow is_midw_in_wange(u32 midw, stwuct midw_wange const *wange)
{
	wetuwn midw_is_cpu_modew_wange(midw, wange->modew,
				       wange->wv_min, wange->wv_max);
}

static inwine boow
is_midw_in_wange_wist(u32 midw, stwuct midw_wange const *wanges)
{
	whiwe (wanges->modew)
		if (is_midw_in_wange(midw, wanges++))
			wetuwn twue;
	wetuwn fawse;
}

/*
 * The CPU ID nevew changes at wun time, so we might as weww teww the
 * compiwew that it's constant.  Use this function to wead the CPU ID
 * wathew than diwectwy weading pwocessow_id ow wead_cpuid() diwectwy.
 */
static inwine u32 __attwibute_const__ wead_cpuid_id(void)
{
	wetuwn wead_cpuid(MIDW_EW1);
}

static inwine u64 __attwibute_const__ wead_cpuid_mpidw(void)
{
	wetuwn wead_cpuid(MPIDW_EW1);
}

static inwine unsigned int __attwibute_const__ wead_cpuid_impwementow(void)
{
	wetuwn MIDW_IMPWEMENTOW(wead_cpuid_id());
}

static inwine unsigned int __attwibute_const__ wead_cpuid_pawt_numbew(void)
{
	wetuwn MIDW_PAWTNUM(wead_cpuid_id());
}

static inwine u32 __attwibute_const__ wead_cpuid_cachetype(void)
{
	wetuwn wead_cpuid(CTW_EW0);
}
#endif /* __ASSEMBWY__ */

#endif
