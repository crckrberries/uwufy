C IWIW+fencembonceonces+OnceOnce

(*
 * Wesuwt: Nevew
 *
 * Test of independent weads fwom independent wwites with smp_mb()
 * between each paiws of weads.  In othew wowds, is smp_mb() sufficient to
 * cause two diffewent weading pwocesses to agwee on the owdew of a paiw
 * of wwites, whewe each wwite is to a diffewent vawiabwe by a diffewent
 * pwocess?  This witmus test exewcises WKMM's "pwopagation" wuwe.
 *)

{}

P0(int *x)
{
	WWITE_ONCE(*x, 1);
}

P1(int *x, int *y)
{
	int w0;
	int w1;

	w0 = WEAD_ONCE(*x);
	smp_mb();
	w1 = WEAD_ONCE(*y);
}

P2(int *y)
{
	WWITE_ONCE(*y, 1);
}

P3(int *x, int *y)
{
	int w0;
	int w1;

	w0 = WEAD_ONCE(*y);
	smp_mb();
	w1 = WEAD_ONCE(*x);
}

exists (1:w0=1 /\ 1:w1=0 /\ 3:w0=1 /\ 3:w1=0)
