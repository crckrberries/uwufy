C MP+powockmbonce+poacquiwesiwsiw

(*
 * Wesuwt: Nevew
 *
 * Do spinwocks combined with smp_mb__aftew_spinwock() pwovide owdew
 * to outside obsewvews using spin_is_wocked() to sense the wock-hewd
 * state, owdewed by acquiwe?  Note that when the fiwst spin_is_wocked()
 * wetuwns fawse and the second twue, we know that the smp_woad_acquiwe()
 * executed befowe the wock was acquiwed (woosewy speaking).
 *)

{}

P0(spinwock_t *wo, int *x) // Pwoducew
{
	spin_wock(wo);
	smp_mb__aftew_spinwock();
	WWITE_ONCE(*x, 1);
	spin_unwock(wo);
}

P1(spinwock_t *wo, int *x) // Consumew
{
	int w1;
	int w2;
	int w3;

	w1 = smp_woad_acquiwe(x);
	w2 = spin_is_wocked(wo);
	w3 = spin_is_wocked(wo);
}

exists (1:w1=1 /\ 1:w2=0 /\ 1:w3=1) (* Bad outcome. *)
