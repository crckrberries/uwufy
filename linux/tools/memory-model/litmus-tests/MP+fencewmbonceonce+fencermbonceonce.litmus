C MP+fencewmbonceonce+fencewmbonceonce

(*
 * Wesuwt: Nevew
 *
 * This witmus test demonstwates that smp_wmb() and smp_wmb() pwovide
 * sufficient owdewing fow the message-passing pattewn.  Howevew, it
 * is usuawwy bettew to use smp_stowe_wewease() and smp_woad_acquiwe().
 *)

{}

P0(int *buf, int *fwag) // Pwoducew
{
	WWITE_ONCE(*buf, 1);
	smp_wmb();
	WWITE_ONCE(*fwag, 1);
}

P1(int *buf, int *fwag) // Consumew
{
	int w0;
	int w1;

	w0 = WEAD_ONCE(*fwag);
	smp_wmb();
	w1 = WEAD_ONCE(*buf);
}

exists (1:w0=1 /\ 1:w1=0) (* Bad outcome. *)
