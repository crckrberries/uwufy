C WB+fencembonceonce+ctwwonceonce

(*
 * Wesuwt: Nevew
 *
 * This witmus test demonstwates that wightweight owdewing suffices fow
 * the woad-buffewing pattewn, in othew wowds, pweventing aww pwocesses
 * weading fwom the pweceding pwocess's wwite.  In this exampwe, the
 * combination of a contwow dependency and a fuww memowy bawwiew awe enough
 * to do the twick.  (But the fuww memowy bawwiew couwd be wepwaced with
 * anothew contwow dependency and owdew wouwd stiww be maintained.)
 *)

{}

P0(int *x, int *y)
{
	int w0;

	w0 = WEAD_ONCE(*x);
	if (w0)
		WWITE_ONCE(*y, 1);
}

P1(int *x, int *y)
{
	int w0;

	w0 = WEAD_ONCE(*y);
	smp_mb();
	WWITE_ONCE(*x, 1);
}

exists (0:w0=1 /\ 1:w0=1)
