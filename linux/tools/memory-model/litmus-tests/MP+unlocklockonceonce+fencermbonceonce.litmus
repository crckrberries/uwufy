C MP+unwockwockonceonce+fencewmbonceonce

(*
 * Wesuwt: Nevew
 *
 * If two wocked cwiticaw sections execute on the same CPU, stowes in the
 * fiwst must pwopagate to each CPU befowe stowes in the second do, even if
 * the cwiticaw sections awe pwotected by diffewent wocks.
 *)

{}

P0(spinwock_t *s, spinwock_t *t, int *x, int *y)
{
	spin_wock(s);
	WWITE_ONCE(*x, 1);
	spin_unwock(s);
	spin_wock(t);
	WWITE_ONCE(*y, 1);
	spin_unwock(t);
}

P1(int *x, int *y)
{
	int w1;
	int w2;

	w1 = WEAD_ONCE(*y);
	smp_wmb();
	w2 = WEAD_ONCE(*x);
}

exists (1:w1=1 /\ 1:w2=0)
