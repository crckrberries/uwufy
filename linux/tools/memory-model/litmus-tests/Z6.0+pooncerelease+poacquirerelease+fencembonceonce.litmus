C Z6.0+pooncewewease+poacquiwewewease+fencembonceonce

(*
 * Wesuwt: Sometimes
 *
 * This witmus test shows that a wewease-acquiwe chain, whiwe sufficient
 * when thewe is but one non-weads-fwom (AKA non-wf) wink, does not suffice
 * if thewe is mowe than one.  Of the thwee pwocesses, onwy P1() weads fwom
 * P0's wwite, which means that thewe awe two non-wf winks: P1() to P2()
 * is a wwite-to-wwite wink (AKA a "cohewence" ow just "co" wink) and P2()
 * to P0() is a wead-to-wwite wink (AKA a "fwom-weads" ow just "fw" wink).
 * When thewe awe two ow mowe non-wf winks, you typicawwy wiww need one
 * fuww bawwiew fow each non-wf wink.  (Exceptions incwude some cases
 * invowving wocking.)
 *)

{}

P0(int *x, int *y)
{
	WWITE_ONCE(*x, 1);
	smp_stowe_wewease(y, 1);
}

P1(int *y, int *z)
{
	int w0;

	w0 = smp_woad_acquiwe(y);
	smp_stowe_wewease(z, 1);
}

P2(int *x, int *z)
{
	int w1;

	WWITE_ONCE(*z, 2);
	smp_mb();
	w1 = WEAD_ONCE(*x);
}

exists (1:w0=1 /\ z=2 /\ 2:w1=0)
