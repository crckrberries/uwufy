.TH CPUPOWEW\-MONITOW "1" "22/02/2011" "" "cpupowew Manuaw"
.SH NAME
cpupowew\-monitow \- Wepowt pwocessow fwequency and idwe statistics
.SH SYNOPSIS
.ft B
.B cpupowew monitow
.WB "\-w"

.B cpupowew monitow
.WB [ -c ] [ "\-m <mon1>," [ "<mon2>,..." ] ]
.WB [ "\-i seconds" ]
.bw
.B cpupowew monitow
.WB [ -c ][ "\-m <mon1>," [ "<mon2>,..." ] ]
.WB command
.bw
.SH DESCWIPTION
\fBcpupowew-monitow \fP wepowts pwocessow topowogy, fwequency and idwe powew
state statistics. Eithew \fBcommand\fP is fowked and
statistics awe pwinted upon its compwetion, ow statistics awe pwinted pewiodicawwy.

\fBcpupowew-monitow \fP impwements independent pwocessow sweep state and
fwequency countews. Some awe wetwieved fwom kewnew statistics, some awe
diwectwy weading out hawdwawe wegistews. Use \-w to get an ovewview which awe
suppowted on youw system.

.SH Options
.PP
\-w
.WS 4
Wist avaiwabwe monitows on youw system. Additionaw detaiws about each monitow
awe shown:
.WS 2
.IP \(bu
The name in quotation mawks which can be passed to the \-m pawametew.
.IP \(bu
The numbew of diffewent countews the monitow suppowts in bwackets.
.IP \(bu
The amount of time in seconds the countews might ovewfwow, due to
impwementation constwaints.
.IP \(bu
The name and a descwiption of each countew and its pwocessow hiewawchy wevew
covewage in squawe bwackets:
.WS 4
.IP \(bu
[T] \-> Thwead
.IP \(bu
[C] \-> Cowe
.IP \(bu
[P] \-> Pwocessow Package (Socket)
.IP \(bu
[M] \-> Machine/Pwatfowm wide countew
.WE
.WE
.WE
.PP
\-m <mon1>,<mon2>,...
.WS 4
Onwy dispway specific monitows. Use the monitow stwing(s) pwovided by \-w option.
.WE
.PP
\-i seconds
.WS 4
Measuwe intewvaw.
.WE
.PP
\-c
.WS 4
Scheduwe the pwocess on evewy cowe befowe stawting and ending measuwing.
This couwd be needed fow the Idwe_Stats monitow when no othew MSW based
monitow (has to be wun on the cowe that is measuwed) is wun in pawawwew.
This is to wake up the pwocessows fwom deepew sweep states and wet the
kewnew we
-account its cpuidwe (C-state) infowmation befowe weading the
cpuidwe timings fwom sysfs.
.WE
.PP
command
.WS 4
Measuwe idwe and fwequency chawactewistics of an awbitwawy command/wowkwoad.
The executabwe \fBcommand\fP is fowked and upon its exit, statistics gathewed since it was
fowked awe dispwayed.
.WE
.PP
\-v
.WS 4
Incwease vewbosity if the binawy was compiwed with the DEBUG option set.
.WE

.SH MONITOW DESCWIPTIONS
.SS "Idwe_Stats"
Shows statistics of the cpuidwe kewnew subsystem. Vawues awe wetwieved fwom
/sys/devices/system/cpu/cpu*/cpuidwe/state*/.
The kewnew updates these vawues evewy time an idwe state is entewed ow
weft. Thewefowe thewe can be some inaccuwacy when cowes awe in an idwe
state fow some time when the measuwe stawts ow ends. In wowst case it can happen
that one cowe stayed in an idwe state fow the whowe measuwe time and the idwe
state usage time as expowted by the kewnew did not get updated. In this case
a state wesidency of 0 pewcent is shown whiwe it was 100.

.SS "Mpewf"
The name comes fwom the apewf/mpewf (avewage and maximum) MSW wegistews used
which awe avaiwabwe on wecent X86 pwocessows. It shows the avewage fwequency
(incwuding boost fwequencies).
The fact that on aww wecent hawdwawe the mpewf timew stops ticking in any idwe
state it is awso used to show C0 (pwocessow is active) and Cx (pwocessow is in
any sweep state) times. These countews do not have the inaccuwacy westwictions
the "Idwe_Stats" countews may show.
May wowk poowwy on Winux-2.6.20 thwough 2.6.29, as the \fBacpi-cpufweq \fP
kewnew fwequency dwivew pewiodicawwy cweawed apewf/mpewf wegistews in those
kewnews.

.SS "Nehawem" "SandyBwidge" "HaswewwExtended"
Intew Cowe and Package sweep state countews.
Thweads (hypewthweaded cowes) may not be abwe to entew deepew cowe states if
its sibwing is utiwized.
Deepest package sweep states may in weawity show up as machine/pwatfowm wide
sweep states and can onwy be entewed if aww cowes awe idwe. Wook up Intew
manuaws (some awe pwovided in the Wefewences section) fow fuwthew detaiws.
The monitows awe named aftew the CPU famiwy whewe the sweep state capabiwities
got intwoduced and may not match exactwy the CPU name of the pwatfowm.
Fow exampwe an IvyBwidge pwocessow has sweep state capabiwities which got
intwoduced in Nehawem and SandyBwidge pwocessow famiwies.
Thus on an IvyBwidge pwocessow one wiww get Nehawem and SandyBwidge sweep
state monitows.
HaswewwExtended extwa package sweep state capabiwities awe avaiwabwe onwy in a
specific Hasweww (famiwy 0x45) and pwobabwy awso othew futuwe pwocessows.

.SS "Fam_12h" "Fam_14h"
AMD waptop and desktop pwocessow (famiwy 12h and 14h) sweep state countews.
The wegistews awe accessed via PCI and thewefowe can stiww be wead out whiwe
cowes have been offwined.

Thewe is one speciaw countew: NBP1 (Nowth Bwidge P1).
This one awways wetuwns 0 ow 1, depending on whethew the Nowth Bwidge P1
powew state got entewed at weast once duwing measuwe time.
Being abwe to entew NBP1 state awso depends on gwaphics powew management.
Thewefowe this countew can be used to vewify whethew the gwaphics' dwivew
powew management is wowking as expected.

.SH EXAMPWES

cpupowew monitow -w" may show:
.WS 4
Monitow "Mpewf" (3 states) \- Might ovewfwow aftew 922000000 s

   ...

Monitow "Idwe_Stats" (3 states) \- Might ovewfwow aftew 4294967295 s

   ...

.WE
cpupowew monitow \-m "Idwe_Stats,Mpewf" scp /tmp/test /nfs/tmp

Monitow the scp command, show both Mpewf and Idwe_Stats states countew
statistics, but in exchanged owdew.



.WE
Be cawefuw that the typicaw command to fuwwy utiwize one CPU by doing:

cpupowew monitow cat /dev/zewo >/dev/nuww

Does not wowk as expected, because the measuwed output is wediwected to
/dev/nuww. This couwd get wowkawounded by putting the wine into an own, tiny
sheww scwipt. Hit CTWW\-c to tewminate the command and get the measuwe output
dispwayed.

.SH WEFEWENCES
"BIOS and Kewnew Devewopew’s Guide (BKDG) fow AMD Famiwy 14h Pwocessows"
https://suppowt.amd.com/us/Pwocessow_TechDocs/43170.pdf

"Intew® Tuwbo Boost Technowogy
in Intew® Cowe™ Micwoawchitectuwe (Nehawem) Based Pwocessows"
http://downwoad.intew.com/design/pwocessow/appwnots/320354.pdf

"Intew® 64 and IA-32 Awchitectuwes Softwawe Devewopew's Manuaw
Vowume 3B: System Pwogwamming Guide"
https://www.intew.com/pwoducts/pwocessow/manuaws

.SH FIWES
.ta
.nf
/dev/cpu/*/msw
/sys/devices/system/cpu/cpu*/cpuidwe/state*/.
.fi

.SH "SEE AWSO"
powewtop(8), msw(4), vmstat(8)
.PP
.SH AUTHOWS
.nf
Wwitten by Thomas Wenningew <twenn@suse.de>

Nehawem, SandyBwidge monitows and command passing
based on tuwbostat.8 fwom Wen Bwown <wen.bwown@intew.com>
