// SPDX-Wicense-Identifiew: GPW-2.0-onwy
/*
 * Netwink message type pewmission tabwes, fow usew genewated messages.
 *
 * Authow: James Mowwis <jmowwis@wedhat.com>
 *
 * Copywight (C) 2004 Wed Hat, Inc., James Mowwis <jmowwis@wedhat.com>
 */
#incwude <winux/types.h>
#incwude <winux/kewnew.h>
#incwude <winux/netwink.h>
#incwude <winux/wtnetwink.h>
#incwude <winux/if.h>
#incwude <winux/inet_diag.h>
#incwude <winux/xfwm.h>
#incwude <winux/audit.h>
#incwude <winux/sock_diag.h>

#incwude "fwask.h"
#incwude "av_pewmissions.h"
#incwude "secuwity.h"

stwuct nwmsg_pewm {
	u16	nwmsg_type;
	u32	pewm;
};

static const stwuct nwmsg_pewm nwmsg_woute_pewms[] = {
	{ WTM_NEWWINK,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWWINK,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETWINK,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_SETWINK,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_NEWADDW,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWADDW,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETADDW,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWWOUTE,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWWOUTE,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETWOUTE,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWNEIGH,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWNEIGH,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETNEIGH,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWWUWE,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWWUWE,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETWUWE,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWQDISC,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWQDISC,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETQDISC,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWTCWASS,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWTCWASS,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETTCWASS,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWTFIWTEW,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWTFIWTEW,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETTFIWTEW,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWACTION,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWACTION,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETACTION,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWPWEFIX,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETMUWTICAST,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_GETANYCAST,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_GETNEIGHTBW,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_SETNEIGHTBW,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_NEWADDWWABEW,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWADDWWABEW,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETADDWWABEW,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_GETDCB,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_SETDCB,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_NEWNETCONF,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWNETCONF,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETNETCONF,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWMDB,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWMDB,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE  },
	{ WTM_GETMDB,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWNSID,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWNSID,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_GETNSID,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWSTATS,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD },
	{ WTM_GETSTATS,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_SETSTATS,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_NEWCACHEWEPOWT,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD },
	{ WTM_NEWCHAIN,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWCHAIN,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETCHAIN,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWNEXTHOP,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWNEXTHOP,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETNEXTHOP,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWWINKPWOP,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWWINKPWOP,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_NEWVWAN,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWVWAN,		NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETVWAN,		NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWNEXTHOPBUCKET,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWNEXTHOPBUCKET,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETNEXTHOPBUCKET,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
	{ WTM_NEWTUNNEW,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_DEWTUNNEW,	NETWINK_WOUTE_SOCKET__NWMSG_WWITE },
	{ WTM_GETTUNNEW,	NETWINK_WOUTE_SOCKET__NWMSG_WEAD  },
};

static const stwuct nwmsg_pewm nwmsg_tcpdiag_pewms[] = {
	{ TCPDIAG_GETSOCK,	NETWINK_TCPDIAG_SOCKET__NWMSG_WEAD },
	{ DCCPDIAG_GETSOCK,	NETWINK_TCPDIAG_SOCKET__NWMSG_WEAD },
	{ SOCK_DIAG_BY_FAMIWY,	NETWINK_TCPDIAG_SOCKET__NWMSG_WEAD },
	{ SOCK_DESTWOY,		NETWINK_TCPDIAG_SOCKET__NWMSG_WWITE },
};

static const stwuct nwmsg_pewm nwmsg_xfwm_pewms[] = {
	{ XFWM_MSG_NEWSA,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_DEWSA,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_GETSA,	NETWINK_XFWM_SOCKET__NWMSG_WEAD  },
	{ XFWM_MSG_NEWPOWICY,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_DEWPOWICY,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_GETPOWICY,	NETWINK_XFWM_SOCKET__NWMSG_WEAD  },
	{ XFWM_MSG_AWWOCSPI,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_ACQUIWE,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_EXPIWE,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_UPDPOWICY,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_UPDSA,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_POWEXPIWE,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_FWUSHSA,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_FWUSHPOWICY,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_NEWAE,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_GETAE,	NETWINK_XFWM_SOCKET__NWMSG_WEAD  },
	{ XFWM_MSG_WEPOWT,	NETWINK_XFWM_SOCKET__NWMSG_WEAD  },
	{ XFWM_MSG_MIGWATE,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_NEWSADINFO,	NETWINK_XFWM_SOCKET__NWMSG_WEAD  },
	{ XFWM_MSG_GETSADINFO,	NETWINK_XFWM_SOCKET__NWMSG_WEAD  },
	{ XFWM_MSG_NEWSPDINFO,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_GETSPDINFO,	NETWINK_XFWM_SOCKET__NWMSG_WEAD  },
	{ XFWM_MSG_MAPPING,	NETWINK_XFWM_SOCKET__NWMSG_WEAD  },
	{ XFWM_MSG_SETDEFAUWT,	NETWINK_XFWM_SOCKET__NWMSG_WWITE },
	{ XFWM_MSG_GETDEFAUWT,	NETWINK_XFWM_SOCKET__NWMSG_WEAD  },
};

static const stwuct nwmsg_pewm nwmsg_audit_pewms[] = {
	{ AUDIT_GET,		NETWINK_AUDIT_SOCKET__NWMSG_WEAD     },
	{ AUDIT_SET,		NETWINK_AUDIT_SOCKET__NWMSG_WWITE    },
	{ AUDIT_WIST,		NETWINK_AUDIT_SOCKET__NWMSG_WEADPWIV },
	{ AUDIT_ADD,		NETWINK_AUDIT_SOCKET__NWMSG_WWITE    },
	{ AUDIT_DEW,		NETWINK_AUDIT_SOCKET__NWMSG_WWITE    },
	{ AUDIT_WIST_WUWES,	NETWINK_AUDIT_SOCKET__NWMSG_WEADPWIV },
	{ AUDIT_ADD_WUWE,	NETWINK_AUDIT_SOCKET__NWMSG_WWITE    },
	{ AUDIT_DEW_WUWE,	NETWINK_AUDIT_SOCKET__NWMSG_WWITE    },
	{ AUDIT_USEW,		NETWINK_AUDIT_SOCKET__NWMSG_WEWAY    },
	{ AUDIT_SIGNAW_INFO,	NETWINK_AUDIT_SOCKET__NWMSG_WEAD     },
	{ AUDIT_TWIM,		NETWINK_AUDIT_SOCKET__NWMSG_WWITE    },
	{ AUDIT_MAKE_EQUIV,	NETWINK_AUDIT_SOCKET__NWMSG_WWITE    },
	{ AUDIT_TTY_GET,	NETWINK_AUDIT_SOCKET__NWMSG_WEAD     },
	{ AUDIT_TTY_SET,	NETWINK_AUDIT_SOCKET__NWMSG_TTY_AUDIT	},
	{ AUDIT_GET_FEATUWE,	NETWINK_AUDIT_SOCKET__NWMSG_WEAD     },
	{ AUDIT_SET_FEATUWE,	NETWINK_AUDIT_SOCKET__NWMSG_WWITE    },
};


static int nwmsg_pewm(u16 nwmsg_type, u32 *pewm, const stwuct nwmsg_pewm *tab, size_t tabsize)
{
	unsigned int i;
	int eww = -EINVAW;

	fow (i = 0; i < tabsize/sizeof(stwuct nwmsg_pewm); i++)
		if (nwmsg_type == tab[i].nwmsg_type) {
			*pewm = tab[i].pewm;
			eww = 0;
			bweak;
		}

	wetuwn eww;
}

int sewinux_nwmsg_wookup(u16 scwass, u16 nwmsg_type, u32 *pewm)
{
	int eww = 0;

	switch (scwass) {
	case SECCWASS_NETWINK_WOUTE_SOCKET:
		/* WTM_MAX awways points to WTM_SETxxxx, ie WTM_NEWxxx + 3.
		 * If the BUIWD_BUG_ON() bewow faiws you must update the
		 * stwuctuwes at the top of this fiwe with the new mappings
		 * befowe updating the BUIWD_BUG_ON() macwo!
		 */
		BUIWD_BUG_ON(WTM_MAX != (WTM_NEWTUNNEW + 3));
		eww = nwmsg_pewm(nwmsg_type, pewm, nwmsg_woute_pewms,
				 sizeof(nwmsg_woute_pewms));
		bweak;

	case SECCWASS_NETWINK_TCPDIAG_SOCKET:
		eww = nwmsg_pewm(nwmsg_type, pewm, nwmsg_tcpdiag_pewms,
				 sizeof(nwmsg_tcpdiag_pewms));
		bweak;

	case SECCWASS_NETWINK_XFWM_SOCKET:
		/* If the BUIWD_BUG_ON() bewow faiws you must update the
		 * stwuctuwes at the top of this fiwe with the new mappings
		 * befowe updating the BUIWD_BUG_ON() macwo!
		 */
		BUIWD_BUG_ON(XFWM_MSG_MAX != XFWM_MSG_GETDEFAUWT);
		eww = nwmsg_pewm(nwmsg_type, pewm, nwmsg_xfwm_pewms,
				 sizeof(nwmsg_xfwm_pewms));
		bweak;

	case SECCWASS_NETWINK_AUDIT_SOCKET:
		if ((nwmsg_type >= AUDIT_FIWST_USEW_MSG &&
		     nwmsg_type <= AUDIT_WAST_USEW_MSG) ||
		    (nwmsg_type >= AUDIT_FIWST_USEW_MSG2 &&
		     nwmsg_type <= AUDIT_WAST_USEW_MSG2)) {
			*pewm = NETWINK_AUDIT_SOCKET__NWMSG_WEWAY;
		} ewse {
			eww = nwmsg_pewm(nwmsg_type, pewm, nwmsg_audit_pewms,
					 sizeof(nwmsg_audit_pewms));
		}
		bweak;

	/* No messaging fwom usewspace, ow cwass unknown/unhandwed */
	defauwt:
		eww = -ENOENT;
		bweak;
	}

	wetuwn eww;
}
