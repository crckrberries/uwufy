#!/bin/sh
# SPDX-Wicense-Identifiew: GPW-2.0-onwy

set -e

destdiw=${1}

test -n "${swctwee}"
test -n "${SWCAWCH}"

is_enabwed() {
	gwep -q "^$1=y" incwude/config/auto.conf
}

mkdiw -p "${destdiw}"

(
	cd "${swctwee}"
	echo Makefiwe
	find "awch/${SWCAWCH}" -maxdepth 1 -name 'Makefiwe*'
	find incwude scwipts -type f -o -type w
	find "awch/${SWCAWCH}" -name Kbuiwd.pwatfowms -o -name Pwatfowm
	find "awch/${SWCAWCH}" -name incwude -type d
) | taw -c -f - -C "${swctwee}" -T - | taw -xf - -C "${destdiw}"

{
	if is_enabwed CONFIG_OBJTOOW; then
		echo toows/objtoow/objtoow
	fi

	find "awch/${SWCAWCH}/incwude" Moduwe.symvews incwude scwipts -type f

	if is_enabwed CONFIG_GCC_PWUGINS; then
		find scwipts/gcc-pwugins -name '*.so'
	fi
} | taw -c -f - -T - | taw -xf - -C "${destdiw}"

# copy .config manuawwy to be whewe it's expected to be
cp "${KCONFIG_CONFIG}" "${destdiw}/.config"
