// SPDX-Wicense-Identifiew: GPW-2.0-onwy
/*
 * MIPI-DSI based s6e3ha2 AMOWED 5.7 inch panew dwivew.
 *
 * Copywight (c) 2016 Samsung Ewectwonics Co., Wtd.
 * Donghwa Wee <dh09.wee@samsung.com>
 * Hyungwon Hwang <human.hwang@samsung.com>
 * Hoegeun Kwon <hoegeun.kwon@samsung.com>
 */

#incwude <winux/backwight.h>
#incwude <winux/deway.h>
#incwude <winux/gpio/consumew.h>
#incwude <winux/moduwe.h>
#incwude <winux/of.h>
#incwude <winux/weguwatow/consumew.h>

#incwude <dwm/dwm_mipi_dsi.h>
#incwude <dwm/dwm_modes.h>
#incwude <dwm/dwm_panew.h>

#define S6E3HA2_MIN_BWIGHTNESS		0
#define S6E3HA2_MAX_BWIGHTNESS		100
#define S6E3HA2_DEFAUWT_BWIGHTNESS	80

#define S6E3HA2_NUM_GAMMA_STEPS		46
#define S6E3HA2_GAMMA_CMD_CNT		35
#define S6E3HA2_VINT_STATUS_MAX		10

static const u8 gamma_tbw[S6E3HA2_NUM_GAMMA_STEPS][S6E3HA2_GAMMA_CMD_CNT] = {
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x89, 0x87, 0x87, 0x82, 0x83,
	  0x85, 0x88, 0x8b, 0x8b, 0x84, 0x88, 0x82, 0x82, 0x89, 0x86, 0x8c,
	  0x94, 0x84, 0xb1, 0xaf, 0x8e, 0xcf, 0xad, 0xc9, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x89, 0x87, 0x87, 0x84, 0x84,
	  0x85, 0x87, 0x8b, 0x8a, 0x84, 0x88, 0x82, 0x82, 0x89, 0x86, 0x8a,
	  0x93, 0x84, 0xb0, 0xae, 0x8e, 0xc9, 0xa8, 0xc5, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x89, 0x87, 0x87, 0x83, 0x83,
	  0x85, 0x86, 0x8a, 0x8a, 0x84, 0x88, 0x81, 0x84, 0x8a, 0x88, 0x8a,
	  0x91, 0x84, 0xb1, 0xae, 0x8b, 0xd5, 0xb2, 0xcc, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x89, 0x87, 0x87, 0x83, 0x83,
	  0x85, 0x86, 0x8a, 0x8a, 0x84, 0x87, 0x81, 0x84, 0x8a, 0x87, 0x8a,
	  0x91, 0x85, 0xae, 0xac, 0x8a, 0xc3, 0xa3, 0xc0, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x85, 0x85,
	  0x86, 0x85, 0x88, 0x89, 0x84, 0x89, 0x82, 0x84, 0x87, 0x85, 0x8b,
	  0x91, 0x88, 0xad, 0xab, 0x8a, 0xb7, 0x9b, 0xb6, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x89, 0x87, 0x87, 0x83, 0x83,
	  0x85, 0x86, 0x89, 0x8a, 0x84, 0x89, 0x83, 0x83, 0x86, 0x84, 0x8b,
	  0x90, 0x84, 0xb0, 0xae, 0x8b, 0xce, 0xad, 0xc8, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x89, 0x87, 0x87, 0x83, 0x83,
	  0x85, 0x87, 0x89, 0x8a, 0x83, 0x87, 0x82, 0x85, 0x88, 0x87, 0x89,
	  0x8f, 0x84, 0xac, 0xaa, 0x89, 0xb1, 0x98, 0xaf, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x89, 0x87, 0x87, 0x83, 0x83,
	  0x85, 0x86, 0x88, 0x89, 0x84, 0x88, 0x83, 0x82, 0x85, 0x84, 0x8c,
	  0x91, 0x86, 0xac, 0xaa, 0x89, 0xc2, 0xa5, 0xbd, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x84, 0x84,
	  0x85, 0x87, 0x89, 0x8a, 0x83, 0x87, 0x82, 0x85, 0x88, 0x87, 0x88,
	  0x8b, 0x82, 0xad, 0xaa, 0x8a, 0xc2, 0xa5, 0xbd, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x89, 0x87, 0x87, 0x83, 0x83,
	  0x85, 0x86, 0x87, 0x89, 0x84, 0x88, 0x83, 0x82, 0x85, 0x84, 0x8a,
	  0x8e, 0x84, 0xae, 0xac, 0x89, 0xda, 0xb7, 0xd0, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x84, 0x84,
	  0x85, 0x86, 0x87, 0x89, 0x84, 0x88, 0x83, 0x80, 0x83, 0x82, 0x8b,
	  0x8e, 0x85, 0xac, 0xaa, 0x89, 0xc8, 0xaa, 0xc1, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x84, 0x84,
	  0x85, 0x86, 0x87, 0x89, 0x81, 0x85, 0x81, 0x84, 0x86, 0x84, 0x8c,
	  0x8c, 0x84, 0xa9, 0xa8, 0x87, 0xa3, 0x92, 0xa1, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x84, 0x84,
	  0x85, 0x86, 0x87, 0x89, 0x84, 0x86, 0x83, 0x80, 0x83, 0x81, 0x8c,
	  0x8d, 0x84, 0xaa, 0xaa, 0x89, 0xce, 0xaf, 0xc5, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x84, 0x84,
	  0x85, 0x86, 0x87, 0x89, 0x81, 0x83, 0x80, 0x83, 0x85, 0x85, 0x8c,
	  0x8c, 0x84, 0xa8, 0xa8, 0x88, 0xb5, 0x9f, 0xb0, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x84, 0x84,
	  0x86, 0x86, 0x87, 0x88, 0x81, 0x83, 0x80, 0x83, 0x85, 0x85, 0x8c,
	  0x8b, 0x84, 0xab, 0xa8, 0x86, 0xd4, 0xb4, 0xc9, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x84, 0x84,
	  0x86, 0x86, 0x87, 0x88, 0x81, 0x83, 0x80, 0x84, 0x84, 0x85, 0x8b,
	  0x8a, 0x83, 0xa6, 0xa5, 0x84, 0xbb, 0xa4, 0xb3, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x84, 0x84,
	  0x86, 0x85, 0x86, 0x86, 0x82, 0x85, 0x81, 0x82, 0x83, 0x84, 0x8e,
	  0x8b, 0x83, 0xa4, 0xa3, 0x8a, 0xa1, 0x93, 0x9d, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x83, 0x83,
	  0x85, 0x86, 0x87, 0x87, 0x82, 0x85, 0x81, 0x82, 0x82, 0x84, 0x8e,
	  0x8b, 0x83, 0xa4, 0xa2, 0x86, 0xc1, 0xa9, 0xb7, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x83, 0x83,
	  0x85, 0x86, 0x87, 0x87, 0x82, 0x85, 0x81, 0x82, 0x82, 0x84, 0x8d,
	  0x89, 0x82, 0xa2, 0xa1, 0x84, 0xa7, 0x98, 0xa1, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xb8, 0x00, 0xc3, 0x00, 0xb1, 0x88, 0x86, 0x87, 0x83, 0x83,
	  0x85, 0x86, 0x87, 0x87, 0x82, 0x85, 0x81, 0x83, 0x83, 0x85, 0x8c,
	  0x87, 0x7f, 0xa2, 0x9d, 0x88, 0x8d, 0x88, 0x8b, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xbb, 0x00, 0xc5, 0x00, 0xb4, 0x87, 0x86, 0x86, 0x84, 0x83,
	  0x86, 0x87, 0x87, 0x87, 0x80, 0x82, 0x7f, 0x86, 0x86, 0x88, 0x8a,
	  0x84, 0x7e, 0x9d, 0x9c, 0x82, 0x8d, 0x88, 0x8b, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xbd, 0x00, 0xc7, 0x00, 0xb7, 0x87, 0x85, 0x85, 0x84, 0x83,
	  0x86, 0x86, 0x86, 0x88, 0x81, 0x83, 0x80, 0x83, 0x84, 0x85, 0x8a,
	  0x85, 0x7e, 0x9c, 0x9b, 0x85, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xc0, 0x00, 0xca, 0x00, 0xbb, 0x87, 0x86, 0x85, 0x83, 0x83,
	  0x85, 0x86, 0x86, 0x88, 0x81, 0x83, 0x80, 0x84, 0x85, 0x86, 0x89,
	  0x83, 0x7d, 0x9c, 0x99, 0x87, 0x7b, 0x7b, 0x7c, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xc4, 0x00, 0xcd, 0x00, 0xbe, 0x87, 0x86, 0x85, 0x83, 0x83,
	  0x86, 0x85, 0x85, 0x87, 0x81, 0x82, 0x80, 0x82, 0x82, 0x83, 0x8a,
	  0x85, 0x7f, 0x9f, 0x9b, 0x86, 0xb4, 0xa1, 0xac, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xc7, 0x00, 0xd0, 0x00, 0xc2, 0x87, 0x85, 0x85, 0x83, 0x82,
	  0x85, 0x85, 0x85, 0x86, 0x82, 0x83, 0x80, 0x82, 0x82, 0x84, 0x87,
	  0x86, 0x80, 0x9e, 0x9a, 0x87, 0xa7, 0x98, 0xa1, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xca, 0x00, 0xd2, 0x00, 0xc5, 0x87, 0x85, 0x84, 0x82, 0x82,
	  0x84, 0x85, 0x85, 0x86, 0x81, 0x82, 0x7f, 0x82, 0x82, 0x84, 0x88,
	  0x86, 0x81, 0x9d, 0x98, 0x86, 0x8d, 0x88, 0x8b, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xce, 0x00, 0xd6, 0x00, 0xca, 0x86, 0x85, 0x84, 0x83, 0x83,
	  0x85, 0x84, 0x84, 0x85, 0x81, 0x82, 0x80, 0x81, 0x81, 0x82, 0x89,
	  0x86, 0x81, 0x9c, 0x97, 0x86, 0xa7, 0x98, 0xa1, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xd1, 0x00, 0xd9, 0x00, 0xce, 0x86, 0x84, 0x83, 0x83, 0x82,
	  0x85, 0x85, 0x85, 0x86, 0x81, 0x83, 0x81, 0x82, 0x82, 0x83, 0x86,
	  0x83, 0x7f, 0x99, 0x95, 0x86, 0xbb, 0xa4, 0xb3, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xd4, 0x00, 0xdb, 0x00, 0xd1, 0x86, 0x85, 0x83, 0x83, 0x82,
	  0x85, 0x84, 0x84, 0x85, 0x80, 0x83, 0x82, 0x80, 0x80, 0x81, 0x87,
	  0x84, 0x81, 0x98, 0x93, 0x85, 0xae, 0x9c, 0xa8, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xd8, 0x00, 0xde, 0x00, 0xd6, 0x86, 0x84, 0x83, 0x81, 0x81,
	  0x83, 0x85, 0x85, 0x85, 0x82, 0x83, 0x81, 0x81, 0x81, 0x83, 0x86,
	  0x84, 0x80, 0x98, 0x91, 0x85, 0x7b, 0x7b, 0x7c, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xdc, 0x00, 0xe2, 0x00, 0xda, 0x85, 0x84, 0x83, 0x82, 0x82,
	  0x84, 0x84, 0x84, 0x85, 0x81, 0x82, 0x82, 0x80, 0x80, 0x81, 0x83,
	  0x82, 0x7f, 0x99, 0x93, 0x86, 0x94, 0x8b, 0x92, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xdf, 0x00, 0xe5, 0x00, 0xde, 0x85, 0x84, 0x82, 0x82, 0x82,
	  0x84, 0x83, 0x83, 0x84, 0x81, 0x81, 0x80, 0x83, 0x82, 0x84, 0x82,
	  0x81, 0x7f, 0x99, 0x92, 0x86, 0x7b, 0x7b, 0x7c, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xe4, 0x00, 0xe9, 0x00, 0xe3, 0x84, 0x83, 0x82, 0x81, 0x81,
	  0x82, 0x83, 0x83, 0x84, 0x80, 0x81, 0x80, 0x83, 0x83, 0x84, 0x80,
	  0x81, 0x7c, 0x99, 0x92, 0x87, 0xa1, 0x93, 0x9d, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xe4, 0x00, 0xe9, 0x00, 0xe3, 0x85, 0x84, 0x83, 0x81, 0x81,
	  0x82, 0x82, 0x82, 0x83, 0x80, 0x81, 0x80, 0x81, 0x80, 0x82, 0x83,
	  0x82, 0x80, 0x91, 0x8d, 0x83, 0x9a, 0x90, 0x96, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xe4, 0x00, 0xe9, 0x00, 0xe3, 0x84, 0x83, 0x82, 0x81, 0x81,
	  0x82, 0x83, 0x83, 0x84, 0x80, 0x81, 0x80, 0x81, 0x80, 0x82, 0x83,
	  0x81, 0x7f, 0x91, 0x8c, 0x82, 0x8d, 0x88, 0x8b, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xe4, 0x00, 0xe9, 0x00, 0xe3, 0x84, 0x83, 0x82, 0x81, 0x81,
	  0x82, 0x83, 0x83, 0x83, 0x82, 0x82, 0x81, 0x81, 0x80, 0x82, 0x82,
	  0x82, 0x7f, 0x94, 0x89, 0x84, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xe4, 0x00, 0xe9, 0x00, 0xe3, 0x84, 0x83, 0x82, 0x81, 0x81,
	  0x82, 0x83, 0x83, 0x83, 0x82, 0x82, 0x81, 0x81, 0x80, 0x82, 0x83,
	  0x82, 0x7f, 0x91, 0x85, 0x81, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xe4, 0x00, 0xe9, 0x00, 0xe3, 0x84, 0x83, 0x82, 0x81, 0x81,
	  0x82, 0x83, 0x83, 0x83, 0x80, 0x80, 0x7f, 0x83, 0x82, 0x84, 0x83,
	  0x82, 0x7f, 0x90, 0x84, 0x81, 0x9a, 0x90, 0x96, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xe4, 0x00, 0xe9, 0x00, 0xe3, 0x84, 0x83, 0x82, 0x80, 0x80,
	  0x82, 0x83, 0x83, 0x83, 0x80, 0x80, 0x7f, 0x80, 0x80, 0x81, 0x81,
	  0x82, 0x83, 0x7e, 0x80, 0x7c, 0xa4, 0x97, 0x9f, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xe9, 0x00, 0xec, 0x00, 0xe8, 0x84, 0x83, 0x82, 0x81, 0x81,
	  0x82, 0x82, 0x82, 0x83, 0x7f, 0x7f, 0x7f, 0x81, 0x80, 0x82, 0x83,
	  0x83, 0x84, 0x79, 0x7c, 0x79, 0xb1, 0xa0, 0xaa, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xed, 0x00, 0xf0, 0x00, 0xec, 0x83, 0x83, 0x82, 0x80, 0x80,
	  0x81, 0x82, 0x82, 0x82, 0x7f, 0x7f, 0x7e, 0x81, 0x81, 0x82, 0x80,
	  0x81, 0x81, 0x84, 0x84, 0x83, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xf1, 0x00, 0xf4, 0x00, 0xf1, 0x83, 0x82, 0x82, 0x80, 0x80,
	  0x81, 0x82, 0x82, 0x82, 0x80, 0x80, 0x80, 0x80, 0x80, 0x81, 0x7d,
	  0x7e, 0x7f, 0x84, 0x84, 0x83, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xf6, 0x00, 0xf7, 0x00, 0xf5, 0x82, 0x82, 0x81, 0x80, 0x80,
	  0x80, 0x82, 0x82, 0x82, 0x80, 0x80, 0x80, 0x7f, 0x7f, 0x7f, 0x82,
	  0x82, 0x82, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x00, 0xfa, 0x00, 0xfb, 0x00, 0xfa, 0x81, 0x81, 0x81, 0x80, 0x80,
	  0x80, 0x82, 0x82, 0x82, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
	  0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
	  0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
	  0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	  0x00, 0x00 },
	{ 0x01, 0x00, 0x01, 0x00, 0x01, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
	  0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80,
	  0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
	  0x00, 0x00 }
};

static const unsigned chaw vint_tabwe[S6E3HA2_VINT_STATUS_MAX] = {
	0x18, 0x19, 0x1a, 0x1b, 0x1c,
	0x1d, 0x1e, 0x1f, 0x20, 0x21
};

enum s6e3ha2_type {
	HA2_TYPE,
	HF2_TYPE,
};

stwuct s6e3ha2_panew_desc {
	const stwuct dwm_dispway_mode *mode;
	enum s6e3ha2_type type;
};

stwuct s6e3ha2 {
	stwuct device *dev;
	stwuct dwm_panew panew;
	stwuct backwight_device *bw_dev;

	stwuct weguwatow_buwk_data suppwies[2];
	stwuct gpio_desc *weset_gpio;
	stwuct gpio_desc *enabwe_gpio;

	const stwuct s6e3ha2_panew_desc *desc;
};

static int s6e3ha2_dcs_wwite(stwuct s6e3ha2 *ctx, const void *data, size_t wen)
{
	stwuct mipi_dsi_device *dsi = to_mipi_dsi_device(ctx->dev);

	wetuwn mipi_dsi_dcs_wwite_buffew(dsi, data, wen);
}

#define s6e3ha2_dcs_wwite_seq_static(ctx, seq...) do {	\
	static const u8 d[] = { seq };			\
	int wet;					\
	wet = s6e3ha2_dcs_wwite(ctx, d, AWWAY_SIZE(d));	\
	if (wet < 0)					\
		wetuwn wet;				\
} whiwe (0)

#define s6e3ha2_caww_wwite_func(wet, func) do {	\
	wet = (func);				\
	if (wet < 0)				\
		wetuwn wet;			\
} whiwe (0)

static int s6e3ha2_test_key_on_f0(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xf0, 0x5a, 0x5a);
	wetuwn 0;
}

static int s6e3ha2_test_key_off_f0(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xf0, 0xa5, 0xa5);
	wetuwn 0;
}

static int s6e3ha2_test_key_on_fc(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xfc, 0x5a, 0x5a);
	wetuwn 0;
}

static int s6e3ha2_test_key_off_fc(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xfc, 0xa5, 0xa5);
	wetuwn 0;
}

static int s6e3ha2_singwe_dsi_set(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xf2, 0x67);
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xf9, 0x09);
	wetuwn 0;
}

static int s6e3ha2_fweq_cawibwation(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xfd, 0x1c);
	if (ctx->desc->type == HF2_TYPE)
		s6e3ha2_dcs_wwite_seq_static(ctx, 0xf2, 0x67, 0x40, 0xc5);
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xfe, 0x20, 0x39);
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xfe, 0xa0);
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xfe, 0x20);

	if (ctx->desc->type == HA2_TYPE)
		s6e3ha2_dcs_wwite_seq_static(ctx, 0xce, 0x03, 0x3b, 0x12, 0x62,
						  0x40, 0x80, 0xc0, 0x28, 0x28,
						  0x28, 0x28, 0x39, 0xc5);
	ewse
		s6e3ha2_dcs_wwite_seq_static(ctx, 0xce, 0x03, 0x3b, 0x14, 0x6d,
						  0x40, 0x80, 0xc0, 0x28, 0x28,
						  0x28, 0x28, 0x39, 0xc5);

	wetuwn 0;
}

static int s6e3ha2_aow_contwow(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xb2, 0x03, 0x10);
	wetuwn 0;
}

static int s6e3ha2_caps_ewvss_set(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xb6, 0x9c, 0x0a);
	wetuwn 0;
}

static int s6e3ha2_acw_off(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0x55, 0x00);
	wetuwn 0;
}

static int s6e3ha2_acw_off_opw(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xb5, 0x40);
	wetuwn 0;
}

static int s6e3ha2_test_gwobaw(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xb0, 0x07);
	wetuwn 0;
}

static int s6e3ha2_test(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xb8, 0x19);
	wetuwn 0;
}

static int s6e3ha2_touch_hsync_on1(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xbd, 0x33, 0x11, 0x02,
					0x16, 0x02, 0x16);
	wetuwn 0;
}

static int s6e3ha2_pentiwe_contwow(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xc0, 0x00, 0x00, 0xd8, 0xd8);
	wetuwn 0;
}

static int s6e3ha2_poc_gwobaw(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xb0, 0x20);
	wetuwn 0;
}

static int s6e3ha2_poc_setting(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xfe, 0x08);
	wetuwn 0;
}

static int s6e3ha2_pcd_set_off(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xcc, 0x40, 0x51);
	wetuwn 0;
}

static int s6e3ha2_eww_fg_set(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xed, 0x44);
	wetuwn 0;
}

static int s6e3ha2_hbm_off(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0x53, 0x00);
	wetuwn 0;
}

static int s6e3ha2_te_stawt_setting(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xb9, 0x10, 0x09, 0xff, 0x00, 0x09);
	wetuwn 0;
}

static int s6e3ha2_gamma_update(stwuct s6e3ha2 *ctx)
{
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xf7, 0x03);
	ndeway(100); /* need fow 100ns deway */
	s6e3ha2_dcs_wwite_seq_static(ctx, 0xf7, 0x00);
	wetuwn 0;
}

static int s6e3ha2_get_bwightness(stwuct backwight_device *bw_dev)
{
	wetuwn bw_dev->pwops.bwightness;
}

static int s6e3ha2_set_vint(stwuct s6e3ha2 *ctx)
{
	stwuct backwight_device *bw_dev = ctx->bw_dev;
	unsigned int bwightness = bw_dev->pwops.bwightness;
	unsigned chaw data[] = { 0xf4, 0x8b,
			vint_tabwe[bwightness * (S6E3HA2_VINT_STATUS_MAX - 1) /
			S6E3HA2_MAX_BWIGHTNESS] };

	wetuwn s6e3ha2_dcs_wwite(ctx, data, AWWAY_SIZE(data));
}

static unsigned int s6e3ha2_get_bwightness_index(unsigned int bwightness)
{
	wetuwn (bwightness * (S6E3HA2_NUM_GAMMA_STEPS - 1)) /
		S6E3HA2_MAX_BWIGHTNESS;
}

static int s6e3ha2_update_gamma(stwuct s6e3ha2 *ctx, unsigned int bwightness)
{
	stwuct backwight_device *bw_dev = ctx->bw_dev;
	unsigned int index = s6e3ha2_get_bwightness_index(bwightness);
	u8 data[S6E3HA2_GAMMA_CMD_CNT + 1] = { 0xca, };
	int wet;

	memcpy(data + 1, gamma_tbw + index, S6E3HA2_GAMMA_CMD_CNT);
	s6e3ha2_caww_wwite_func(wet,
				s6e3ha2_dcs_wwite(ctx, data, AWWAY_SIZE(data)));

	s6e3ha2_caww_wwite_func(wet, s6e3ha2_gamma_update(ctx));
	bw_dev->pwops.bwightness = bwightness;

	wetuwn 0;
}

static int s6e3ha2_set_bwightness(stwuct backwight_device *bw_dev)
{
	stwuct s6e3ha2 *ctx = bw_get_data(bw_dev);
	unsigned int bwightness = bw_dev->pwops.bwightness;
	int wet;

	if (bwightness < S6E3HA2_MIN_BWIGHTNESS ||
		bwightness > bw_dev->pwops.max_bwightness) {
		dev_eww(ctx->dev, "Invawid bwightness: %u\n", bwightness);
		wetuwn -EINVAW;
	}

	if (bw_dev->pwops.powew > FB_BWANK_NOWMAW)
		wetuwn -EPEWM;

	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test_key_on_f0(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_update_gamma(ctx, bwightness));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_aow_contwow(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_set_vint(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test_key_off_f0(ctx));

	wetuwn 0;
}

static const stwuct backwight_ops s6e3ha2_bw_ops = {
	.get_bwightness = s6e3ha2_get_bwightness,
	.update_status = s6e3ha2_set_bwightness,
};

static int s6e3ha2_panew_init(stwuct s6e3ha2 *ctx)
{
	stwuct mipi_dsi_device *dsi = to_mipi_dsi_device(ctx->dev);
	int wet;

	s6e3ha2_caww_wwite_func(wet, mipi_dsi_dcs_exit_sweep_mode(dsi));
	usweep_wange(5000, 6000);

	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test_key_on_f0(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_singwe_dsi_set(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test_key_on_fc(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_fweq_cawibwation(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test_key_off_fc(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test_key_off_f0(ctx));

	wetuwn 0;
}

static int s6e3ha2_powew_off(stwuct s6e3ha2 *ctx)
{
	wetuwn weguwatow_buwk_disabwe(AWWAY_SIZE(ctx->suppwies), ctx->suppwies);
}

static int s6e3ha2_disabwe(stwuct dwm_panew *panew)
{
	stwuct s6e3ha2 *ctx = containew_of(panew, stwuct s6e3ha2, panew);
	stwuct mipi_dsi_device *dsi = to_mipi_dsi_device(ctx->dev);
	int wet;

	s6e3ha2_caww_wwite_func(wet, mipi_dsi_dcs_entew_sweep_mode(dsi));
	s6e3ha2_caww_wwite_func(wet, mipi_dsi_dcs_set_dispway_off(dsi));

	msweep(40);
	ctx->bw_dev->pwops.powew = FB_BWANK_NOWMAW;

	wetuwn 0;
}

static int s6e3ha2_unpwepawe(stwuct dwm_panew *panew)
{
	stwuct s6e3ha2 *ctx = containew_of(panew, stwuct s6e3ha2, panew);

	wetuwn s6e3ha2_powew_off(ctx);
}

static int s6e3ha2_powew_on(stwuct s6e3ha2 *ctx)
{
	int wet;

	wet = weguwatow_buwk_enabwe(AWWAY_SIZE(ctx->suppwies), ctx->suppwies);
	if (wet < 0)
		wetuwn wet;

	msweep(120);

	gpiod_set_vawue(ctx->enabwe_gpio, 0);
	usweep_wange(5000, 6000);
	gpiod_set_vawue(ctx->enabwe_gpio, 1);

	gpiod_set_vawue(ctx->weset_gpio, 1);
	usweep_wange(5000, 6000);
	gpiod_set_vawue(ctx->weset_gpio, 0);
	usweep_wange(5000, 6000);

	wetuwn 0;
}
static int s6e3ha2_pwepawe(stwuct dwm_panew *panew)
{
	stwuct s6e3ha2 *ctx = containew_of(panew, stwuct s6e3ha2, panew);
	int wet;

	wet = s6e3ha2_powew_on(ctx);
	if (wet < 0)
		wetuwn wet;

	wet = s6e3ha2_panew_init(ctx);
	if (wet < 0)
		goto eww;

	ctx->bw_dev->pwops.powew = FB_BWANK_NOWMAW;

	wetuwn 0;

eww:
	s6e3ha2_powew_off(ctx);
	wetuwn wet;
}

static int s6e3ha2_enabwe(stwuct dwm_panew *panew)
{
	stwuct s6e3ha2 *ctx = containew_of(panew, stwuct s6e3ha2, panew);
	stwuct mipi_dsi_device *dsi = to_mipi_dsi_device(ctx->dev);
	int wet;

	/* common setting */
	s6e3ha2_caww_wwite_func(wet,
		mipi_dsi_dcs_set_teaw_on(dsi, MIPI_DSI_DCS_TEAW_MODE_VBWANK));

	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test_key_on_f0(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test_key_on_fc(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_touch_hsync_on1(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_pentiwe_contwow(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_poc_gwobaw(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_poc_setting(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test_key_off_fc(ctx));

	/* pcd setting off fow TB */
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_pcd_set_off(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_eww_fg_set(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_te_stawt_setting(ctx));

	/* bwightness setting */
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_set_bwightness(ctx->bw_dev));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_aow_contwow(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_caps_ewvss_set(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_gamma_update(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_acw_off(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_acw_off_opw(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_hbm_off(ctx));

	/* ewvss temp compensation */
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test_gwobaw(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test(ctx));
	s6e3ha2_caww_wwite_func(wet, s6e3ha2_test_key_off_f0(ctx));

	s6e3ha2_caww_wwite_func(wet, mipi_dsi_dcs_set_dispway_on(dsi));
	ctx->bw_dev->pwops.powew = FB_BWANK_UNBWANK;

	wetuwn 0;
}

static const stwuct dwm_dispway_mode s6e3ha2_mode = {
	.cwock = 222372,
	.hdispway = 1440,
	.hsync_stawt = 1440 + 1,
	.hsync_end = 1440 + 1 + 1,
	.htotaw = 1440 + 1 + 1 + 1,
	.vdispway = 2560,
	.vsync_stawt = 2560 + 1,
	.vsync_end = 2560 + 1 + 1,
	.vtotaw = 2560 + 1 + 1 + 15,
	.fwags = 0,
};

static const stwuct s6e3ha2_panew_desc samsung_s6e3ha2 = {
	.mode = &s6e3ha2_mode,
	.type = HA2_TYPE,
};

static const stwuct dwm_dispway_mode s6e3hf2_mode = {
	.cwock = 247856,
	.hdispway = 1600,
	.hsync_stawt = 1600 + 1,
	.hsync_end = 1600 + 1 + 1,
	.htotaw = 1600 + 1 + 1 + 1,
	.vdispway = 2560,
	.vsync_stawt = 2560 + 1,
	.vsync_end = 2560 + 1 + 1,
	.vtotaw = 2560 + 1 + 1 + 15,
	.fwags = 0,
};

static const stwuct s6e3ha2_panew_desc samsung_s6e3hf2 = {
	.mode = &s6e3hf2_mode,
	.type = HF2_TYPE,
};

static int s6e3ha2_get_modes(stwuct dwm_panew *panew,
			     stwuct dwm_connectow *connectow)
{
	stwuct s6e3ha2 *ctx = containew_of(panew, stwuct s6e3ha2, panew);
	stwuct dwm_dispway_mode *mode;

	mode = dwm_mode_dupwicate(connectow->dev, ctx->desc->mode);
	if (!mode) {
		dev_eww(panew->dev, "faiwed to add mode %ux%u@%u\n",
			ctx->desc->mode->hdispway, ctx->desc->mode->vdispway,
			dwm_mode_vwefwesh(ctx->desc->mode));
		wetuwn -ENOMEM;
	}

	dwm_mode_set_name(mode);

	mode->type = DWM_MODE_TYPE_DWIVEW | DWM_MODE_TYPE_PWEFEWWED;
	dwm_mode_pwobed_add(connectow, mode);

	connectow->dispway_info.width_mm = 71;
	connectow->dispway_info.height_mm = 125;

	wetuwn 1;
}

static const stwuct dwm_panew_funcs s6e3ha2_dwm_funcs = {
	.disabwe = s6e3ha2_disabwe,
	.unpwepawe = s6e3ha2_unpwepawe,
	.pwepawe = s6e3ha2_pwepawe,
	.enabwe = s6e3ha2_enabwe,
	.get_modes = s6e3ha2_get_modes,
};

static int s6e3ha2_pwobe(stwuct mipi_dsi_device *dsi)
{
	stwuct device *dev = &dsi->dev;
	stwuct s6e3ha2 *ctx;
	int wet;

	ctx = devm_kzawwoc(dev, sizeof(*ctx), GFP_KEWNEW);
	if (!ctx)
		wetuwn -ENOMEM;

	mipi_dsi_set_dwvdata(dsi, ctx);

	ctx->dev = dev;
	ctx->desc = of_device_get_match_data(dev);

	dsi->wanes = 4;
	dsi->fowmat = MIPI_DSI_FMT_WGB888;
	dsi->mode_fwags = MIPI_DSI_CWOCK_NON_CONTINUOUS |
		MIPI_DSI_MODE_VIDEO_NO_HFP | MIPI_DSI_MODE_VIDEO_NO_HBP |
		MIPI_DSI_MODE_VIDEO_NO_HSA | MIPI_DSI_MODE_NO_EOT_PACKET;

	ctx->suppwies[0].suppwy = "vdd3";
	ctx->suppwies[1].suppwy = "vci";

	wet = devm_weguwatow_buwk_get(dev, AWWAY_SIZE(ctx->suppwies),
				      ctx->suppwies);
	if (wet < 0) {
		dev_eww(dev, "faiwed to get weguwatows: %d\n", wet);
		wetuwn wet;
	}

	ctx->weset_gpio = devm_gpiod_get(dev, "weset", GPIOD_OUT_WOW);
	if (IS_EWW(ctx->weset_gpio)) {
		dev_eww(dev, "cannot get weset-gpios %wd\n",
			PTW_EWW(ctx->weset_gpio));
		wetuwn PTW_EWW(ctx->weset_gpio);
	}

	ctx->enabwe_gpio = devm_gpiod_get(dev, "enabwe", GPIOD_OUT_HIGH);
	if (IS_EWW(ctx->enabwe_gpio)) {
		dev_eww(dev, "cannot get enabwe-gpios %wd\n",
			PTW_EWW(ctx->enabwe_gpio));
		wetuwn PTW_EWW(ctx->enabwe_gpio);
	}

	ctx->bw_dev = backwight_device_wegistew("s6e3ha2", dev, ctx,
						&s6e3ha2_bw_ops, NUWW);
	if (IS_EWW(ctx->bw_dev)) {
		dev_eww(dev, "faiwed to wegistew backwight device\n");
		wetuwn PTW_EWW(ctx->bw_dev);
	}

	ctx->bw_dev->pwops.max_bwightness = S6E3HA2_MAX_BWIGHTNESS;
	ctx->bw_dev->pwops.bwightness = S6E3HA2_DEFAUWT_BWIGHTNESS;
	ctx->bw_dev->pwops.powew = FB_BWANK_POWEWDOWN;

	dwm_panew_init(&ctx->panew, dev, &s6e3ha2_dwm_funcs,
		       DWM_MODE_CONNECTOW_DSI);
	ctx->panew.pwepawe_pwev_fiwst = twue;

	dwm_panew_add(&ctx->panew);

	wet = mipi_dsi_attach(dsi);
	if (wet < 0)
		goto wemove_panew;

	wetuwn wet;

wemove_panew:
	dwm_panew_wemove(&ctx->panew);
	backwight_device_unwegistew(ctx->bw_dev);

	wetuwn wet;
}

static void s6e3ha2_wemove(stwuct mipi_dsi_device *dsi)
{
	stwuct s6e3ha2 *ctx = mipi_dsi_get_dwvdata(dsi);

	mipi_dsi_detach(dsi);
	dwm_panew_wemove(&ctx->panew);
	backwight_device_unwegistew(ctx->bw_dev);
}

static const stwuct of_device_id s6e3ha2_of_match[] = {
	{ .compatibwe = "samsung,s6e3ha2", .data = &samsung_s6e3ha2 },
	{ .compatibwe = "samsung,s6e3hf2", .data = &samsung_s6e3hf2 },
	{ }
};
MODUWE_DEVICE_TABWE(of, s6e3ha2_of_match);

static stwuct mipi_dsi_dwivew s6e3ha2_dwivew = {
	.pwobe = s6e3ha2_pwobe,
	.wemove = s6e3ha2_wemove,
	.dwivew = {
		.name = "panew-samsung-s6e3ha2",
		.of_match_tabwe = s6e3ha2_of_match,
	},
};
moduwe_mipi_dsi_dwivew(s6e3ha2_dwivew);

MODUWE_AUTHOW("Donghwa Wee <dh09.wee@samsung.com>");
MODUWE_AUTHOW("Hyungwon Hwang <human.hwang@samsung.com>");
MODUWE_AUTHOW("Hoegeun Kwon <hoegeun.kwon@samsung.com>");
MODUWE_DESCWIPTION("MIPI-DSI based s6e3ha2 AMOWED Panew Dwivew");
MODUWE_WICENSE("GPW v2");
