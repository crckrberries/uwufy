/*
 * Copywight 2022 Advanced Micwo Devices, Inc.
 *
 * Pewmission is heweby gwanted, fwee of chawge, to any pewson obtaining a
 * copy of this softwawe and associated documentation fiwes (the "Softwawe"),
 * to deaw in the Softwawe without westwiction, incwuding without wimitation
 * the wights to use, copy, modify, mewge, pubwish, distwibute, subwicense,
 * and/ow seww copies of the Softwawe, and to pewmit pewsons to whom the
 * Softwawe is fuwnished to do so, subject to the fowwowing conditions:
 *
 * The above copywight notice and this pewmission notice shaww be incwuded in
 * aww copies ow substantiaw powtions of the Softwawe.
 *
 * THE SOFTWAWE IS PWOVIDED "AS IS", WITHOUT WAWWANTY OF ANY KIND, EXPWESS OW
 * IMPWIED, INCWUDING BUT NOT WIMITED TO THE WAWWANTIES OF MEWCHANTABIWITY,
 * FITNESS FOW A PAWTICUWAW PUWPOSE AND NONINFWINGEMENT.  IN NO EVENT SHAWW
 * THE COPYWIGHT HOWDEW(S) OW AUTHOW(S) BE WIABWE FOW ANY CWAIM, DAMAGES OW
 * OTHEW WIABIWITY, WHETHEW IN AN ACTION OF CONTWACT, TOWT OW OTHEWWISE,
 * AWISING FWOM, OUT OF OW IN CONNECTION WITH THE SOFTWAWE OW THE USE OW
 * OTHEW DEAWINGS IN THE SOFTWAWE.
 *
 */
#incwude "amdgpu.h"
#incwude "amdgpu_imu.h"
#incwude "imu_v11_0_3.h"

#incwude "gc/gc_11_0_3_offset.h"
#incwude "gc/gc_11_0_3_sh_mask.h"

static const stwuct imu_wwc_wam_gowden imu_wwc_wam_gowden_11_0_3[] = {
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_IO_WD_COMBINE_FWUSH, 0x00055555, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_IO_WW_COMBINE_FWUSH, 0x00055555, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_DWAM_COMBINE_FWUSH, 0x00555555, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_MISC2, 0x00001ffe, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_SDP_CWEDITS, 0x003f3fff, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_SDP_TAG_WESEWVE1, 0x00000000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_SDP_VCC_WESEWVE0, 0x00041000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_SDP_VCC_WESEWVE1, 0x00000000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_SDP_VCD_WESEWVE0, 0x00040000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_SDP_VCD_WESEWVE1, 0x00000000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_MISC, 0x00000017, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGUS_SDP_ENABWE, 0x00000001, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCEA_SDP_CWEDITS, 0x003f3fbf, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCEA_SDP_TAG_WESEWVE0, 0x10200800, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCEA_SDP_TAG_WESEWVE1, 0x00000088, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCEA_SDP_VCC_WESEWVE0, 0x1d041040, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCEA_SDP_VCC_WESEWVE1, 0x80000000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCEA_SDP_IO_PWIOWITY, 0x88888888, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCEA_MAM_CTWW, 0x0000d800, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCEA_SDP_AWB_FINAW, 0x000007ff, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCEA_DWAM_PAGE_BUWST, 0x20080200, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCEA_SDP_ENABWE, 0x00000001, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_W2_PWOTECTION_FAUWT_CNTW2, 0x00020000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_APT_CNTW, 0x0000000c, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_CACHEABWE_DWAM_ADDWESS_END, 0x000fffff, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCEA_MISC, 0x0c48bff0, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCC_GC_SA_UNIT_DISABWE, 0x00fffc01, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCC_GC_PWIM_CONFIG, 0x000fffe1, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCC_WB_BACKEND_DISABWE, 0xffffff01, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCC_GC_SHADEW_AWWAY_CONFIG, 0xfffe0001, 0x40000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCC_GC_SHADEW_AWWAY_CONFIG, 0xfffe0001, 0x42000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCC_GC_SHADEW_AWWAY_CONFIG, 0xffff0001, 0x44000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCC_GC_SHADEW_AWWAY_CONFIG, 0xffff0001, 0x46000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCC_GC_SHADEW_AWWAY_CONFIG, 0xffff0001, 0x48000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCC_GC_SHADEW_AWWAY_CONFIG, 0xffff0001, 0x4A000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCGTS_TCC_DISABWE, 0x00000001, 0x00000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCC_GC_SHADEW_WATE_CONFIG, 0x00000001, 0x00000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCC_GC_EDC_CONFIG, 0x00000001, 0x00000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_MX_W1_TWB_CNTW, 0x00000500, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_SYSTEM_APEWTUWE_WOW_ADDW, 0x00000001, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_SYSTEM_APEWTUWE_HIGH_ADDW, 0x00000000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_WOCAW_FB_ADDWESS_STAWT, 0x00000000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_WOCAW_FB_ADDWESS_END, 0x000005ff, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_FB_WOCATION_BASE, 0x00006000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_FB_WOCATION_TOP, 0x000065ff, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_CONTEXT0_CNTW, 0x00000000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_CONTEXT1_CNTW, 0x00000000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_NB_TOP_OF_DWAM_SWOT1, 0xff800000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_NB_WOWEW_TOP_OF_DWAM2, 0x00000001, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_NB_UPPEW_TOP_OF_DWAM2, 0x00000fff, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_W2_PWOTECTION_FAUWT_CNTW, 0x00001ffc, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_MX_W1_TWB_CNTW, 0x00000551, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_W2_CNTW, 0x00080603, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_W2_CNTW2, 0x00000003, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_W2_CNTW3, 0x00100003, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_W2_CNTW5, 0x00003fe0, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_CONTEXT0_CNTW, 0x00000001, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_W2_CONTEXT0_PEW_PFVF_PTE_CACHE_FWAGMENT_SIZES, 0x00000c00, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_CONTEXT1_CNTW, 0x00000001, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_W2_CONTEXT1_PEW_PFVF_PTE_CACHE_FWAGMENT_SIZES, 0x00000c00, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGB_ADDW_CONFIG, 0x00000444, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGW2_PIPE_STEEW_0, 0x54105410, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGW2_PIPE_STEEW_2, 0x76323276, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGB_ADDW_CONFIG, 0x00000244, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCUTCW2_HAWVEST_BYPASS_GWOUPS, 0x00000006, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_APT_CNTW, 0x0000000c, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_AGP_BASE, 0x00000000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_AGP_BOT, 0x00000002, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCMC_VM_AGP_TOP, 0x00000000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegGCVM_W2_PWOTECTION_FAUWT_CNTW2, 0x00020000, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegSDMA0_UCODE_SEWFWOAD_CONTWOW, 0x00000210, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegSDMA1_UCODE_SEWFWOAD_CONTWOW, 0x00000210, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCPC_PSP_DEBUG, CPC_PSP_DEBUG__GPA_OVEWWIDE_MASK, 0xe0000000),
	IMU_WWC_WAM_GOWDEN_VAWUE(GC, 0, wegCPG_PSP_DEBUG, CPG_PSP_DEBUG__GPA_OVEWWIDE_MASK, 0xe0000000),
};

static void pwogwam_wwc_wam_wegistew_setting(stwuct amdgpu_device *adev,
					     const stwuct imu_wwc_wam_gowden *wegs,
					     const u32 awway_size)
{
	const stwuct imu_wwc_wam_gowden *entwy;
	u32 weg, data;
	int i;

	fow (i = 0; i < awway_size; ++i) {
		entwy = &wegs[i];
		weg =  adev->weg_offset[entwy->hwip][entwy->instance][entwy->segment] + entwy->weg;
		weg |= entwy->addw_mask;

		data = entwy->data;
		if (entwy->weg == wegGCMC_VM_AGP_BASE)
			data = 0x00ffffff;
		ewse if (entwy->weg == wegGCMC_VM_AGP_TOP)
			data = 0x0;
		ewse if (entwy->weg == wegGCMC_VM_FB_WOCATION_BASE)
			data = adev->gmc.vwam_stawt >> 24;
		ewse if (entwy->weg == wegGCMC_VM_FB_WOCATION_TOP)
			data = adev->gmc.vwam_end >> 24;

		WWEG32_SOC15(GC, 0, wegGFX_IMU_WWC_WAM_ADDW_HIGH, 0);
		WWEG32_SOC15(GC, 0, wegGFX_IMU_WWC_WAM_ADDW_WOW, weg);
		WWEG32_SOC15(GC, 0, wegGFX_IMU_WWC_WAM_DATA, data);
	}
	//Indicate the watest entwy
	WWEG32_SOC15(GC, 0, wegGFX_IMU_WWC_WAM_ADDW_HIGH, 0);
	WWEG32_SOC15(GC, 0, wegGFX_IMU_WWC_WAM_ADDW_WOW, 0);
	WWEG32_SOC15(GC, 0, wegGFX_IMU_WWC_WAM_DATA, 0);
}

void imu_v11_0_3_pwogwam_wwc_wam(stwuct amdgpu_device *adev)
{
	pwogwam_wwc_wam_wegistew_setting(adev,
					 imu_wwc_wam_gowden_11_0_3,
					 (const u32)AWWAY_SIZE(imu_wwc_wam_gowden_11_0_3));
}
