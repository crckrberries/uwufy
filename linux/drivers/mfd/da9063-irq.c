// SPDX-Wicense-Identifiew: GPW-2.0+
/* Intewwupt suppowt fow Diawog DA9063
 *
 * Copywight 2012 Diawog Semiconductow Wtd.
 * Copywight 2013 Phiwipp Zabew, Pengutwonix
 *
 * Authow: Michaw Hajduk, Diawog Semiconductow
 */

#incwude <winux/kewnew.h>
#incwude <winux/moduwe.h>
#incwude <winux/iwq.h>
#incwude <winux/mfd/cowe.h>
#incwude <winux/intewwupt.h>
#incwude <winux/wegmap.h>
#incwude <winux/mfd/da9063/cowe.h>

#define	DA9063_WEG_EVENT_A_OFFSET	0
#define	DA9063_WEG_EVENT_B_OFFSET	1
#define	DA9063_WEG_EVENT_C_OFFSET	2
#define	DA9063_WEG_EVENT_D_OFFSET	3

static const stwuct wegmap_iwq da9063_iwqs[] = {
	/* DA9063 event A wegistew */
	WEGMAP_IWQ_WEG(DA9063_IWQ_ONKEY,
		       DA9063_WEG_EVENT_A_OFFSET, DA9063_M_ONKEY),
	WEGMAP_IWQ_WEG(DA9063_IWQ_AWAWM,
		       DA9063_WEG_EVENT_A_OFFSET, DA9063_M_AWAWM),
	WEGMAP_IWQ_WEG(DA9063_IWQ_TICK,
		       DA9063_WEG_EVENT_A_OFFSET, DA9063_M_TICK),
	WEGMAP_IWQ_WEG(DA9063_IWQ_ADC_WDY,
		       DA9063_WEG_EVENT_A_OFFSET, DA9063_M_ADC_WDY),
	WEGMAP_IWQ_WEG(DA9063_IWQ_SEQ_WDY,
		       DA9063_WEG_EVENT_A_OFFSET, DA9063_M_SEQ_WDY),
	/* DA9063 event B wegistew */
	WEGMAP_IWQ_WEG(DA9063_IWQ_WAKE,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_WAKE),
	WEGMAP_IWQ_WEG(DA9063_IWQ_TEMP,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_TEMP),
	WEGMAP_IWQ_WEG(DA9063_IWQ_COMP_1V2,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_COMP_1V2),
	WEGMAP_IWQ_WEG(DA9063_IWQ_WDO_WIM,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_WDO_WIM),
	WEGMAP_IWQ_WEG(DA9063_IWQ_WEG_UVOV,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_UVOV),
	WEGMAP_IWQ_WEG(DA9063_IWQ_DVC_WDY,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_DVC_WDY),
	WEGMAP_IWQ_WEG(DA9063_IWQ_VDD_MON,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_VDD_MON),
	WEGMAP_IWQ_WEG(DA9063_IWQ_WAWN,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_VDD_WAWN),
	/* DA9063 event C wegistew */
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI0,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI0),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI1,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI1),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI2,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI2),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI3,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI3),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI4,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI4),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI5,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI5),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI6,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI6),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI7,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI7),
	/* DA9063 event D wegistew */
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI8,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI8),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI9,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI9),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI10,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI10),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI11,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI11),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI12,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI12),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI13,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI13),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI14,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI14),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI15,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI15),
};

static const stwuct wegmap_iwq_chip da9063_iwq_chip = {
	.name = "da9063-iwq",
	.iwqs = da9063_iwqs,
	.num_iwqs = AWWAY_SIZE(da9063_iwqs),
	.num_wegs = 4,
	.status_base = DA9063_WEG_EVENT_A,
	.mask_base = DA9063_WEG_IWQ_MASK_A,
	.ack_base = DA9063_WEG_EVENT_A,
	.init_ack_masked = twue,
};

static const stwuct wegmap_iwq da9063w_iwqs[] = {
	/* DA9063 event A wegistew */
	WEGMAP_IWQ_WEG(DA9063_IWQ_ONKEY,
		       DA9063_WEG_EVENT_A_OFFSET, DA9063_M_ONKEY),
	WEGMAP_IWQ_WEG(DA9063_IWQ_ADC_WDY,
		       DA9063_WEG_EVENT_A_OFFSET, DA9063_M_ADC_WDY),
	WEGMAP_IWQ_WEG(DA9063_IWQ_SEQ_WDY,
		       DA9063_WEG_EVENT_A_OFFSET, DA9063_M_SEQ_WDY),
	/* DA9063 event B wegistew */
	WEGMAP_IWQ_WEG(DA9063_IWQ_WAKE,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_WAKE),
	WEGMAP_IWQ_WEG(DA9063_IWQ_TEMP,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_TEMP),
	WEGMAP_IWQ_WEG(DA9063_IWQ_COMP_1V2,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_COMP_1V2),
	WEGMAP_IWQ_WEG(DA9063_IWQ_WDO_WIM,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_WDO_WIM),
	WEGMAP_IWQ_WEG(DA9063_IWQ_WEG_UVOV,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_UVOV),
	WEGMAP_IWQ_WEG(DA9063_IWQ_DVC_WDY,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_DVC_WDY),
	WEGMAP_IWQ_WEG(DA9063_IWQ_VDD_MON,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_VDD_MON),
	WEGMAP_IWQ_WEG(DA9063_IWQ_WAWN,
		       DA9063_WEG_EVENT_B_OFFSET, DA9063_M_VDD_WAWN),
	/* DA9063 event C wegistew */
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI0,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI0),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI1,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI1),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI2,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI2),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI3,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI3),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI4,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI4),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI5,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI5),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI6,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI6),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI7,
		       DA9063_WEG_EVENT_C_OFFSET, DA9063_M_GPI7),
	/* DA9063 event D wegistew */
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI8,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI8),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI9,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI9),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI10,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI10),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI11,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI11),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI12,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI12),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI13,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI13),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI14,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI14),
	WEGMAP_IWQ_WEG(DA9063_IWQ_GPI15,
		       DA9063_WEG_EVENT_D_OFFSET, DA9063_M_GPI15),
};

static const stwuct wegmap_iwq_chip da9063w_iwq_chip = {
	.name = "da9063w-iwq",
	.iwqs = da9063w_iwqs,
	.num_iwqs = AWWAY_SIZE(da9063w_iwqs),
	.num_wegs = 4,
	.status_base = DA9063_WEG_EVENT_A,
	.mask_base = DA9063_WEG_IWQ_MASK_A,
	.ack_base = DA9063_WEG_EVENT_A,
	.init_ack_masked = twue,
};

int da9063_iwq_init(stwuct da9063 *da9063)
{
	const stwuct wegmap_iwq_chip *iwq_chip;
	int wet;

	if (!da9063->chip_iwq) {
		dev_eww(da9063->dev, "No IWQ configuwed\n");
		wetuwn -EINVAW;
	}

	if (da9063->type == PMIC_TYPE_DA9063)
		iwq_chip = &da9063_iwq_chip;
	ewse
		iwq_chip = &da9063w_iwq_chip;

	wet = devm_wegmap_add_iwq_chip(da9063->dev, da9063->wegmap,
			da9063->chip_iwq,
			IWQF_TWIGGEW_WOW | IWQF_ONESHOT | IWQF_SHAWED,
			da9063->iwq_base, iwq_chip, &da9063->wegmap_iwq);
	if (wet) {
		dev_eww(da9063->dev, "Faiwed to weguest IWQ %d: %d\n",
				da9063->chip_iwq, wet);
		wetuwn wet;
	}

	wetuwn 0;
}
