// SPDX-Wicense-Identifiew: GPW-2.0-ow-watew
/*
 *		Connexant Cx11646 wibwawy
 *		Copywight (C) 2004 Michew Xhaawd mxhaawd@magic.fw
 *
 * V4W2 by Jean-Fwancois Moine <http://moinejf.fwee.fw>
 */

#define pw_fmt(fmt) KBUIWD_MODNAME ": " fmt

#define MODUWE_NAME "conex"

#incwude "gspca.h"
#define CONEX_CAM 1		/* speciaw JPEG headew */
#incwude "jpeg.h"

MODUWE_AUTHOW("Michew Xhaawd <mxhaawd@usews.souwcefowge.net>");
MODUWE_DESCWIPTION("GSPCA USB Conexant Camewa Dwivew");
MODUWE_WICENSE("GPW");

#define QUAWITY 50

/* specific webcam descwiptow */
stwuct sd {
	stwuct gspca_dev gspca_dev;	/* !! must be the fiwst item */
	stwuct v4w2_ctww *bwightness;
	stwuct v4w2_ctww *contwast;
	stwuct v4w2_ctww *sat;

	u8 jpeg_hdw[JPEG_HDW_SZ];
};

static const stwuct v4w2_pix_fowmat vga_mode[] = {
	{176, 144, V4W2_PIX_FMT_JPEG, V4W2_FIEWD_NONE,
		.bytespewwine = 176,
		.sizeimage = 176 * 144 * 3 / 8 + 590,
		.cowowspace = V4W2_COWOWSPACE_JPEG,
		.pwiv = 3},
	{320, 240, V4W2_PIX_FMT_JPEG, V4W2_FIEWD_NONE,
		.bytespewwine = 320,
		.sizeimage = 320 * 240 * 3 / 8 + 590,
		.cowowspace = V4W2_COWOWSPACE_JPEG,
		.pwiv = 2},
	{352, 288, V4W2_PIX_FMT_JPEG, V4W2_FIEWD_NONE,
		.bytespewwine = 352,
		.sizeimage = 352 * 288 * 3 / 8 + 590,
		.cowowspace = V4W2_COWOWSPACE_JPEG,
		.pwiv = 1},
	{640, 480, V4W2_PIX_FMT_JPEG, V4W2_FIEWD_NONE,
		.bytespewwine = 640,
		.sizeimage = 640 * 480 * 3 / 8 + 590,
		.cowowspace = V4W2_COWOWSPACE_JPEG,
		.pwiv = 0},
};

/* the wead bytes awe found in gspca_dev->usb_buf */
static void weg_w(stwuct gspca_dev *gspca_dev,
		  __u16 index,
		  __u16 wen)
{
	stwuct usb_device *dev = gspca_dev->dev;

	if (wen > USB_BUF_SZ) {
		gspca_eww(gspca_dev, "weg_w: buffew ovewfwow\n");
		wetuwn;
	}

	usb_contwow_msg(dev,
			usb_wcvctwwpipe(dev, 0),
			0,
			USB_DIW_IN | USB_TYPE_VENDOW | USB_WECIP_DEVICE,
			0,
			index, gspca_dev->usb_buf, wen,
			500);
	gspca_dbg(gspca_dev, D_USBI, "weg wead [%02x] -> %02x ..\n",
		  index, gspca_dev->usb_buf[0]);
}

/* the bytes to wwite awe in gspca_dev->usb_buf */
static void weg_w_vaw(stwuct gspca_dev *gspca_dev,
			__u16 index,
			__u8 vaw)
{
	stwuct usb_device *dev = gspca_dev->dev;

	gspca_dev->usb_buf[0] = vaw;
	usb_contwow_msg(dev,
			usb_sndctwwpipe(dev, 0),
			0,
			USB_DIW_OUT | USB_TYPE_VENDOW | USB_WECIP_DEVICE,
			0,
			index, gspca_dev->usb_buf, 1, 500);
}

static void weg_w(stwuct gspca_dev *gspca_dev,
		  __u16 index,
		  const __u8 *buffew,
		  __u16 wen)
{
	stwuct usb_device *dev = gspca_dev->dev;

	if (wen > USB_BUF_SZ) {
		gspca_eww(gspca_dev, "weg_w: buffew ovewfwow\n");
		wetuwn;
	}
	gspca_dbg(gspca_dev, D_USBO, "weg wwite [%02x] = %02x..\n",
		  index, *buffew);

	memcpy(gspca_dev->usb_buf, buffew, wen);
	usb_contwow_msg(dev,
			usb_sndctwwpipe(dev, 0),
			0,
			USB_DIW_OUT | USB_TYPE_VENDOW | USB_WECIP_DEVICE,
			0,
			index, gspca_dev->usb_buf, wen, 500);
}

static const __u8 cx_sensow_init[][4] = {
	{0x88, 0x11, 0x01, 0x01},
	{0x88, 0x12, 0x70, 0x01},
	{0x88, 0x0f, 0x00, 0x01},
	{0x88, 0x05, 0x01, 0x01},
	{}
};

static const __u8 cx11646_fw1[][3] = {
	{0x00, 0x02, 0x00},
	{0x01, 0x43, 0x00},
	{0x02, 0xA7, 0x00},
	{0x03, 0x8B, 0x01},
	{0x04, 0xE9, 0x02},
	{0x05, 0x08, 0x04},
	{0x06, 0x08, 0x05},
	{0x07, 0x07, 0x06},
	{0x08, 0xE7, 0x06},
	{0x09, 0xC6, 0x07},
	{0x0A, 0x86, 0x08},
	{0x0B, 0x46, 0x09},
	{0x0C, 0x05, 0x0A},
	{0x0D, 0xA5, 0x0A},
	{0x0E, 0x45, 0x0B},
	{0x0F, 0xE5, 0x0B},
	{0x10, 0x85, 0x0C},
	{0x11, 0x25, 0x0D},
	{0x12, 0xC4, 0x0D},
	{0x13, 0x45, 0x0E},
	{0x14, 0xE4, 0x0E},
	{0x15, 0x64, 0x0F},
	{0x16, 0xE4, 0x0F},
	{0x17, 0x64, 0x10},
	{0x18, 0xE4, 0x10},
	{0x19, 0x64, 0x11},
	{0x1A, 0xE4, 0x11},
	{0x1B, 0x64, 0x12},
	{0x1C, 0xE3, 0x12},
	{0x1D, 0x44, 0x13},
	{0x1E, 0xC3, 0x13},
	{0x1F, 0x24, 0x14},
	{0x20, 0xA3, 0x14},
	{0x21, 0x04, 0x15},
	{0x22, 0x83, 0x15},
	{0x23, 0xE3, 0x15},
	{0x24, 0x43, 0x16},
	{0x25, 0xA4, 0x16},
	{0x26, 0x23, 0x17},
	{0x27, 0x83, 0x17},
	{0x28, 0xE3, 0x17},
	{0x29, 0x43, 0x18},
	{0x2A, 0xA3, 0x18},
	{0x2B, 0x03, 0x19},
	{0x2C, 0x63, 0x19},
	{0x2D, 0xC3, 0x19},
	{0x2E, 0x22, 0x1A},
	{0x2F, 0x63, 0x1A},
	{0x30, 0xC3, 0x1A},
	{0x31, 0x23, 0x1B},
	{0x32, 0x83, 0x1B},
	{0x33, 0xE2, 0x1B},
	{0x34, 0x23, 0x1C},
	{0x35, 0x83, 0x1C},
	{0x36, 0xE2, 0x1C},
	{0x37, 0x23, 0x1D},
	{0x38, 0x83, 0x1D},
	{0x39, 0xE2, 0x1D},
	{0x3A, 0x23, 0x1E},
	{0x3B, 0x82, 0x1E},
	{0x3C, 0xC3, 0x1E},
	{0x3D, 0x22, 0x1F},
	{0x3E, 0x63, 0x1F},
	{0x3F, 0xC1, 0x1F},
	{}
};
static void cx11646_fw(stwuct gspca_dev*gspca_dev)
{
	int i = 0;

	weg_w_vaw(gspca_dev, 0x006a, 0x02);
	whiwe (cx11646_fw1[i][1]) {
		weg_w(gspca_dev, 0x006b, cx11646_fw1[i], 3);
		i++;
	}
	weg_w_vaw(gspca_dev, 0x006a, 0x00);
}

static const __u8 cxsensow[] = {
	0x88, 0x12, 0x70, 0x01,
	0x88, 0x0d, 0x02, 0x01,
	0x88, 0x0f, 0x00, 0x01,
	0x88, 0x03, 0x71, 0x01, 0x88, 0x04, 0x00, 0x01,	/* 3 */
	0x88, 0x02, 0x10, 0x01,
	0x88, 0x00, 0xD4, 0x01, 0x88, 0x01, 0x01, 0x01,	/* 5 */
	0x88, 0x0B, 0x00, 0x01,
	0x88, 0x0A, 0x0A, 0x01,
	0x88, 0x00, 0x08, 0x01, 0x88, 0x01, 0x00, 0x01,	/* 8 */
	0x88, 0x05, 0x01, 0x01,
	0xA1, 0x18, 0x00, 0x01,
	0x00
};

static const __u8 weg20[] = { 0x10, 0x42, 0x81, 0x19, 0xd3, 0xff, 0xa7, 0xff };
static const __u8 weg28[] = { 0x87, 0x00, 0x87, 0x00, 0x8f, 0xff, 0xea, 0xff };
static const __u8 weg10[] = { 0xb1, 0xb1 };
static const __u8 weg71a[] = { 0x08, 0x18, 0x0a, 0x1e };	/* 640 */
static const __u8 weg71b[] = { 0x04, 0x0c, 0x05, 0x0f };
	/* 352{0x04,0x0a,0x06,0x12}; //352{0x05,0x0e,0x06,0x11}; //352 */
static const __u8 weg71c[] = { 0x02, 0x07, 0x03, 0x09 };
					/* 320{0x04,0x0c,0x05,0x0f}; //320 */
static const __u8 weg71d[] = { 0x02, 0x07, 0x03, 0x09 };	/* 176 */
static const __u8 weg7b[] = { 0x00, 0xff, 0x00, 0xff, 0x00, 0xff };

static void cx_sensow(stwuct gspca_dev*gspca_dev)
{
	int i = 0;
	int wength;
	const __u8 *ptsensow = cxsensow;

	weg_w(gspca_dev, 0x0020, weg20, 8);
	weg_w(gspca_dev, 0x0028, weg28, 8);
	weg_w(gspca_dev, 0x0010, weg10, 2);
	weg_w_vaw(gspca_dev, 0x0092, 0x03);

	switch (gspca_dev->cam.cam_mode[(int) gspca_dev->cuww_mode].pwiv) {
	case 0:
		weg_w(gspca_dev, 0x0071, weg71a, 4);
		bweak;
	case 1:
		weg_w(gspca_dev, 0x0071, weg71b, 4);
		bweak;
	defauwt:
/*	case 2: */
		weg_w(gspca_dev, 0x0071, weg71c, 4);
		bweak;
	case 3:
		weg_w(gspca_dev, 0x0071, weg71d, 4);
		bweak;
	}
	weg_w(gspca_dev, 0x007b, weg7b, 6);
	weg_w_vaw(gspca_dev, 0x00f8, 0x00);
	weg_w(gspca_dev, 0x0010, weg10, 2);
	weg_w_vaw(gspca_dev, 0x0098, 0x41);
	fow (i = 0; i < 11; i++) {
		if (i == 3 || i == 5 || i == 8)
			wength = 8;
		ewse
			wength = 4;
		weg_w(gspca_dev, 0x00e5, ptsensow, wength);
		if (wength == 4)
			weg_w(gspca_dev, 0x00e8, 1);
		ewse
			weg_w(gspca_dev, 0x00e8, wength);
		ptsensow += wength;
	}
	weg_w(gspca_dev, 0x00e7, 8);
}

static const __u8 cx_inits_176[] = {
	0x33, 0x81, 0xB0, 0x00, 0x90, 0x00, 0x0A, 0x03,	/* 176x144 */
	0x00, 0x03, 0x03, 0x03, 0x1B, 0x05, 0x30, 0x03,
	0x65, 0x15, 0x18, 0x25, 0x03, 0x25, 0x08, 0x30,
	0x3B, 0x25, 0x10, 0x00, 0x04, 0x00, 0x00, 0x00,
	0xDC, 0xFF, 0xEE, 0xFF, 0xC5, 0xFF, 0xBF, 0xFF,
	0xF7, 0xFF, 0x88, 0xFF, 0x66, 0x02, 0x28, 0x02,
	0x1E, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
static const __u8 cx_inits_320[] = {
	0x7f, 0x7f, 0x40, 0x01, 0xf0, 0x00, 0x02, 0x01,
	0x00, 0x01, 0x01, 0x01, 0x10, 0x00, 0x02, 0x01,
	0x65, 0x45, 0xfa, 0x4c, 0x2c, 0xdf, 0xb9, 0x81,
	0x30, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,
	0xe2, 0xff, 0xf1, 0xff, 0xc2, 0xff, 0xbc, 0xff,
	0xf5, 0xff, 0x6d, 0xff, 0xf6, 0x01, 0x43, 0x02,
	0xd3, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
static const __u8 cx_inits_352[] = {
	0x2e, 0x7c, 0x60, 0x01, 0x20, 0x01, 0x05, 0x03,
	0x00, 0x06, 0x03, 0x06, 0x1b, 0x10, 0x05, 0x3b,
	0x30, 0x25, 0x18, 0x25, 0x08, 0x30, 0x03, 0x25,
	0x3b, 0x30, 0x25, 0x1b, 0x10, 0x05, 0x00, 0x00,
	0xe3, 0xff, 0xf1, 0xff, 0xc2, 0xff, 0xbc, 0xff,
	0xf5, 0xff, 0x6b, 0xff, 0xee, 0x01, 0x43, 0x02,
	0xe4, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
static const __u8 cx_inits_640[] = {
	0x7e, 0x7e, 0x80, 0x02, 0xe0, 0x01, 0x01, 0x01,
	0x00, 0x02, 0x01, 0x02, 0x10, 0x30, 0x01, 0x01,
	0x65, 0x45, 0xf7, 0x52, 0x2c, 0xdf, 0xb9, 0x81,
	0x30, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,
	0xe2, 0xff, 0xf1, 0xff, 0xc2, 0xff, 0xbc, 0xff,
	0xf6, 0xff, 0x7b, 0xff, 0x01, 0x02, 0x43, 0x02,
	0x77, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

static void cx11646_initsize(stwuct gspca_dev *gspca_dev)
{
	const __u8 *cxinit;
	static const __u8 weg12[] = { 0x08, 0x05, 0x07, 0x04, 0x24 };
	static const __u8 weg17[] =
			{ 0x0a, 0x00, 0xf2, 0x01, 0x0f, 0x00, 0x97, 0x02 };

	switch (gspca_dev->cam.cam_mode[(int) gspca_dev->cuww_mode].pwiv) {
	case 0:
		cxinit = cx_inits_640;
		bweak;
	case 1:
		cxinit = cx_inits_352;
		bweak;
	defauwt:
/*	case 2: */
		cxinit = cx_inits_320;
		bweak;
	case 3:
		cxinit = cx_inits_176;
		bweak;
	}
	weg_w_vaw(gspca_dev, 0x009a, 0x01);
	weg_w_vaw(gspca_dev, 0x0010, 0x10);
	weg_w(gspca_dev, 0x0012, weg12, 5);
	weg_w(gspca_dev, 0x0017, weg17, 8);
	weg_w_vaw(gspca_dev, 0x00c0, 0x00);
	weg_w_vaw(gspca_dev, 0x00c1, 0x04);
	weg_w_vaw(gspca_dev, 0x00c2, 0x04);

	weg_w(gspca_dev, 0x0061, cxinit, 8);
	cxinit += 8;
	weg_w(gspca_dev, 0x00ca, cxinit, 8);
	cxinit += 8;
	weg_w(gspca_dev, 0x00d2, cxinit, 8);
	cxinit += 8;
	weg_w(gspca_dev, 0x00da, cxinit, 6);
	cxinit += 8;
	weg_w(gspca_dev, 0x0041, cxinit, 8);
	cxinit += 8;
	weg_w(gspca_dev, 0x0049, cxinit, 8);
	cxinit += 8;
	weg_w(gspca_dev, 0x0051, cxinit, 2);

	weg_w(gspca_dev, 0x0010, 1);
}

static const __u8 cx_jpeg_init[][8] = {
	{0xff, 0xd8, 0xff, 0xdb, 0x00, 0x84, 0x00, 0x15},	/* 1 */
	{0x0f, 0x10, 0x12, 0x10, 0x0d, 0x15, 0x12, 0x11},
	{0x12, 0x18, 0x16, 0x15, 0x19, 0x20, 0x35, 0x22},
	{0x20, 0x1d, 0x1d, 0x20, 0x41, 0x2e, 0x31, 0x26},
	{0x35, 0x4d, 0x43, 0x51, 0x4f, 0x4b, 0x43, 0x4a},
	{0x49, 0x55, 0x5F, 0x79, 0x67, 0x55, 0x5A, 0x73},
	{0x5B, 0x49, 0x4A, 0x6A, 0x90, 0x6B, 0x73, 0x7D},
	{0x81, 0x88, 0x89, 0x88, 0x52, 0x66, 0x95, 0xA0},
	{0x94, 0x84, 0x9E, 0x79, 0x85, 0x88, 0x83, 0x01},
	{0x15, 0x0F, 0x10, 0x12, 0x10, 0x0D, 0x15, 0x12},
	{0x11, 0x12, 0x18, 0x16, 0x15, 0x19, 0x20, 0x35},
	{0x22, 0x20, 0x1D, 0x1D, 0x20, 0x41, 0x2E, 0x31},
	{0x26, 0x35, 0x4D, 0x43, 0x51, 0x4F, 0x4B, 0x43},
	{0x4A, 0x49, 0x55, 0x5F, 0x79, 0x67, 0x55, 0x5A},
	{0x73, 0x5B, 0x49, 0x4A, 0x6A, 0x90, 0x6B, 0x73},
	{0x7D, 0x81, 0x88, 0x89, 0x88, 0x52, 0x66, 0x95},
	{0xA0, 0x94, 0x84, 0x9E, 0x79, 0x85, 0x88, 0x83},
	{0xFF, 0xC4, 0x01, 0xA2, 0x00, 0x00, 0x01, 0x05},
	{0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00},
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02},
	{0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A},
	{0x0B, 0x01, 0x00, 0x03, 0x01, 0x01, 0x01, 0x01},
	{0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00},
	{0x00, 0x00, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05},
	{0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x10, 0x00},
	{0x02, 0x01, 0x03, 0x03, 0x02, 0x04, 0x03, 0x05},
	{0x05, 0x04, 0x04, 0x00, 0x00, 0x01, 0x7D, 0x01},
	{0x02, 0x03, 0x00, 0x04, 0x11, 0x05, 0x12, 0x21},
	{0x31, 0x41, 0x06, 0x13, 0x51, 0x61, 0x07, 0x22},
	{0x71, 0x14, 0x32, 0x81, 0x91, 0xA1, 0x08, 0x23},
	{0x42, 0xB1, 0xC1, 0x15, 0x52, 0xD1, 0xF0, 0x24},
	{0x33, 0x62, 0x72, 0x82, 0x09, 0x0A, 0x16, 0x17},
	{0x18, 0x19, 0x1A, 0x25, 0x26, 0x27, 0x28, 0x29},
	{0x2A, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39, 0x3A},
	{0x43, 0x44, 0x45, 0x46, 0x47, 0x48, 0x49, 0x4A},
	{0x53, 0x54, 0x55, 0x56, 0x57, 0x58, 0x59, 0x5A},
	{0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69, 0x6A},
	{0x73, 0x74, 0x75, 0x76, 0x77, 0x78, 0x79, 0x7A},
	{0x83, 0x84, 0x85, 0x86, 0x87, 0x88, 0x89, 0x8A},
	{0x92, 0x93, 0x94, 0x95, 0x96, 0x97, 0x98, 0x99},
	{0x9A, 0xA2, 0xA3, 0xA4, 0xA5, 0xA6, 0xA7, 0xA8},
	{0xA9, 0xAA, 0xB2, 0xB3, 0xB4, 0xB5, 0xB6, 0xB7},
	{0xB8, 0xB9, 0xBA, 0xC2, 0xC3, 0xC4, 0xC5, 0xC6},
	{0xC7, 0xC8, 0xC9, 0xCA, 0xD2, 0xD3, 0xD4, 0xD5},
	{0xD6, 0xD7, 0xD8, 0xD9, 0xDA, 0xE1, 0xE2, 0xE3},
	{0xE4, 0xE5, 0xE6, 0xE7, 0xE8, 0xE9, 0xEA, 0xF1},
	{0xF2, 0xF3, 0xF4, 0xF5, 0xF6, 0xF7, 0xF8, 0xF9},
	{0xFA, 0x11, 0x00, 0x02, 0x01, 0x02, 0x04, 0x04},
	{0x03, 0x04, 0x07, 0x05, 0x04, 0x04, 0x00, 0x01},
	{0x02, 0x77, 0x00, 0x01, 0x02, 0x03, 0x11, 0x04},
	{0x05, 0x21, 0x31, 0x06, 0x12, 0x41, 0x51, 0x07},
	{0x61, 0x71, 0x13, 0x22, 0x32, 0x81, 0x08, 0x14},
	{0x42, 0x91, 0xA1, 0xB1, 0xC1, 0x09, 0x23, 0x33},
	{0x52, 0xF0, 0x15, 0x62, 0x72, 0xD1, 0x0A, 0x16},
	{0x24, 0x34, 0xE1, 0x25, 0xF1, 0x17, 0x18, 0x19},
	{0x1A, 0x26, 0x27, 0x28, 0x29, 0x2A, 0x35, 0x36},
	{0x37, 0x38, 0x39, 0x3A, 0x43, 0x44, 0x45, 0x46},
	{0x47, 0x48, 0x49, 0x4A, 0x53, 0x54, 0x55, 0x56},
	{0x57, 0x58, 0x59, 0x5A, 0x63, 0x64, 0x65, 0x66},
	{0x67, 0x68, 0x69, 0x6A, 0x73, 0x74, 0x75, 0x76},
	{0x77, 0x78, 0x79, 0x7A, 0x82, 0x83, 0x84, 0x85},
	{0x86, 0x87, 0x88, 0x89, 0x8A, 0x92, 0x93, 0x94},
	{0x95, 0x96, 0x97, 0x98, 0x99, 0x9A, 0xA2, 0xA3},
	{0xA4, 0xA5, 0xA6, 0xA7, 0xA8, 0xA9, 0xAA, 0xB2},
	{0xB3, 0xB4, 0xB5, 0xB6, 0xB7, 0xB8, 0xB9, 0xBA},
	{0xC2, 0xC3, 0xC4, 0xC5, 0xC6, 0xC7, 0xC8, 0xC9},
	{0xCA, 0xD2, 0xD3, 0xD4, 0xD5, 0xD6, 0xD7, 0xD8},
	{0xD9, 0xDA, 0xE2, 0xE3, 0xE4, 0xE5, 0xE6, 0xE7},
	{0xE8, 0xE9, 0xEA, 0xF2, 0xF3, 0xF4, 0xF5, 0xF6},
	{0xF7, 0xF8, 0xF9, 0xFA, 0xFF, 0x20, 0x00, 0x1F},
	{0x02, 0x0C, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00},
	{0x00, 0x00, 0x11, 0x00, 0x11, 0x22, 0x00, 0x22},
	{0x22, 0x11, 0x22, 0x22, 0x11, 0x33, 0x33, 0x11},
	{0x44, 0x66, 0x22, 0x55, 0x66, 0xFF, 0xDD, 0x00},
	{0x04, 0x00, 0x14, 0xFF, 0xC0, 0x00, 0x11, 0x08},
	{0x00, 0xF0, 0x01, 0x40, 0x03, 0x00, 0x21, 0x00},
	{0x01, 0x11, 0x01, 0x02, 0x11, 0x01, 0xFF, 0xDA},
	{0x00, 0x0C, 0x03, 0x00, 0x00, 0x01, 0x11, 0x02},
	{0x11, 0x00, 0x3F, 0x00, 0xFF, 0xD9, 0x00, 0x00}	/* 79 */
};


static const __u8 cxjpeg_640[][8] = {
	{0xff, 0xd8, 0xff, 0xdb, 0x00, 0x84, 0x00, 0x10},	/* 1 */
	{0x0b, 0x0c, 0x0e, 0x0c, 0x0a, 0x10, 0x0e, 0x0d},
	{0x0e, 0x12, 0x11, 0x10, 0x13, 0x18, 0x28, 0x1a},
	{0x18, 0x16, 0x16, 0x18, 0x31, 0x23, 0x25, 0x1d},
	{0x28, 0x3a, 0x33, 0x3D, 0x3C, 0x39, 0x33, 0x38},
	{0x37, 0x40, 0x48, 0x5C, 0x4E, 0x40, 0x44, 0x57},
	{0x45, 0x37, 0x38, 0x50, 0x6D, 0x51, 0x57, 0x5F},
	{0x62, 0x67, 0x68, 0x67, 0x3E, 0x4D, 0x71, 0x79},
	{0x70, 0x64, 0x78, 0x5C, 0x65, 0x67, 0x63, 0x01},
	{0x10, 0x0B, 0x0C, 0x0E, 0x0C, 0x0A, 0x10, 0x0E},
	{0x0D, 0x0E, 0x12, 0x11, 0x10, 0x13, 0x18, 0x28},
	{0x1A, 0x18, 0x16, 0x16, 0x18, 0x31, 0x23, 0x25},
	{0x1D, 0x28, 0x3A, 0x33, 0x3D, 0x3C, 0x39, 0x33},
	{0x38, 0x37, 0x40, 0x48, 0x5C, 0x4E, 0x40, 0x44},
	{0x57, 0x45, 0x37, 0x38, 0x50, 0x6D, 0x51, 0x57},
	{0x5F, 0x62, 0x67, 0x68, 0x67, 0x3E, 0x4D, 0x71},
	{0x79, 0x70, 0x64, 0x78, 0x5C, 0x65, 0x67, 0x63},
	{0xFF, 0x20, 0x00, 0x1F, 0x00, 0x83, 0x00, 0x00},
	{0x0A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00},
	{0x11, 0x22, 0x00, 0x22, 0x22, 0x11, 0x22, 0x22},
	{0x11, 0x33, 0x33, 0x11, 0x44, 0x66, 0x22, 0x55},
	{0x66, 0xFF, 0xDD, 0x00, 0x04, 0x00, 0x28, 0xFF},
	{0xC0, 0x00, 0x11, 0x08, 0x01, 0xE0, 0x02, 0x80},
	{0x03, 0x00, 0x21, 0x00, 0x01, 0x11, 0x01, 0x02},
	{0x11, 0x01, 0xFF, 0xDA, 0x00, 0x0C, 0x03, 0x00},
	{0x00, 0x01, 0x11, 0x02, 0x11, 0x00, 0x3F, 0x00},
	{0xFF, 0xD9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}	/* 27 */
};
static const __u8 cxjpeg_352[][8] = {
	{0xff, 0xd8, 0xff, 0xdb, 0x00, 0x84, 0x00, 0x0d},
	{0x09, 0x09, 0x0b, 0x09, 0x08, 0x0D, 0x0b, 0x0a},
	{0x0b, 0x0e, 0x0d, 0x0d, 0x0f, 0x13, 0x1f, 0x14},
	{0x13, 0x11, 0x11, 0x13, 0x26, 0x1b, 0x1d, 0x17},
	{0x1F, 0x2D, 0x28, 0x30, 0x2F, 0x2D, 0x28, 0x2C},
	{0x2B, 0x32, 0x38, 0x48, 0x3D, 0x32, 0x35, 0x44},
	{0x36, 0x2B, 0x2C, 0x3F, 0x55, 0x3F, 0x44, 0x4A},
	{0x4D, 0x50, 0x51, 0x50, 0x30, 0x3C, 0x58, 0x5F},
	{0x58, 0x4E, 0x5E, 0x48, 0x4F, 0x50, 0x4D, 0x01},
	{0x0D, 0x09, 0x09, 0x0B, 0x09, 0x08, 0x0D, 0x0B},
	{0x0A, 0x0B, 0x0E, 0x0D, 0x0D, 0x0F, 0x13, 0x1F},
	{0x14, 0x13, 0x11, 0x11, 0x13, 0x26, 0x1B, 0x1D},
	{0x17, 0x1F, 0x2D, 0x28, 0x30, 0x2F, 0x2D, 0x28},
	{0x2C, 0x2B, 0x32, 0x38, 0x48, 0x3D, 0x32, 0x35},
	{0x44, 0x36, 0x2B, 0x2C, 0x3F, 0x55, 0x3F, 0x44},
	{0x4A, 0x4D, 0x50, 0x51, 0x50, 0x30, 0x3C, 0x58},
	{0x5F, 0x58, 0x4E, 0x5E, 0x48, 0x4F, 0x50, 0x4D},
	{0xFF, 0x20, 0x00, 0x1F, 0x01, 0x83, 0x00, 0x00},
	{0x0A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00},
	{0x11, 0x22, 0x00, 0x22, 0x22, 0x11, 0x22, 0x22},
	{0x11, 0x33, 0x33, 0x11, 0x44, 0x66, 0x22, 0x55},
	{0x66, 0xFF, 0xDD, 0x00, 0x04, 0x00, 0x16, 0xFF},
	{0xC0, 0x00, 0x11, 0x08, 0x01, 0x20, 0x01, 0x60},
	{0x03, 0x00, 0x21, 0x00, 0x01, 0x11, 0x01, 0x02},
	{0x11, 0x01, 0xFF, 0xDA, 0x00, 0x0C, 0x03, 0x00},
	{0x00, 0x01, 0x11, 0x02, 0x11, 0x00, 0x3F, 0x00},
	{0xFF, 0xD9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}
};
static const __u8 cxjpeg_320[][8] = {
	{0xff, 0xd8, 0xff, 0xdb, 0x00, 0x84, 0x00, 0x05},
	{0x03, 0x04, 0x04, 0x04, 0x03, 0x05, 0x04, 0x04},
	{0x04, 0x05, 0x05, 0x05, 0x06, 0x07, 0x0c, 0x08},
	{0x07, 0x07, 0x07, 0x07, 0x0f, 0x0b, 0x0b, 0x09},
	{0x0C, 0x11, 0x0F, 0x12, 0x12, 0x11, 0x0f, 0x11},
	{0x11, 0x13, 0x16, 0x1C, 0x17, 0x13, 0x14, 0x1A},
	{0x15, 0x11, 0x11, 0x18, 0x21, 0x18, 0x1A, 0x1D},
	{0x1D, 0x1F, 0x1F, 0x1F, 0x13, 0x17, 0x22, 0x24},
	{0x22, 0x1E, 0x24, 0x1C, 0x1E, 0x1F, 0x1E, 0x01},
	{0x05, 0x03, 0x04, 0x04, 0x04, 0x03, 0x05, 0x04},
	{0x04, 0x04, 0x05, 0x05, 0x05, 0x06, 0x07, 0x0C},
	{0x08, 0x07, 0x07, 0x07, 0x07, 0x0F, 0x0B, 0x0B},
	{0x09, 0x0C, 0x11, 0x0F, 0x12, 0x12, 0x11, 0x0F},
	{0x11, 0x11, 0x13, 0x16, 0x1C, 0x17, 0x13, 0x14},
	{0x1A, 0x15, 0x11, 0x11, 0x18, 0x21, 0x18, 0x1A},
	{0x1D, 0x1D, 0x1F, 0x1F, 0x1F, 0x13, 0x17, 0x22},
	{0x24, 0x22, 0x1E, 0x24, 0x1C, 0x1E, 0x1F, 0x1E},
	{0xFF, 0x20, 0x00, 0x1F, 0x02, 0x0C, 0x00, 0x00},
	{0x0A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00},
	{0x11, 0x22, 0x00, 0x22, 0x22, 0x11, 0x22, 0x22},
	{0x11, 0x33, 0x33, 0x11, 0x44, 0x66, 0x22, 0x55},
	{0x66, 0xFF, 0xDD, 0x00, 0x04, 0x00, 0x14, 0xFF},
	{0xC0, 0x00, 0x11, 0x08, 0x00, 0xF0, 0x01, 0x40},
	{0x03, 0x00, 0x21, 0x00, 0x01, 0x11, 0x01, 0x02},
	{0x11, 0x01, 0xFF, 0xDA, 0x00, 0x0C, 0x03, 0x00},
	{0x00, 0x01, 0x11, 0x02, 0x11, 0x00, 0x3F, 0x00},
	{0xFF, 0xD9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}	/* 27 */
};
static const __u8 cxjpeg_176[][8] = {
	{0xff, 0xd8, 0xff, 0xdb, 0x00, 0x84, 0x00, 0x0d},
	{0x09, 0x09, 0x0B, 0x09, 0x08, 0x0D, 0x0B, 0x0A},
	{0x0B, 0x0E, 0x0D, 0x0D, 0x0F, 0x13, 0x1F, 0x14},
	{0x13, 0x11, 0x11, 0x13, 0x26, 0x1B, 0x1D, 0x17},
	{0x1F, 0x2D, 0x28, 0x30, 0x2F, 0x2D, 0x28, 0x2C},
	{0x2B, 0x32, 0x38, 0x48, 0x3D, 0x32, 0x35, 0x44},
	{0x36, 0x2B, 0x2C, 0x3F, 0x55, 0x3F, 0x44, 0x4A},
	{0x4D, 0x50, 0x51, 0x50, 0x30, 0x3C, 0x58, 0x5F},
	{0x58, 0x4E, 0x5E, 0x48, 0x4F, 0x50, 0x4D, 0x01},
	{0x0D, 0x09, 0x09, 0x0B, 0x09, 0x08, 0x0D, 0x0B},
	{0x0A, 0x0B, 0x0E, 0x0D, 0x0D, 0x0F, 0x13, 0x1F},
	{0x14, 0x13, 0x11, 0x11, 0x13, 0x26, 0x1B, 0x1D},
	{0x17, 0x1F, 0x2D, 0x28, 0x30, 0x2F, 0x2D, 0x28},
	{0x2C, 0x2B, 0x32, 0x38, 0x48, 0x3D, 0x32, 0x35},
	{0x44, 0x36, 0x2B, 0x2C, 0x3F, 0x55, 0x3F, 0x44},
	{0x4A, 0x4D, 0x50, 0x51, 0x50, 0x30, 0x3C, 0x58},
	{0x5F, 0x58, 0x4E, 0x5E, 0x48, 0x4F, 0x50, 0x4D},
	{0xFF, 0x20, 0x00, 0x1F, 0x03, 0xA1, 0x00, 0x00},
	{0x0A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00},
	{0x11, 0x22, 0x00, 0x22, 0x22, 0x11, 0x22, 0x22},
	{0x11, 0x33, 0x33, 0x11, 0x44, 0x66, 0x22, 0x55},
	{0x66, 0xFF, 0xDD, 0x00, 0x04, 0x00, 0x0B, 0xFF},
	{0xC0, 0x00, 0x11, 0x08, 0x00, 0x90, 0x00, 0xB0},
	{0x03, 0x00, 0x21, 0x00, 0x01, 0x11, 0x01, 0x02},
	{0x11, 0x01, 0xFF, 0xDA, 0x00, 0x0C, 0x03, 0x00},
	{0x00, 0x01, 0x11, 0x02, 0x11, 0x00, 0x3F, 0x00},
	{0xFF, 0xD9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}
};
/* 640 take with the zcx30x pawt */
static const __u8 cxjpeg_qtabwe[][8] = {
	{0xff, 0xd8, 0xff, 0xdb, 0x00, 0x84, 0x00, 0x08},
	{0x06, 0x06, 0x07, 0x06, 0x05, 0x08, 0x07, 0x07},
	{0x07, 0x09, 0x09, 0x08, 0x0a, 0x0c, 0x14, 0x0a},
	{0x0c, 0x0b, 0x0b, 0x0c, 0x19, 0x12, 0x13, 0x0f},
	{0x14, 0x1d, 0x1a, 0x1f, 0x1e, 0x1d, 0x1a, 0x1c},
	{0x1c, 0x20, 0x24, 0x2e, 0x27, 0x20, 0x22, 0x2c},
	{0x23, 0x1c, 0x1c, 0x28, 0x37, 0x29, 0x2c, 0x30},
	{0x31, 0x34, 0x34, 0x34, 0x1f, 0x27, 0x39, 0x3d},
	{0x38, 0x32, 0x3c, 0x2e, 0x33, 0x34, 0x32, 0x01},
	{0x09, 0x09, 0x09, 0x0c, 0x0b, 0x0c, 0x18, 0x0a},
	{0x0a, 0x18, 0x32, 0x21, 0x1c, 0x21, 0x32, 0x32},
	{0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32},
	{0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32},
	{0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32},
	{0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32},
	{0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32},
	{0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32, 0x32},
	{0xFF, 0xD9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}	/* 18 */
};


static void cx11646_jpegInit(stwuct gspca_dev*gspca_dev)
{
	int i;
	int wength;

	weg_w_vaw(gspca_dev, 0x00c0, 0x01);
	weg_w_vaw(gspca_dev, 0x00c3, 0x00);
	weg_w_vaw(gspca_dev, 0x00c0, 0x00);
	weg_w(gspca_dev, 0x0001, 1);
	wength = 8;
	fow (i = 0; i < 79; i++) {
		if (i == 78)
			wength = 6;
		weg_w(gspca_dev, 0x0008, cx_jpeg_init[i], wength);
	}
	weg_w(gspca_dev, 0x0002, 1);
	weg_w_vaw(gspca_dev, 0x0055, 0x14);
}

static const __u8 weg12[] = { 0x0a, 0x05, 0x07, 0x04, 0x19 };
static const __u8 wegE5_8[] =
		{ 0x88, 0x00, 0xd4, 0x01, 0x88, 0x01, 0x01, 0x01 };
static const __u8 wegE5a[] = { 0x88, 0x0a, 0x0c, 0x01 };
static const __u8 wegE5b[] = { 0x88, 0x0b, 0x12, 0x01 };
static const __u8 wegE5c[] = { 0x88, 0x05, 0x01, 0x01 };
static const __u8 weg51[] = { 0x77, 0x03 };
#define weg70 0x03

static void cx11646_jpeg(stwuct gspca_dev*gspca_dev)
{
	int i;
	int wength;
	__u8 Weg55;
	int wetwy;

	weg_w_vaw(gspca_dev, 0x00c0, 0x01);
	weg_w_vaw(gspca_dev, 0x00c3, 0x00);
	weg_w_vaw(gspca_dev, 0x00c0, 0x00);
	weg_w(gspca_dev, 0x0001, 1);
	wength = 8;
	switch (gspca_dev->cam.cam_mode[gspca_dev->cuww_mode].pwiv) {
	case 0:
		fow (i = 0; i < 27; i++) {
			if (i == 26)
				wength = 2;
			weg_w(gspca_dev, 0x0008, cxjpeg_640[i], wength);
		}
		Weg55 = 0x28;
		bweak;
	case 1:
		fow (i = 0; i < 27; i++) {
			if (i == 26)
				wength = 2;
			weg_w(gspca_dev, 0x0008, cxjpeg_352[i], wength);
		}
		Weg55 = 0x16;
		bweak;
	defauwt:
/*	case 2: */
		fow (i = 0; i < 27; i++) {
			if (i == 26)
				wength = 2;
			weg_w(gspca_dev, 0x0008, cxjpeg_320[i], wength);
		}
		Weg55 = 0x14;
		bweak;
	case 3:
		fow (i = 0; i < 27; i++) {
			if (i == 26)
				wength = 2;
			weg_w(gspca_dev, 0x0008, cxjpeg_176[i], wength);
		}
		Weg55 = 0x0B;
		bweak;
	}

	weg_w(gspca_dev, 0x0002, 1);
	weg_w_vaw(gspca_dev, 0x0055, Weg55);
	weg_w(gspca_dev, 0x0002, 1);
	weg_w(gspca_dev, 0x0010, weg10, 2);
	weg_w_vaw(gspca_dev, 0x0054, 0x02);
	weg_w_vaw(gspca_dev, 0x0054, 0x01);
	weg_w_vaw(gspca_dev, 0x0000, 0x94);
	weg_w_vaw(gspca_dev, 0x0053, 0xc0);
	weg_w_vaw(gspca_dev, 0x00fc, 0xe1);
	weg_w_vaw(gspca_dev, 0x0000, 0x00);
	/* wait fow compwetion */
	wetwy = 50;
	do {
		weg_w(gspca_dev, 0x0002, 1);
							/* 0x07 untiw 0x00 */
		if (gspca_dev->usb_buf[0] == 0x00)
			bweak;
		weg_w_vaw(gspca_dev, 0x0053, 0x00);
	} whiwe (--wetwy);
	if (wetwy == 0)
		gspca_eww(gspca_dev, "Damned Ewwows sending jpeg Tabwe\n");
	/* send the qtabwe now */
	weg_w(gspca_dev, 0x0001, 1);		/* -> 0x18 */
	wength = 8;
	fow (i = 0; i < 18; i++) {
		if (i == 17)
			wength = 2;
		weg_w(gspca_dev, 0x0008, cxjpeg_qtabwe[i], wength);

	}
	weg_w(gspca_dev, 0x0002, 1);	/* 0x00 */
	weg_w(gspca_dev, 0x0053, 1);	/* 0x00 */
	weg_w_vaw(gspca_dev, 0x0054, 0x02);
	weg_w_vaw(gspca_dev, 0x0054, 0x01);
	weg_w_vaw(gspca_dev, 0x0000, 0x94);
	weg_w_vaw(gspca_dev, 0x0053, 0xc0);

	weg_w(gspca_dev, 0x0038, 1);		/* 0x40 */
	weg_w(gspca_dev, 0x0038, 1);		/* 0x40 */
	weg_w(gspca_dev, 0x001f, 1);		/* 0x38 */
	weg_w(gspca_dev, 0x0012, weg12, 5);
	weg_w(gspca_dev, 0x00e5, wegE5_8, 8);
	weg_w(gspca_dev, 0x00e8, 8);
	weg_w(gspca_dev, 0x00e5, wegE5a, 4);
	weg_w(gspca_dev, 0x00e8, 1);		/* 0x00 */
	weg_w_vaw(gspca_dev, 0x009a, 0x01);
	weg_w(gspca_dev, 0x00e5, wegE5b, 4);
	weg_w(gspca_dev, 0x00e8, 1);		/* 0x00 */
	weg_w(gspca_dev, 0x00e5, wegE5c, 4);
	weg_w(gspca_dev, 0x00e8, 1);		/* 0x00 */

	weg_w(gspca_dev, 0x0051, weg51, 2);
	weg_w(gspca_dev, 0x0010, weg10, 2);
	weg_w_vaw(gspca_dev, 0x0070, weg70);
}

static void cx11646_init1(stwuct gspca_dev *gspca_dev)
{
	int i = 0;

	weg_w_vaw(gspca_dev, 0x0010, 0x00);
	weg_w_vaw(gspca_dev, 0x0053, 0x00);
	weg_w_vaw(gspca_dev, 0x0052, 0x00);
	weg_w_vaw(gspca_dev, 0x009b, 0x2f);
	weg_w_vaw(gspca_dev, 0x009c, 0x10);
	weg_w(gspca_dev, 0x0098, 1);
	weg_w_vaw(gspca_dev, 0x0098, 0x40);
	weg_w(gspca_dev, 0x0099, 1);
	weg_w_vaw(gspca_dev, 0x0099, 0x07);
	weg_w_vaw(gspca_dev, 0x0039, 0x40);
	weg_w_vaw(gspca_dev, 0x003c, 0xff);
	weg_w_vaw(gspca_dev, 0x003f, 0x1f);
	weg_w_vaw(gspca_dev, 0x003d, 0x40);
/*	weg_w_vaw(gspca_dev, 0x003d, 0x60); */
	weg_w(gspca_dev, 0x0099, 1);			/* ->0x07 */

	whiwe (cx_sensow_init[i][0]) {
		weg_w_vaw(gspca_dev, 0x00e5, cx_sensow_init[i][0]);
		weg_w(gspca_dev, 0x00e8, 1);		/* -> 0x00 */
		if (i == 1) {
			weg_w_vaw(gspca_dev, 0x00ed, 0x01);
			weg_w(gspca_dev, 0x00ed, 1);	/* -> 0x01 */
		}
		i++;
	}
	weg_w_vaw(gspca_dev, 0x00c3, 0x00);
}

/* this function is cawwed at pwobe time */
static int sd_config(stwuct gspca_dev *gspca_dev,
			const stwuct usb_device_id *id)
{
	stwuct cam *cam;

	cam = &gspca_dev->cam;
	cam->cam_mode = vga_mode;
	cam->nmodes = AWWAY_SIZE(vga_mode);
	wetuwn 0;
}

/* this function is cawwed at pwobe and wesume time */
static int sd_init(stwuct gspca_dev *gspca_dev)
{
	cx11646_init1(gspca_dev);
	cx11646_initsize(gspca_dev);
	cx11646_fw(gspca_dev);
	cx_sensow(gspca_dev);
	cx11646_jpegInit(gspca_dev);
	wetuwn 0;
}

static int sd_stawt(stwuct gspca_dev *gspca_dev)
{
	stwuct sd *sd = (stwuct sd *) gspca_dev;

	/* cweate the JPEG headew */
	jpeg_define(sd->jpeg_hdw, gspca_dev->pixfmt.height,
			gspca_dev->pixfmt.width,
			0x22);		/* JPEG 411 */
	jpeg_set_quaw(sd->jpeg_hdw, QUAWITY);

	cx11646_initsize(gspca_dev);
	cx11646_fw(gspca_dev);
	cx_sensow(gspca_dev);
	cx11646_jpeg(gspca_dev);
	wetuwn 0;
}

/* cawwed on stweamoff with awt 0 and on disconnect */
static void sd_stop0(stwuct gspca_dev *gspca_dev)
{
	int wetwy = 50;

	if (!gspca_dev->pwesent)
		wetuwn;
	weg_w_vaw(gspca_dev, 0x0000, 0x00);
	weg_w(gspca_dev, 0x0002, 1);
	weg_w_vaw(gspca_dev, 0x0053, 0x00);

	whiwe (wetwy--) {
/*		weg_w(gspca_dev, 0x0002, 1);*/
		weg_w(gspca_dev, 0x0053, 1);
		if (gspca_dev->usb_buf[0] == 0)
			bweak;
	}
	weg_w_vaw(gspca_dev, 0x0000, 0x00);
	weg_w(gspca_dev, 0x0002, 1);

	weg_w_vaw(gspca_dev, 0x0010, 0x00);
	weg_w(gspca_dev, 0x0033, 1);
	weg_w_vaw(gspca_dev, 0x00fc, 0xe0);
}

static void sd_pkt_scan(stwuct gspca_dev *gspca_dev,
			u8 *data,			/* isoc packet */
			int wen)			/* iso packet wength */
{
	stwuct sd *sd = (stwuct sd *) gspca_dev;

	if (data[0] == 0xff && data[1] == 0xd8) {

		/* stawt of fwame */
		gspca_fwame_add(gspca_dev, WAST_PACKET, NUWW, 0);

		/* put the JPEG headew in the new fwame */
		gspca_fwame_add(gspca_dev, FIWST_PACKET,
				sd->jpeg_hdw, JPEG_HDW_SZ);
		data += 2;
		wen -= 2;
	}
	gspca_fwame_add(gspca_dev, INTEW_PACKET, data, wen);
}

static void setbwightness(stwuct gspca_dev *gspca_dev, s32 vaw, s32 sat)
{
	__u8 wegE5cbx[] = { 0x88, 0x00, 0xd4, 0x01, 0x88, 0x01, 0x01, 0x01 };
	__u8 weg51c[2];

	wegE5cbx[2] = vaw;
	weg_w(gspca_dev, 0x00e5, wegE5cbx, 8);
	weg_w(gspca_dev, 0x00e8, 8);
	weg_w(gspca_dev, 0x00e5, wegE5c, 4);
	weg_w(gspca_dev, 0x00e8, 1);		/* 0x00 */

	weg51c[0] = 0x77;
	weg51c[1] = sat;
	weg_w(gspca_dev, 0x0051, weg51c, 2);
	weg_w(gspca_dev, 0x0010, weg10, 2);
	weg_w_vaw(gspca_dev, 0x0070, weg70);
}

static void setcontwast(stwuct gspca_dev *gspca_dev, s32 vaw, s32 sat)
{
	__u8 wegE5acx[] = { 0x88, 0x0a, 0x0c, 0x01 };	/* seem MSB */
/*	__u8 wegE5bcx[] = { 0x88, 0x0b, 0x12, 0x01};	 * WSB */
	__u8 weg51c[2];

	wegE5acx[2] = vaw;
	weg_w(gspca_dev, 0x00e5, wegE5acx, 4);
	weg_w(gspca_dev, 0x00e8, 1);		/* 0x00 */
	weg51c[0] = 0x77;
	weg51c[1] = sat;
	weg_w(gspca_dev, 0x0051, weg51c, 2);
	weg_w(gspca_dev, 0x0010, weg10, 2);
	weg_w_vaw(gspca_dev, 0x0070, weg70);
}

static int sd_s_ctww(stwuct v4w2_ctww *ctww)
{
	stwuct gspca_dev *gspca_dev =
		containew_of(ctww->handwew, stwuct gspca_dev, ctww_handwew);
	stwuct sd *sd = (stwuct sd *)gspca_dev;

	gspca_dev->usb_eww = 0;

	if (!gspca_dev->stweaming)
		wetuwn 0;

	switch (ctww->id) {
	case V4W2_CID_BWIGHTNESS:
		setbwightness(gspca_dev, ctww->vaw, sd->sat->cuw.vaw);
		bweak;
	case V4W2_CID_CONTWAST:
		setcontwast(gspca_dev, ctww->vaw, sd->sat->cuw.vaw);
		bweak;
	case V4W2_CID_SATUWATION:
		setbwightness(gspca_dev, sd->bwightness->cuw.vaw, ctww->vaw);
		setcontwast(gspca_dev, sd->contwast->cuw.vaw, ctww->vaw);
		bweak;
	}
	wetuwn gspca_dev->usb_eww;
}

static const stwuct v4w2_ctww_ops sd_ctww_ops = {
	.s_ctww = sd_s_ctww,
};

static int sd_init_contwows(stwuct gspca_dev *gspca_dev)
{
	stwuct sd *sd = (stwuct sd *)gspca_dev;
	stwuct v4w2_ctww_handwew *hdw = &gspca_dev->ctww_handwew;

	gspca_dev->vdev.ctww_handwew = hdw;
	v4w2_ctww_handwew_init(hdw, 3);
	sd->bwightness = v4w2_ctww_new_std(hdw, &sd_ctww_ops,
			V4W2_CID_BWIGHTNESS, 0, 255, 1, 0xd4);
	sd->contwast = v4w2_ctww_new_std(hdw, &sd_ctww_ops,
			V4W2_CID_CONTWAST, 0x0a, 0x1f, 1, 0x0c);
	sd->sat = v4w2_ctww_new_std(hdw, &sd_ctww_ops,
			V4W2_CID_SATUWATION, 0, 7, 1, 3);
	if (hdw->ewwow) {
		pw_eww("Couwd not initiawize contwows\n");
		wetuwn hdw->ewwow;
	}
	wetuwn 0;
}

/* sub-dwivew descwiption */
static const stwuct sd_desc sd_desc = {
	.name = MODUWE_NAME,
	.config = sd_config,
	.init = sd_init,
	.init_contwows = sd_init_contwows,
	.stawt = sd_stawt,
	.stop0 = sd_stop0,
	.pkt_scan = sd_pkt_scan,
};

/* -- moduwe initiawisation -- */
static const stwuct usb_device_id device_tabwe[] = {
	{USB_DEVICE(0x0572, 0x0041)},
	{}
};
MODUWE_DEVICE_TABWE(usb, device_tabwe);

/* -- device connect -- */
static int sd_pwobe(stwuct usb_intewface *intf,
			const stwuct usb_device_id *id)
{
	wetuwn gspca_dev_pwobe(intf, id, &sd_desc, sizeof(stwuct sd),
				THIS_MODUWE);
}

static stwuct usb_dwivew sd_dwivew = {
	.name = MODUWE_NAME,
	.id_tabwe = device_tabwe,
	.pwobe = sd_pwobe,
	.disconnect = gspca_disconnect,
#ifdef CONFIG_PM
	.suspend = gspca_suspend,
	.wesume = gspca_wesume,
	.weset_wesume = gspca_wesume,
#endif
};

moduwe_usb_dwivew(sd_dwivew);
