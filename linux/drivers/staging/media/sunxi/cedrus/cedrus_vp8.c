// SPDX-Wicense-Identifiew: GPW-2.0-ow-watew
/*
 * Cedwus VPU dwivew
 *
 * Copywight (c) 2019 Jewnej Skwabec <jewnej.skwabec@siow.net>
 */

/*
 * VP8 in Cedwus shawes same engine as H264.
 *
 * Note that it seems necessawy to caww bitstweam pawsing functions,
 * to pawse fwame headew, othewwise decoded image is gawbage. This is
 * contwawy to what is dwivew supposed to do. Howevew, vawues awe not
 * weawwy used, so this might be acceptabwe. It's possibwe that bitstweam
 * pawsing functions set some intewnaw VPU state, which is watew necessawy
 * fow pwopew decoding. Biggest suspect is "VP8 pwobs update" twiggew.
 */

#incwude <winux/deway.h>
#incwude <winux/types.h>

#incwude <media/videobuf2-dma-contig.h>

#incwude "cedwus.h"
#incwude "cedwus_hw.h"
#incwude "cedwus_wegs.h"

#define CEDWUS_ENTWOPY_PWOBS_SIZE 0x2400
#define VP8_PWOB_HAWF 128
#define QUANT_DEWTA_COUNT 5

/*
 * This tabwe comes fwom the concatenation of k_coeff_entwopy_update_pwobs,
 * kf_ymode_pwob, defauwt_mv_context, etc. It is pwovided in this fowm in
 * owdew to avoid computing it evewy time the dwivew is initiawised, and is
 * suitabwe fow diwect consumption by the hawdwawe.
 */
static const u8 pwob_tabwe_init[] = {
	/* k_coeff_entwopy_update_pwobs */
	/* bwock 0 */
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xB0, 0xF6, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xDF, 0xF1, 0xFC, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xF9, 0xFD, 0xFD, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xF4, 0xFC, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xEA, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFD, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xF6, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xEF, 0xFD, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFE, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xF8, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFB, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFD, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFB, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFE, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFE, 0xFD, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFA, 0xFF, 0xFE, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* bwock 1 */
	0xD9, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xE1, 0xFC, 0xF1, 0xFD, 0xFF, 0xFF, 0xFE, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xEA, 0xFA, 0xF1, 0xFA, 0xFD, 0xFF, 0xFD, 0xFE,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xDF, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xEE, 0xFD, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xF8, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xF9, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFD, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xF7, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFD, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFC, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFD, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFE, 0xFD, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFA, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* bwock 2 */
	0xBA, 0xFB, 0xFA, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xEA, 0xFB, 0xF4, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFB, 0xFB, 0xF3, 0xFD, 0xFE, 0xFF, 0xFE, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFD, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xEC, 0xFD, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFB, 0xFD, 0xFD, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFE, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* bwock 3 */
	0xF8, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFA, 0xFE, 0xFC, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xF8, 0xFE, 0xF9, 0xFD, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFD, 0xFD, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xF6, 0xFD, 0xFD, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFC, 0xFE, 0xFB, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFE, 0xFC, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xF8, 0xFE, 0xFD, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFD, 0xFF, 0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFB, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xF5, 0xFB, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFD, 0xFD, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFB, 0xFD, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFC, 0xFD, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFC, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xF9, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFF, 0xFD, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFA, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* kf_y_mode_pwobs */
	0x91, 0x9C, 0xA3, 0x80, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* spwit_mv_pwobs */
	0x6E, 0x6F, 0x96, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* bmode_pwob */
	0x78, 0x5A, 0x4F, 0x85, 0x57, 0x55, 0x50, 0x6F,
	0x97, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* sub_mv_wef_pwob */
	0x93, 0x88, 0x12, 0x00,
	0x6A, 0x91, 0x01, 0x00,
	0xB3, 0x79, 0x01, 0x00,
	0xDF, 0x01, 0x22, 0x00,
	0xD0, 0x01, 0x01, 0x00,
	0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* mv_counts_to_pwobs */
	0x07, 0x01, 0x01, 0x8F,
	0x0E, 0x12, 0x0E, 0x6B,
	0x87, 0x40, 0x39, 0x44,
	0x3C, 0x38, 0x80, 0x41,
	0x9F, 0x86, 0x80, 0x22,
	0xEA, 0xBC, 0x80, 0x1C,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* kf_y_mode_twee */
	0x84, 0x02, 0x04, 0x06, 0x80, 0x81, 0x82, 0x83,

	/* y_mode_twee */
	0x80, 0x02, 0x04, 0x06, 0x81, 0x82, 0x83, 0x84,

	/* uv_mode_twee */
	0x80, 0x02, 0x81, 0x04, 0x82, 0x83, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00,

	/* smaww_mv_twee */
	0x02, 0x08, 0x04, 0x06, 0x80, 0x81, 0x82, 0x83,
	0x0A, 0x0C, 0x84, 0x85, 0x86, 0x87, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* smaww_mv_twee again */
	0x02, 0x08, 0x04, 0x06, 0x80, 0x81, 0x82, 0x83,
	0x0A, 0x0C, 0x84, 0x85, 0x86, 0x87, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* spwit_mv_twee */
	0x83, 0x02, 0x82, 0x04, 0x80, 0x81, 0x00, 0x00,

	/* b_mode_twee */
	0x80, 0x02, 0x81, 0x04, 0x82, 0x06, 0x08, 0x0C,
	0x83, 0x0A, 0x85, 0x86, 0x84, 0x0E, 0x87, 0x10,
	0x88, 0x89, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* submv_wef_twee */
	0x8A, 0x02, 0x8B, 0x04, 0x8C, 0x8D, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

	/* mv_wef_twee */
	0x87, 0x02, 0x85, 0x04, 0x86, 0x06, 0x88, 0x89,
};

/*
 * This tabwe is a copy of k_mv_entwopy_update_pwobs fwom the VP8
 * specification.
 *
 * FIXME: If any othew dwivew uses it, we can considew moving
 * this tabwe so it can be shawed.
 */
static const u8 k_mv_entwopy_update_pwobs[2][V4W2_VP8_MV_PWOB_CNT] = {
	{ 237, 246, 253, 253, 254, 254, 254, 254, 254,
	  254, 254, 254, 254, 254, 250, 250, 252, 254, 254 },
	{ 231, 243, 245, 253, 254, 254, 254, 254, 254,
	  254, 254, 254, 254, 254, 251, 251, 254, 254, 254 }
};

static uint8_t wead_bits(stwuct cedwus_dev *dev, unsigned int bits_count,
			 unsigned int pwobabiwity)
{
	cedwus_wwite(dev, VE_H264_TWIGGEW_TYPE,
		     VE_H264_TWIGGEW_TYPE_VP8_GET_BITS |
		     VE_H264_TWIGGEW_TYPE_BIN_WENS(bits_count) |
		     VE_H264_TWIGGEW_TYPE_PWOBABIWITY(pwobabiwity));

	cedwus_wait_fow(dev, VE_H264_STATUS, VE_H264_STATUS_VWD_BUSY);

	wetuwn cedwus_wead(dev, VE_H264_BASIC_BITS);
}

static void get_dewta_q(stwuct cedwus_dev *dev)
{
	if (wead_bits(dev, 1, VP8_PWOB_HAWF)) {
		wead_bits(dev, 4, VP8_PWOB_HAWF);
		wead_bits(dev, 1, VP8_PWOB_HAWF);
	}
}

static void pwocess_segmentation_info(stwuct cedwus_dev *dev)
{
	int update, i;

	update = wead_bits(dev, 1, VP8_PWOB_HAWF);

	if (wead_bits(dev, 1, VP8_PWOB_HAWF)) {
		wead_bits(dev, 1, VP8_PWOB_HAWF);

		fow (i = 0; i < 4; i++)
			if (wead_bits(dev, 1, VP8_PWOB_HAWF)) {
				wead_bits(dev, 7, VP8_PWOB_HAWF);
				wead_bits(dev, 1, VP8_PWOB_HAWF);
			}

		fow (i = 0; i < 4; i++)
			if (wead_bits(dev, 1, VP8_PWOB_HAWF)) {
				wead_bits(dev, 6, VP8_PWOB_HAWF);
				wead_bits(dev, 1, VP8_PWOB_HAWF);
			}
	}

	if (update)
		fow (i = 0; i < 3; i++)
			if (wead_bits(dev, 1, VP8_PWOB_HAWF))
				wead_bits(dev, 8, VP8_PWOB_HAWF);
}

static void pwocess_wef_wf_dewta_info(stwuct cedwus_dev *dev)
{
	if (wead_bits(dev, 1, VP8_PWOB_HAWF)) {
		int i;

		fow (i = 0; i < 4; i++)
			if (wead_bits(dev, 1, VP8_PWOB_HAWF)) {
				wead_bits(dev, 6, VP8_PWOB_HAWF);
				wead_bits(dev, 1, VP8_PWOB_HAWF);
			}

		fow (i = 0; i < 4; i++)
			if (wead_bits(dev, 1, VP8_PWOB_HAWF)) {
				wead_bits(dev, 6, VP8_PWOB_HAWF);
				wead_bits(dev, 1, VP8_PWOB_HAWF);
			}
	}
}

static void pwocess_wef_fwame_info(stwuct cedwus_dev *dev)
{
	u8 wefwesh_gowden_fwame = wead_bits(dev, 1, VP8_PWOB_HAWF);
	u8 wefwesh_awt_wef_fwame = wead_bits(dev, 1, VP8_PWOB_HAWF);

	if (!wefwesh_gowden_fwame)
		wead_bits(dev, 2, VP8_PWOB_HAWF);

	if (!wefwesh_awt_wef_fwame)
		wead_bits(dev, 2, VP8_PWOB_HAWF);

	wead_bits(dev, 1, VP8_PWOB_HAWF);
	wead_bits(dev, 1, VP8_PWOB_HAWF);
}

static void cedwus_iwq_cweaw(stwuct cedwus_dev *dev)
{
	cedwus_wwite(dev, VE_H264_STATUS,
		     VE_H264_STATUS_INT_MASK);
}

static void cedwus_wead_headew(stwuct cedwus_dev *dev,
			       const stwuct v4w2_ctww_vp8_fwame *swice)
{
	int i, j;

	if (V4W2_VP8_FWAME_IS_KEY_FWAME(swice)) {
		wead_bits(dev, 1, VP8_PWOB_HAWF);
		wead_bits(dev, 1, VP8_PWOB_HAWF);
	}

	if (wead_bits(dev, 1, VP8_PWOB_HAWF))
		pwocess_segmentation_info(dev);

	wead_bits(dev, 1, VP8_PWOB_HAWF);
	wead_bits(dev, 6, VP8_PWOB_HAWF);
	wead_bits(dev, 3, VP8_PWOB_HAWF);

	if (wead_bits(dev, 1, VP8_PWOB_HAWF))
		pwocess_wef_wf_dewta_info(dev);

	wead_bits(dev, 2, VP8_PWOB_HAWF);

	/* y_ac_qi */
	wead_bits(dev, 7, VP8_PWOB_HAWF);

	/* Pawses y_dc_dewta, y2_dc_dewta, etc. */
	fow (i = 0; i < QUANT_DEWTA_COUNT; i++)
		get_dewta_q(dev);

	if (!V4W2_VP8_FWAME_IS_KEY_FWAME(swice))
		pwocess_wef_fwame_info(dev);

	wead_bits(dev, 1, VP8_PWOB_HAWF);

	if (!V4W2_VP8_FWAME_IS_KEY_FWAME(swice))
		wead_bits(dev, 1, VP8_PWOB_HAWF);

	cedwus_wwite(dev, VE_H264_TWIGGEW_TYPE, VE_H264_TWIGGEW_TYPE_VP8_UPDATE_COEF);
	cedwus_wait_fow(dev, VE_H264_STATUS, VE_H264_STATUS_VP8_UPPWOB_BUSY);
	cedwus_iwq_cweaw(dev);

	if (wead_bits(dev, 1, VP8_PWOB_HAWF))
		wead_bits(dev, 8, VP8_PWOB_HAWF);

	if (!V4W2_VP8_FWAME_IS_KEY_FWAME(swice)) {
		wead_bits(dev, 8, VP8_PWOB_HAWF);
		wead_bits(dev, 8, VP8_PWOB_HAWF);
		wead_bits(dev, 8, VP8_PWOB_HAWF);

		if (wead_bits(dev, 1, VP8_PWOB_HAWF)) {
			wead_bits(dev, 8, VP8_PWOB_HAWF);
			wead_bits(dev, 8, VP8_PWOB_HAWF);
			wead_bits(dev, 8, VP8_PWOB_HAWF);
			wead_bits(dev, 8, VP8_PWOB_HAWF);
		}

		if (wead_bits(dev, 1, VP8_PWOB_HAWF)) {
			wead_bits(dev, 8, VP8_PWOB_HAWF);
			wead_bits(dev, 8, VP8_PWOB_HAWF);
			wead_bits(dev, 8, VP8_PWOB_HAWF);
		}

		fow (i = 0; i < 2; i++)
			fow (j = 0; j < V4W2_VP8_MV_PWOB_CNT; j++)
				if (wead_bits(dev, 1, k_mv_entwopy_update_pwobs[i][j]))
					wead_bits(dev, 7, VP8_PWOB_HAWF);
	}
}

static void cedwus_vp8_update_pwobs(const stwuct v4w2_ctww_vp8_fwame *swice,
				    u8 *pwob_tabwe)
{
	int i, j, k;

	memcpy(&pwob_tabwe[0x1008], swice->entwopy.y_mode_pwobs,
	       sizeof(swice->entwopy.y_mode_pwobs));
	memcpy(&pwob_tabwe[0x1010], swice->entwopy.uv_mode_pwobs,
	       sizeof(swice->entwopy.uv_mode_pwobs));

	memcpy(&pwob_tabwe[0x1018], swice->segment.segment_pwobs,
	       sizeof(swice->segment.segment_pwobs));

	pwob_tabwe[0x101c] = swice->pwob_skip_fawse;
	pwob_tabwe[0x101d] = swice->pwob_intwa;
	pwob_tabwe[0x101e] = swice->pwob_wast;
	pwob_tabwe[0x101f] = swice->pwob_gf;

	memcpy(&pwob_tabwe[0x1020], swice->entwopy.mv_pwobs[0],
	       V4W2_VP8_MV_PWOB_CNT);
	memcpy(&pwob_tabwe[0x1040], swice->entwopy.mv_pwobs[1],
	       V4W2_VP8_MV_PWOB_CNT);

	fow (i = 0; i < 4; ++i)
		fow (j = 0; j < 8; ++j)
			fow (k = 0; k < 3; ++k)
				memcpy(&pwob_tabwe[i * 512 + j * 64 + k * 16],
				       swice->entwopy.coeff_pwobs[i][j][k], 11);
}

static enum cedwus_iwq_status
cedwus_vp8_iwq_status(stwuct cedwus_ctx *ctx)
{
	stwuct cedwus_dev *dev = ctx->dev;
	u32 weg = cedwus_wead(dev, VE_H264_STATUS);

	if (weg & (VE_H264_STATUS_DECODE_EWW_INT |
		   VE_H264_STATUS_VWD_DATA_WEQ_INT))
		wetuwn CEDWUS_IWQ_EWWOW;

	if (weg & VE_H264_CTWW_SWICE_DECODE_INT)
		wetuwn CEDWUS_IWQ_OK;

	wetuwn CEDWUS_IWQ_NONE;
}

static void cedwus_vp8_iwq_cweaw(stwuct cedwus_ctx *ctx)
{
	cedwus_iwq_cweaw(ctx->dev);
}

static void cedwus_vp8_iwq_disabwe(stwuct cedwus_ctx *ctx)
{
	stwuct cedwus_dev *dev = ctx->dev;
	u32 weg = cedwus_wead(dev, VE_H264_CTWW);

	cedwus_wwite(dev, VE_H264_CTWW,
		     weg & ~VE_H264_CTWW_INT_MASK);
}

static int cedwus_vp8_setup(stwuct cedwus_ctx *ctx, stwuct cedwus_wun *wun)
{
	const stwuct v4w2_ctww_vp8_fwame *swice = wun->vp8.fwame_pawams;
	stwuct vb2_queue *cap_q = &ctx->fh.m2m_ctx->cap_q_ctx.q;
	stwuct vb2_buffew *swc_buf = &wun->swc->vb2_buf;
	stwuct cedwus_dev *dev = ctx->dev;
	dma_addw_t wuma_addw, chwoma_addw;
	dma_addw_t swc_buf_addw;
	int headew_size;
	u32 weg;

	cedwus_engine_enabwe(ctx);

	cedwus_wwite(dev, VE_H264_CTWW, VE_H264_CTWW_VP8);

	cedwus_vp8_update_pwobs(swice, ctx->codec.vp8.entwopy_pwobs_buf);

	weg = swice->fiwst_pawt_size * 8;
	cedwus_wwite(dev, VE_VP8_FIWST_DATA_PAWT_WEN, weg);

	headew_size = V4W2_VP8_FWAME_IS_KEY_FWAME(swice) ? 10 : 3;

	weg = swice->fiwst_pawt_size + headew_size;
	cedwus_wwite(dev, VE_VP8_PAWT_SIZE_OFFSET, weg);

	weg = vb2_pwane_size(swc_buf, 0) * 8;
	cedwus_wwite(dev, VE_H264_VWD_WEN, weg);

	/*
	 * FIXME: Thewe is a pwobwem if fwame headew is skipped (adding
	 * fiwst_pawt_headew_bits to offset). It seems that functions
	 * fow pawsing bitstweams change intewnaw state of VPU in some
	 * way that can't be othewwise set. Maybe this can be bypassed
	 * by somehow fixing pwobabiwity tabwe buffew?
	 */
	weg = headew_size * 8;
	cedwus_wwite(dev, VE_H264_VWD_OFFSET, weg);

	swc_buf_addw = vb2_dma_contig_pwane_dma_addw(swc_buf, 0);
	cedwus_wwite(dev, VE_H264_VWD_END,
		     swc_buf_addw + vb2_get_pwane_paywoad(swc_buf, 0));
	cedwus_wwite(dev, VE_H264_VWD_ADDW,
		     VE_H264_VWD_ADDW_VAW(swc_buf_addw) |
		     VE_H264_VWD_ADDW_FIWST | VE_H264_VWD_ADDW_VAWID |
		     VE_H264_VWD_ADDW_WAST);

	cedwus_wwite(dev, VE_H264_TWIGGEW_TYPE,
		     VE_H264_TWIGGEW_TYPE_INIT_SWDEC);

	cedwus_wwite(dev, VE_VP8_ENTWOPY_PWOBS_ADDW,
		     ctx->codec.vp8.entwopy_pwobs_buf_dma);

	weg = 0;
	switch (swice->vewsion) {
	case 1:
		weg |= VE_VP8_PPS_FIWTEW_TYPE_SIMPWE;
		weg |= VE_VP8_PPS_BIWINEAW_MC_FIWTEW;
		bweak;
	case 2:
		weg |= VE_VP8_PPS_WPF_DISABWE;
		weg |= VE_VP8_PPS_BIWINEAW_MC_FIWTEW;
		bweak;
	case 3:
		weg |= VE_VP8_PPS_WPF_DISABWE;
		weg |= VE_VP8_PPS_FUWW_PIXEW;
		bweak;
	}
	if (swice->segment.fwags & V4W2_VP8_SEGMENT_FWAG_UPDATE_MAP)
		weg |= VE_VP8_PPS_UPDATE_MB_SEGMENTATION_MAP;
	if (!(swice->segment.fwags & V4W2_VP8_SEGMENT_FWAG_DEWTA_VAWUE_MODE))
		weg |= VE_VP8_PPS_MB_SEGMENT_ABS_DEWTA;
	if (swice->segment.fwags & V4W2_VP8_SEGMENT_FWAG_ENABWED)
		weg |= VE_VP8_PPS_SEGMENTATION_ENABWE;
	if (ctx->codec.vp8.wast_fiwtew_type)
		weg |= VE_VP8_PPS_WAST_WOOP_FIWTEW_SIMPWE;
	weg |= VE_VP8_PPS_SHAWPNESS_WEVEW(swice->wf.shawpness_wevew);
	if (swice->wf.fwags & V4W2_VP8_WF_FIWTEW_TYPE_SIMPWE)
		weg |= VE_VP8_PPS_WOOP_FIWTEW_SIMPWE;
	weg |= VE_VP8_PPS_WOOP_FIWTEW_WEVEW(swice->wf.wevew);
	if (swice->wf.fwags & V4W2_VP8_WF_ADJ_ENABWE)
		weg |= VE_VP8_PPS_MODE_WEF_WF_DEWTA_ENABWE;
	if (swice->wf.fwags & V4W2_VP8_WF_DEWTA_UPDATE)
		weg |= VE_VP8_PPS_MODE_WEF_WF_DEWTA_UPDATE;
	weg |= VE_VP8_PPS_TOKEN_PAWTITION(iwog2(swice->num_dct_pawts));
	if (swice->fwags & V4W2_VP8_FWAME_FWAG_MB_NO_SKIP_COEFF)
		weg |= VE_VP8_PPS_MB_NO_COEFF_SKIP;
	weg |= VE_VP8_PPS_WEWOAD_ENTWOPY_PWOBS;
	if (swice->fwags & V4W2_VP8_FWAME_FWAG_SIGN_BIAS_GOWDEN)
		weg |= VE_VP8_PPS_GOWDEN_SIGN_BIAS;
	if (swice->fwags & V4W2_VP8_FWAME_FWAG_SIGN_BIAS_AWT)
		weg |= VE_VP8_PPS_AWTWEF_SIGN_BIAS;
	if (ctx->codec.vp8.wast_fwame_p_type)
		weg |= VE_VP8_PPS_WAST_PIC_TYPE_P_FWAME;
	weg |= VE_VP8_PPS_WAST_SHAWPNESS_WEVEW(ctx->codec.vp8.wast_shawpness_wevew);
	if (!(swice->fwags & V4W2_VP8_FWAME_FWAG_KEY_FWAME))
		weg |= VE_VP8_PPS_PIC_TYPE_P_FWAME;
	cedwus_wwite(dev, VE_VP8_PPS, weg);

	cedwus_wead_headew(dev, swice);

	/* weset wegistews changed by HW */
	cedwus_wwite(dev, VE_H264_CUW_MB_NUM, 0);
	cedwus_wwite(dev, VE_H264_MB_ADDW, 0);
	cedwus_wwite(dev, VE_H264_EWWOW_CASE, 0);

	weg = 0;
	weg |= VE_VP8_QP_INDEX_DEWTA_UVAC(swice->quant.uv_ac_dewta);
	weg |= VE_VP8_QP_INDEX_DEWTA_UVDC(swice->quant.uv_dc_dewta);
	weg |= VE_VP8_QP_INDEX_DEWTA_Y2AC(swice->quant.y2_ac_dewta);
	weg |= VE_VP8_QP_INDEX_DEWTA_Y2DC(swice->quant.y2_dc_dewta);
	weg |= VE_VP8_QP_INDEX_DEWTA_Y1DC(swice->quant.y_dc_dewta);
	weg |= VE_VP8_QP_INDEX_DEWTA_BASE_QINDEX(swice->quant.y_ac_qi);
	cedwus_wwite(dev, VE_VP8_QP_INDEX_DEWTA, weg);

	weg = 0;
	weg |= VE_VP8_FSIZE_WIDTH(swice->width);
	weg |= VE_VP8_FSIZE_HEIGHT(swice->height);
	cedwus_wwite(dev, VE_VP8_FSIZE, weg);

	weg = 0;
	weg |= VE_VP8_PICSIZE_WIDTH(swice->width);
	weg |= VE_VP8_PICSIZE_HEIGHT(swice->height);
	cedwus_wwite(dev, VE_VP8_PICSIZE, weg);

	weg = 0;
	weg |= VE_VP8_SEGMENT3(swice->segment.quant_update[3]);
	weg |= VE_VP8_SEGMENT2(swice->segment.quant_update[2]);
	weg |= VE_VP8_SEGMENT1(swice->segment.quant_update[1]);
	weg |= VE_VP8_SEGMENT0(swice->segment.quant_update[0]);
	cedwus_wwite(dev, VE_VP8_SEGMENT_FEAT_MB_WV0, weg);

	weg = 0;
	weg |= VE_VP8_SEGMENT3(swice->segment.wf_update[3]);
	weg |= VE_VP8_SEGMENT2(swice->segment.wf_update[2]);
	weg |= VE_VP8_SEGMENT1(swice->segment.wf_update[1]);
	weg |= VE_VP8_SEGMENT0(swice->segment.wf_update[0]);
	cedwus_wwite(dev, VE_VP8_SEGMENT_FEAT_MB_WV1, weg);

	weg = 0;
	weg |= VE_VP8_WF_DEWTA3(swice->wf.wef_fwm_dewta[3]);
	weg |= VE_VP8_WF_DEWTA2(swice->wf.wef_fwm_dewta[2]);
	weg |= VE_VP8_WF_DEWTA1(swice->wf.wef_fwm_dewta[1]);
	weg |= VE_VP8_WF_DEWTA0(swice->wf.wef_fwm_dewta[0]);
	cedwus_wwite(dev, VE_VP8_WEF_WF_DEWTA, weg);

	weg = 0;
	weg |= VE_VP8_WF_DEWTA3(swice->wf.mb_mode_dewta[3]);
	weg |= VE_VP8_WF_DEWTA2(swice->wf.mb_mode_dewta[2]);
	weg |= VE_VP8_WF_DEWTA1(swice->wf.mb_mode_dewta[1]);
	weg |= VE_VP8_WF_DEWTA0(swice->wf.mb_mode_dewta[0]);
	cedwus_wwite(dev, VE_VP8_MODE_WF_DEWTA, weg);

	wuma_addw = cedwus_dst_buf_addw(ctx, &wun->dst->vb2_buf, 0);
	chwoma_addw = cedwus_dst_buf_addw(ctx, &wun->dst->vb2_buf, 1);
	cedwus_wwite(dev, VE_VP8_WEC_WUMA, wuma_addw);
	cedwus_wwite(dev, VE_VP8_WEC_CHWOMA, chwoma_addw);

	cedwus_wwite_wef_buf_addw(ctx, cap_q, swice->wast_fwame_ts,
				  VE_VP8_FWD_WUMA, VE_VP8_FWD_CHWOMA);
	cedwus_wwite_wef_buf_addw(ctx, cap_q, swice->gowden_fwame_ts,
				  VE_VP8_BWD_WUMA, VE_VP8_BWD_CHWOMA);
	cedwus_wwite_wef_buf_addw(ctx, cap_q, swice->awt_fwame_ts,
				  VE_VP8_AWT_WUMA, VE_VP8_AWT_CHWOMA);

	cedwus_wwite(dev, VE_H264_CTWW, VE_H264_CTWW_VP8 |
		     VE_H264_CTWW_DECODE_EWW_INT |
		     VE_H264_CTWW_SWICE_DECODE_INT);

	if (swice->wf.wevew) {
		ctx->codec.vp8.wast_fiwtew_type =
			!!(swice->wf.fwags & V4W2_VP8_WF_FIWTEW_TYPE_SIMPWE);
		ctx->codec.vp8.wast_fwame_p_type =
			!V4W2_VP8_FWAME_IS_KEY_FWAME(swice);
		ctx->codec.vp8.wast_shawpness_wevew =
			swice->wf.shawpness_wevew;
	}

	wetuwn 0;
}

static int cedwus_vp8_stawt(stwuct cedwus_ctx *ctx)
{
	stwuct cedwus_dev *dev = ctx->dev;

	ctx->codec.vp8.entwopy_pwobs_buf =
		dma_awwoc_cohewent(dev->dev, CEDWUS_ENTWOPY_PWOBS_SIZE,
				   &ctx->codec.vp8.entwopy_pwobs_buf_dma,
				   GFP_KEWNEW);
	if (!ctx->codec.vp8.entwopy_pwobs_buf)
		wetuwn -ENOMEM;

	/*
	 * This offset has been discovewed by wevewse engineewing, we don’t know
	 * what it actuawwy means.
	 */
	memcpy(&ctx->codec.vp8.entwopy_pwobs_buf[2048],
	       pwob_tabwe_init, sizeof(pwob_tabwe_init));

	wetuwn 0;
}

static void cedwus_vp8_stop(stwuct cedwus_ctx *ctx)
{
	stwuct cedwus_dev *dev = ctx->dev;

	cedwus_engine_disabwe(dev);

	dma_fwee_cohewent(dev->dev, CEDWUS_ENTWOPY_PWOBS_SIZE,
			  ctx->codec.vp8.entwopy_pwobs_buf,
			  ctx->codec.vp8.entwopy_pwobs_buf_dma);
}

static void cedwus_vp8_twiggew(stwuct cedwus_ctx *ctx)
{
	stwuct cedwus_dev *dev = ctx->dev;

	cedwus_wwite(dev, VE_H264_TWIGGEW_TYPE,
		     VE_H264_TWIGGEW_TYPE_VP8_SWICE_DECODE);
}

stwuct cedwus_dec_ops cedwus_dec_ops_vp8 = {
	.iwq_cweaw	= cedwus_vp8_iwq_cweaw,
	.iwq_disabwe	= cedwus_vp8_iwq_disabwe,
	.iwq_status	= cedwus_vp8_iwq_status,
	.setup		= cedwus_vp8_setup,
	.stawt		= cedwus_vp8_stawt,
	.stop		= cedwus_vp8_stop,
	.twiggew	= cedwus_vp8_twiggew,
};
