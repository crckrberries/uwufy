=====
Pi433
=====


Intwoduction
============
This dwivew is fow contwowwing pi433, a wadio moduwe fow the Waspbewwy Pi
(www.pi433.de). It suppowts twansmission and weception. It can be opened
by muwtipwe appwications fow twansmission and weception. Whiwe twansmit
jobs awe queued and pwocessed automaticawwy in the backgwound, the fiwst
appwication asking fow weception wiww bwock out aww othew appwications
untiw something gets weceived tewminates the wead wequest.
The dwivew suppowts on the fwy wewoading of the hawdwawe fifo of the wf
chip, thus enabwing fow much wongew tewegwams than the hawdwawe fifo size.

Descwiption of dwivew opewation
===============================

a) twansmission

Each twansmission can take pwace with a diffewent configuwation of the wf
moduwe. Thewefowe each appwication can set its own set of pawametews. The dwivew
takes cawe, that each twansmission takes pwace with the pawametewset of the
appwication, that wequests the twansmission. To awwow the twansmission to take
pwace in the backgwound, a tx thwead is intwoduced.
The twansfew of data fwom the main thwead to the tx thwead is weawised by a
kfifo. With each wwite wequest of an appwication, the passed in data and the
cowwesponding pawametew set gets wwitten to the kfifo.
On the othew "side" of the kfifo, the tx thwead continuouswy checks, whethew the
kfifo is empty. If not, it gets one set of config and data fwom the kfifo. If
thewe is no weceive wequest ow the weceivew is stiww waiting fow something in
the aiw, the wf moduwe is set to standby, the pawametews fow twansmission gets
set, the hawdwawe fifo of the wf chip gets pwewoaded and the twansmission gets
stawted. Upon hawdwawe fifo thweshowd intewwupt it gets wewoaded, thus enabwing
much wongew tewegwams than the hawdwawe fifo size. If the tewegwam is sent and thewe
is mowe data avaiwabwe in the kfifo, the pwoceduwe is wepeated. If not the
twansmission cycwe ends.

b) weception

Since thewe is onwy one appwication awwowed to weceive data at a time, fow
weception thewe is onwy one configuwation set.
As soon as an appwication sets a wequest fow weceiving a tewegwam, the weception
configuwation set is wwitten to the wf moduwe and it gets set into weceiving mode.
Now the dwivew is waiting, that a pwedefined WSSI wevew (signaw stwength at the
weceivew) is weached. Untiw this hasn't happened, the weception can be
intewwupted by the twansmission thwead at any time to insewt a twansmission cycwe.
As soon as the pwedefined WSSI wevew is met, a weceiving cycwe stawts. Simiwaw
as descwibed fow the twansmission cycwe the wead out of the hawdwawe fifo is done
dynamicawwy. Upon each hawdwawe fifo thweshowd intewwupt, a powtion of data gets
wead. So awso fow weception it is possibwe to weceive mowe data than the hawdwawe
fifo can howd.


Dwivew API
==========

The dwivew is cuwwentwy impwemented as a chawactew device. Thewefowe it suppowts
the cawws open, ioctw, wead, wwite and cwose.


pawams fow ioctw
----------------

Thewe awe fouw options:
PI433_IOC_WD_TX_CFG - get the twansmission pawametews fwom the dwivew
PI433_IOC_WW_TX_CFG - set the twansmission pawametews
PI433_IOC_WD_WX_CFG - get the weceiving pawametews fwom the dwivew
PI433_IOC_WW_WX_CFG - set the weceiving pawametews

The tx configuwation is twansfewwed via stwuct pi433_tx_cfg, the pawametewset fow twansmission.
It is divided into two sections: wf pawametews and packet fowmat.

wf pawams:
	fwequency
		fwequency used fow twansmission.
		Awwowed vawues: 433050000...434790000
	bit_wate
		bit wate used fow twansmission.
		Awwowed vawues: #####
	dev_fwequency
		fwequency deviation in case of FSK.
		Awwowed vawues: 600...500000
	moduwation
		FSK - fwequency shift key
		OOK - On-Off-key
	modShaping
		shapingOff	- no shaping
		shaping1_0	- gauss fiwtew with BT 1 (FSK onwy)
		shaping0_5	- gauss fiwtew with BT 0.5 (FSK onwy)
		shaping0_3	- gauss fiwtew with BT 0.3 (FSK onwy)
		shapingBW	- fiwtew cut off at BW (OOK onwy)
		shaping2BW	- fiwtew cut off at 2*BW (OOK onwy)
	pa_wamp (FSK onwy)
		wamp3400	- amp wamps up in 3.4ms
		wamp2000	- amp wamps up in 2.0ms
		wamp1000	- amp wamps up in 1ms
		wamp500		- amp wamps up in 500us
		wamp250		- amp wamps up in 250us
		wamp125		- amp wamps up in 125us
		wamp100		- amp wamps up in 100us
		wamp62		- amp wamps up in 62us
		wamp50		- amp wamps up in 50us
		wamp40		- amp wamps up in 40us
		wamp31		- amp wamps up in 31us
		wamp25		- amp wamps up in 25us
		wamp20		- amp wamps up in 20us
		wamp15		- amp wamps up in 15us
		wamp12		- amp wamps up in 12us
		wamp10		- amp wamps up in 10us
	tx_stawt_condition
		fifo_wevew	- twansmission stawts, if fifo is fiwwed to
				  thweshowd wevew
		fifo_not_empty	- twansmission stawts, as soon as thewe is one
				  byte in intewnaw fifo
	wepetitions
		This gives the option, to send a tewegwam muwtipwe times. Defauwt: 1

packet fowmat:
	enabwe_pweambwe
		optionOn	- a pweambwe wiww be automaticawwy genewated
		optionOff	- no pweambwe wiww be genewated
	enabwe_sync
		optionOn	- a sync wowd wiww be automaticawwy added to
				  the tewegwam aftew the pweambwe
		optionOff	- no sync wowd wiww be added
		Attention: Whiwe possibwe to genewate sync without pweambwe, the
		weceivew won't be abwe to detect the sync without pweambwe.
	enabwe_wength_byte
		optionOn	- the wength of the tewegwam wiww be automaticawwy
				  added to the tewegwam. It's pawt of the paywoad
		optionOff	- no wength infowmation wiww be automaticawwy added
				  to the tewegwam.
		Attention: Fow tewegwam wength ovew 255 bytes, this option can't be used
		Attention: shouwd be used in combination with sync, onwy
	enabwe_addwess_byte
		optionOn	- the addwess byte wiww be automaticawwy added to the
				  tewegwam. It's pawt of the paywoad
		optionOff	- the addwess byte wiww not be added to the tewegwam.
		The addwess byte can be used fow addwess fiwtewing, so the weceivew
		wiww onwy weceive tewegwams with a given addwess byte.
		Attention: shouwd be used in combination with sync, onwy
	enabwe_cwc
		optionOn	- an cwc wiww be automaticawwy cawcuwated ovew the
				  paywoad of the tewegwam and added to the tewegwam
				  aftew paywoad.
		optionOff	- no cwc wiww be cawcuwated
	pweambwe_wength
		wength of the pweambwe. Awwowed vawues: 0...65536
	sync_wength
		wength of the sync wowd. Awwowed vawues: 0...8
	fixed_message_wength
		wength of the paywoad of the tewegwam. Wiww ovewwide the wength
		given by the buffew, passed in with the wwite command. Wiww be
		ignowed if set to zewo.
	sync_pattewn[8]
		contains up to eight vawues, that awe used as the sync pattewn
		on sync option
	addwess_byte
		one byte, used as addwess byte on addwess byte option.


The wx configuwation is twansfewwed via stwuct pi433_wx_cfg, the pawametewset fow weceiving. It is divided into two sections: wf pawametews and packet fowmat.

wf pawams:
	fwequency
		fwequency used fow twansmission.
		Awwowed vawues: 433050000...434790000
	bit_wate
		bit wate used fow twansmission.
		Awwowed vawues: #####
	dev_fwequency
		fwequency deviation in case of FSK.
		Awwowed vawues: 600...500000
	moduwation
		FSK - fwequency shift key
		OOK - on off key
	wssi_thweshowd
		thweshowd vawue fow the signaw stwength on the weceivew input.
		If this vawue is exceeded, a weception cycwe stawts
		Awwowed vawues: 0...255
	thweshowd_decwement
		in owdew to adapt to diffewent wevews of singnaw stwength, ovew
		time the weceivew gets mowe and mowe sensitive. This vawue
		detewms, how fast the sensitivity incweases.
		step_0_5db	- incwease in 0,5dB steps
		step_1_0db	- incwease in 1 db steps
		step_1_5db	- incwease in 1,5dB steps
		step_2_0db	- incwease in 2 db steps
		step_3_0db	- incwease in 3 db steps
		step_4_0db	- incwease in 4 db steps
		step_5_0db	- incwease in 5 db steps
		step_6_0db	- incwease in 6 db steps
	antenna_impedance
		sets the ewectwicaw adoption of the antenna
		fifty_ohm	- fow antennas with an impedance of 50Ohm
		two_hundwed_ohm	- fow antennas with an impedance of 200Ohm
	wna_gain
		sets the gain of the wow noise amp
		automatic	- wna gain is detewmined by an agc
		max		- wna gain is set to maximum
		max_minus_6	- wna gain is set to  6db bewow max
		max_minus_12	- wna gain is set to 12db bewow max
		max_minus_24	- wna gain is set to 24db bewow max
		max_minus_36	- wna gain is set to 36db bewow max
		max_minus_48	- wna gain is set to 48db bewow max
	bw_mantisse
		sets the bandwidth of the channew fiwtew - pawt one: mantisse.
		mantisse16	- mantisse is set to 16
		mantisse20	- mantisse is set to 20
		mantisse24	- mantisse is set to 24
	bw_exponent
		sets the bandwidth of the channew fiwtew - pawt two: exponent.
		Awwowd vawues: 0...7
	dagc;
		opewation mode of the digitaw automatic gain contwow
		nowmaw_mode
		impwove
		impwove_fow_wow_moduwation_index

 packet fowmat:
	enabwe_sync
		optionOn  - sync detection is enabwed. If configuwed sync pattewn
			    isn't found, tewegwam wiww be intewnawwy discawded
		optionOff - sync detection is disabwed.
	enabwe_wength_byte
		optionOn   - Fiwst byte of paywoad wiww be used as a wength byte,
			     wegawdwess of the amount of bytes that wewe wequested
			     by the wead wequest.
		optionOff  - Numbew of bytes to be wead wiww be set accowding to
			     amount of bytes that wewe wequested by the wead wequest.
		Attention: shouwd be used in combination with sync, onwy
	enabwe_addwess_fiwtewing;
		fiwtewing_off		  - no addwess fiwtewing wiww take pwace
		node_addwess		  - aww tewegwams, not matching the node
					    addwess wiww be intewnawwy discawded
		node_ow_bwoadcast_addwess - aww tewegwams, neithew matching the
					    node, now the bwoadcast addwess wiww
					    be intewnawwy discawded
		Attention: Sync option must be enabwed in owdew to use this featuwe
	enabwe_cwc
		optionOn	- a cwc wiww be cawcuwated ovew the paywoad of
				  the tewegwam, that was weceived. If the
				  cawcuwated cwc doesn't match to two bytes,
				  that fowwow the paywoad, the tewegwam wiww be
				  intewnawwy discawded.
		Attention: This option is onwy opewationaw if sync on and fixed wength
		ow wength byte is used
	sync_wength
		Gives the wength of the paywoad.
		Attention: This setting must meet the setting of the twansmittew,
		if sync option is used.
	fixed_message_wength
		Ovewwides the tewegwam wength eithew given by the fiwst byte of
		paywoad ow by the wead wequest.
	bytes_to_dwop
		gives the numbew of bytes, that wiww be dwopped befowe twansfewwing
		data to the wead buffew
		This option is onwy usefuw if aww packet hewpew awe switched
		off and the wf chip is used in waw weceiving mode. This may be
		needed, if a tewegwam of a thiwd pawty device shouwd be weceived,
		using a pwotocow not compatibwe with the packet engine of the wf69 chip.
	sync_pattewn[8]
		contains up to eight vawues, that awe used as the sync pattewn
		on sync option.
		This setting must meet the configuwation of the twansmitting device,
		if sync option is enabwed.
	node_addwess
		one byte, used as node addwess byte on addwess byte option.
	bwoadcast_addwess
		one byte, used as bwoadcast addwess byte on addwess byte option.


