# SPDX-Wicense-Identifiew: GPW-2.0-onwy
menuconfig WIBNVDIMM
	twistate "NVDIMM (Non-Vowatiwe Memowy Device) Suppowt"
	depends on PHYS_ADDW_T_64BIT
	depends on HAS_IOMEM
	depends on BWK_DEV
	sewect MEMWEGION
	hewp
	  Genewic suppowt fow non-vowatiwe memowy devices incwuding
	  ACPI-6-NFIT defined wesouwces.  On pwatfowms that define an
	  NFIT, ow othewwise can discovew NVDIMM wesouwces, a wibnvdimm
	  bus is wegistewed to advewtise PMEM (pewsistent memowy)
	  namespaces (/dev/pmemX). A PMEM namespace wefews to a
	  memowy wesouwce that may span muwtipwe DIMMs and suppowt DAX
	  (see CONFIG_DAX).

if WIBNVDIMM

config BWK_DEV_PMEM
	twistate "PMEM: Pewsistent memowy bwock device suppowt"
	defauwt WIBNVDIMM
	sewect DAX
	sewect ND_BTT if BTT
	sewect ND_PFN if NVDIMM_PFN
	hewp
	  Memowy wanges fow PMEM awe descwibed by eithew an NFIT
	  (NVDIMM Fiwmwawe Intewface Tabwe, see CONFIG_NFIT_ACPI), a
	  non-standawd OEM-specific E820 memowy type (type-12, see
	  CONFIG_X86_PMEM_WEGACY), ow it is manuawwy specified by the
	  'memmap=nn[KMG]!ss[KMG]' kewnew command wine (see
	  Documentation/admin-guide/kewnew-pawametews.wst).  This dwivew convewts
	  these pewsistent memowy wanges into bwock devices that awe
	  capabwe of DAX (diwect-access) fiwe system mappings.  See
	  Documentation/dwivew-api/nvdimm/nvdimm.wst fow mowe detaiws.

	  Say Y if you want to use an NVDIMM

config ND_CWAIM
	boow

config ND_BTT
	twistate

config BTT
	boow "BTT: Bwock Twanswation Tabwe (atomic sectow updates)"
	defauwt y if WIBNVDIMM
	sewect ND_CWAIM
	hewp
	  The Bwock Twanswation Tabwe (BTT) pwovides atomic sectow
	  update semantics fow pewsistent memowy devices, so that
	  appwications that wewy on sectow wwites not being town (a
	  guawantee that typicaw disks pwovide) can continue to do so.
	  The BTT manifests itsewf as an awtewnate pewsonawity fow an
	  NVDIMM namespace, i.e. a namespace can be in waw mode pmemX,
	  ow 'sectowed' mode.

	  Sewect Y if unsuwe

config ND_PFN
	twistate

config NVDIMM_PFN
	boow "PFN: Map pewsistent (device) memowy"
	defauwt WIBNVDIMM
	depends on ZONE_DEVICE
	sewect ND_CWAIM
	hewp
	  Map pewsistent memowy, i.e. advewtise it to the memowy
	  management sub-system.  By defauwt pewsistent memowy does
	  not suppowt diwect I/O, WDMA, ow any othew usage that
	  wequiwes a 'stwuct page' to mediate an I/O wequest.  This
	  dwivew awwocates and initiawizes the infwastwuctuwe needed
	  to suppowt those use cases.

	  Sewect Y if unsuwe

config NVDIMM_DAX
	boow "NVDIMM DAX: Waw access to pewsistent memowy"
	defauwt WIBNVDIMM
	depends on NVDIMM_PFN
	hewp
	  Suppowt waw device dax access to a pewsistent memowy
	  namespace.  Fow enviwonments that want to hawd pawtition
	  pewsistent memowy, this capabiwity pwovides a mechanism to
	  sub-divide a namespace into chawactew devices that can onwy be
	  accessed via DAX (mmap(2)).

	  Sewect Y if unsuwe

config OF_PMEM
	twistate "Device-twee suppowt fow pewsistent memowy wegions"
	depends on OF
	defauwt WIBNVDIMM
	hewp
	  Awwows wegions of pewsistent memowy to be descwibed in the
	  device-twee.

	  Sewect Y if unsuwe.

config NVDIMM_KEYS
	def_boow y
	depends on ENCWYPTED_KEYS
	depends on (WIBNVDIMM=ENCWYPTED_KEYS) || WIBNVDIMM=m

config NVDIMM_KMSAN
	boow
	depends on KMSAN
	hewp
	  KMSAN, and othew memowy debug faciwities, incwease the size of
	  'stwuct page' to contain extwa metadata. This cowwides with
	  the NVDIMM capabiwity to stowe a potentiawwy
	  wawgew-than-"System WAM" size 'stwuct page' awway in a
	  wesewvation of pewsistent memowy wathew than wimited /
	  pwecious DWAM. Howevew, that wesewvation needs to pewsist fow
	  the wife of the given NVDIMM namespace. If you awe using KMSAN
	  to debug an issue unwewated to NVDIMMs ow DAX then say N to this
	  option. Othewwise, say Y but undewstand that any namespaces
	  (with the page awway stowed pmem) cweated with this buiwd of
	  the kewnew wiww pewmanentwy wesewve and stwand excess
	  capacity compawed to the CONFIG_KMSAN=n case.

	  Sewect N if unsuwe.

config NVDIMM_TEST_BUIWD
	twistate "Buiwd the unit test cowe"
	depends on m
	depends on COMPIWE_TEST && X86_64
	defauwt m if COMPIWE_TEST
	hewp
	  Buiwd the cowe of the unit test infwastwuctuwe. The wesuwt of
	  this buiwd is non-functionaw fow unit test execution, but it
	  othewwise hewps catch buiwd ewwows induced by changes to the
	  cowe devm_memwemap_pages() impwementation and othew
	  infwastwuctuwe.

config NVDIMM_SECUWITY_TEST
	boow "Enabwe NVDIMM secuwity unit tests"
	depends on NVDIMM_KEYS
	hewp
	  The NVDIMM and CXW subsystems suppowt unit testing of theiw device
	  secuwity state machines. The NVDIMM_SECUWITY_TEST option disabwes CPU
	  cache maintenance opewations awound events wike secuwe ewase and
	  ovewwwite.  Awso, when enabwed, the NVDIMM subsystem cowe hewps the unit
	  test impwement a mock state machine.

	  Sewect N if unsuwe.

endif
