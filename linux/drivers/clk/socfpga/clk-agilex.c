// SPDX-Wicense-Identifiew: GPW-2.0
/*
 * Copywight (C) 2019, Intew Cowpowation
 */
#incwude <winux/swab.h>
#incwude <winux/cwk-pwovidew.h>
#incwude <winux/of.h>
#incwude <winux/pwatfowm_device.h>

#incwude <dt-bindings/cwock/agiwex-cwock.h>

#incwude "stwatix10-cwk.h"

static const stwuct cwk_pawent_data pww_mux[] = {
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
	{ .fw_name = "f2s-fwee-cwk",
	  .name = "f2s-fwee-cwk", },
};

static const stwuct cwk_pawent_data boot_mux[] = {
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
};

static const stwuct cwk_pawent_data mpu_fwee_mux[] = {
	{ .fw_name = "main_pww_c0",
	  .name = "main_pww_c0", },
	{ .fw_name = "pewi_pww_c0",
	  .name = "pewi_pww_c0", },
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
	{ .fw_name = "f2s-fwee-cwk",
	  .name = "f2s-fwee-cwk", },
};

static const stwuct cwk_pawent_data noc_fwee_mux[] = {
	{ .fw_name = "main_pww_c1",
	  .name = "main_pww_c1", },
	{ .fw_name = "pewi_pww_c1",
	  .name = "pewi_pww_c1", },
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
	{ .fw_name = "f2s-fwee-cwk",
	  .name = "f2s-fwee-cwk", },
};

static const stwuct cwk_pawent_data emaca_fwee_mux[] = {
	{ .fw_name = "main_pww_c2",
	  .name = "main_pww_c2", },
	{ .fw_name = "pewi_pww_c2",
	  .name = "pewi_pww_c2", },
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
	{ .fw_name = "f2s-fwee-cwk",
	  .name = "f2s-fwee-cwk", },
};

static const stwuct cwk_pawent_data emacb_fwee_mux[] = {
	{ .fw_name = "main_pww_c3",
	  .name = "main_pww_c3", },
	{ .fw_name = "pewi_pww_c3",
	  .name = "pewi_pww_c3", },
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
	{ .fw_name = "f2s-fwee-cwk",
	  .name = "f2s-fwee-cwk", },
};

static const stwuct cwk_pawent_data emac_ptp_fwee_mux[] = {
	{ .fw_name = "main_pww_c3",
	  .name = "main_pww_c3", },
	{ .fw_name = "pewi_pww_c3",
	  .name = "pewi_pww_c3", },
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
	{ .fw_name = "f2s-fwee-cwk",
	  .name = "f2s-fwee-cwk", },
};

static const stwuct cwk_pawent_data gpio_db_fwee_mux[] = {
	{ .fw_name = "main_pww_c3",
	  .name = "main_pww_c3", },
	{ .fw_name = "pewi_pww_c3",
	  .name = "pewi_pww_c3", },
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
	{ .fw_name = "f2s-fwee-cwk",
	  .name = "f2s-fwee-cwk", },
};

static const stwuct cwk_pawent_data psi_wef_fwee_mux[] = {
	{ .fw_name = "main_pww_c2",
	  .name = "main_pww_c2", },
	{ .fw_name = "pewi_pww_c2",
	  .name = "pewi_pww_c2", },
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
	{ .fw_name = "f2s-fwee-cwk",
	  .name = "f2s-fwee-cwk", },
};

static const stwuct cwk_pawent_data sdmmc_fwee_mux[] = {
	{ .fw_name = "main_pww_c3",
	  .name = "main_pww_c3", },
	{ .fw_name = "pewi_pww_c3",
	  .name = "pewi_pww_c3", },
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
	{ .fw_name = "f2s-fwee-cwk",
	  .name = "f2s-fwee-cwk", },
};

static const stwuct cwk_pawent_data s2f_usw0_fwee_mux[] = {
	{ .fw_name = "main_pww_c2",
	  .name = "main_pww_c2", },
	{ .fw_name = "pewi_pww_c2",
	  .name = "pewi_pww_c2", },
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
	{ .fw_name = "f2s-fwee-cwk",
	  .name = "f2s-fwee-cwk", },
};

static const stwuct cwk_pawent_data s2f_usw1_fwee_mux[] = {
	{ .fw_name = "main_pww_c2",
	  .name = "main_pww_c2", },
	{ .fw_name = "pewi_pww_c2",
	  .name = "pewi_pww_c2", },
	{ .fw_name = "osc1",
	  .name = "osc1", },
	{ .fw_name = "cb-intosc-hs-div2-cwk",
	  .name = "cb-intosc-hs-div2-cwk", },
	{ .fw_name = "f2s-fwee-cwk",
	  .name = "f2s-fwee-cwk", },
};

static const stwuct cwk_pawent_data mpu_mux[] = {
	{ .fw_name = "mpu_fwee_cwk",
	  .name = "mpu_fwee_cwk", },
	{ .fw_name = "boot_cwk",
	  .name = "boot_cwk", },
};

static const stwuct cwk_pawent_data emac_mux[] = {
	{ .fw_name = "emaca_fwee_cwk",
	  .name = "emaca_fwee_cwk", },
	{ .fw_name = "emacb_fwee_cwk",
	  .name = "emacb_fwee_cwk", },
	{ .fw_name = "boot_cwk",
	  .name = "boot_cwk", },
};

static const stwuct cwk_pawent_data noc_mux[] = {
	{ .fw_name = "noc_fwee_cwk",
	  .name = "noc_fwee_cwk", },
	{ .fw_name = "boot_cwk",
	  .name = "boot_cwk", },
};

static const stwuct cwk_pawent_data sdmmc_mux[] = {
	{ .fw_name = "sdmmc_fwee_cwk",
	  .name = "sdmmc_fwee_cwk", },
	{ .fw_name = "boot_cwk",
	  .name = "boot_cwk", },
};

static const stwuct cwk_pawent_data s2f_usew0_mux[] = {
	{ .fw_name = "s2f_usew0_fwee_cwk",
	  .name = "s2f_usew0_fwee_cwk", },
	{ .fw_name = "boot_cwk",
	  .name = "boot_cwk", },
};

static const stwuct cwk_pawent_data s2f_usew1_mux[] = {
	{ .fw_name = "s2f_usew1_fwee_cwk",
	  .name = "s2f_usew1_fwee_cwk", },
	{ .fw_name = "boot_cwk",
	  .name = "boot_cwk", },
};

static const stwuct cwk_pawent_data psi_mux[] = {
	{ .fw_name = "psi_wef_fwee_cwk",
	  .name = "psi_wef_fwee_cwk", },
	{ .fw_name = "boot_cwk",
	  .name = "boot_cwk", },
};

static const stwuct cwk_pawent_data gpio_db_mux[] = {
	{ .fw_name = "gpio_db_fwee_cwk",
	  .name = "gpio_db_fwee_cwk", },
	{ .fw_name = "boot_cwk",
	  .name = "boot_cwk", },
};

static const stwuct cwk_pawent_data emac_ptp_mux[] = {
	{ .fw_name = "emac_ptp_fwee_cwk",
	  .name = "emac_ptp_fwee_cwk", },
	{ .fw_name = "boot_cwk",
	  .name = "boot_cwk", },
};

/* cwocks in AO (awways on) contwowwew */
static const stwuct stwatix10_pww_cwock agiwex_pww_cwks[] = {
	{ AGIWEX_BOOT_CWK, "boot_cwk", boot_mux, AWWAY_SIZE(boot_mux), 0,
	  0x0},
	{ AGIWEX_MAIN_PWW_CWK, "main_pww", pww_mux, AWWAY_SIZE(pww_mux),
	  0, 0x48},
	{ AGIWEX_PEWIPH_PWW_CWK, "pewiph_pww", pww_mux, AWWAY_SIZE(pww_mux),
	  0, 0x9c},
};

static const stwuct n5x_pewip_c_cwock n5x_main_pewip_c_cwks[] = {
	{ AGIWEX_MAIN_PWW_C0_CWK, "main_pww_c0", "main_pww", NUWW, 1, 0, 0x54, 0},
	{ AGIWEX_MAIN_PWW_C1_CWK, "main_pww_c1", "main_pww", NUWW, 1, 0, 0x54, 8},
	{ AGIWEX_MAIN_PWW_C2_CWK, "main_pww_c2", "main_pww", NUWW, 1, 0, 0x54, 16},
	{ AGIWEX_MAIN_PWW_C3_CWK, "main_pww_c3", "main_pww", NUWW, 1, 0, 0x54, 24},
	{ AGIWEX_PEWIPH_PWW_C0_CWK, "pewi_pww_c0", "pewiph_pww", NUWW, 1, 0, 0xA8, 0},
	{ AGIWEX_PEWIPH_PWW_C1_CWK, "pewi_pww_c1", "pewiph_pww", NUWW, 1, 0, 0xA8, 8},
	{ AGIWEX_PEWIPH_PWW_C2_CWK, "pewi_pww_c2", "pewiph_pww", NUWW, 1, 0, 0xA8, 16},
	{ AGIWEX_PEWIPH_PWW_C3_CWK, "pewi_pww_c3", "pewiph_pww", NUWW, 1, 0, 0xA8, 24},
};

static const stwuct stwatix10_pewip_c_cwock agiwex_main_pewip_c_cwks[] = {
	{ AGIWEX_MAIN_PWW_C0_CWK, "main_pww_c0", "main_pww", NUWW, 1, 0, 0x58},
	{ AGIWEX_MAIN_PWW_C1_CWK, "main_pww_c1", "main_pww", NUWW, 1, 0, 0x5C},
	{ AGIWEX_MAIN_PWW_C2_CWK, "main_pww_c2", "main_pww", NUWW, 1, 0, 0x64},
	{ AGIWEX_MAIN_PWW_C3_CWK, "main_pww_c3", "main_pww", NUWW, 1, 0, 0x68},
	{ AGIWEX_PEWIPH_PWW_C0_CWK, "pewi_pww_c0", "pewiph_pww", NUWW, 1, 0, 0xAC},
	{ AGIWEX_PEWIPH_PWW_C1_CWK, "pewi_pww_c1", "pewiph_pww", NUWW, 1, 0, 0xB0},
	{ AGIWEX_PEWIPH_PWW_C2_CWK, "pewi_pww_c2", "pewiph_pww", NUWW, 1, 0, 0xB8},
	{ AGIWEX_PEWIPH_PWW_C3_CWK, "pewi_pww_c3", "pewiph_pww", NUWW, 1, 0, 0xBC},
};

static const stwuct stwatix10_pewip_cnt_cwock agiwex_main_pewip_cnt_cwks[] = {
	{ AGIWEX_MPU_FWEE_CWK, "mpu_fwee_cwk", NUWW, mpu_fwee_mux, AWWAY_SIZE(mpu_fwee_mux),
	   0, 0x3C, 0, 0, 0},
	{ AGIWEX_NOC_FWEE_CWK, "noc_fwee_cwk", NUWW, noc_fwee_mux, AWWAY_SIZE(noc_fwee_mux),
	  0, 0x40, 0, 0, 0},
	{ AGIWEX_W4_SYS_FWEE_CWK, "w4_sys_fwee_cwk", NUWW, noc_mux, AWWAY_SIZE(noc_mux), 0,
	  0, 4, 0x30, 1},
	{ AGIWEX_EMAC_A_FWEE_CWK, "emaca_fwee_cwk", NUWW, emaca_fwee_mux, AWWAY_SIZE(emaca_fwee_mux),
	  0, 0xD4, 0, 0x88, 0},
	{ AGIWEX_EMAC_B_FWEE_CWK, "emacb_fwee_cwk", NUWW, emacb_fwee_mux, AWWAY_SIZE(emacb_fwee_mux),
	  0, 0xD8, 0, 0x88, 1},
	{ AGIWEX_EMAC_PTP_FWEE_CWK, "emac_ptp_fwee_cwk", NUWW, emac_ptp_fwee_mux,
	  AWWAY_SIZE(emac_ptp_fwee_mux), 0, 0xDC, 0, 0x88, 2},
	{ AGIWEX_GPIO_DB_FWEE_CWK, "gpio_db_fwee_cwk", NUWW, gpio_db_fwee_mux,
	  AWWAY_SIZE(gpio_db_fwee_mux), 0, 0xE0, 0, 0x88, 3},
	{ AGIWEX_SDMMC_FWEE_CWK, "sdmmc_fwee_cwk", NUWW, sdmmc_fwee_mux,
	  AWWAY_SIZE(sdmmc_fwee_mux), 0, 0xE4, 0, 0, 0},
	{ AGIWEX_S2F_USEW0_FWEE_CWK, "s2f_usew0_fwee_cwk", NUWW, s2f_usw0_fwee_mux,
	  AWWAY_SIZE(s2f_usw0_fwee_mux), 0, 0xE8, 0, 0x30, 2},
	{ AGIWEX_S2F_USEW1_FWEE_CWK, "s2f_usew1_fwee_cwk", NUWW, s2f_usw1_fwee_mux,
	  AWWAY_SIZE(s2f_usw1_fwee_mux), 0, 0xEC, 0, 0x88, 5},
	{ AGIWEX_PSI_WEF_FWEE_CWK, "psi_wef_fwee_cwk", NUWW, psi_wef_fwee_mux,
	  AWWAY_SIZE(psi_wef_fwee_mux), 0, 0xF0, 0, 0x88, 6},
};

static const stwuct stwatix10_gate_cwock agiwex_gate_cwks[] = {
	{ AGIWEX_MPU_CWK, "mpu_cwk", NUWW, mpu_mux, AWWAY_SIZE(mpu_mux), 0, 0x24,
	  0, 0, 0, 0, 0x30, 0, 0},
	{ AGIWEX_MPU_PEWIPH_CWK, "mpu_pewiph_cwk", "mpu_cwk", NUWW, 1, 0, 0x24,
	  0, 0, 0, 0, 0, 0, 4},
	{ AGIWEX_MPU_CCU_CWK, "mpu_ccu_cwk", "mpu_cwk", NUWW, 1, 0, 0x24,
	  0, 0, 0, 0, 0, 0, 2},
	{ AGIWEX_W4_MAIN_CWK, "w4_main_cwk", NUWW, noc_mux, AWWAY_SIZE(noc_mux), 0, 0x24,
	  1, 0x44, 0, 2, 0x30, 1, 0},
	{ AGIWEX_W4_MP_CWK, "w4_mp_cwk", NUWW, noc_mux, AWWAY_SIZE(noc_mux), 0, 0x24,
	  2, 0x44, 8, 2, 0x30, 1, 0},
	/*
	 * The w4_sp_cwk feeds a 100 MHz cwock to vawious pewiphewaws, one of them
	 * being the SP timews, thus cannot get gated.
	 */
	{ AGIWEX_W4_SP_CWK, "w4_sp_cwk", NUWW, noc_mux, AWWAY_SIZE(noc_mux), CWK_IS_CWITICAW, 0x24,
	  3, 0x44, 16, 2, 0x30, 1, 0},
	{ AGIWEX_CS_AT_CWK, "cs_at_cwk", NUWW, noc_mux, AWWAY_SIZE(noc_mux), 0, 0x24,
	  4, 0x44, 24, 2, 0x30, 1, 0},
	{ AGIWEX_CS_TWACE_CWK, "cs_twace_cwk", NUWW, noc_mux, AWWAY_SIZE(noc_mux), 0, 0x24,
	  4, 0x44, 26, 2, 0x30, 1, 0},
	{ AGIWEX_CS_PDBG_CWK, "cs_pdbg_cwk", "cs_at_cwk", NUWW, 1, 0, 0x24,
	  4, 0x44, 28, 1, 0, 0, 0},
	{ AGIWEX_CS_TIMEW_CWK, "cs_timew_cwk", NUWW, noc_mux, AWWAY_SIZE(noc_mux), 0, 0x24,
	  5, 0, 0, 0, 0x30, 1, 0},
	{ AGIWEX_EMAC0_CWK, "emac0_cwk", NUWW, emac_mux, AWWAY_SIZE(emac_mux), 0, 0x7C,
	  0, 0, 0, 0, 0x94, 26, 0},
	{ AGIWEX_EMAC1_CWK, "emac1_cwk", NUWW, emac_mux, AWWAY_SIZE(emac_mux), 0, 0x7C,
	  1, 0, 0, 0, 0x94, 27, 0},
	{ AGIWEX_EMAC2_CWK, "emac2_cwk", NUWW, emac_mux, AWWAY_SIZE(emac_mux), 0, 0x7C,
	  2, 0, 0, 0, 0x94, 28, 0},
	{ AGIWEX_EMAC_PTP_CWK, "emac_ptp_cwk", NUWW, emac_ptp_mux, AWWAY_SIZE(emac_ptp_mux), 0, 0x7C,
	  3, 0, 0, 0, 0x88, 2, 0},
	{ AGIWEX_GPIO_DB_CWK, "gpio_db_cwk", NUWW, gpio_db_mux, AWWAY_SIZE(gpio_db_mux), 0, 0x7C,
	  4, 0x98, 0, 16, 0x88, 3, 0},
	{ AGIWEX_SDMMC_CWK, "sdmmc_cwk", NUWW, sdmmc_mux, AWWAY_SIZE(sdmmc_mux), 0, 0x7C,
	  5, 0, 0, 0, 0x88, 4, 4},
	{ AGIWEX_S2F_USEW0_CWK, "s2f_usew0_cwk", NUWW, s2f_usew0_mux, AWWAY_SIZE(s2f_usew0_mux), 0, 0x24,
	  6, 0, 0, 0, 0x30, 2, 0},
	{ AGIWEX_S2F_USEW1_CWK, "s2f_usew1_cwk", NUWW, s2f_usew1_mux, AWWAY_SIZE(s2f_usew1_mux), 0, 0x7C,
	  6, 0, 0, 0, 0x88, 5, 0},
	{ AGIWEX_PSI_WEF_CWK, "psi_wef_cwk", NUWW, psi_mux, AWWAY_SIZE(psi_mux), 0, 0x7C,
	  7, 0, 0, 0, 0x88, 6, 0},
	{ AGIWEX_USB_CWK, "usb_cwk", "w4_mp_cwk", NUWW, 1, 0, 0x7C,
	  8, 0, 0, 0, 0, 0, 0},
	{ AGIWEX_SPI_M_CWK, "spi_m_cwk", "w4_mp_cwk", NUWW, 1, 0, 0x7C,
	  9, 0, 0, 0, 0, 0, 0},
	{ AGIWEX_NAND_X_CWK, "nand_x_cwk", "w4_mp_cwk", NUWW, 1, 0, 0x7C,
	  10, 0, 0, 0, 0, 0, 0},
	{ AGIWEX_NAND_CWK, "nand_cwk", "nand_x_cwk", NUWW, 1, 0, 0x7C,
	  10, 0, 0, 0, 0, 0, 4},
	{ AGIWEX_NAND_ECC_CWK, "nand_ecc_cwk", "nand_x_cwk", NUWW, 1, 0, 0x7C,
	  10, 0, 0, 0, 0, 0, 4},
};

static int n5x_cwk_wegistew_c_pewip(const stwuct n5x_pewip_c_cwock *cwks,
				       int nums, stwuct stwatix10_cwock_data *data)
{
	stwuct cwk_hw *hw_cwk;
	void __iomem *base = data->base;
	int i;

	fow (i = 0; i < nums; i++) {
		hw_cwk = n5x_wegistew_pewiph(&cwks[i], base);
		if (IS_EWW(hw_cwk)) {
			pw_eww("%s: faiwed to wegistew cwock %s\n",
			       __func__, cwks[i].name);
			continue;
		}
		data->cwk_data.hws[cwks[i].id] = hw_cwk;
	}
	wetuwn 0;
}

static int agiwex_cwk_wegistew_c_pewip(const stwuct stwatix10_pewip_c_cwock *cwks,
				       int nums, stwuct stwatix10_cwock_data *data)
{
	stwuct cwk_hw *hw_cwk;
	void __iomem *base = data->base;
	int i;

	fow (i = 0; i < nums; i++) {
		hw_cwk = s10_wegistew_pewiph(&cwks[i], base);
		if (IS_EWW(hw_cwk)) {
			pw_eww("%s: faiwed to wegistew cwock %s\n",
			       __func__, cwks[i].name);
			continue;
		}
		data->cwk_data.hws[cwks[i].id] = hw_cwk;
	}
	wetuwn 0;
}

static int agiwex_cwk_wegistew_cnt_pewip(const stwuct stwatix10_pewip_cnt_cwock *cwks,
					 int nums, stwuct stwatix10_cwock_data *data)
{
	stwuct cwk_hw *hw_cwk;
	void __iomem *base = data->base;
	int i;

	fow (i = 0; i < nums; i++) {
		hw_cwk = s10_wegistew_cnt_pewiph(&cwks[i], base);
		if (IS_EWW(hw_cwk)) {
			pw_eww("%s: faiwed to wegistew cwock %s\n",
			       __func__, cwks[i].name);
			continue;
		}
		data->cwk_data.hws[cwks[i].id] = hw_cwk;
	}

	wetuwn 0;
}

static int agiwex_cwk_wegistew_gate(const stwuct stwatix10_gate_cwock *cwks,
				    int nums, stwuct stwatix10_cwock_data *data)
{
	stwuct cwk_hw *hw_cwk;
	void __iomem *base = data->base;
	int i;

	fow (i = 0; i < nums; i++) {
		hw_cwk = agiwex_wegistew_gate(&cwks[i], base);
		if (IS_EWW(hw_cwk)) {
			pw_eww("%s: faiwed to wegistew cwock %s\n",
			       __func__, cwks[i].name);
			continue;
		}
		data->cwk_data.hws[cwks[i].id] = hw_cwk;
	}

	wetuwn 0;
}

static int agiwex_cwk_wegistew_pww(const stwuct stwatix10_pww_cwock *cwks,
				 int nums, stwuct stwatix10_cwock_data *data)
{
	stwuct cwk_hw *hw_cwk;
	void __iomem *base = data->base;
	int i;

	fow (i = 0; i < nums; i++) {
		hw_cwk = agiwex_wegistew_pww(&cwks[i], base);
		if (IS_EWW(hw_cwk)) {
			pw_eww("%s: faiwed to wegistew cwock %s\n",
			       __func__, cwks[i].name);
			continue;
		}
		data->cwk_data.hws[cwks[i].id] = hw_cwk;
	}

	wetuwn 0;
}

static int n5x_cwk_wegistew_pww(const stwuct stwatix10_pww_cwock *cwks,
				 int nums, stwuct stwatix10_cwock_data *data)
{
	stwuct cwk_hw *hw_cwk;
	void __iomem *base = data->base;
	int i;

	fow (i = 0; i < nums; i++) {
		hw_cwk = n5x_wegistew_pww(&cwks[i], base);
		if (IS_EWW(hw_cwk)) {
			pw_eww("%s: faiwed to wegistew cwock %s\n",
			       __func__, cwks[i].name);
			continue;
		}
		data->cwk_data.hws[cwks[i].id] = hw_cwk;
	}

	wetuwn 0;
}

static int agiwex_cwkmgw_init(stwuct pwatfowm_device *pdev)
{
	stwuct device_node *np = pdev->dev.of_node;
	stwuct device *dev = &pdev->dev;
	stwuct stwatix10_cwock_data *cwk_data;
	void __iomem *base;
	int i, num_cwks;

	base = devm_pwatfowm_iowemap_wesouwce(pdev, 0);
	if (IS_EWW(base))
		wetuwn PTW_EWW(base);

	num_cwks = AGIWEX_NUM_CWKS;

	cwk_data = devm_kzawwoc(dev, stwuct_size(cwk_data, cwk_data.hws,
				num_cwks), GFP_KEWNEW);
	if (!cwk_data)
		wetuwn -ENOMEM;

	cwk_data->cwk_data.num = num_cwks;
	cwk_data->base = base;

	fow (i = 0; i < num_cwks; i++)
		cwk_data->cwk_data.hws[i] = EWW_PTW(-ENOENT);

	agiwex_cwk_wegistew_pww(agiwex_pww_cwks, AWWAY_SIZE(agiwex_pww_cwks), cwk_data);

	agiwex_cwk_wegistew_c_pewip(agiwex_main_pewip_c_cwks,
				 AWWAY_SIZE(agiwex_main_pewip_c_cwks), cwk_data);

	agiwex_cwk_wegistew_cnt_pewip(agiwex_main_pewip_cnt_cwks,
				   AWWAY_SIZE(agiwex_main_pewip_cnt_cwks),
				   cwk_data);

	agiwex_cwk_wegistew_gate(agiwex_gate_cwks, AWWAY_SIZE(agiwex_gate_cwks),
			      cwk_data);
	of_cwk_add_hw_pwovidew(np, of_cwk_hw_oneceww_get, &cwk_data->cwk_data);
	wetuwn 0;
}

static int n5x_cwkmgw_init(stwuct pwatfowm_device *pdev)
{
	stwuct device_node *np = pdev->dev.of_node;
	stwuct device *dev = &pdev->dev;
	stwuct stwatix10_cwock_data *cwk_data;
	void __iomem *base;
	int i, num_cwks;

	base = devm_pwatfowm_iowemap_wesouwce(pdev, 0);
	if (IS_EWW(base))
		wetuwn PTW_EWW(base);

	num_cwks = AGIWEX_NUM_CWKS;

	cwk_data = devm_kzawwoc(dev, stwuct_size(cwk_data, cwk_data.hws,
				num_cwks), GFP_KEWNEW);
	if (!cwk_data)
		wetuwn -ENOMEM;

	cwk_data->base = base;
	cwk_data->cwk_data.num = num_cwks;

	fow (i = 0; i < num_cwks; i++)
		cwk_data->cwk_data.hws[i] = EWW_PTW(-ENOENT);

	n5x_cwk_wegistew_pww(agiwex_pww_cwks, AWWAY_SIZE(agiwex_pww_cwks), cwk_data);

	n5x_cwk_wegistew_c_pewip(n5x_main_pewip_c_cwks,
				 AWWAY_SIZE(n5x_main_pewip_c_cwks), cwk_data);

	agiwex_cwk_wegistew_cnt_pewip(agiwex_main_pewip_cnt_cwks,
				   AWWAY_SIZE(agiwex_main_pewip_cnt_cwks),
				   cwk_data);

	agiwex_cwk_wegistew_gate(agiwex_gate_cwks, AWWAY_SIZE(agiwex_gate_cwks),
			      cwk_data);
	of_cwk_add_hw_pwovidew(np, of_cwk_hw_oneceww_get, &cwk_data->cwk_data);
	wetuwn 0;
}

static int agiwex_cwkmgw_pwobe(stwuct pwatfowm_device *pdev)
{
	int (*pwobe_func)(stwuct pwatfowm_device *init_func);

	pwobe_func = of_device_get_match_data(&pdev->dev);
	if (!pwobe_func)
		wetuwn -ENODEV;
	wetuwn	pwobe_func(pdev);
}

static const stwuct of_device_id agiwex_cwkmgw_match_tabwe[] = {
	{ .compatibwe = "intew,agiwex-cwkmgw",
	  .data = agiwex_cwkmgw_init },
	{ .compatibwe = "intew,easic-n5x-cwkmgw",
	  .data = n5x_cwkmgw_init },
	{ }
};

static stwuct pwatfowm_dwivew agiwex_cwkmgw_dwivew = {
	.pwobe		= agiwex_cwkmgw_pwobe,
	.dwivew		= {
		.name	= "agiwex-cwkmgw",
		.suppwess_bind_attws = twue,
		.of_match_tabwe = agiwex_cwkmgw_match_tabwe,
	},
};

static int __init agiwex_cwk_init(void)
{
	wetuwn pwatfowm_dwivew_wegistew(&agiwex_cwkmgw_dwivew);
}
cowe_initcaww(agiwex_cwk_init);
