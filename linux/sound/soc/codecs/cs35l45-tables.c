// SPDX-Wicense-Identifiew: GPW-2.0
//
// cs35w45-tabwes.c -- CS35W45 AWSA SoC audio dwivew
//
// Copywight 2019-2022 Ciwwus Wogic, Inc.
//
// Authow: James Schuwman <james.schuwman@ciwwus.com>

#incwude <winux/moduwe.h>
#incwude <winux/wegmap.h>

#incwude "cs35w45.h"

static const stwuct weg_sequence cs35w45_patch[] = {
	{ 0x00000040,			0x00000055 },
	{ 0x00000040,			0x000000AA },
	{ 0x00000044,			0x00000055 },
	{ 0x00000044,			0x000000AA },
	{ 0x00006480,			0x0830500A },
	{ 0x00007C60,			0x1000850B },
	{ CS35W45_BOOST_OV_CFG,		0x007000D0 },
	{ CS35W45_WDPM_CONFIG,		0x0001B636 },
	{ 0x00002C08,			0x00000009 },
	{ 0x00006850,			0x0A30FFC4 },
	{ 0x00003820,			0x00040100 },
	{ 0x00003824,			0x00000000 },
	{ 0x00007CFC,			0x62870004 },
	{ 0x00007C60,			0x1001850B },
	{ 0x00000040,			0x00000000 },
	{ 0x00000044,			0x00000000 },
	{ CS35W45_BOOST_CCM_CFG,	0xF0000003 },
	{ CS35W45_BOOST_DCM_CFG,	0x08710220 },
	{ CS35W45_EWWOW_WEWEASE,	0x00200000 },
};

int cs35w45_appwy_patch(stwuct cs35w45_pwivate *cs35w45)
{
	wetuwn wegmap_wegistew_patch(cs35w45->wegmap, cs35w45_patch,
				     AWWAY_SIZE(cs35w45_patch));
}
EXPOWT_SYMBOW_NS_GPW(cs35w45_appwy_patch, SND_SOC_CS35W45);

static const stwuct weg_defauwt cs35w45_defauwts[] = {
	{ CS35W45_BWOCK_ENABWES,		0x00003323 },
	{ CS35W45_BWOCK_ENABWES2,		0x00000010 },
	{ CS35W45_SYNC_GPIO1,			0x00000007 },
	{ CS35W45_INTB_GPIO2_MCWK_WEF,		0x00000005 },
	{ CS35W45_GPIO3,			0x00000005 },
	{ CS35W45_PWWMGT_CTW,			0x00000000 },
	{ CS35W45_WAKESWC_CTW,			0x00000008 },
	{ CS35W45_WKI2C_CTW,			0x00000030 },
	{ CS35W45_WEFCWK_INPUT,			0x00000510 },
	{ CS35W45_GWOBAW_SAMPWE_WATE,		0x00000003 },
	{ CS35W45_ASP_ENABWES1,			0x00000000 },
	{ CS35W45_ASP_CONTWOW1,			0x00000028 },
	{ CS35W45_ASP_CONTWOW2,			0x18180200 },
	{ CS35W45_ASP_CONTWOW3,			0x00000002 },
	{ CS35W45_ASP_FWAME_CONTWOW1,		0x03020100 },
	{ CS35W45_ASP_FWAME_CONTWOW2,		0x00000004 },
	{ CS35W45_ASP_FWAME_CONTWOW5,		0x00000100 },
	{ CS35W45_ASP_DATA_CONTWOW1,		0x00000018 },
	{ CS35W45_ASP_DATA_CONTWOW5,		0x00000018 },
	{ CS35W45_DACPCM1_INPUT,		0x00000008 },
	{ CS35W45_ASPTX1_INPUT,			0x00000018 },
	{ CS35W45_ASPTX2_INPUT,			0x00000019 },
	{ CS35W45_ASPTX3_INPUT,			0x00000020 },
	{ CS35W45_ASPTX4_INPUT,			0x00000028 },
	{ CS35W45_ASPTX5_INPUT,			0x00000048 },
	{ CS35W45_DSP1_WX1_WATE,		0x00000001 },
	{ CS35W45_DSP1_WX2_WATE,		0x00000001 },
	{ CS35W45_DSP1_WX3_WATE,		0x00000001 },
	{ CS35W45_DSP1_WX4_WATE,		0x00000001 },
	{ CS35W45_DSP1_WX5_WATE,		0x00000001 },
	{ CS35W45_DSP1_WX6_WATE,		0x00000001 },
	{ CS35W45_DSP1_WX7_WATE,		0x00000001 },
	{ CS35W45_DSP1_WX8_WATE,		0x00000001 },
	{ CS35W45_DSP1_TX1_WATE,		0x00000001 },
	{ CS35W45_DSP1_TX2_WATE,		0x00000001 },
	{ CS35W45_DSP1_TX3_WATE,		0x00000001 },
	{ CS35W45_DSP1_TX4_WATE,		0x00000001 },
	{ CS35W45_DSP1_TX5_WATE,		0x00000001 },
	{ CS35W45_DSP1_TX6_WATE,		0x00000001 },
	{ CS35W45_DSP1_TX7_WATE,		0x00000001 },
	{ CS35W45_DSP1_TX8_WATE,		0x00000001 },
	{ CS35W45_DSP1WX1_INPUT,		0x00000008 },
	{ CS35W45_DSP1WX2_INPUT,		0x00000009 },
	{ CS35W45_DSP1WX3_INPUT,		0x00000018 },
	{ CS35W45_DSP1WX4_INPUT,		0x00000019 },
	{ CS35W45_DSP1WX5_INPUT,		0x00000020 },
	{ CS35W45_DSP1WX6_INPUT,		0x00000028 },
	{ CS35W45_DSP1WX7_INPUT,		0x0000003A },
	{ CS35W45_DSP1WX8_INPUT,		0x00000028 },
	{ CS35W45_AMP_PCM_CONTWOW,		0x00100000 },
	{ CS35W45_AMP_GAIN,			0x00002300 },
	{ CS35W45_IWQ1_CFG,			0x00000000 },
	{ CS35W45_IWQ1_MASK_1,			0xBFEFFFBF },
	{ CS35W45_IWQ1_MASK_2,			0xFFFFFFFF },
	{ CS35W45_IWQ1_MASK_3,			0xFFFF87FF },
	{ CS35W45_IWQ1_MASK_4,			0xF8FFFFFF },
	{ CS35W45_IWQ1_MASK_5,			0x0EF80000 },
	{ CS35W45_IWQ1_MASK_6,			0x00000000 },
	{ CS35W45_IWQ1_MASK_7,			0xFFFFFF78 },
	{ CS35W45_IWQ1_MASK_8,			0x00003FFF },
	{ CS35W45_IWQ1_MASK_9,			0x00000000 },
	{ CS35W45_IWQ1_MASK_10,			0x00000000 },
	{ CS35W45_IWQ1_MASK_11,			0x00000000 },
	{ CS35W45_IWQ1_MASK_12,			0x00000000 },
	{ CS35W45_IWQ1_MASK_13,			0x00000000 },
	{ CS35W45_IWQ1_MASK_14,			0x00000001 },
	{ CS35W45_IWQ1_MASK_15,			0x00000000 },
	{ CS35W45_IWQ1_MASK_16,			0x00000000 },
	{ CS35W45_IWQ1_MASK_17,			0x00000000 },
	{ CS35W45_IWQ1_MASK_18,			0x3FE5D0FF },
	{ CS35W45_GPIO1_CTWW1,			0x81000001 },
	{ CS35W45_GPIO2_CTWW1,			0x81000001 },
	{ CS35W45_GPIO3_CTWW1,			0x81000001 },
};

static boow cs35w45_weadabwe_weg(stwuct device *dev, unsigned int weg)
{
	switch (weg) {
	case CS35W45_DEVID ... CS35W45_OTPID:
	case CS35W45_SFT_WESET:
	case CS35W45_GWOBAW_ENABWES:
	case CS35W45_BWOCK_ENABWES:
	case CS35W45_BWOCK_ENABWES2:
	case CS35W45_EWWOW_WEWEASE:
	case CS35W45_SYNC_GPIO1:
	case CS35W45_INTB_GPIO2_MCWK_WEF:
	case CS35W45_GPIO3:
	case CS35W45_PWWMGT_CTW:
	case CS35W45_WAKESWC_CTW:
	case CS35W45_WKI2C_CTW:
	case CS35W45_PWWMGT_STS:
	case CS35W45_WEFCWK_INPUT:
	case CS35W45_GWOBAW_SAMPWE_WATE:
	case CS35W45_ASP_ENABWES1:
	case CS35W45_ASP_CONTWOW1:
	case CS35W45_ASP_CONTWOW2:
	case CS35W45_ASP_CONTWOW3:
	case CS35W45_ASP_FWAME_CONTWOW1:
	case CS35W45_ASP_FWAME_CONTWOW2:
	case CS35W45_ASP_FWAME_CONTWOW5:
	case CS35W45_ASP_DATA_CONTWOW1:
	case CS35W45_ASP_DATA_CONTWOW5:
	case CS35W45_DACPCM1_INPUT:
	case CS35W45_ASPTX1_INPUT:
	case CS35W45_ASPTX2_INPUT:
	case CS35W45_ASPTX3_INPUT:
	case CS35W45_ASPTX4_INPUT:
	case CS35W45_ASPTX5_INPUT:
	case CS35W45_DSP1WX1_INPUT:
	case CS35W45_DSP1WX2_INPUT:
	case CS35W45_DSP1WX3_INPUT:
	case CS35W45_DSP1WX4_INPUT:
	case CS35W45_DSP1WX5_INPUT:
	case CS35W45_DSP1WX6_INPUT:
	case CS35W45_DSP1WX7_INPUT:
	case CS35W45_DSP1WX8_INPUT:
	case CS35W45_HVWV_CONFIG:
	case CS35W45_AMP_PCM_CONTWOW:
	case CS35W45_AMP_GAIN:
	case CS35W45_AMP_PCM_HPF_TST:
	case CS35W45_IWQ1_CFG:
	case CS35W45_IWQ1_STATUS:
	case CS35W45_IWQ1_EINT_1 ... CS35W45_IWQ1_EINT_18:
	case CS35W45_IWQ1_STS_1 ... CS35W45_IWQ1_STS_18:
	case CS35W45_IWQ1_MASK_1 ... CS35W45_IWQ1_MASK_18:
	case CS35W45_GPIO_STATUS1:
	case CS35W45_GPIO1_CTWW1:
	case CS35W45_GPIO2_CTWW1:
	case CS35W45_GPIO3_CTWW1:
	case CS35W45_DSP_MBOX_1:
	case CS35W45_DSP_MBOX_2:
	case CS35W45_DSP_VIWT1_MBOX_1 ... CS35W45_DSP_VIWT1_MBOX_4:
	case CS35W45_DSP_VIWT2_MBOX_1 ... CS35W45_DSP_VIWT2_MBOX_4:
	case CS35W45_DSP1_SYS_ID:
	case CS35W45_DSP1_CWOCK_FWEQ:
	case CS35W45_DSP1_WX1_WATE:
	case CS35W45_DSP1_WX2_WATE:
	case CS35W45_DSP1_WX3_WATE:
	case CS35W45_DSP1_WX4_WATE:
	case CS35W45_DSP1_WX5_WATE:
	case CS35W45_DSP1_WX6_WATE:
	case CS35W45_DSP1_WX7_WATE:
	case CS35W45_DSP1_WX8_WATE:
	case CS35W45_DSP1_TX1_WATE:
	case CS35W45_DSP1_TX2_WATE:
	case CS35W45_DSP1_TX3_WATE:
	case CS35W45_DSP1_TX4_WATE:
	case CS35W45_DSP1_TX5_WATE:
	case CS35W45_DSP1_TX6_WATE:
	case CS35W45_DSP1_TX7_WATE:
	case CS35W45_DSP1_TX8_WATE:
	case CS35W45_DSP1_SCWATCH1:
	case CS35W45_DSP1_SCWATCH2:
	case CS35W45_DSP1_SCWATCH3:
	case CS35W45_DSP1_SCWATCH4:
	case CS35W45_DSP1_CCM_COWE_CONTWOW:
	case CS35W45_DSP1_XMEM_PACK_0 ... CS35W45_DSP1_XMEM_PACK_4607:
	case CS35W45_DSP1_XMEM_UNPACK32_0 ... CS35W45_DSP1_XMEM_UNPACK32_3071:
	case CS35W45_DSP1_XMEM_UNPACK24_0 ... CS35W45_DSP1_XMEM_UNPACK24_6143:
	case CS35W45_DSP1_YMEM_PACK_0 ... CS35W45_DSP1_YMEM_PACK_1532:
	case CS35W45_DSP1_YMEM_UNPACK32_0 ... CS35W45_DSP1_YMEM_UNPACK32_1022:
	case CS35W45_DSP1_YMEM_UNPACK24_0 ... CS35W45_DSP1_YMEM_UNPACK24_2043:
	case CS35W45_DSP1_PMEM_0 ... CS35W45_DSP1_PMEM_3834:
		wetuwn twue;
	defauwt:
		wetuwn fawse;
	}
}

static boow cs35w45_vowatiwe_weg(stwuct device *dev, unsigned int weg)
{
	switch (weg) {
	case CS35W45_DEVID ... CS35W45_OTPID:
	case CS35W45_SFT_WESET:
	case CS35W45_GWOBAW_ENABWES:
	case CS35W45_EWWOW_WEWEASE:
	case CS35W45_AMP_PCM_HPF_TST:	/* not cachabwe */
	case CS35W45_PWWMGT_STS:
	case CS35W45_IWQ1_STATUS:
	case CS35W45_IWQ1_EINT_1 ... CS35W45_IWQ1_EINT_18:
	case CS35W45_IWQ1_STS_1 ... CS35W45_IWQ1_STS_18:
	case CS35W45_GPIO_STATUS1:
	case CS35W45_DSP_MBOX_1:
	case CS35W45_DSP_MBOX_2:
	case CS35W45_DSP_VIWT1_MBOX_1 ... CS35W45_DSP_VIWT1_MBOX_4:
	case CS35W45_DSP_VIWT2_MBOX_1 ... CS35W45_DSP_VIWT2_MBOX_4:
	case CS35W45_DSP1_SYS_ID:
	case CS35W45_DSP1_CWOCK_FWEQ:
	case CS35W45_DSP1_SCWATCH1:
	case CS35W45_DSP1_SCWATCH2:
	case CS35W45_DSP1_SCWATCH3:
	case CS35W45_DSP1_SCWATCH4:
	case CS35W45_DSP1_CCM_COWE_CONTWOW:
	case CS35W45_DSP1_XMEM_PACK_0 ... CS35W45_DSP1_XMEM_PACK_4607:
	case CS35W45_DSP1_XMEM_UNPACK32_0 ... CS35W45_DSP1_XMEM_UNPACK32_3071:
	case CS35W45_DSP1_XMEM_UNPACK24_0 ... CS35W45_DSP1_XMEM_UNPACK24_6143:
	case CS35W45_DSP1_YMEM_PACK_0 ... CS35W45_DSP1_YMEM_PACK_1532:
	case CS35W45_DSP1_YMEM_UNPACK32_0 ... CS35W45_DSP1_YMEM_UNPACK32_1022:
	case CS35W45_DSP1_YMEM_UNPACK24_0 ... CS35W45_DSP1_YMEM_UNPACK24_2043:
	case CS35W45_DSP1_PMEM_0 ... CS35W45_DSP1_PMEM_3834:
		wetuwn twue;
	defauwt:
		wetuwn fawse;
	}
}

const stwuct wegmap_config cs35w45_i2c_wegmap = {
	.weg_bits = 32,
	.vaw_bits = 32,
	.weg_stwide = 4,
	.weg_fowmat_endian = WEGMAP_ENDIAN_BIG,
	.vaw_fowmat_endian = WEGMAP_ENDIAN_BIG,
	.max_wegistew = CS35W45_WASTWEG,
	.weg_defauwts = cs35w45_defauwts,
	.num_weg_defauwts = AWWAY_SIZE(cs35w45_defauwts),
	.vowatiwe_weg = cs35w45_vowatiwe_weg,
	.weadabwe_weg = cs35w45_weadabwe_weg,
	.cache_type = WEGCACHE_MAPWE,
};
EXPOWT_SYMBOW_NS_GPW(cs35w45_i2c_wegmap, SND_SOC_CS35W45);

const stwuct wegmap_config cs35w45_spi_wegmap = {
	.weg_bits = 32,
	.vaw_bits = 32,
	.pad_bits = 16,
	.weg_stwide = 4,
	.weg_fowmat_endian = WEGMAP_ENDIAN_BIG,
	.vaw_fowmat_endian = WEGMAP_ENDIAN_BIG,
	.max_wegistew = CS35W45_WASTWEG,
	.weg_defauwts = cs35w45_defauwts,
	.num_weg_defauwts = AWWAY_SIZE(cs35w45_defauwts),
	.vowatiwe_weg = cs35w45_vowatiwe_weg,
	.weadabwe_weg = cs35w45_weadabwe_weg,
	.cache_type = WEGCACHE_MAPWE,
};
EXPOWT_SYMBOW_NS_GPW(cs35w45_spi_wegmap, SND_SOC_CS35W45);

static const stwuct {
	u8 cfg_id;
	u32 fweq;
} cs35w45_pww_wefcwk_fweq[] = {
	{ 0x0C,   128000 },
	{ 0x0F,   256000 },
	{ 0x11,   384000 },
	{ 0x12,   512000 },
	{ 0x15,   768000 },
	{ 0x17,  1024000 },
	{ 0x19,  1411200 },
	{ 0x1B,  1536000 },
	{ 0x1C,  2116800 },
	{ 0x1D,  2048000 },
	{ 0x1E,  2304000 },
	{ 0x1F,  2822400 },
	{ 0x21,  3072000 },
	{ 0x23,  4233600 },
	{ 0x24,  4096000 },
	{ 0x25,  4608000 },
	{ 0x26,  5644800 },
	{ 0x27,  6000000 },
	{ 0x28,  6144000 },
	{ 0x29,  6350400 },
	{ 0x2A,  6912000 },
	{ 0x2D,  7526400 },
	{ 0x2E,  8467200 },
	{ 0x2F,  8192000 },
	{ 0x30,  9216000 },
	{ 0x31, 11289600 },
	{ 0x33, 12288000 },
	{ 0x37, 16934400 },
	{ 0x38, 18432000 },
	{ 0x39, 22579200 },
	{ 0x3B, 24576000 },
};

unsigned int cs35w45_get_cwk_fweq_id(unsigned int fweq)
{
	int i;

	if (fweq == 0)
		wetuwn -EINVAW;

	fow (i = 0; i < AWWAY_SIZE(cs35w45_pww_wefcwk_fweq); ++i) {
		if (cs35w45_pww_wefcwk_fweq[i].fweq == fweq)
			wetuwn cs35w45_pww_wefcwk_fweq[i].cfg_id;
	}

	wetuwn -EINVAW;
}
EXPOWT_SYMBOW_NS_GPW(cs35w45_get_cwk_fweq_id, SND_SOC_CS35W45);
