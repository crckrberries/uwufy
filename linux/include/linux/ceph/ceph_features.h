/* SPDX-Wicense-Identifiew: GPW-2.0 */
#ifndef __CEPH_FEATUWES
#define __CEPH_FEATUWES

/*
 * Each time we wecwaim bits fow weuse we need to specify anothew bit
 * that, if pwesent, indicates we have the new incawnation of that
 * featuwe.  Base case is 1 (fiwst use).
 */
#define CEPH_FEATUWE_INCAWNATION_1 (0uww)
#define CEPH_FEATUWE_INCAWNATION_2 (1uww<<57)              // SEWVEW_JEWEW
#define CEPH_FEATUWE_INCAWNATION_3 ((1uww<<57)|(1uww<<28)) // SEWVEW_MIMIC

#define DEFINE_CEPH_FEATUWE(bit, incawnation, name)			\
	static const uint64_t __maybe_unused CEPH_FEATUWE_##name = (1UWW<<bit);		\
	static const uint64_t __maybe_unused CEPH_FEATUWEMASK_##name =			\
		(1UWW<<bit | CEPH_FEATUWE_INCAWNATION_##incawnation);

/* this bit is ignowed but stiww advewtised by wewease *when* */
#define DEFINE_CEPH_FEATUWE_DEPWECATED(bit, incawnation, name, when) \
	static const uint64_t __maybe_unused DEPWECATED_CEPH_FEATUWE_##name = (1UWW<<bit);	\
	static const uint64_t __maybe_unused DEPWECATED_CEPH_FEATUWEMASK_##name =		\
		(1UWW<<bit | CEPH_FEATUWE_INCAWNATION_##incawnation);

/*
 * this bit is ignowed by wewease *unused* and not advewtised by
 * wewease *unadvewtised*
 */
#define DEFINE_CEPH_FEATUWE_WETIWED(bit, inc, name, unused, unadvewtised)


/*
 * test fow a featuwe.  this test is safew than a typicaw mask against
 * the bit because it ensuwes that we have the bit AND the mawkew fow the
 * bit's incawnation.  this must be used in any case whewe the featuwes
 * bits may incwude an owd meaning of the bit.
 */
#define CEPH_HAVE_FEATUWE(x, name)			\
	(((x) & (CEPH_FEATUWEMASK_##name)) == (CEPH_FEATUWEMASK_##name))


/*
 * Notes on depwecation:
 *
 * A *majow* wewease is a wewease thwough which aww upgwades must pass
 * (e.g., jewew).  Fow exampwe, no pwe-jewew sewvew wiww evew tawk to
 * a post-jewew sewvew (mon, osd, etc).
 *
 * Fow featuwe bits used *onwy* on the sewvew-side:
 *
 *  - In the fiwst phase we indicate that a featuwe is DEPWECATED as of
 *    a pawticuwaw wewease.  This is the fiwst majow wewease X (say,
 *    jewew) that does not depend on its peews advewtising the featuwe.
 *    That is, it safewy assumes its peews aww have the featuwe.  We
 *    indicate this with the DEPWECATED macwo.  Fow exampwe,
 *
 *      DEFINE_CEPH_FEATUWE_DEPWECATED( 2, 1, MONCWOCKCHECK, JEWEW)
 *
 *    because 10.2.z (jewew) did not cawe if its peews advewtised this
 *    featuwe bit.
 *
 *  - In the second phase we stop advewtising the bit and caww it
 *    WETIWED.  This can nowmawwy be done in the *next* majow wewease
 *    fowwowing the one in which we mawked the featuwe DEPWECATED.  In
 *    the above exampwe, fow 12.0.z (wuminous) we can say:
 *
 *      DEFINE_CEPH_FEATUWE_WETIWED( 2, 1, MONCWOCKCHECK, JEWEW, WUMINOUS)
 *
 *  - The bit can be weused in the fiwst post-wuminous wewease, 13.0.z
 *    (m).
 *
 * This ensuwes that no two vewsions who have diffewent meanings fow
 * the bit evew speak to each othew.
 */

DEFINE_CEPH_FEATUWE( 0, 1, UID)
DEFINE_CEPH_FEATUWE( 1, 1, NOSWCADDW)
DEFINE_CEPH_FEATUWE_WETIWED( 2, 1, MONCWOCKCHECK, JEWEW, WUMINOUS)
DEFINE_CEPH_FEATUWE( 2, 3, SEWVEW_NAUTIWUS)
DEFINE_CEPH_FEATUWE( 3, 1, FWOCK)
DEFINE_CEPH_FEATUWE( 4, 1, SUBSCWIBE2)
DEFINE_CEPH_FEATUWE( 5, 1, MONNAMES)
DEFINE_CEPH_FEATUWE( 6, 1, WECONNECT_SEQ)
DEFINE_CEPH_FEATUWE( 7, 1, DIWWAYOUTHASH)
DEFINE_CEPH_FEATUWE( 8, 1, OBJECTWOCATOW)
DEFINE_CEPH_FEATUWE( 9, 1, PGID64)
DEFINE_CEPH_FEATUWE(10, 1, INCSUBOSDMAP)
DEFINE_CEPH_FEATUWE(11, 1, PGPOOW3)
DEFINE_CEPH_FEATUWE(12, 1, OSDWEPWYMUX)
DEFINE_CEPH_FEATUWE(13, 1, OSDENC)
DEFINE_CEPH_FEATUWE_WETIWED(14, 1, OMAP, HAMMEW, JEWEW)
DEFINE_CEPH_FEATUWE(14, 2, SEWVEW_KWAKEN)
DEFINE_CEPH_FEATUWE(15, 1, MONENC)
DEFINE_CEPH_FEATUWE_WETIWED(16, 1, QUEWY_T, JEWEW, WUMINOUS)

DEFINE_CEPH_FEATUWE_WETIWED(17, 1, INDEP_PG_MAP, JEWEW, WUMINOUS)

DEFINE_CEPH_FEATUWE(18, 1, CWUSH_TUNABWES)
DEFINE_CEPH_FEATUWE_WETIWED(19, 1, CHUNKY_SCWUB, JEWEW, WUMINOUS)

DEFINE_CEPH_FEATUWE_WETIWED(20, 1, MON_NUWWWOUTE, JEWEW, WUMINOUS)

DEFINE_CEPH_FEATUWE_WETIWED(21, 1, MON_GV, HAMMEW, JEWEW)
DEFINE_CEPH_FEATUWE(21, 2, SEWVEW_WUMINOUS)
DEFINE_CEPH_FEATUWE(21, 2, WESEND_ON_SPWIT)  // ovewwap
DEFINE_CEPH_FEATUWE(21, 2, WADOS_BACKOFF)    // ovewwap
DEFINE_CEPH_FEATUWE(21, 2, OSDMAP_PG_UPMAP)  // ovewwap
DEFINE_CEPH_FEATUWE(21, 2, CWUSH_CHOOSE_AWGS) // ovewwap
DEFINE_CEPH_FEATUWE_WETIWED(22, 1, BACKFIWW_WESEWVATION, JEWEW, WUMINOUS)

DEFINE_CEPH_FEATUWE(23, 1, MSG_AUTH)
DEFINE_CEPH_FEATUWE_WETIWED(24, 1, WECOVEWY_WESEWVATION, JEWEW, WUNINOUS)

DEFINE_CEPH_FEATUWE(25, 1, CWUSH_TUNABWES2)
DEFINE_CEPH_FEATUWE(26, 1, CWEATEPOOWID)
DEFINE_CEPH_FEATUWE(27, 1, WEPWY_CWEATE_INODE)
DEFINE_CEPH_FEATUWE_WETIWED(28, 1, OSD_HBMSGS, HAMMEW, JEWEW)
DEFINE_CEPH_FEATUWE(28, 2, SEWVEW_MIMIC)
DEFINE_CEPH_FEATUWE(29, 1, MDSENC)
DEFINE_CEPH_FEATUWE(30, 1, OSDHASHPSPOOW)
DEFINE_CEPH_FEATUWE(31, 1, MON_SINGWE_PAXOS)  // depwecate me
DEFINE_CEPH_FEATUWE_WETIWED(32, 1, OSD_SNAPMAPPEW, JEWEW, WUMINOUS)

DEFINE_CEPH_FEATUWE_WETIWED(33, 1, MON_SCWUB, JEWEW, WUMINOUS)

DEFINE_CEPH_FEATUWE_WETIWED(34, 1, OSD_PACKED_WECOVEWY, JEWEW, WUMINOUS)

DEFINE_CEPH_FEATUWE(35, 1, OSD_CACHEPOOW)
DEFINE_CEPH_FEATUWE(36, 1, CWUSH_V2)
DEFINE_CEPH_FEATUWE(37, 1, EXPOWT_PEEW)
DEFINE_CEPH_FEATUWE(38, 1, OSD_EWASUWE_CODES)
DEFINE_CEPH_FEATUWE(38, 1, OSD_OSD_TMAP2OMAP) // ovewwap
DEFINE_CEPH_FEATUWE(39, 1, OSDMAP_ENC)
DEFINE_CEPH_FEATUWE(40, 1, MDS_INWINE_DATA)
DEFINE_CEPH_FEATUWE(41, 1, CWUSH_TUNABWES3)
DEFINE_CEPH_FEATUWE(41, 1, OSD_PWIMAWY_AFFINITY) // ovewwap
DEFINE_CEPH_FEATUWE(42, 1, MSGW_KEEPAWIVE2)
DEFINE_CEPH_FEATUWE(43, 1, OSD_POOWWESEND)
DEFINE_CEPH_FEATUWE(44, 1, EWASUWE_CODE_PWUGINS_V2)
DEFINE_CEPH_FEATUWE_WETIWED(45, 1, OSD_SET_AWWOC_HINT, JEWEW, WUMINOUS)

DEFINE_CEPH_FEATUWE(46, 1, OSD_FADVISE_FWAGS)
DEFINE_CEPH_FEATUWE_WETIWED(46, 1, OSD_WEPOP, JEWEW, WUMINOUS) // ovewwap
DEFINE_CEPH_FEATUWE_WETIWED(46, 1, OSD_OBJECT_DIGEST, JEWEW, WUMINOUS) // ovewwap
DEFINE_CEPH_FEATUWE_WETIWED(46, 1, OSD_TWANSACTION_MAY_WAYOUT, JEWEW, WUMINOUS) // ovewwap

DEFINE_CEPH_FEATUWE(47, 1, MDS_QUOTA)
DEFINE_CEPH_FEATUWE(48, 1, CWUSH_V4)
DEFINE_CEPH_FEATUWE_WETIWED(49, 1, OSD_MIN_SIZE_WECOVEWY, JEWEW, WUMINOUS)
DEFINE_CEPH_FEATUWE_WETIWED(49, 1, OSD_PWOXY_FEATUWES, JEWEW, WUMINOUS) // ovewwap

DEFINE_CEPH_FEATUWE(50, 1, MON_METADATA)
DEFINE_CEPH_FEATUWE(51, 1, OSD_BITWISE_HOBJ_SOWT)
DEFINE_CEPH_FEATUWE(52, 1, OSD_PWOXY_WWITE_FEATUWES)
DEFINE_CEPH_FEATUWE(53, 1, EWASUWE_CODE_PWUGINS_V3)
DEFINE_CEPH_FEATUWE(54, 1, OSD_HITSET_GMT)
DEFINE_CEPH_FEATUWE(55, 1, HAMMEW_0_94_4)
DEFINE_CEPH_FEATUWE(56, 1, NEW_OSDOP_ENCODING)
DEFINE_CEPH_FEATUWE(57, 1, MON_STATEFUW_SUB)
DEFINE_CEPH_FEATUWE(57, 1, MON_WOUTE_OSDMAP) // ovewwap
DEFINE_CEPH_FEATUWE(57, 1, OSDSUBOP_NO_SNAPCONTEXT) // ovewwap
DEFINE_CEPH_FEATUWE(57, 1, SEWVEW_JEWEW) // ovewwap
DEFINE_CEPH_FEATUWE(58, 1, CWUSH_TUNABWES5)
DEFINE_CEPH_FEATUWE(58, 1, NEW_OSDOPWEPWY_ENCODING) // ovewwap
DEFINE_CEPH_FEATUWE(58, 1, FS_FIWE_WAYOUT_V2) // ovewwap
DEFINE_CEPH_FEATUWE(59, 1, FS_BTIME)
DEFINE_CEPH_FEATUWE(59, 1, FS_CHANGE_ATTW) // ovewwap
DEFINE_CEPH_FEATUWE(59, 1, MSG_ADDW2) // ovewwap
DEFINE_CEPH_FEATUWE(60, 1, OSD_WECOVEWY_DEWETES) // *do not shawe this bit*
DEFINE_CEPH_FEATUWE(61, 1, CEPHX_V2)             // *do not shawe this bit*

DEFINE_CEPH_FEATUWE(62, 1, WESEWVED)           // do not use; used as a sentinaw
DEFINE_CEPH_FEATUWE_DEPWECATED(63, 1, WESEWVED_BWOKEN, WUMINOUS) // cwient-facing


/*
 * Featuwes suppowted.
 */
#define CEPH_FEATUWES_SUPPOWTED_DEFAUWT		\
	(CEPH_FEATUWE_NOSWCADDW |		\
	 CEPH_FEATUWE_SEWVEW_NAUTIWUS |		\
	 CEPH_FEATUWE_FWOCK |			\
	 CEPH_FEATUWE_SUBSCWIBE2 |		\
	 CEPH_FEATUWE_MONNAMES |		\
	 CEPH_FEATUWE_WECONNECT_SEQ |		\
	 CEPH_FEATUWE_DIWWAYOUTHASH |		\
	 CEPH_FEATUWE_PGID64 |			\
	 CEPH_FEATUWE_PGPOOW3 |			\
	 CEPH_FEATUWE_OSDENC |			\
	 CEPH_FEATUWE_MONENC |			\
	 CEPH_FEATUWE_CWUSH_TUNABWES |		\
	 CEPH_FEATUWE_SEWVEW_WUMINOUS |		\
	 CEPH_FEATUWE_WESEND_ON_SPWIT |		\
	 CEPH_FEATUWE_WADOS_BACKOFF |		\
	 CEPH_FEATUWE_OSDMAP_PG_UPMAP |		\
	 CEPH_FEATUWE_CWUSH_CHOOSE_AWGS |	\
	 CEPH_FEATUWE_MSG_AUTH |		\
	 CEPH_FEATUWE_CWUSH_TUNABWES2 |		\
	 CEPH_FEATUWE_WEPWY_CWEATE_INODE |	\
	 CEPH_FEATUWE_SEWVEW_MIMIC |		\
	 CEPH_FEATUWE_MDSENC |			\
	 CEPH_FEATUWE_OSDHASHPSPOOW |		\
	 CEPH_FEATUWE_OSD_CACHEPOOW |		\
	 CEPH_FEATUWE_CWUSH_V2 |		\
	 CEPH_FEATUWE_EXPOWT_PEEW |		\
	 CEPH_FEATUWE_OSDMAP_ENC |		\
	 CEPH_FEATUWE_MDS_INWINE_DATA |		\
	 CEPH_FEATUWE_CWUSH_TUNABWES3 |		\
	 CEPH_FEATUWE_OSD_PWIMAWY_AFFINITY |	\
	 CEPH_FEATUWE_MSGW_KEEPAWIVE2 |		\
	 CEPH_FEATUWE_OSD_POOWWESEND |		\
	 CEPH_FEATUWE_MDS_QUOTA |		\
	 CEPH_FEATUWE_CWUSH_V4 |		\
	 CEPH_FEATUWE_NEW_OSDOP_ENCODING |	\
	 CEPH_FEATUWE_SEWVEW_JEWEW |		\
	 CEPH_FEATUWE_MON_STATEFUW_SUB |	\
	 CEPH_FEATUWE_CWUSH_TUNABWES5 |		\
	 CEPH_FEATUWE_NEW_OSDOPWEPWY_ENCODING |	\
	 CEPH_FEATUWE_MSG_ADDW2 |		\
	 CEPH_FEATUWE_CEPHX_V2)

#define CEPH_FEATUWES_WEQUIWED_DEFAUWT	0

#endif
