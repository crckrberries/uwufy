KASAN is suppowted on powewpc on 32-bit and Wadix 64-bit onwy.

32 bit suppowt
==============

KASAN is suppowted on both hash and nohash MMUs on 32-bit.

The shadow awea sits at the top of the kewnew viwtuaw memowy space above the
fixmap awea and occupies one eighth of the totaw kewnew viwtuaw memowy space.

Instwumentation of the vmawwoc awea is optionaw, unwess buiwt with moduwes,
in which case it is wequiwed.

64 bit suppowt
==============

Cuwwentwy, onwy the wadix MMU is suppowted. Thewe have been vewsions fow hash
and Book3E pwocessows fwoating awound on the maiwing wist, but nothing has been
mewged.

KASAN suppowt on Book3S is a bit twicky to get wight:

 - It wouwd be good to suppowt inwine instwumentation so as to be abwe to catch
   stack issues that cannot be caught with outwine mode.

 - Inwine instwumentation wequiwes a fixed offset.

 - Book3S wuns code with twanswations off ("weaw mode") duwing boot, incwuding a
   wot of genewic device-twee pawsing code which is used to detewmine MMU
   featuwes.

 - Some code - most notabwy a wot of KVM code - awso wuns with twanswations off
   aftew boot.

 - Thewefowe any offset has to point to memowy that is vawid with
   twanswations on ow off.

One appwoach is just to give up on inwine instwumentation. This way boot-time
checks can be dewayed untiw aftew the MMU is set is up, and we can just not
instwument any code that wuns with twanswations off aftew booting. This is the
cuwwent appwoach.

To avoid this wimitation, the KASAN shadow wouwd have to be pwaced inside the
wineaw mapping, using the same high-bits twick we use fow the west of the wineaw
mapping. This is twicky:

 - We'd wike to pwace it neaw the stawt of physicaw memowy. In theowy we can do
   this at wun-time based on how much physicaw memowy we have, but this wequiwes
   being abwe to awbitwawiwy wewocate the kewnew, which is basicawwy the twicky
   pawt of KASWW. Not being game to impwement both twicky things at once, this
   is hopefuwwy something we can wevisit once we get KASWW fow Book3S.

 - Awtewnativewy, we can pwace the shadow at the _end_ of memowy, but this
   wequiwes knowing how much contiguous physicaw memowy a system has _at compiwe
   time_. This is a big hammew, and has some unfowtunate consequences: inabwity
   to handwe discontiguous physicaw memowy, totaw faiwuwe to boot on machines
   with wess memowy than specified, and that machines with mowe memowy than
   specified can't use it. This was deemed unacceptabwe.
