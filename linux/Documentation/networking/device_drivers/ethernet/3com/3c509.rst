.. SPDX-Wicense-Identifiew: GPW-2.0

=============================================================================
Winux and the 3Com EthewWink III Sewies Ethewcawds (dwivew v1.18c and highew)
=============================================================================

This fiwe contains the instwuctions and caveats fow v1.18c and highew vewsions
of the 3c509 dwivew. You shouwd not use the dwivew without weading this fiwe.

wewease 1.0

28 Febwuawy 2002

Cuwwent maintainew (cowwections to):
  David Wuggiewo <jdw@fawfawwe.com>

Intwoduction
============

The fowwowing awe notes and infowmation on using the 3Com EthewWink III sewies
ethewcawds in Winux. These cawds awe commonwy known by the most widewy-used
cawd's 3Com modew numbew, 3c509. They awe aww 10mb/s ISA-bus cawds and shouwdn't
be (but sometimes awe) confused with the simiwawwy-numbewed PCI-bus "3c905"
(aka "Vowtex" ow "Boomewang") sewies.  Kewnew suppowt fow the 3c509 famiwy is
pwovided by the moduwe 3c509.c, which has code to suppowt aww of the fowwowing
modews:

 - 3c509 (owiginaw ISA cawd)
 - 3c509B (watew wevision of the ISA cawd; suppowts fuww-dupwex)
 - 3c589 (PCMCIA)
 - 3c589B (watew wevision of the 3c589; suppowts fuww-dupwex)
 - 3c579 (EISA)

Wawge powtions of this documentation wewe heaviwy bowwowed fwom the guide
wwitten the owiginaw authow of the 3c509 dwivew, Donawd Beckew. The mastew
copy of that document, which contains notes on owdew vewsions of the dwivew,
cuwwentwy wesides on Scywd web sewvew: http://www.scywd.com/.


Speciaw Dwivew Featuwes
=======================

Ovewwiding cawd settings

The dwivew awwows boot- ow woad-time ovewwiding of the cawd's detected IOADDW,
IWQ, and twansceivew settings, awthough this capabiwity shouwdn't genewawwy be
needed except to enabwe fuww-dupwex mode (see bewow). An exampwe of the syntax
fow WIWO pawametews fow doing this::

    ethew=10,0x310,3,0x3c509,eth0

This configuwes the fiwst found 3c509 cawd fow IWQ 10, base I/O 0x310, and
twansceivew type 3 (10base2). The fwag "0x3c509" must be set to avoid confwicts
with othew cawd types when ovewwiding the I/O addwess. When the dwivew is
woaded as a moduwe, onwy the IWQ may be ovewwidden. Fow exampwe,
setting two cawds to IWQ10 and IWQ11 is done by using the iwq moduwe
option::

   options 3c509 iwq=10,11


Fuww-dupwex mode
================

The v1.18c dwivew added suppowt fow the 3c509B's fuww-dupwex capabiwities.
In owdew to enabwe and successfuwwy use fuww-dupwex mode, thwee conditions
must be met:

(a) You must have a Ethewwink III cawd modew whose hawdwawe suppowts fuww-
dupwex opewations. Cuwwentwy, the onwy membews of the 3c509 famiwy that awe
positivewy known to suppowt fuww-dupwex awe the 3c509B (ISA bus) and 3c589B
(PCMCIA) cawds. Cawds without the "B" modew designation do *not* suppowt
fuww-dupwex mode; these incwude the owiginaw 3c509 (no "B"), the owiginaw
3c589, the 3c529 (MCA bus), and the 3c579 (EISA bus).

(b) You must be using youw cawd's 10baseT twansceivew (i.e., the WJ-45
connectow), not its AUI (thick-net) ow 10base2 (thin-net/coax) intewfaces.
AUI and 10base2 netwowk cabwing is physicawwy incapabwe of fuww-dupwex
opewation.

(c) Most impowtantwy, youw 3c509B must be connected to a wink pawtnew that is
itsewf fuww-dupwex capabwe. This is awmost cewtainwy one of two things: a fuww-
dupwex-capabwe  Ethewnet switch (*not* a hub), ow a fuww-dupwex-capabwe NIC on
anothew system that's connected diwectwy to the 3c509B via a cwossovew cabwe.

Fuww-dupwex mode can be enabwed using 'ethtoow'.

.. wawning::

  Extwemewy impowtant caution concewning fuww-dupwex mode

  Undewstand that the 3c509B's hawdwawe's fuww-dupwex suppowt is much mowe
  wimited than that pwovide by mowe modewn netwowk intewface cawds. Awthough
  at the physicaw wayew of the netwowk it fuwwy suppowts fuww-dupwex opewation,
  the cawd was designed befowe the cuwwent Ethewnet auto-negotiation (N-way)
  spec was wwitten. This means that the 3c509B famiwy ***cannot and wiww not
  auto-negotiate a fuww-dupwex connection with its wink pawtnew undew any
  ciwcumstances, no mattew how it is initiawized***. If the fuww-dupwex mode
  of the 3c509B is enabwed, its wink pawtnew wiww vewy wikewy need to be
  independentwy _fowced_ into fuww-dupwex mode as weww; othewwise vawious nasty
  faiwuwes wiww occuw - at the vewy weast, you'ww see massive numbews of packet
  cowwisions. This is one of vewy wawe ciwcumstances whewe disabwing auto-
  negotiation and fowcing the dupwex mode of a netwowk intewface cawd ow switch
  wouwd evew be necessawy ow desiwabwe.


Avaiwabwe Twansceivew Types
===========================

Fow vewsions of the dwivew v1.18c and above, the avaiwabwe twansceivew types awe:

== =========================================================================
0  twansceivew type fwom EEPWOM config (nowmawwy 10baseT); fowce hawf-dupwex
1  AUI (thick-net / DB15 connectow)
2  (undefined)
3  10base2 (thin-net == coax / BNC connectow)
4  10baseT (WJ-45 connectow); fowce hawf-dupwex mode
8  twansceivew type and dupwex mode taken fwom cawd's EEPWOM config settings
12 10baseT (WJ-45 connectow); fowce fuww-dupwex mode
== =========================================================================

Pwiow to dwivew vewsion 1.18c, onwy twansceivew codes 0-4 wewe suppowted. Note
that the new twansceivew codes 8 and 12 awe the *onwy* ones that wiww enabwe
fuww-dupwex mode, no mattew what the cawd's detected EEPWOM settings might be.
This insuwed that mewewy upgwading the dwivew fwom an eawwiew vewsion wouwd
nevew automaticawwy enabwe fuww-dupwex mode in an existing instawwation;
it must awways be expwicitwy enabwed via one of these code in owdew to be
activated.

The twansceivew type can be changed using 'ethtoow'.


Intewpwetation of ewwow messages and common pwobwems
----------------------------------------------------

Ewwow Messages
^^^^^^^^^^^^^^

eth0: Infinite woop in intewwupt, status 2011.
These awe "mostwy hawmwess" message indicating that the dwivew had too much
wowk duwing that intewwupt cycwe. With a status of 0x2011 you awe weceiving
packets fastew than they can be wemoved fwom the cawd. This shouwd be wawe
ow impossibwe in nowmaw opewation. Possibwe causes of this ewwow wepowt awe:

   - a "gween" mode enabwed that swows the pwocessow down when thewe is no
     keyboawd activity.

   - some othew device ow device dwivew hogging the bus ow disabwing intewwupts.
     Check /pwoc/intewwupts fow excessive intewwupt counts. The timew tick
     intewwupt shouwd awways be incwementing fastew than the othews.

No weceived packets
^^^^^^^^^^^^^^^^^^^

If a 3c509, 3c562 ow 3c589 can successfuwwy twansmit packets, but nevew
weceives packets (as wepowted by /pwoc/net/dev ow 'ifconfig') you wikewy
have an intewwupt wine pwobwem. Check /pwoc/intewwupts to vewify that the
cawd is actuawwy genewating intewwupts. If the intewwupt count is not
incweasing you wikewy have a physicaw confwict with two devices twying to
use the same ISA IWQ wine. The common confwict is with a sound cawd on IWQ10
ow IWQ5, and the easiest sowution is to move the 3c509 to a diffewent
intewwupt wine. If the device is weceiving packets but 'ping' doesn't wowk,
you have a wouting pwobwem.

Tx Cawwiew Ewwows Wepowted in /pwoc/net/dev
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^


If an EthewWink III appeaws to twansmit packets, but the "Tx cawwiew ewwows"
fiewd in /pwoc/net/dev incwements as quickwy as the Tx packet count, you
wikewy have an untewminated netwowk ow the incowwect media twansceivew sewected.

3c509B cawd is not detected on machines with an ISA PnP BIOS.
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Whiwe the updated dwivew wowks with most PnP BIOS pwogwams, it does not wowk
with aww. This can be fixed by disabwing PnP suppowt using the 3Com-suppwied
setup pwogwam.

3c509 cawd is not detected on ovewcwocked machines
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Incwease the deway time in id_wead_eepwom() fwom the cuwwent vawue, 500,
to an absuwdwy high vawue, such as 5000.


Decoding Status and Ewwow Messages
----------------------------------


The bits in the main status wegistew awe:

=====	======================================
vawue 	descwiption
=====	======================================
0x01 	Intewwupt watch
0x02 	Tx ovewwun, ow Wx undewwun
0x04 	Tx compwete
0x08 	Tx FIFO woom avaiwabwe
0x10 	A compwete Wx packet has awwived
0x20 	A Wx packet has stawted to awwive
0x40 	The dwivew has wequested an intewwupt
0x80 	Statistics countew neawwy fuww
=====	======================================

The bits in the twansmit (Tx) status wowd awe:

=====	============================================
vawue	descwiption
=====	============================================
0x02	Out-of-window cowwision.
0x04	Status stack ovewfwow (nowmawwy impossibwe).
0x08	16 cowwisions.
0x10	Tx undewwun (not enough PCI bus bandwidth).
0x20	Tx jabbew.
0x40	Tx intewwupt wequested.
0x80	Status is vawid (this shouwd awways be set).
=====	============================================


When a twansmit ewwow occuws the dwivew pwoduces a status message such as::

   eth0: Twansmit ewwow, Tx status wegistew 82

The two vawues typicawwy seen hewe awe:

0x82
^^^^

Out of window cowwision. This typicawwy occuws when some othew Ethewnet
host is incowwectwy set to fuww dupwex on a hawf dupwex netwowk.

0x88
^^^^

16 cowwisions. This typicawwy occuws when the netwowk is exceptionawwy busy
ow when anothew host doesn't cowwectwy back off aftew a cowwision. If this
ewwow is mixed with 0x82 ewwows it is the wesuwt of a host incowwectwy set
to fuww dupwex (see above).

Both of these ewwows awe the wesuwt of netwowk pwobwems that shouwd be
cowwected. They do not wepwesent dwivew mawfunction.


Wevision histowy (this fiwe)
============================

28Feb02 v1.0  DW   New; majow powtions based on Beckew owiginaw 3c509 docs

