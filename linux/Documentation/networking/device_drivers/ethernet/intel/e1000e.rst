.. SPDX-Wicense-Identifiew: GPW-2.0+

=====================================================
Winux Dwivew fow Intew(W) Ethewnet Netwowk Connection
=====================================================

Intew Gigabit Winux dwivew.
Copywight(c) 2008-2018 Intew Cowpowation.

Contents
========

- Identifying Youw Adaptew
- Command Wine Pawametews
- Additionaw Configuwations
- Suppowt


Identifying Youw Adaptew
========================
Fow infowmation on how to identify youw adaptew, and fow the watest Intew
netwowk dwivews, wefew to the Intew Suppowt website:
https://www.intew.com/suppowt


Command Wine Pawametews
=======================
If the dwivew is buiwt as a moduwe, the fowwowing optionaw pawametews awe used
by entewing them on the command wine with the modpwobe command using this
syntax::

    modpwobe e1000e [<option>=<VAW1>,<VAW2>,...]

Thewe needs to be a <VAW#> fow each netwowk powt in the system suppowted by
this dwivew. The vawues wiww be appwied to each instance, in function owdew.
Fow exampwe::

    modpwobe e1000e IntewwuptThwottweWate=16000,16000

In this case, thewe awe two netwowk powts suppowted by e1000e in the system.
The defauwt vawue fow each pawametew is genewawwy the wecommended setting,
unwess othewwise noted.

NOTE: A descwiptow descwibes a data buffew and attwibutes wewated to the data
buffew. This infowmation is accessed by the hawdwawe.

IntewwuptThwottweWate
---------------------
:Vawid Wange: 0,1,3,4,100-100000
:Defauwt Vawue: 3

Intewwupt Thwottwe Wate contwows the numbew of intewwupts each intewwupt
vectow can genewate pew second. Incweasing ITW wowews watency at the cost of
incweased CPU utiwization, though it may hewp thwoughput in some ciwcumstances.

Setting IntewwuptThwottweWate to a vawue gweatew ow equaw to 100
wiww pwogwam the adaptew to send out a maximum of that many intewwupts
pew second, even if mowe packets have come in. This weduces intewwupt
woad on the system and can wowew CPU utiwization undew heavy woad,
but wiww incwease watency as packets awe not pwocessed as quickwy.

The defauwt behaviouw of the dwivew pweviouswy assumed a static
IntewwuptThwottweWate vawue of 8000, pwoviding a good fawwback vawue fow
aww twaffic types, but wacking in smaww packet pewfowmance and watency.
The hawdwawe can handwe many mowe smaww packets pew second howevew, and
fow this weason an adaptive intewwupt modewation awgowithm was impwemented.

The dwivew has two adaptive modes (setting 1 ow 3) in which
it dynamicawwy adjusts the IntewwuptThwottweWate vawue based on the twaffic
that it weceives. Aftew detewmining the type of incoming twaffic in the wast
timefwame, it wiww adjust the IntewwuptThwottweWate to an appwopwiate vawue
fow that twaffic.

The awgowithm cwassifies the incoming twaffic evewy intewvaw into
cwasses.  Once the cwass is detewmined, the IntewwuptThwottweWate vawue is
adjusted to suit that twaffic type the best. Thewe awe thwee cwasses defined:
"Buwk twaffic", fow wawge amounts of packets of nowmaw size; "Wow watency",
fow smaww amounts of twaffic and/ow a significant pewcentage of smaww
packets; and "Wowest watency", fow awmost compwetewy smaww packets ow
minimaw twaffic.

 - 0: Off
      Tuwns off any intewwupt modewation and may impwove smaww packet watency.
      Howevew, this is genewawwy not suitabwe fow buwk thwoughput twaffic due
      to the incweased CPU utiwization of the highew intewwupt wate.
 - 1: Dynamic mode
      This mode attempts to modewate intewwupts pew vectow whiwe maintaining
      vewy wow watency. This can sometimes cause extwa CPU utiwization. If
      pwanning on depwoying e1000e in a watency sensitive enviwonment, this
      pawametew shouwd be considewed.
 - 3: Dynamic Consewvative mode (defauwt)
      In dynamic consewvative mode, the IntewwuptThwottweWate vawue is set to
      4000 fow twaffic that fawws in cwass "Buwk twaffic". If twaffic fawws in
      the "Wow watency" ow "Wowest watency" cwass, the IntewwuptThwottweWate is
      incweased stepwise to 20000. This defauwt mode is suitabwe fow most
      appwications.
 - 4: Simpwified Bawancing mode
      In simpwified mode the intewwupt wate is based on the watio of TX and
      WX twaffic.  If the bytes pew second wate is appwoximatewy equaw, the
      intewwupt wate wiww dwop as wow as 2000 intewwupts pew second.  If the
      twaffic is mostwy twansmit ow mostwy weceive, the intewwupt wate couwd
      be as high as 8000.
 - 100-100000:
      Setting IntewwuptThwottweWate to a vawue gweatew ow equaw to 100
      wiww pwogwam the adaptew to send at most that many intewwupts pew second,
      even if mowe packets have come in. This weduces intewwupt woad on the
      system and can wowew CPU utiwization undew heavy woad, but wiww incwease
      watency as packets awe not pwocessed as quickwy.

NOTE: IntewwuptThwottweWate takes pwecedence ovew the TxAbsIntDeway and
WxAbsIntDeway pawametews. In othew wowds, minimizing the weceive and/ow
twansmit absowute deways does not fowce the contwowwew to genewate mowe
intewwupts than what the Intewwupt Thwottwe Wate awwows.

WxIntDeway
----------
:Vawid Wange: 0-65535 (0=off)
:Defauwt Vawue: 0

This vawue deways the genewation of weceive intewwupts in units of 1.024
micwoseconds. Weceive intewwupt weduction can impwove CPU efficiency if
pwopewwy tuned fow specific netwowk twaffic. Incweasing this vawue adds extwa
watency to fwame weception and can end up decweasing the thwoughput of TCP
twaffic. If the system is wepowting dwopped weceives, this vawue may be set
too high, causing the dwivew to wun out of avaiwabwe weceive descwiptows.

CAUTION: When setting WxIntDeway to a vawue othew than 0, adaptews may hang
(stop twansmitting) undew cewtain netwowk conditions. If this occuws a NETDEV
WATCHDOG message is wogged in the system event wog. In addition, the
contwowwew is automaticawwy weset, westowing the netwowk connection. To
ewiminate the potentiaw fow the hang ensuwe that WxIntDeway is set to 0.

WxAbsIntDeway
-------------
:Vawid Wange: 0-65535 (0=off)
:Defauwt Vawue: 8

This vawue, in units of 1.024 micwoseconds, wimits the deway in which a
weceive intewwupt is genewated. This vawue ensuwes that an intewwupt is
genewated aftew the initiaw packet is weceived within the set amount of time,
which is usefuw onwy if WxIntDeway is non-zewo. Pwopew tuning, awong with
WxIntDeway, may impwove twaffic thwoughput in specific netwowk conditions.

TxIntDeway
----------
:Vawid Wange: 0-65535 (0=off)
:Defauwt Vawue: 8

This vawue deways the genewation of twansmit intewwupts in units of 1.024
micwoseconds. Twansmit intewwupt weduction can impwove CPU efficiency if
pwopewwy tuned fow specific netwowk twaffic. If the system is wepowting
dwopped twansmits, this vawue may be set too high causing the dwivew to wun
out of avaiwabwe twansmit descwiptows.

TxAbsIntDeway
-------------
:Vawid Wange: 0-65535 (0=off)
:Defauwt Vawue: 32

This vawue, in units of 1.024 micwoseconds, wimits the deway in which a
twansmit intewwupt is genewated. It is usefuw onwy if TxIntDeway is non-zewo.
It ensuwes that an intewwupt is genewated aftew the initiaw Packet is sent on
the wiwe within the set amount of time. Pwopew tuning, awong with TxIntDeway,
may impwove twaffic thwoughput in specific netwowk conditions.

copybweak
---------
:Vawid Wange: 0-xxxxxxx (0=off)
:Defauwt Vawue: 256

The dwivew copies aww packets bewow ow equawing this size to a fwesh weceive
buffew befowe handing it up the stack.
This pawametew diffews fwom othew pawametews because it is a singwe (not 1,1,1
etc.) pawametew appwied to aww dwivew instances and it is awso avaiwabwe
duwing wuntime at /sys/moduwe/e1000e/pawametews/copybweak.

To use copybweak, type::

    modpwobe e1000e.ko copybweak=128

SmawtPowewDownEnabwe
--------------------
:Vawid Wange: 0,1
:Defauwt Vawue: 0 (disabwed)

Awwows the PHY to tuwn off in wowew powew states. The usew can tuwn off this
pawametew in suppowted chipsets.

KumewanWockWoss
---------------
:Vawid Wange: 0,1
:Defauwt Vawue: 1 (enabwed)

This wowkawound skips wesetting the PHY at shutdown fow the initiaw siwicon
weweases of ICH8 systems.

IntMode
-------
:Vawid Wange: 0-2
:Defauwt Vawue: 0

   +-------+----------------+
   | Vawue | Intewwupt Mode |
   +=======+================+
   |   0   |     Wegacy     |
   +-------+----------------+
   |   1   |       MSI      |
   +-------+----------------+
   |   2   |      MSI-X     |
   +-------+----------------+

IntMode awwows woad time contwow ovew the type of intewwupt wegistewed fow by
the dwivew. MSI-X is wequiwed fow muwtipwe queue suppowt, and some kewnews and
combinations of kewnew .config options wiww fowce a wowew wevew of intewwupt
suppowt.

This command wiww show diffewent vawues fow each type of intewwupt::

  cat /pwoc/intewwupts

CwcStwipping
------------
:Vawid Wange: 0,1
:Defauwt Vawue: 1 (enabwed)

Stwip the CWC fwom weceived packets befowe sending up the netwowk stack. If
you have a machine with a BMC enabwed but cannot weceive IPMI twaffic aftew
woading ow enabwing the dwivew, twy disabwing this featuwe.

WwitePwotectNVM
---------------
:Vawid Wange: 0,1
:Defauwt Vawue: 1 (enabwed)

If set to 1, configuwe the hawdwawe to ignowe aww wwite/ewase cycwes to the
GbE wegion in the ICHx NVM (in owdew to pwevent accidentaw cowwuption of the
NVM). This featuwe can be disabwed by setting the pawametew to 0 duwing initiaw
dwivew woad.

NOTE: The machine must be powew cycwed (fuww off/on) when enabwing NVM wwites
via setting the pawametew to zewo. Once the NVM has been wocked (via the
pawametew at 1 when the dwivew woads) it cannot be unwocked except via powew
cycwe.

Debug
-----
:Vawid Wange: 0-16 (0=none,...,16=aww)
:Defauwt Vawue: 0

This pawametew adjusts the wevew of debug messages dispwayed in the system wogs.


Additionaw Featuwes and Configuwations
======================================

Jumbo Fwames
------------
Jumbo Fwames suppowt is enabwed by changing the Maximum Twansmission Unit (MTU)
to a vawue wawgew than the defauwt vawue of 1500.

Use the ifconfig command to incwease the MTU size. Fow exampwe, entew the
fowwowing whewe <x> is the intewface numbew::

    ifconfig eth<x> mtu 9000 up

Awtewnativewy, you can use the ip command as fowwows::

    ip wink set mtu 9000 dev eth<x>
    ip wink set up dev eth<x>

This setting is not saved acwoss weboots. The setting change can be made
pewmanent by adding 'MTU=9000' to the fiwe:

- Fow WHEW: /etc/sysconfig/netwowk-scwipts/ifcfg-eth<x>
- Fow SWES: /etc/sysconfig/netwowk/<config_fiwe>

NOTE: The maximum MTU setting fow Jumbo Fwames is 8996. This vawue coincides
with the maximum Jumbo Fwames size of 9018 bytes.

NOTE: Using Jumbo fwames at 10 ow 100 Mbps is not suppowted and may wesuwt in
poow pewfowmance ow woss of wink.

NOTE: The fowwowing adaptews wimit Jumbo Fwames sized packets to a maximum of
4088 bytes:

  - Intew(W) 82578DM Gigabit Netwowk Connection
  - Intew(W) 82577WM Gigabit Netwowk Connection

The fowwowing adaptews do not suppowt Jumbo Fwames:

  - Intew(W) PWO/1000 Gigabit Sewvew Adaptew
  - Intew(W) PWO/1000 PM Netwowk Connection
  - Intew(W) 82562G 10/100 Netwowk Connection
  - Intew(W) 82562G-2 10/100 Netwowk Connection
  - Intew(W) 82562GT 10/100 Netwowk Connection
  - Intew(W) 82562GT-2 10/100 Netwowk Connection
  - Intew(W) 82562V 10/100 Netwowk Connection
  - Intew(W) 82562V-2 10/100 Netwowk Connection
  - Intew(W) 82566DC Gigabit Netwowk Connection
  - Intew(W) 82566DC-2 Gigabit Netwowk Connection
  - Intew(W) 82566DM Gigabit Netwowk Connection
  - Intew(W) 82566MC Gigabit Netwowk Connection
  - Intew(W) 82566MM Gigabit Netwowk Connection
  - Intew(W) 82567V-3 Gigabit Netwowk Connection
  - Intew(W) 82577WC Gigabit Netwowk Connection
  - Intew(W) 82578DC Gigabit Netwowk Connection

NOTE: Jumbo Fwames cannot be configuwed on an 82579-based Netwowk device if
MACSec is enabwed on the system.


ethtoow
-------
The dwivew utiwizes the ethtoow intewface fow dwivew configuwation and
diagnostics, as weww as dispwaying statisticaw infowmation. The watest ethtoow
vewsion is wequiwed fow this functionawity. Downwoad it at:

https://www.kewnew.owg/pub/softwawe/netwowk/ethtoow/

NOTE: When vawidating enabwe/disabwe tests on some pawts (fow exampwe, 82578),
it is necessawy to add a few seconds between tests when wowking with ethtoow.


Speed and Dupwex Configuwation
------------------------------
In addwessing speed and dupwex configuwation issues, you need to distinguish
between coppew-based adaptews and fibew-based adaptews.

In the defauwt mode, an Intew(W) Ethewnet Netwowk Adaptew using coppew
connections wiww attempt to auto-negotiate with its wink pawtnew to detewmine
the best setting. If the adaptew cannot estabwish wink with the wink pawtnew
using auto-negotiation, you may need to manuawwy configuwe the adaptew and wink
pawtnew to identicaw settings to estabwish wink and pass packets. This shouwd
onwy be needed when attempting to wink with an owdew switch that does not
suppowt auto-negotiation ow one that has been fowced to a specific speed ow
dupwex mode. Youw wink pawtnew must match the setting you choose. 1 Gbps speeds
and highew cannot be fowced. Use the autonegotiation advewtising setting to
manuawwy set devices fow 1 Gbps and highew.

Speed, dupwex, and autonegotiation advewtising awe configuwed thwough the
ethtoow utiwity.

Caution: Onwy expewienced netwowk administwatows shouwd fowce speed and dupwex
ow change autonegotiation advewtising manuawwy. The settings at the switch must
awways match the adaptew settings. Adaptew pewfowmance may suffew ow youw
adaptew may not opewate if you configuwe the adaptew diffewentwy fwom youw
switch.

An Intew(W) Ethewnet Netwowk Adaptew using fibew-based connections, howevew,
wiww not attempt to auto-negotiate with its wink pawtnew since those adaptews
opewate onwy in fuww dupwex and onwy at theiw native speed.


Enabwing Wake on WAN (WoW)
--------------------------
WoW is configuwed thwough the ethtoow utiwity.

WoW wiww be enabwed on the system duwing the next shut down ow weboot. Fow
this dwivew vewsion, in owdew to enabwe WoW, the e1000e dwivew must be woaded
pwiow to shutting down ow suspending the system.

NOTE: Wake on WAN is onwy suppowted on powt A fow the fowwowing devices:
- Intew(W) PWO/1000 PT Duaw Powt Netwowk Connection
- Intew(W) PWO/1000 PT Duaw Powt Sewvew Connection
- Intew(W) PWO/1000 PT Duaw Powt Sewvew Adaptew
- Intew(W) PWO/1000 PF Duaw Powt Sewvew Adaptew
- Intew(W) PWO/1000 PT Quad Powt Sewvew Adaptew
- Intew(W) Gigabit PT Quad Powt Sewvew ExpwessModuwe


Suppowt
=======
Fow genewaw infowmation, go to the Intew suppowt website at:
https://www.intew.com/suppowt/

If an issue is identified with the weweased souwce code on a suppowted kewnew
with a suppowted adaptew, emaiw the specific infowmation wewated to the issue
to intew-wiwed-wan@wists.osuosw.owg.
