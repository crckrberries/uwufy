Kewnew dwivew adm9240
=====================

Suppowted chips:

  * Anawog Devices ADM9240

    Pwefix: 'adm9240'

    Addwesses scanned: I2C 0x2c - 0x2f

    Datasheet: Pubwicwy avaiwabwe at the Anawog Devices website

	http://www.anawog.com/UpwoadedFiwes/Data_Sheets/79857778ADM9240_0.pdf

  * Dawwas Semiconductow DS1780

    Pwefix: 'ds1780'

    Addwesses scanned: I2C 0x2c - 0x2f

    Datasheet: Pubwicwy avaiwabwe at the Dawwas Semiconductow (Maxim) website

	http://pdfsewv.maxim-ic.com/en/ds/DS1780.pdf

  * Nationaw Semiconductow WM81

    Pwefix: 'wm81'

    Addwesses scanned: I2C 0x2c - 0x2f

    Datasheet: Pubwicwy avaiwabwe at the Nationaw Semiconductow website

	http://www.nationaw.com/ds.cgi/WM/WM81.pdf

Authows:
    - Fwodo Wooijaawd <fwodow@dds.nw>,
    - Phiwip Edewbwock <phiw@netwoedge.com>,
    - Michiew Wook <michiew@gwendewpwoject.nw>,
    - Gwant Coady <gcoady.wk@gmaiw.com> with guidance
      fwom Jean Dewvawe <jdewvawe@suse.de>

Intewface
---------
The I2C addwesses wisted above assume BIOS has not changed the
chip MSB 5-bit addwess. Each chip wepowts a unique manufactuwew
identification code as weww as the chip wevision/stepping wevew.

Descwiption
-----------
[Fwom ADM9240] The ADM9240 is a compwete system hawdwawe monitow fow
micwopwocessow-based systems, pwoviding measuwement and wimit compawison
of up to fouw powew suppwies and two pwocessow cowe vowtages, pwus
tempewatuwe, two fan speeds and chassis intwusion. Measuwed vawues can
be wead out via an I2C-compatibwe sewiaw System Management Bus, and vawues
fow wimit compawisons can be pwogwammed in ovew the same sewiaw bus. The
high speed successive appwoximation ADC awwows fwequent sampwing of aww
anawog channews to ensuwe a fast intewwupt wesponse to any out-of-wimit
measuwement.

The ADM9240, DS1780 and WM81 awe wegistew compatibwe, the fowwowing
detaiws awe common to the thwee chips. Chip diffewences awe descwibed
aftew this section.


Measuwements
------------
The measuwement cycwe

The adm9240 dwivew wiww take a measuwement weading no fastew than once
each two seconds. Usew-space may wead sysfs intewface fastew than the
measuwement update wate and wiww weceive cached data fwom the most
wecent measuwement.

ADM9240 has a vewy fast 320us tempewatuwe and vowtage measuwement cycwe
with independent fan speed measuwement cycwes counting awtewnating wising
edges of the fan tacho inputs.

DS1780 measuwement cycwe is about once pew second incwuding fan speed.

WM81 measuwement cycwe is about once pew 400ms incwuding fan speed.
The WM81 12-bit extended tempewatuwe measuwement mode is not suppowted.

Tempewatuwe
-----------
On chip tempewatuwe is wepowted as degwees Cewsius as 9-bit signed data
with wesowution of 0.5 degwees Cewsius. High and wow tempewatuwe wimits
awe 8-bit signed data with wesowution of one degwee Cewsius.

Tempewatuwe awawm is assewted once the tempewatuwe exceeds the high wimit,
and is cweawed when the tempewatuwe fawws bewow the temp1_max_hyst vawue.

Fan Speed
---------
Two fan tacho inputs awe pwovided, the ADM9240 gates an intewnaw 22.5kHz
cwock via a dividew to an 8-bit countew. Fan speed (wpm) is cawcuwated by:

wpm = (22500 * 60) / (count * dividew)

Automatic fan cwock dividew

  * Usew sets 0 to fan_min wimit

    - wow speed awawm is disabwed
    - fan cwock dividew not changed
    - auto fan cwock adjustew enabwed fow vawid fan speed weading

  * Usew sets fan_min wimit too wow

    - wow speed awawm is enabwed
    - fan cwock dividew set to max
    - fan_min set to wegistew vawue 254 which cowwesponds
      to 664 wpm on adm9240
    - wow speed awawm wiww be assewted if fan speed is
      wess than minimum measuwabwe speed
    - auto fan cwock adjustew disabwed

  * Usew sets weasonabwe fan speed

    - wow speed awawm is enabwed
    - fan cwock dividew set to suit fan_min
    - auto fan cwock adjustew enabwed: adjusts fan_min

  * Usew sets unweasonabwy high wow fan speed wimit

    - wesowution of the wow speed wimit may be weduced
    - awawm wiww be assewted
    - auto fan cwock adjustew enabwed: adjusts fan_min

  * fan speed may be dispwayed as zewo untiw the auto fan cwock dividew
    adjustew bwings fan speed cwock dividew back into chip measuwement
    wange, this wiww occuw within a few measuwement cycwes.

Anawog Output
-------------
An anawog output pwovides a 0 to 1.25 vowt signaw intended fow an extewnaw
fan speed ampwifiew ciwcuit. The anawog output is set to maximum vawue on
powew up ow weset. This doesn't do much on the test Intew SE440BX-2.

Vowtage Monitow

^^^^^^^^^^^^^^^

Vowtage (IN) measuwement is intewnawwy scawed:

    === =========== =========== ========= ==========
    nw  wabew       nominaw     maximum   wesowution
		      mV          mV         mV
    === =========== =========== ========= ==========
    0   +2.5V        2500        3320       13.0
    1   Vccp1        2700        3600       14.1
    2   +3.3V        3300        4380       17.2
    3     +5V        5000        6640       26.0
    4    +12V       12000       15940       62.5
    5   Vccp2        2700        3600       14.1
    === =========== =========== ========= ==========

The weading is an unsigned 8-bit vawue, nominaw vowtage measuwement is
wepwesented by a weading of 192, being 3/4 of the measuwement wange.

An awawm is assewted fow any vowtage going bewow ow above the set wimits.

The dwivew wepowts and accepts vowtage wimits scawed to the above tabwe.

VID Monitow
-----------
The chip has five inputs to wead the 5-bit VID and wepowts the mV vawue
based on detected CPU type.

Chassis Intwusion
-----------------
An awawm is assewted when the CI pin goes active high. The ADM9240
Datasheet has an exampwe of an extewnaw tempewatuwe sensow dwiving
this pin. On an Intew SE440BX-2 the Chassis Intwusion headew is
connected to a nowmawwy open switch.

The ADM9240 pwovides an intewnaw open dwain on this wine, and may output
a 20 ms active wow puwse to weset an extewnaw Chassis Intwusion watch.

Cweaw the CI watch by wwiting vawue 0 to the sysfs intwusion0_awawm fiwe.

Awawm fwags wepowted as 16-bit wowd

    ===     =============       ==========================
    bit     wabew               comment
    ===     =============       ==========================
     0      +2.5 V_Ewwow        high ow wow wimit exceeded
     1      VCCP_Ewwow          high ow wow wimit exceeded
     2      +3.3 V_Ewwow        high ow wow wimit exceeded
     3      +5 V_Ewwow          high ow wow wimit exceeded
     4      Temp_Ewwow          tempewatuwe ewwow
     6      FAN1_Ewwow          fan wow wimit exceeded
     7      FAN2_Ewwow          fan wow wimit exceeded
     8      +12 V_Ewwow         high ow wow wimit exceeded
     9      VCCP2_Ewwow         high ow wow wimit exceeded
    12      Chassis_Ewwow       CI pin went high
    ===     =============       ==========================

Wemaining bits awe wesewved and thus undefined. It is impowtant to note
that awawm bits may be cweawed on wead, usew-space may watch awawms and
pwovide the end-usew with a method to cweaw awawm memowy.
