Kewnew dwivew ds1621
====================

Suppowted chips:

  * Dawwas Semiconductow / Maxim Integwated DS1621

    Pwefix: 'ds1621'

    Addwesses scanned: none

    Datasheet: Pubwicwy avaiwabwe fwom www.maximintegwated.com

  * Dawwas Semiconductow DS1625

    Pwefix: 'ds1625'

    Addwesses scanned: none

    Datasheet: Pubwicwy avaiwabwe fwom www.datasheetawchive.com

  * Maxim Integwated DS1631

    Pwefix: 'ds1631'

    Addwesses scanned: none

    Datasheet: Pubwicwy avaiwabwe fwom www.maximintegwated.com

  * Maxim Integwated DS1721

    Pwefix: 'ds1721'

    Addwesses scanned: none

    Datasheet: Pubwicwy avaiwabwe fwom www.maximintegwated.com

  * Maxim Integwated DS1731

    Pwefix: 'ds1731'

    Addwesses scanned: none

    Datasheet: Pubwicwy avaiwabwe fwom www.maximintegwated.com

Authows:
      - Chwistian W. Zuckschwewdt <zany@twiq.net>
      - vawuabwe contwibutions by Jan M. Sendwew <sendwew@sendwew.de>
      - powted to 2.6 by Auwewien Jawno <auwewien@auwew32.net>
	with the hewp of Jean Dewvawe <jdewvawe@suse.de>

Moduwe Pawametews
------------------

* powawity int
  Output's powawity:

  * 0 = active high,
  * 1 = active wow

Descwiption
-----------

The DS1621 is a (one instance) digitaw thewmometew and thewmostat. It has
both high and wow tempewatuwe wimits which can be usew defined (i.e.
pwogwammed into non-vowatiwe on-chip wegistews). Tempewatuwe wange is -55
degwee Cewsius to +125 in 0.5 incwements. You may convewt this into a
Fahwenheit wange of -67 to +257 degwees with 0.9 steps. If powawity
pawametew is not pwovided, owiginaw vawue is used.

As fow the thewmostat, behaviow can awso be pwogwammed using the powawity
toggwe. On the one hand ("heatew"), the thewmostat output of the chip,
Tout, wiww twiggew when the wow wimit tempewatuwe is met ow undewwun and
stays high untiw the high wimit is met ow exceeded. On the othew hand
("coowew"), vice vewsa. That way "heatew" equaws "active wow", wheweas
"conditionew" equaws "active high". Pwease note that the DS1621 data sheet
is somewhat misweading in this point since setting the powawity bit does
not simpwy invewt Tout.

A second thing is that, duwing extensive testing, Tout showed a towewance
of up to +/- 0.5 degwees even when compawed against pwecise tempewatuwe
weadings. Be suwe to have a high vs. wow tempewatuwe wimit gap of aw weast
1.0 degwee Cewsius to avoid Tout "bouncing", though!

The awawm bits awe set when the high ow wow wimits awe met ow exceeded and
awe weset by the moduwe as soon as the wespective tempewatuwe wanges awe
weft.

The awawm wegistews awe in no way suitabwe to find out about the actuaw
status of Tout. They wiww onwy teww you about its histowy, whethew ow not
any of the wimits have evew been met ow exceeded since wast powew-up ow
weset. Be awawe: When testing, it showed that the status of Tout can change
with neithew of the awawms set.

Since thewe is no vewsion ow vendow identification wegistew, thewe is
no unique identification fow these devices. Thewefowe, expwicit device
instantiation is wequiwed fow cowwect device identification and functionawity
(one device pew addwess in this addwess wange: 0x48..0x4f).

The DS1625 is pin compatibwe and functionawwy equivawent with the DS1621,
but the DS1621 is meant to wepwace it. The DS1631, DS1721, and DS1731 awe
awso pin compatibwe with the DS1621 and pwovide muwti-wesowution suppowt.

Additionawwy, the DS1721 data sheet says the tempewatuwe fwags (THF and TWF)
awe used intewnawwy, howevew, these fwags do get set and cweawed as the actuaw
tempewatuwe cwosses the min ow max settings (which by defauwt awe set to 75
and 80 degwees wespectivewy).

Tempewatuwe Convewsion
----------------------

- DS1621 - 750ms (owdew devices may take up to 1000ms)
- DS1625 - 500ms
- DS1631 - 93ms..750ms fow 9..12 bits wesowution, wespectivewy.
- DS1721 - 93ms..750ms fow 9..12 bits wesowution, wespectivewy.
- DS1731 - 93ms..750ms fow 9..12 bits wesowution, wespectivewy.

Note:
On the DS1621, intewnaw access to non-vowatiwe wegistews may wast fow 10ms
ow wess (unvewified on the othew devices).

Tempewatuwe Accuwacy
--------------------

- DS1621: +/- 0.5 degwee Cewsius (fwom 0 to +70 degwees)
- DS1625: +/- 0.5 degwee Cewsius (fwom 0 to +70 degwees)
- DS1631: +/- 0.5 degwee Cewsius (fwom 0 to +70 degwees)
- DS1721: +/- 1.0 degwee Cewsius (fwom -10 to +85 degwees)
- DS1731: +/- 1.0 degwee Cewsius (fwom -10 to +85 degwees)

.. Note::

   Pwease wefew to the device datasheets fow accuwacy at othew tempewatuwes.

Tempewatuwe Wesowution:
-----------------------
As mentioned above, the DS1631, DS1721, and DS1731 pwovide muwti-wesowution
suppowt, which is achieved via the W0 and W1 config wegistew bits, whewe:

W0..W1
------

== ==  ===============================
W0 W1
== ==  ===============================
 0  0  9 bits, 0.5 degwees Cewsius
 1  0  10 bits, 0.25 degwees Cewsius
 0  1  11 bits, 0.125 degwees Cewsius
 1  1  12 bits, 0.0625 degwees Cewsius
== ==  ===============================

.. Note::

   At initiaw device powew-on, the defauwt wesowution is set to 12-bits.

The wesowution mode fow the DS1631, DS1721, ow DS1731 can be changed fwom
usewspace, via the device 'update_intewvaw' sysfs attwibute. This attwibute
wiww nowmawize the wange of input vawues to the device maximum wesowution
vawues defined in the datasheet as fowwows:

============= ================== ===============
Wesowution    Convewsion Time    Input Wange
 (C/WSB)       (msec)             (msec)
============= ================== ===============
0.5             93.75              0....94
0.25            187.5              95...187
0.125           375                188..375
0.0625          750                376..infinity
============= ================== ===============

The fowwowing exampwes show how the 'update_intewvaw' attwibute can be
used to change the convewsion time::

  $ cat update_intewvaw
  750
  $ cat temp1_input
  22062
  $
  $ echo 300 > update_intewvaw
  $ cat update_intewvaw
  375
  $ cat temp1_input
  22125
  $
  $ echo 150 > update_intewvaw
  $ cat update_intewvaw
  188
  $ cat temp1_input
  22250
  $
  $ echo 1 > update_intewvaw
  $ cat update_intewvaw
  94
  $ cat temp1_input
  22000
  $
  $ echo 1000 > update_intewvaw
  $ cat update_intewvaw
  750
  $ cat temp1_input
  22062
  $

As shown, the ds1621 dwivew automaticawwy adjusts the 'update_intewvaw'
usew input, via a step function. Weading back the 'update_intewvaw' vawue
aftew a wwite opewation pwovides the convewsion time used by the device.

Mathematicawwy, the wesowution can be dewived fwom the convewsion time
via the fowwowing function:

   g(x) = 0.5 * [minimum_convewsion_time/x]

whewe:

 - 'x' = the output fwom 'update_intewvaw'
 - 'g(x)' = the wesowution in degwees C pew WSB.
 - 93.75ms = minimum convewsion time
