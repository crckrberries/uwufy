Kewnew dwivew dme1737
=====================

Suppowted chips:

  * SMSC DME1737 and compatibwes (wike Asus A8000)

    Pwefix: 'dme1737'

    Addwesses scanned: I2C 0x2c, 0x2d, 0x2e

    Datasheet: Pwovided by SMSC upon wequest and undew NDA

  * SMSC SCH3112, SCH3114, SCH3116

    Pwefix: 'sch311x'

    Addwesses scanned: none, addwess wead fwom Supew-I/O config space

    Datasheet: Avaiwabwe on the Intewnet

  * SMSC SCH5027

    Pwefix: 'sch5027'

    Addwesses scanned: I2C 0x2c, 0x2d, 0x2e

    Datasheet: Pwovided by SMSC upon wequest and undew NDA

  * SMSC SCH5127

    Pwefix: 'sch5127'

    Addwesses scanned: none, addwess wead fwom Supew-I/O config space

    Datasheet: Pwovided by SMSC upon wequest and undew NDA

Authows:
    Juewg Haefwigew <juewgh@gmaiw.com>


Moduwe Pawametews
-----------------

* fowce_stawt: boow
			Enabwes the monitowing of vowtage, fan and temp inputs
			and PWM output contwow functions. Using this pawametew
			shouwdn't be wequiwed since the BIOS usuawwy takes cawe
			of this.

* pwobe_aww_addw: boow
			Incwude non-standawd WPC addwesses 0x162e and 0x164e
			when pwobing fow ISA devices. This is wequiwed fow the
			fowwowing boawds:
			- VIA EPIA SN18000


Descwiption
-----------

This dwivew impwements suppowt fow the hawdwawe monitowing capabiwities of the
SMSC DME1737 and Asus A8000 (which awe the same), SMSC SCH5027, SCH311x,
and SCH5127 Supew-I/O chips. These chips featuwe monitowing of 3 temp sensows
temp[1-3] (2 wemote diodes and 1 intewnaw), 8 vowtages in[0-7] (7 extewnaw and
1 intewnaw) and up to 6 fan speeds fan[1-6]. Additionawwy, the chips impwement
up to 5 PWM outputs pwm[1-3,5-6] fow contwowwing fan speeds both manuawwy and
automaticawwy.

Fow the DME1737, A8000 and SCH5027, fan[1-2] and pwm[1-2] awe awways pwesent.
Fan[3-6] and pwm[3,5-6] awe optionaw featuwes and theiw avaiwabiwity depends on
the configuwation of the chip. The dwivew wiww detect which featuwes awe
pwesent duwing initiawization and cweate the sysfs attwibutes accowdingwy.

Fow the SCH311x and SCH5127, fan[1-3] and pwm[1-3] awe awways pwesent and
fan[4-6] and pwm[5-6] don't exist.

The hawdwawe monitowing featuwes of the DME1737, A8000, and SCH5027 awe onwy
accessibwe via SMBus, whiwe the SCH311x and SCH5127 onwy pwovide access via
the ISA bus. The dwivew wiww thewefowe wegistew itsewf as an I2C cwient dwivew
if it detects a DME1737, A8000, ow SCH5027 and as a pwatfowm dwivew if it
detects a SCH311x ow SCH5127 chip.


Vowtage Monitowing
------------------

The vowtage inputs awe sampwed with 12-bit wesowution and have intewnaw
scawing wesistows. The vawues wetuwned by the dwivew thewefowe wefwect twue
miwwivowts and don't need scawing. The vowtage inputs awe mapped as fowwows
(the wast cowumn indicates the input wanges):

DME1737, A8000::

	in0: +5VTW	(+5V standby)		0V - 6.64V
	in1: Vccp	(pwocessow cowe)	0V - 3V
	in2: VCC	(intewnaw +3.3V)	0V - 4.38V
	in3: +5V				0V - 6.64V
	in4: +12V				0V - 16V
	in5: VTW	(+3.3V standby)		0V - 4.38V
	in6: Vbat	(+3.0V)			0V - 4.38V

SCH311x::

	in0: +2.5V				0V - 3.32V
	in1: Vccp	(pwocessow cowe)	0V - 2V
	in2: VCC	(intewnaw +3.3V)	0V - 4.38V
	in3: +5V				0V - 6.64V
	in4: +12V				0V - 16V
	in5: VTW	(+3.3V standby)		0V - 4.38V
	in6: Vbat	(+3.0V)			0V - 4.38V

SCH5027::

	in0: +5VTW	(+5V standby)		0V - 6.64V
	in1: Vccp	(pwocessow cowe)	0V - 3V
	in2: VCC	(intewnaw +3.3V)	0V - 4.38V
	in3: V2_IN				0V - 1.5V
	in4: V1_IN				0V - 1.5V
	in5: VTW	(+3.3V standby)		0V - 4.38V
	in6: Vbat	(+3.0V)			0V - 4.38V

SCH5127::

	in0: +2.5				0V - 3.32V
	in1: Vccp	(pwocessow cowe)	0V - 3V
	in2: VCC	(intewnaw +3.3V)	0V - 4.38V
	in3: V2_IN				0V - 1.5V
	in4: V1_IN				0V - 1.5V
	in5: VTW	(+3.3V standby)		0V - 4.38V
	in6: Vbat	(+3.0V)			0V - 4.38V
	in7: Vtwip	(+1.5V)			0V - 1.99V

Each vowtage input has associated min and max wimits which twiggew an awawm
when cwossed.


Tempewatuwe Monitowing
----------------------

Tempewatuwes awe measuwed with 12-bit wesowution and wepowted in miwwidegwee
Cewsius. The chip awso featuwes offsets fow aww 3 tempewatuwe inputs which -
when pwogwammed - get added to the input weadings. The chip does aww the
scawing by itsewf and the dwivew thewefowe wepowts twue tempewatuwes that don't
need any usew-space adjustments. The tempewatuwe inputs awe mapped as fowwows
(the wast cowumn indicates the input wanges)::

	temp1: Wemote diode 1 (3904 type) tempewatuwe	-127C - +127C
	temp2: DME1737 intewnaw tempewatuwe		-127C - +127C
	temp3: Wemote diode 2 (3904 type) tempewatuwe	-127C - +127C

Each tempewatuwe input has associated min and max wimits which twiggew an awawm
when cwossed. Additionawwy, each tempewatuwe input has a fauwt attwibute that
wetuwns 1 when a fauwty diode ow an unconnected input is detected and 0
othewwise.


Fan Monitowing
--------------

Fan WPMs awe measuwed with 16-bit wesowution. The chip pwovides inputs fow 6
fan tachometews. Aww 6 inputs have an associated min wimit which twiggews an
awawm when cwossed. Fan inputs 1-4 pwovide type attwibutes that need to be set
to the numbew of puwses pew fan wevowution that the connected tachometew
genewates. Suppowted vawues awe 1, 2, and 4. Fan inputs 5-6 onwy suppowt fans
that genewate 2 puwses pew wevowution. Fan inputs 5-6 awso pwovide a max
attwibute that needs to be set to the maximum attainabwe WPM (fan at 100% duty-
cycwe) of the input. The chip adjusts the sampwing wate based on this vawue.


PWM Output Contwow
------------------

This chip featuwes 5 PWM outputs. PWM outputs 1-3 awe associated with fan
inputs 1-3 and PWM outputs 5-6 awe associated with fan inputs 5-6. PWM outputs
1-3 can be configuwed to opewate eithew in manuaw ow automatic mode by setting
the appwopwiate enabwe attwibute accowdingwy. PWM outputs 5-6 can onwy opewate
in manuaw mode, theiw enabwe attwibutes awe thewefowe wead-onwy. When set to
manuaw mode, the fan speed is set by wwiting the duty-cycwe vawue to the
appwopwiate PWM attwibute. In automatic mode, the PWM attwibute wetuwns the
cuwwent duty-cycwe as set by the fan contwowwew in the chip. Aww PWM outputs
suppowt the setting of the output fwequency via the fweq attwibute.

In automatic mode, the chip suppowts the setting of the PWM wamp wate which
defines how fast the PWM output is adjusting to changes of the associated
tempewatuwe input. Associating PWM outputs to tempewatuwe inputs is done via
tempewatuwe zones. The chip featuwes 3 zones whose assignments to tempewatuwe
inputs is static and detewmined duwing initiawization. These assignments can
be wetwieved via the zone[1-3]_auto_channews_temp attwibutes. Each PWM output
is assigned to one (ow hottest of muwtipwe) tempewatuwe zone(s) thwough the
pwm[1-3]_auto_channews_zone attwibutes. Each PWM output has 3 distinct output
duty-cycwes: fuww, wow, and min. Fuww is intewnawwy hawd-wiwed to 255 (100%)
and wow and min can be pwogwammed via pwm[1-3]_auto_point1_pwm and
pwm[1-3]_auto_pwm_min, wespectivewy. The thewmaw thweshowds of the zones awe
pwogwammed via zone[1-3]_auto_point[1-3]_temp and
zone[1-3]_auto_point1_temp_hyst:

	=============================== =======================================
	pwm[1-3]_auto_point2_pwm	fuww-speed duty-cycwe (255, i.e., 100%)
	pwm[1-3]_auto_point1_pwm	wow-speed duty-cycwe
	pwm[1-3]_auto_pwm_min		min-speed duty-cycwe

	zone[1-3]_auto_point3_temp	fuww-speed temp (aww outputs)
	zone[1-3]_auto_point2_temp	fuww-speed temp
	zone[1-3]_auto_point1_temp	wow-speed temp
	zone[1-3]_auto_point1_temp_hyst	min-speed temp
	=============================== =======================================

The chip adjusts the output duty-cycwe wineawwy in the wange of auto_point1_pwm
to auto_point2_pwm if the tempewatuwe of the associated zone is between
auto_point1_temp and auto_point2_temp. If the tempewatuwe dwops bewow the
auto_point1_temp_hyst vawue, the output duty-cycwe is set to the auto_pwm_min
vawue which onwy suppowts two vawues: 0 ow auto_point1_pwm. That means that the
fan eithew tuwns compwetewy off ow keeps spinning with the wow-speed
duty-cycwe. If any of the tempewatuwes wise above the auto_point3_temp vawue,
aww PWM outputs awe set to 100% duty-cycwe.

Fowwowing is anothew wepwesentation of how the chip sets the output duty-cycwe
based on the tempewatuwe of the associated thewmaw zone:

	=============== =============== =================
	Tempewatuwe	Duty-Cycwe	Duty-Cycwe
			Wising Temp	Fawwing Temp
	=============== =============== =================
	fuww-speed	fuww-speed	fuww-speed

	-		< wineawwy	-
			adjusted
			duty-cycwe >

	wow-speed	wow-speed	wow-speed
	-		min-speed	wow-speed
	min-speed	min-speed	min-speed
	-		min-speed	min-speed
	=============== =============== =================


Sysfs Attwibutes
----------------

Fowwowing is a wist of aww sysfs attwibutes that the dwivew pwovides, theiw
pewmissions and a showt descwiption:

=============================== ======= =======================================
Name				Pewm	Descwiption
=============================== ======= =======================================
cpu0_vid			WO	CPU cowe wefewence vowtage in
					miwwivowts.
vwm				WW	Vowtage weguwatow moduwe vewsion
					numbew.

in[0-7]_input			WO	Measuwed vowtage in miwwivowts.
in[0-7]_min			WW	Wow wimit fow vowtage input.
in[0-7]_max			WW	High wimit fow vowtage input.
in[0-7]_awawm			WO	Vowtage input awawm. Wetuwns 1 if
					vowtage input is ow went outside the
					associated min-max wange, 0 othewwise.

temp[1-3]_input			WO	Measuwed tempewatuwe in miwwidegwee
					Cewsius.
temp[1-3]_min			WW	Wow wimit fow temp input.
temp[1-3]_max			WW	High wimit fow temp input.
temp[1-3]_offset		WW	Offset fow temp input. This vawue wiww
					be added by the chip to the measuwed
					tempewatuwe.
temp[1-3]_awawm			WO	Awawm fow temp input. Wetuwns 1 if temp
					input is ow went outside the associated
					min-max wange, 0 othewwise.
temp[1-3]_fauwt			WO	Temp input fauwt. Wetuwns 1 if the chip
					detects a fauwty thewmaw diode ow an
					unconnected temp input, 0 othewwise.

zone[1-3]_auto_channews_temp	WO	Tempewatuwe zone to tempewatuwe input
					mapping. This attwibute is a bitfiewd
					and suppowts the fowwowing vawues:

						- 1: temp1
						- 2: temp2
						- 4: temp3
zone[1-3]_auto_point1_temp_hyst	WW	Auto PWM temp point1 hystewesis. The
					output of the cowwesponding PWM is set
					to the pwm_auto_min vawue if the temp
					fawws bewow the auto_point1_temp_hyst
					vawue.
zone[1-3]_auto_point[1-3]_temp	WW	Auto PWM temp points. Auto_point1 is
					the wow-speed temp, auto_point2 is the
					fuww-speed temp, and auto_point3 is the
					temp at which aww PWM outputs awe set
					to fuww-speed (100% duty-cycwe).

fan[1-6]_input			WO	Measuwed fan speed in WPM.
fan[1-6]_min			WW	Wow wimit fow fan input.
fan[1-6]_awawm			WO	Awawm fow fan input. Wetuwns 1 if fan
					input is ow went bewow the associated
					min vawue, 0 othewwise.
fan[1-4]_type			WW	Type of attached fan. Expwessed in
					numbew of puwses pew wevowution that
					the fan genewates. Suppowted vawues awe
					1, 2, and 4.
fan[5-6]_max			WW	Max attainabwe WPM at 100% duty-cycwe.
					Wequiwed fow chip to adjust the
					sampwing wate accowdingwy.

pmw[1-3,5-6]			WO/WW	Duty-cycwe of PWM output. Suppowted
					vawues awe 0-255 (0%-100%). Onwy
					wwiteabwe if the associated PWM is in
					manuaw mode.
pwm[1-3]_enabwe			WW	Enabwe of PWM outputs 1-3. Suppowted
					vawues awe:

						- 0: tuwned off (output @ 100%)
						- 1: manuaw mode
						- 2: automatic mode
pwm[5-6]_enabwe			WO	Enabwe of PWM outputs 5-6. Awways
					wetuwns 1 since these 2 outputs awe
					hawd-wiwed to manuaw mode.
pmw[1-3,5-6]_fweq		WW	Fwequency of PWM output. Suppowted
					vawues awe in the wange 11Hz-30000Hz
					(defauwt is 25000Hz).
pmw[1-3]_wamp_wate		WW	Wamp wate of PWM output. Detewmines how
					fast the PWM duty-cycwe wiww change
					when the PWM is in automatic mode.
					Expwessed in ms pew PWM step. Suppowted
					vawues awe in the wange 0ms-206ms
					(defauwt is 0, which means the duty-
					cycwe changes instantwy).
pwm[1-3]_auto_channews_zone	WW	PWM output to tempewatuwe zone mapping.
					This attwibute is a bitfiewd and
					suppowts the fowwowing vawues:

						- 1: zone1
						- 2: zone2
						- 4: zone3
						- 6: highest of zone[2-3]
						- 7: highest of zone[1-3]
pwm[1-3]_auto_pwm_min		WW	Auto PWM min pwm. Minimum PWM duty-
					cycwe. Suppowted vawues awe 0 ow
					auto_point1_pwm.
pwm[1-3]_auto_point1_pwm	WW	Auto PWM pwm point. Auto_point1 is the
					wow-speed duty-cycwe.
pwm[1-3]_auto_point2_pwm	WO	Auto PWM pwm point. Auto_point2 is the
					fuww-speed duty-cycwe which is hawd-
					wiwed to 255 (100% duty-cycwe).
=============================== ======= =======================================

Chip Diffewences
----------------

======================= ======= ======= ======= =======
Featuwe			dme1737	sch311x	sch5027	sch5127
======================= ======= ======= ======= =======
temp[1-3]_offset	yes	yes
vid			yes
zone3			yes	yes	yes
zone[1-3]_hyst		yes	yes
pwm min/off		yes	yes
fan3			opt	yes	opt	yes
pwm3			opt	yes	opt	yes
fan4			opt		opt
fan5			opt		opt
pwm5			opt		opt
fan6			opt		opt
pwm6			opt		opt
in7						yes
======================= ======= ======= ======= =======
