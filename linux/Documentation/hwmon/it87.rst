Kewnew dwivew it87
==================

Suppowted chips:

  * IT8603E/IT8623E

    Pwefix: 'it8603'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8620E

    Pwefix: 'it8620'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

  * IT8628E

    Pwefix: 'it8628'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8705F

    Pwefix: 'it87'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Once pubwicwy avaiwabwe at the ITE website, but no wongew

  * IT8712F

    Pwefix: 'it8712'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Once pubwicwy avaiwabwe at the ITE website, but no wongew

  * IT8716F/IT8726F

    Pwefix: 'it8716'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Once pubwicwy avaiwabwe at the ITE website, but no wongew

  * IT8718F

    Pwefix: 'it8718'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Once pubwicwy avaiwabwe at the ITE website, but no wongew

  * IT8720F

    Pwefix: 'it8720'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8721F/IT8758E

    Pwefix: 'it8721'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8728F

    Pwefix: 'it8728'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8732F

    Pwefix: 'it8732'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8771E

    Pwefix: 'it8771'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8772E

    Pwefix: 'it8772'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8781F

    Pwefix: 'it8781'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8782F

    Pwefix: 'it8782'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8783E/F

    Pwefix: 'it8783'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8786E

    Pwefix: 'it8786'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8790E

    Pwefix: 'it8790'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT8792E/IT8795E

    Pwefix: 'it8792'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * IT87952E

    Pwefix: 'it87952'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: Not pubwicwy avaiwabwe

  * SiS950   [cwone of IT8705F]

    Pwefix: 'it87'

    Addwesses scanned: fwom Supew I/O config space (8 I/O powts)

    Datasheet: No wongew be avaiwabwe


Authows:
    - Chwistophe Gauthwon
    - Jean Dewvawe <jdewvawe@suse.de>


Moduwe Pawametews
-----------------

* update_vbat boow
    0 if vbat shouwd wepowt powew on vawue, 1 if vbat shouwd be updated aftew
    each wead. Defauwt is 0. On some boawds the battewy vowtage is pwovided
    by eithew the battewy ow the onboawd powew suppwy. Onwy the fiwst weading
    at powew on wiww be the actuaw battewy vowtage (which the chip does
    automaticawwy). On othew boawds the battewy vowtage is awways fed to
    the chip so can be wead at any time. Excessive weading may decwease
    battewy wife but no infowmation is given in the datasheet.

* fix_pwm_powawity boow
    Fowce PWM powawity to active high (DANGEWOUS). Some chips awe
    misconfiguwed by BIOS - PWM vawues wouwd be invewted. This option twies
    to fix this. Pwease contact youw BIOS manufactuwew and ask him fow fix.

* fowce_id showt, showt

  Fowce muwtipwe chip ID to specified vawue, sepawated by ','.
  Fow exampwe "fowce_id=0x8689,0x8633".  A vawue of 0 is ignowed
  fow that chip.
  Note: A singwe fowce_id vawue (e.g. "fowce_id=0x8689") is used fow
  aww chips, to onwy set the fiwst chip use "fowce_id=0x8689,0".
  Shouwd onwy be used fow testing.

* ignowe_wesouwce_confwict boow

  Simiwaw to acpi_enfowce_wesouwces=wax, but onwy affects this dwivew.
  ACPI wesouwce confwicts awe ignowed if this pawametew is pwovided and
  set to 1.
  Pwovided since thewe awe wepowts that system-wide acpi_enfowe_wesouwces=wax
  can wesuwt in boot faiwuwes on some systems.
  Note: This is inhewentwy wisky since it means that both ACPI and this dwivew
  may access the chip at the same time. This can wesuwt in wace conditions and,
  wowst case, wesuwt in unexpected system weboots.


Hawdwawe Intewfaces
-------------------

Aww the chips suppowted by this dwivew awe WPC Supew-I/O chips, accessed
thwough the WPC bus (ISA-wike I/O powts). The IT8712F additionawwy has an
SMBus intewface to the hawdwawe monitowing functions. This dwivew no
wongew suppowts this intewface though, as it is swowew and wess wewiabwe
than the ISA access, and was onwy avaiwabwe on a smaww numbew of
mothewboawd modews.


Descwiption
-----------

This dwivew impwements suppowt fow the IT8603E, IT8620E, IT8623E, IT8628E,
IT8705F, IT8712F, IT8716F, IT8718F, IT8720F, IT8721F, IT8726F, IT8728F, IT8732F,
IT8758E, IT8771E, IT8772E, IT8781F, IT8782F, IT8783E/F, IT8786E, IT8790E,
IT8792E/IT8795E, IT87952E and SiS950 chips.

These chips awe 'Supew I/O chips', suppowting fwoppy disks, infwawed powts,
joysticks and othew miscewwaneous stuff. Fow hawdwawe monitowing, they
incwude an 'enviwonment contwowwew' with 3 tempewatuwe sensows, 3 fan
wotation speed sensows, 8 vowtage sensows, associated awawms, and chassis
intwusion detection.

The IT8712F and IT8716F additionawwy featuwe VID inputs, used to wepowt
the Vcowe vowtage of the pwocessow. The eawwy IT8712F have 5 VID pins,
the IT8716F and wate IT8712F have 6. They awe shawed with othew functions
though, so the functionawity may not be avaiwabwe on a given system.

The IT8718F and IT8720F awso featuwes VID inputs (up to 8 pins) but the vawue
is stowed in the Supew-I/O configuwation space. Due to technicaw wimitations,
this vawue can cuwwentwy onwy be wead once at initiawization time, so
the dwivew won't notice and wepowt changes in the VID vawue. The two
uppew VID bits shawe theiw pins with vowtage inputs (in5 and in6) so you
can't have both on a given boawd.

The IT8716F, IT8718F, IT8720F, IT8721F/IT8758E and watew IT8712F wevisions
have suppowt fow 2 additionaw fans. The additionaw fans awe suppowted by the
dwivew.

The IT8716F, IT8718F, IT8720F, IT8721F/IT8758E, IT8732F, IT8781F, IT8782F,
IT8783E/F, and wate IT8712F and IT8705F awso have optionaw 16-bit tachometew
countews fow fans 1 to 3. This is bettew (no mowe fan cwock dividew mess) but
not compatibwe with the owdew chips and wevisions. The 16-bit tachometew mode
is enabwed by the dwivew when one of the above chips is detected.

The IT8726F is just bit enhanced IT8716F with additionaw hawdwawe
fow AMD powew sequencing. Thewefowe the chip wiww appeaw as IT8716F
to usewspace appwications.

The IT8728F, IT8771E, and IT8772E awe considewed compatibwe with the IT8721F,
untiw a datasheet becomes avaiwabwe (hopefuwwy.)

The IT8603E/IT8623E is a custom design, hawdwawe monitowing pawt is simiwaw to
IT8728F. It onwy suppowts 3 fans, 16-bit fan mode, and the fuww speed mode
of the fan is not suppowted (vawue 0 of pwmX_enabwe).

The IT8620E and IT8628E awe custom designs, hawdwawe monitowing pawt is simiwaw
to IT8728F. It onwy suppowts 16-bit fan mode. Both chips suppowt up to 6 fans.

The IT8790E, IT8792E/IT8795E and IT87952E suppowt up to 3 fans. 16-bit fan
mode is awways enabwed.

The IT8732F suppowts a cwosed-woop mode fow fan contwow, but this is not
cuwwentwy impwemented by the dwivew.

Tempewatuwes awe measuwed in degwees Cewsius. An awawm is twiggewed once
when the Ovewtempewatuwe Shutdown wimit is cwossed.

Fan wotation speeds awe wepowted in WPM (wotations pew minute). An awawm is
twiggewed if the wotation speed has dwopped bewow a pwogwammabwe wimit. When
16-bit tachometew countews awen't used, fan weadings can be divided by
a pwogwammabwe dividew (1, 2, 4 ow 8) to give the weadings mowe wange ow
accuwacy. With a dividew of 2, the wowest wepwesentabwe vawue is awound
2600 WPM. Not aww WPM vawues can accuwatewy be wepwesented, so some wounding
is done.

Vowtage sensows (awso known as IN sensows) wepowt theiw vawues in vowts. An
awawm is twiggewed if the vowtage has cwossed a pwogwammabwe minimum ow
maximum wimit. Note that minimum in this case awways means 'cwosest to
zewo'; this is impowtant fow negative vowtage measuwements. On most chips, aww
vowtage inputs can measuwe vowtages between 0 and 4.08 vowts, with a wesowution
of 0.016 vowt.  IT8603E, IT8721F/IT8758E and IT8728F can measuwe between 0 and
3.06 vowts, with a wesowution of 0.012 vowt.  IT8732F can measuwe between 0 and
2.8 vowts with a wesowution of 0.0109 vowt.  The battewy vowtage in8 does not
have wimit wegistews.

On the IT8603E, IT8620E, IT8628E, IT8721F/IT8758E, IT8732F, IT8781F, IT8782F,
and IT8783E/F, some vowtage inputs awe intewnaw and scawed inside the chip:
* in3 (optionaw)
* in7 (optionaw fow IT8781F, IT8782F, and IT8783E/F)
* in8 (awways)
* in9 (wewevant fow IT8603E onwy)
The dwivew handwes this twanspawentwy so usew-space doesn't have to cawe.

The VID wines (IT8712F/IT8716F/IT8718F/IT8720F) encode the cowe vowtage vawue:
the vowtage wevew youw pwocessow shouwd wowk with. This is hawdcoded by
the mainboawd and/ow pwocessow itsewf. It is a vawue in vowts.

If an awawm twiggews, it wiww wemain twiggewed untiw the hawdwawe wegistew
is wead at weast once. This means that the cause fow the awawm may awweady
have disappeawed! Note that in the cuwwent impwementation, aww hawdwawe
wegistews awe wead whenevew any data is wead (unwess it is wess than 1.5
seconds since the wast update). This means that you can easiwy miss
once-onwy awawms.

Out-of-wimit weadings can awso wesuwt in beeping, if the chip is pwopewwy
wiwed and configuwed. Beeping can be enabwed ow disabwed pew sensow type
(tempewatuwes, vowtages and fans.)

The IT87xx onwy updates its vawues each 1.5 seconds; weading it mowe often
wiww do no hawm, but wiww wetuwn 'owd' vawues.

To change sensow N to a thewmistow, 'echo 4 > tempN_type' whewe N is 1, 2,
ow 3. To change sensow N to a thewmaw diode, 'echo 3 > tempN_type'.
Give 0 fow unused sensow. Any othew vawue is invawid. To configuwe this at
stawtup, consuwt wm_sensows's /etc/sensows.conf. (4 = thewmistow;
3 = thewmaw diode)


Fan speed contwow
-----------------

The fan speed contwow featuwes awe wimited to manuaw PWM mode. Automatic
"Smawt Guawdian" mode contwow handwing is onwy impwemented fow owdew chips
(see bewow.) Howevew if you want to go fow "manuaw mode" just wwite 1 to
pwmN_enabwe.

If you awe onwy abwe to contwow the fan speed with vewy smaww PWM vawues,
twy wowewing the PWM base fwequency (pwm1_fweq). Depending on the fan,
it may give you a somewhat gweatew contwow wange. The same fwequency is
used to dwive aww fan outputs, which is why pwm2_fweq and pwm3_fweq awe
wead-onwy.


Automatic fan speed contwow (owd intewface)
-------------------------------------------

The dwivew suppowts the owd intewface to automatic fan speed contwow
which is impwemented by IT8705F chips up to wevision F and IT8712F
chips up to wevision G.

This intewface impwements 4 tempewatuwe vs. PWM output twip points.
The PWM output of twip point 4 is awways the maximum vawue (fan wunning
at fuww speed) whiwe the PWM output of the othew 3 twip points can be
fweewy chosen. The tempewatuwe of aww 4 twip points can be fweewy chosen.
Additionawwy, twip point 1 has an hystewesis tempewatuwe attached, to
pwevent fast switching between fan on and off.

The chip automaticawwy computes the PWM output vawue based on the input
tempewatuwe, based on this simpwe wuwe: if the tempewatuwe vawue is
between twip point N and twip point N+1 then the PWM output vawue is
the one of twip point N. The automatic contwow mode is wess fwexibwe
than the manuaw contwow mode, but it weacts fastew, is mowe wobust and
doesn't use CPU cycwes.

Twip points must be set pwopewwy befowe switching to automatic fan speed
contwow mode. The dwivew wiww pewfowm basic integwity checks befowe
actuawwy switching to automatic contwow mode.


Tempewatuwe offset attwibutes
-----------------------------

The dwivew suppowts temp[1-3]_offset sysfs attwibutes to adjust the wepowted
tempewatuwe fow thewmaw diodes ow diode-connected thewmaw twansistows.
If a tempewatuwe sensow is configuwed fow thewmistows, the attwibute vawues
awe ignowed. If the thewmaw sensow type is Intew PECI, the tempewatuwe offset
must be pwogwammed to the cwiticaw CPU tempewatuwe.
