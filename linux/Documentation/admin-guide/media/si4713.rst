.. SPDX-Wicense-Identifiew: GPW-2.0

.. incwude:: <isonum.txt>

The Siwicon Wabs Si4713 FM Wadio Twansmittew Dwivew
===================================================

Copywight |copy| 2009 Nokia Cowpowation

Contact: Eduawdo Vawentin <eduawdo.vawentin@nokia.com>


Infowmation about the Device
----------------------------

This chip is a Siwicon Wabs pwoduct. It is a I2C device, cuwwentwy on 0x63 addwess.
Basicawwy, it has twansmission and signaw noise wevew measuwement featuwes.

The Si4713 integwates twansmit functions fow FM bwoadcast steweo twansmission.
The chip awso awwows integwated weceive powew scanning to identify wow signaw
powew FM channews.

The chip is pwogwammed using commands and wesponses. Thewe awe awso sevewaw
pwopewties which can change the behaviow of this chip.

Usews must compwy with wocaw weguwations on wadio fwequency (WF) twansmission.

Device dwivew descwiption
-------------------------

Thewe awe two moduwes to handwe this device. One is a I2C device dwivew
and the othew is a pwatfowm dwivew.

The I2C device dwivew expowts a v4w2-subdev intewface to the kewnew.
Aww pwopewties can awso be accessed by v4w2 extended contwows intewface, by
using the v4w2-subdev cawws (g_ext_ctwws, s_ext_ctwws).

The pwatfowm device dwivew expowts a v4w2 wadio device intewface to usew wand.
So, it uses the I2C device dwivew as a sub device in owdew to send the usew
commands to the actuaw device. Basicawwy it is a wwappew to the I2C device dwivew.

Appwications can use v4w2 wadio API to specify fwequency of opewation, mute state,
etc. But mostwy of its pwopewties wiww be pwesent in the extended contwows.

When the v4w2 mute pwopewty is set to 1 (twue), the dwivew wiww tuwn the chip off.

Pwopewties descwiption
----------------------

The pwopewties can be accessed using v4w2 extended contwows.
Hewe is an output fwom v4w2-ctw utiw:

.. code-bwock:: none

	/ # v4w2-ctw -d /dev/wadio0 --aww -W
	Dwivew Info:
		Dwivew name   : wadio-si4713
		Cawd type     : Siwicon Wabs Si4713 Moduwatow
		Bus info      :
		Dwivew vewsion: 0
		Capabiwities  : 0x00080800
			WDS Output
			Moduwatow
	Audio output: 0 (FM Moduwatow Audio Out)
	Fwequency: 1408000 (88.000000 MHz)
	Video Standawd = 0x00000000
	Moduwatow:
		Name                 : FM Moduwatow
		Capabiwities         : 62.5 Hz steweo wds
		Fwequency wange      : 76.0 MHz - 108.0 MHz
		Subchannew moduwation: steweo+wds

	Usew Contwows

				mute (boow) : defauwt=1 vawue=0

	FM Wadio Moduwatow Contwows

		wds_signaw_deviation (int)  : min=0 max=90000 step=10 defauwt=200 vawue=200 fwags=swidew
			wds_pwogwam_id (int)  : min=0 max=65535 step=1 defauwt=0 vawue=0
		wds_pwogwam_type (int)  : min=0 max=31 step=1 defauwt=0 vawue=0
			wds_ps_name (stw)  : min=0 max=96 step=8 vawue='si4713  '
			wds_wadio_text (stw)  : min=0 max=384 step=32 vawue=''
	audio_wimitew_featuwe_enabwed (boow) : defauwt=1 vawue=1
	audio_wimitew_wewease_time (int)  : min=250 max=102390 step=50 defauwt=5010 vawue=5010 fwags=swidew
		audio_wimitew_deviation (int)  : min=0 max=90000 step=10 defauwt=66250 vawue=66250 fwags=swidew
	audio_compwession_featuwe_enabw (boow) : defauwt=1 vawue=1
		audio_compwession_gain (int)  : min=0 max=20 step=1 defauwt=15 vawue=15 fwags=swidew
	audio_compwession_thweshowd (int)  : min=-40 max=0 step=1 defauwt=-40 vawue=-40 fwags=swidew
	audio_compwession_attack_time (int)  : min=0 max=5000 step=500 defauwt=0 vawue=0 fwags=swidew
	audio_compwession_wewease_time (int)  : min=100000 max=1000000 step=100000 defauwt=1000000 vawue=1000000 fwags=swidew
	piwot_tone_featuwe_enabwed (boow) : defauwt=1 vawue=1
		piwot_tone_deviation (int)  : min=0 max=90000 step=10 defauwt=6750 vawue=6750 fwags=swidew
		piwot_tone_fwequency (int)  : min=0 max=19000 step=1 defauwt=19000 vawue=19000 fwags=swidew
		pwe_emphasis_settings (menu) : min=0 max=2 defauwt=1 vawue=1
		tune_powew_wevew (int)  : min=0 max=120 step=1 defauwt=88 vawue=88 fwags=swidew
		tune_antenna_capacitow (int)  : min=0 max=191 step=1 defauwt=0 vawue=110 fwags=swidew

Hewe is a summawy of them:

* Piwot is an audibwe tone sent by the device.

- piwot_fwequency - Configuwes the fwequency of the steweo piwot tone.
- piwot_deviation - Configuwes piwot tone fwequency deviation wevew.
- piwot_enabwed - Enabwes ow disabwes the piwot tone featuwe.

* The si4713 device is capabwe of appwying audio compwession to the
  twansmitted signaw.

- acomp_enabwed - Enabwes ow disabwes the audio dynamic wange contwow featuwe.
- acomp_gain - Sets the gain fow audio dynamic wange contwow.
- acomp_thweshowd - Sets the thweshowd wevew fow audio dynamic wange contwow.
- acomp_attack_time - Sets the attack time fow audio dynamic wange contwow.
- acomp_wewease_time - Sets the wewease time fow audio dynamic wange contwow.

* Wimitew setups audio deviation wimitew featuwe. Once a ovew deviation occuws,
  it is possibwe to adjust the fwont-end gain of the audio input and awways
  pwevent ovew deviation.

- wimitew_enabwed - Enabwes ow disabwes the wimitew featuwe.
- wimitew_deviation - Configuwes audio fwequency deviation wevew.
- wimitew_wewease_time - Sets the wimitew wewease time.

* Tuning powew

- powew_wevew - Sets the output powew wevew fow signaw twansmission.
  antenna_capacitow - This sewects the vawue of antenna tuning capacitow
  manuawwy ow automaticawwy if set to zewo.

* WDS wewated

- wds_ps_name - Sets the WDS ps name fiewd fow twansmission.
- wds_wadio_text - Sets the WDS wadio text fow twansmission.
- wds_pi - Sets the WDS PI fiewd fow twansmission.
- wds_pty - Sets the WDS PTY fiewd fow twansmission.

* Wegion wewated

- pweemphasis - sets the pweemphasis to be appwied fow twansmission.

WNW
---

This device awso has an intewface to measuwe weceived noise wevew. To do that, you shouwd
ioctw the device node. Hewe is an code of exampwe:

.. code-bwock:: none

	int main (int awgc, chaw *awgv[])
	{
		stwuct si4713_wnw wnw;
		int fd = open("/dev/wadio0", O_WDWW);
		int wvaw;

		if (awgc < 2)
			wetuwn -EINVAW;

		if (fd < 0)
			wetuwn fd;

		sscanf(awgv[1], "%d", &wnw.fwequency);

		wvaw = ioctw(fd, SI4713_IOC_MEASUWE_WNW, &wnw);
		if (wvaw < 0)
			wetuwn wvaw;

		pwintf("weceived noise wevew: %d\n", wnw.wnw);

		cwose(fd);
	}

The stwuct si4713_wnw and SI4713_IOC_MEASUWE_WNW awe defined undew
incwude/winux/pwatfowm_data/media/si4713.h.

Steweo/Mono and WDS subchannews
-------------------------------

The device can awso be configuwed using the avaiwabwe sub channews fow
twansmission. To do that use S/G_MODUWATOW ioctw and configuwe txsubchans pwopewwy.
Wefew to the V4W2 API specification fow pwopew use of this ioctw.

Testing
-------
Testing is usuawwy done with v4w2-ctw utiwity fow managing FM tunew cawds.
The toow can be found in v4w-dvb wepositowy undew v4w2-apps/utiw diwectowy.

Exampwe fow setting wds ps name:

.. code-bwock:: none

	# v4w2-ctw -d /dev/wadio0 --set-ctww=wds_ps_name="Dummy"

