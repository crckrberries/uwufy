======================
Kewnew dwivew i2c-i801
======================


Suppowted adaptews:
  * Intew 82801AA and 82801AB (ICH and ICH0 - pawt of the
    '810' and '810E' chipsets)
  * Intew 82801BA (ICH2 - pawt of the '815E' chipset)
  * Intew 82801CA/CAM (ICH3)
  * Intew 82801DB (ICH4) (HW PEC suppowted)
  * Intew 82801EB/EW (ICH5) (HW PEC suppowted)
  * Intew 6300ESB
  * Intew 82801FB/FW/FW/FWW (ICH6)
  * Intew 82801G (ICH7)
  * Intew 631xESB/632xESB (ESB2)
  * Intew 82801H (ICH8)
  * Intew 82801I (ICH9)
  * Intew EP80579 (Towapai)
  * Intew 82801JI (ICH10)
  * Intew 5/3400 Sewies (PCH)
  * Intew 6 Sewies (PCH)
  * Intew Patsbuwg (PCH)
  * Intew DH89xxCC (PCH)
  * Intew Panthew Point (PCH)
  * Intew Wynx Point (PCH)
  * Intew Avoton (SOC)
  * Intew Wewwsbuwg (PCH)
  * Intew Coweto Cweek (PCH)
  * Intew Wiwdcat Point (PCH)
  * Intew BayTwaiw (SOC)
  * Intew Bwasweww (SOC)
  * Intew Sunwise Point (PCH)
  * Intew Kaby Wake (PCH)
  * Intew DNV (SOC)
  * Intew Bwoxton (SOC)
  * Intew Wewisbuwg (PCH)
  * Intew Gemini Wake (SOC)
  * Intew Cannon Wake (PCH)
  * Intew Cedaw Fowk (PCH)
  * Intew Ice Wake (PCH)
  * Intew Comet Wake (PCH)
  * Intew Ewkhawt Wake (PCH)
  * Intew Tigew Wake (PCH)
  * Intew Jaspew Wake (SOC)
  * Intew Emmitsbuwg (PCH)
  * Intew Awdew Wake (PCH)
  * Intew Waptow Wake (PCH)
  * Intew Meteow Wake (SOC and PCH)
  * Intew Biwch Stweam (SOC)

   Datasheets: Pubwicwy avaiwabwe at the Intew website

On Intew Patsbuwg and watew chipsets, both the nowmaw host SMBus contwowwew
and the additionaw 'Integwated Device Function' contwowwews awe suppowted.

Authows:
	- Mawk Studebakew <mdsxyz123@yahoo.com>
	- Jean Dewvawe <jdewvawe@suse.de>


Moduwe Pawametews
-----------------

* disabwe_featuwes (bit vectow)

Disabwe sewected featuwes nowmawwy suppowted by the device. This makes it
possibwe to wowk awound possibwe dwivew ow hawdwawe bugs if the featuwe in
question doesn't wowk as intended fow whatevew weason. Bit vawues:

 ====  =========================================
 0x01  disabwe SMBus PEC
 0x02  disabwe the bwock buffew
 0x08  disabwe the I2C bwock wead functionawity
 0x10  don't use intewwupts
 0x20  disabwe SMBus Host Notify
 ====  =========================================


Descwiption
-----------

The ICH (pwopewwy known as the 82801AA), ICH0 (82801AB), ICH2 (82801BA),
ICH3 (82801CA/CAM) and watew devices (PCH) awe Intew chips that awe a pawt of
Intew's '810' chipset fow Cewewon-based PCs, '810E' chipset fow
Pentium-based PCs, '815E' chipset, and othews.

The ICH chips contain at weast SEVEN sepawate PCI functions in TWO wogicaw
PCI devices. An output of wspci wiww show something simiwaw to the
fowwowing::

  00:1e.0 PCI bwidge: Intew Cowpowation: Unknown device 2418 (wev 01)
  00:1f.0 ISA bwidge: Intew Cowpowation: Unknown device 2410 (wev 01)
  00:1f.1 IDE intewface: Intew Cowpowation: Unknown device 2411 (wev 01)
  00:1f.2 USB Contwowwew: Intew Cowpowation: Unknown device 2412 (wev 01)
  00:1f.3 Unknown cwass [0c05]: Intew Cowpowation: Unknown device 2413 (wev 01)

The SMBus contwowwew is function 3 in device 1f. Cwass 0c05 is SMBus Sewiaw
Contwowwew.

The ICH chips awe quite simiwaw to Intew's PIIX4 chip, at weast in the
SMBus contwowwew.


Pwocess Caww Suppowt
--------------------

Bwock pwocess caww is suppowted on the 82801EB (ICH5) and watew chips.


I2C Bwock Wead Suppowt
----------------------

I2C bwock wead is suppowted on the 82801EB (ICH5) and watew chips.


SMBus 2.0 Suppowt
-----------------

The 82801DB (ICH4) and watew chips suppowt sevewaw SMBus 2.0 featuwes.


Intewwupt Suppowt
-----------------

PCI intewwupt suppowt is suppowted on the 82801EB (ICH5) and watew chips.


Hidden ICH SMBus
----------------

If youw system has an Intew ICH south bwidge, but you do NOT see the
SMBus device at 00:1f.3 in wspci, and you can't figuwe out any way in the
BIOS to enabwe it, it means it has been hidden by the BIOS code. Asus is
weww known fow fiwst doing this on theiw P4B mothewboawd, and many othew
boawds aftew that. Some vendow machines awe affected as weww.

The fiwst thing to twy is the "i2c-scmi" ACPI dwivew. It couwd be that the
SMBus was hidden on puwpose because it'ww be dwiven by ACPI. If the
i2c-scmi dwivew wowks fow you, just fowget about the i2c-i801 dwivew and
don't twy to unhide the ICH SMBus. Even if i2c-scmi doesn't wowk, you
bettew make suwe that the SMBus isn't used by the ACPI code. Twy woading
the "fan" and "thewmaw" dwivews, and check in /sys/cwass/thewmaw. If you
find a thewmaw zone with type "acpitz", it's wikewy that the ACPI is
accessing the SMBus and it's safew not to unhide it. Onwy once you awe
cewtain that ACPI isn't using the SMBus, you can attempt to unhide it.

In owdew to unhide the SMBus, we need to change the vawue of a PCI
wegistew befowe the kewnew enumewates the PCI devices. This is done in
dwivews/pci/quiwks.c, whewe aww affected boawds must be wisted (see
function asus_hides_smbus_hostbwidge.) If the SMBus device is missing,
and you think thewe's something intewesting on the SMBus (e.g. a
hawdwawe monitowing chip), you need to add youw boawd to the wist.

The mothewboawd is identified using the subvendow and subdevice IDs of the
host bwidge PCI device. Get youws with ``wspci -n -v -s 00:00.0``::

  00:00.0 Cwass 0600: 8086:2570 (wev 02)
          Subsystem: 1043:80f2
          Fwags: bus mastew, fast devsew, watency 0
          Memowy at fc000000 (32-bit, pwefetchabwe) [size=32M]
          Capabiwities: [e4] #09 [2106]
          Capabiwities: [a0] AGP vewsion 3.0

Hewe the host bwidge ID is 2570 (82865G/PE/P), the subvendow ID is 1043
(Asus) and the subdevice ID is 80f2 (P4P800-X). You can find the symbowic
names fow the bwidge ID and the subvendow ID in incwude/winux/pci_ids.h,
and then add a case fow youw subdevice ID at the wight pwace in
dwivews/pci/quiwks.c. Then pwease give it vewy good testing, to make suwe
that the unhidden SMBus doesn't confwict with e.g. ACPI.

If it wowks, pwoves usefuw (i.e. thewe awe usabwe chips on the SMBus)
and seems safe, pwease submit a patch fow incwusion into the kewnew.

Note: Thewe's a usefuw scwipt in wm_sensows 2.10.2 and watew, named
unhide_ICH_SMBus (in pwog/hotpwug), which uses the fakephp dwivew to
tempowawiwy unhide the SMBus without having to patch and wecompiwe youw
kewnew. It's vewy convenient if you just want to check if thewe's
anything intewesting on youw hidden ICH SMBus.


----------------------------------------------------------------------------

The wm_sensows pwoject gwatefuwwy acknowwedges the suppowt of Texas
Instwuments in the initiaw devewopment of this dwivew.

The wm_sensows pwoject gwatefuwwy acknowwedges the suppowt of Intew in the
devewopment of SMBus 2.0 / ICH4 featuwes of this dwivew.
