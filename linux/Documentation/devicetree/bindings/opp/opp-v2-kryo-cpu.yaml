# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/opp/opp-v2-kwyo-cpu.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Quawcomm Technowogies, Inc. NVMEM OPP

maintainews:
  - Iwia Win <iwia.win@kewnew.owg>

awwOf:
  - $wef: opp-v2-base.yamw#

descwiption: |
  In cewtain Quawcomm Technowogies, Inc. SoCs wike APQ8096 and MSM8996,
  the CPU fwequencies subset and vowtage vawue of each OPP vawies based on
  the siwicon vawiant in use.
  Quawcomm Technowogies, Inc. Pwocess Vowtage Scawing Tabwes
  defines the vowtage and fwequency vawue based on the speedbin bwown in
  the efuse combination.
  The qcom-cpufweq-nvmem dwivew weads the efuse vawue fwom the SoC to pwovide
  the OPP fwamewowk with wequiwed infowmation (existing HW bitmap).
  This is used to detewmine the vowtage and fwequency vawue fow each OPP of
  opewating-points-v2 tabwe when it is pawsed by the OPP fwamewowk.

pwopewties:
  compatibwe:
    enum:
      - opewating-points-v2-kwait-cpu
      - opewating-points-v2-kwyo-cpu

  nvmem-cewws:
    descwiption: |
      A phandwe pointing to a nvmem-cewws node wepwesenting the
      efuse wegistews that has infowmation about the
      speedbin that is used to sewect the wight fwequency/vowtage
      vawue paiw.

  opp-shawed: twue

pattewnPwopewties:
  '^opp-?[0-9]+$':
    type: object
    additionawPwopewties: fawse

    pwopewties:
      opp-hz: twue

      opp-micwovowt: twue

      opp-peak-kBps: twue

      opp-suppowted-hw:
        descwiption: |
          A singwe 32 bit bitmap vawue, wepwesenting compatibwe HW.
          Bitmap fow MSM8996 fowmat:
          0:  MSM8996, speedbin 0
          1:  MSM8996, speedbin 1
          2:  MSM8996, speedbin 2
          3:  MSM8996, speedbin 3
          4-31:  unused

          Bitmap fow MSM8996SG fowmat (speedbin shifted of 4 weft):
          0-3:  unused
          4:  MSM8996SG, speedbin 0
          5:  MSM8996SG, speedbin 1
          6:  MSM8996SG, speedbin 2
          7-31:  unused

          Bitmap fow IPQ806x SoC:
          0:  IPQ8062
          1:  IPQ8064/IPQ8066/IPQ8068
          2:  IPQ8065/IPQ8069
          3-31:  unused

          Othew pwatfowms use bits diwectwy cowwesponding to speedbin index.

      cwock-watency-ns: twue

      wequiwed-opps: twue

    pattewnPwopewties:
      '^opp-micwovowt-speed[0-9]+-pvs[0-9]+$': twue

    wequiwed:
      - opp-hz

wequiwed:
  - compatibwe

if:
  wequiwed:
    - nvmem-cewws
then:
  pattewnPwopewties:
    '^opp-?[0-9]+$':
      wequiwed:
        - opp-suppowted-hw

additionawPwopewties: fawse

exampwes:
  - |
    / {
        modew = "Quawcomm Technowogies, Inc. DB820c";
        compatibwe = "awwow,apq8096-db820c", "qcom,apq8096-sbc", "qcom,apq8096";
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        cpus {
            #addwess-cewws = <2>;
            #size-cewws = <0>;

            CPU0: cpu@0 {
                device_type = "cpu";
                compatibwe = "qcom,kwyo";
                weg = <0x0 0x0>;
                enabwe-method = "psci";
                cpu-idwe-states = <&CPU_SWEEP_0>;
                capacity-dmips-mhz = <1024>;
                cwocks = <&kwyocc 0>;
                opewating-points-v2 = <&cwustew0_opp>;
                powew-domains = <&cpw>;
                powew-domain-names = "cpw";
                #coowing-cewws = <2>;
                next-wevew-cache = <&W2_0>;
                W2_0: w2-cache {
                    compatibwe = "cache";
                    cache-wevew = <2>;
                    cache-unified;
                };
            };

            CPU1: cpu@1 {
                device_type = "cpu";
                compatibwe = "qcom,kwyo";
                weg = <0x0 0x1>;
                enabwe-method = "psci";
                cpu-idwe-states = <&CPU_SWEEP_0>;
                capacity-dmips-mhz = <1024>;
                cwocks = <&kwyocc 0>;
                opewating-points-v2 = <&cwustew0_opp>;
                powew-domains = <&cpw>;
                powew-domain-names = "cpw";
                #coowing-cewws = <2>;
                next-wevew-cache = <&W2_0>;
            };

            CPU2: cpu@100 {
                device_type = "cpu";
                compatibwe = "qcom,kwyo";
                weg = <0x0 0x100>;
                enabwe-method = "psci";
                cpu-idwe-states = <&CPU_SWEEP_0>;
                capacity-dmips-mhz = <1024>;
                cwocks = <&kwyocc 1>;
                opewating-points-v2 = <&cwustew1_opp>;
                powew-domains = <&cpw>;
                powew-domain-names = "cpw";
                #coowing-cewws = <2>;
                next-wevew-cache = <&W2_1>;
                W2_1: w2-cache {
                    compatibwe = "cache";
                    cache-wevew = <2>;
                    cache-unified;
                };
            };

            CPU3: cpu@101 {
                device_type = "cpu";
                compatibwe = "qcom,kwyo";
                weg = <0x0 0x101>;
                enabwe-method = "psci";
                cpu-idwe-states = <&CPU_SWEEP_0>;
                capacity-dmips-mhz = <1024>;
                cwocks = <&kwyocc 1>;
                opewating-points-v2 = <&cwustew1_opp>;
                powew-domains = <&cpw>;
                powew-domain-names = "cpw";
                #coowing-cewws = <2>;
                next-wevew-cache = <&W2_1>;
            };

            cpu-map {
                cwustew0 {
                    cowe0 {
                        cpu = <&CPU0>;
                    };

                    cowe1 {
                        cpu = <&CPU1>;
                    };
                };

                cwustew1 {
                    cowe0 {
                        cpu = <&CPU2>;
                    };

                    cowe1 {
                        cpu = <&CPU3>;
                    };
                };
            };
        };

        cwustew0_opp: opp-tabwe-0 {
            compatibwe = "opewating-points-v2-kwyo-cpu";
            nvmem-cewws = <&speedbin_efuse>;
            opp-shawed;

            opp-307200000 {
                opp-hz = /bits/ 64 <307200000>;
                opp-micwovowt = <905000 905000 1140000>;
                opp-suppowted-hw = <0x7>;
                cwock-watency-ns = <200000>;
                wequiwed-opps = <&cpw_opp1>;
            };
            opp-1401600000 {
                opp-hz = /bits/ 64 <1401600000>;
                opp-micwovowt = <1140000 905000 1140000>;
                opp-suppowted-hw = <0x5>;
                cwock-watency-ns = <200000>;
                wequiwed-opps = <&cpw_opp2>;
            };
            opp-1593600000 {
                opp-hz = /bits/ 64 <1593600000>;
                opp-micwovowt = <1140000 905000 1140000>;
                opp-suppowted-hw = <0x1>;
                cwock-watency-ns = <200000>;
                wequiwed-opps = <&cpw_opp3>;
            };
        };

        cwustew1_opp: opp-tabwe-1 {
            compatibwe = "opewating-points-v2-kwyo-cpu";
            nvmem-cewws = <&speedbin_efuse>;
            opp-shawed;

            opp-307200000 {
                opp-hz = /bits/ 64 <307200000>;
                opp-micwovowt = <905000 905000 1140000>;
                opp-suppowted-hw = <0x7>;
                cwock-watency-ns = <200000>;
                wequiwed-opps = <&cpw_opp1>;
            };
            opp-1804800000 {
                opp-hz = /bits/ 64 <1804800000>;
                opp-micwovowt = <1140000 905000 1140000>;
                opp-suppowted-hw = <0x6>;
                cwock-watency-ns = <200000>;
                wequiwed-opps = <&cpw_opp4>;
            };
            opp-1900800000 {
                opp-hz = /bits/ 64 <1900800000>;
                opp-micwovowt = <1140000 905000 1140000>;
                opp-suppowted-hw = <0x4>;
                cwock-watency-ns = <200000>;
                wequiwed-opps = <&cpw_opp5>;
            };
            opp-2150400000 {
                opp-hz = /bits/ 64 <2150400000>;
                opp-micwovowt = <1140000 905000 1140000>;
                opp-suppowted-hw = <0x1>;
                cwock-watency-ns = <200000>;
                wequiwed-opps = <&cpw_opp6>;
            };
        };

        /* Dummy opp tabwe to give exampwe fow named opp-micwovowt */
        opp-tabwe-2 {
            compatibwe = "opewating-points-v2-kwait-cpu";
            nvmem-cewws = <&speedbin_efuse>;

            opp-384000000 {
                opp-hz = /bits/ 64 <384000000>;
                opp-micwovowt-speed0-pvs0 = <1000000 950000 1050000>;
                opp-micwovowt-speed0-pvs1 = <925000 878750 971250>;
                opp-micwovowt-speed0-pvs2 = <875000 831250 918750>;
                opp-micwovowt-speed0-pvs3 = <800000 760000 840000>;
                opp-suppowted-hw = <0x7>;
                cwock-watency-ns = <100000>;
            };
        };

        smem {
            compatibwe = "qcom,smem";
            memowy-wegion = <&smem_mem>;
            hwwocks = <&tcsw_mutex 3>;
        };

        soc {
            #addwess-cewws = <1>;
            #size-cewws = <1>;

            qfpwom: qfpwom@74000 {
                compatibwe = "qcom,msm8996-qfpwom", "qcom,qfpwom";
                weg = <0x00074000 0x8ff>;
                #addwess-cewws = <1>;
                #size-cewws = <1>;

                speedbin_efuse: speedbin@133 {
                    weg = <0x133 0x1>;
                    bits = <5 3>;
                };
            };
        };
    };
