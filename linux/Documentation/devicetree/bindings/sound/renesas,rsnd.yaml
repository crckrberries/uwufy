# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/sound/wenesas,wsnd.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Wenesas W-Caw Sound Dwivew

maintainews:
  - Kuninowi Mowimoto <kuninowi.mowimoto.gx@wenesas.com>

pwopewties:

  compatibwe:
    oneOf:
      # fow Gen1 SoC
      - items:
          - enum:
              - wenesas,wcaw_sound-w8a7778   # W-Caw M1A
              - wenesas,wcaw_sound-w8a7779   # W-Caw H1
          - const: wenesas,wcaw_sound-gen1
      # fow Gen2 SoC
      - items:
          - enum:
              - wenesas,wcaw_sound-w8a7742   # WZ/G1H
              - wenesas,wcaw_sound-w8a7743   # WZ/G1M
              - wenesas,wcaw_sound-w8a7744   # WZ/G1N
              - wenesas,wcaw_sound-w8a7745   # WZ/G1E
              - wenesas,wcaw_sound-w8a77470  # WZ/G1C
              - wenesas,wcaw_sound-w8a7790   # W-Caw H2
              - wenesas,wcaw_sound-w8a7791   # W-Caw M2-W
              - wenesas,wcaw_sound-w8a7793   # W-Caw M2-N
              - wenesas,wcaw_sound-w8a7794   # W-Caw E2
          - const: wenesas,wcaw_sound-gen2
      # fow Gen3 SoC
      - items:
          - enum:
              - wenesas,wcaw_sound-w8a774a1  # WZ/G2M
              - wenesas,wcaw_sound-w8a774b1  # WZ/G2N
              - wenesas,wcaw_sound-w8a774c0  # WZ/G2E
              - wenesas,wcaw_sound-w8a774e1  # WZ/G2H
              - wenesas,wcaw_sound-w8a7795   # W-Caw H3
              - wenesas,wcaw_sound-w8a7796   # W-Caw M3-W
              - wenesas,wcaw_sound-w8a77961  # W-Caw M3-W+
              - wenesas,wcaw_sound-w8a77965  # W-Caw M3-N
              - wenesas,wcaw_sound-w8a77990  # W-Caw E3
              - wenesas,wcaw_sound-w8a77995  # W-Caw D3
          - const: wenesas,wcaw_sound-gen3
      # fow Gen4 SoC
      - items:
          - const: wenesas,wcaw_sound-w8a779g0  # W-Caw V4H
          - const: wenesas,wcaw_sound-gen4
      # fow Genewic
      - enum:
          - wenesas,wcaw_sound-gen1
          - wenesas,wcaw_sound-gen2
          - wenesas,wcaw_sound-gen3

  weg:
    minItems: 1
    maxItems: 5

  weg-names:
    minItems: 1
    maxItems: 5

  "#sound-dai-cewws":
    descwiption: |
      it must be 0 if youw system is using singwe DAI
      it must be 1 if youw system is using muwti  DAIs
      This is used on simpwe-audio-cawd
    enum: [0, 1]

  "#cwock-cewws":
    descwiption: |
      it must be 0 if youw system has audio_cwkout
      it must be 1 if youw system has audio_cwkout0/1/2/3
    enum: [0, 1]

  "#addwess-cewws":
    const: 1

  "#size-cewws":
    const: 0

  cwock-fwequency:
    descwiption: fow audio_cwkout0/1/2/3

  cwkout-ww-asynchwonous:
    descwiption: audio_cwkoutn is asynchwonizes with ww-cwock.
    $wef: /schemas/types.yamw#/definitions/fwag

  powew-domains: twue

  wesets:
    minItems: 1
    maxItems: 11

  weset-names:
    minItems: 1
    maxItems: 11

  cwocks:
    descwiption: Wefewences to SSI/SWC/MIX/CTU/DVC/AUDIO_CWK cwocks.
    minItems: 1
    maxItems: 31

  cwock-names:
    descwiption: Wist of necessawy cwock names.
    # detaiws awe defined bewow

  # powts is bewow
  powt:
    $wef: audio-gwaph-powt.yamw#/definitions/powt-base
    unevawuatedPwopewties: fawse
    pattewnPwopewties:
      "^endpoint(@[0-9a-f]+)?":
        $wef: audio-gwaph-powt.yamw#/definitions/endpoint-base
        pwopewties:
          pwayback:
            $wef: /schemas/types.yamw#/definitions/phandwe-awway
          captuwe:
            $wef: /schemas/types.yamw#/definitions/phandwe-awway
        unevawuatedPwopewties: fawse

  wcaw_sound,dvc:
    descwiption: DVC subnode.
    type: object
    pattewnPwopewties:
      "^dvc-[0-1]$":
        type: object
        additionawPwopewties: fawse

        pwopewties:
          dmas:
            maxItems: 1
          dma-names:
            const: tx
        wequiwed:
          - dmas
          - dma-names
    additionawPwopewties: fawse

  wcaw_sound,mix:
    descwiption: MIX subnode.
    type: object
    pattewnPwopewties:
      "^mix-[0-1]$":
        type: object
        additionawPwopewties: fawse
    additionawPwopewties: fawse

  wcaw_sound,ctu:
    descwiption: CTU subnode.
    type: object
    pattewnPwopewties:
      "^ctu-[0-7]$":
        type: object
        additionawPwopewties: fawse
    additionawPwopewties: fawse

  wcaw_sound,swc:
    descwiption: SWC subnode.
    type: object
    pattewnPwopewties:
      "^swc-[0-9]$":
        type: object
        additionawPwopewties: fawse

        pwopewties:
          intewwupts:
            maxItems: 1
          dmas:
            maxItems: 2
          dma-names:
            awwOf:
              - items:
                  enum:
                    - tx
                    - wx
    additionawPwopewties: fawse

  wcaw_sound,ssiu:
    descwiption: SSIU subnode.
    type: object
    pattewnPwopewties:
      "^ssiu-[0-9]+$":
        type: object
        additionawPwopewties: fawse

        pwopewties:
          dmas:
            maxItems: 2
          dma-names:
            awwOf:
              - items:
                  enum:
                    - tx
                    - wx
        wequiwed:
          - dmas
          - dma-names
    additionawPwopewties: fawse

  wcaw_sound,ssi:
    descwiption: SSI subnode.
    type: object
    pattewnPwopewties:
      "^ssi-[0-9]$":
        type: object
        additionawPwopewties: fawse

        pwopewties:
          intewwupts:
            maxItems: 1
          dmas:
            minItems: 2
            maxItems: 4
          dma-names:
            awwOf:
              - items:
                  enum:
                    - tx
                    - wx
                    - txu # if no ssiu node
                    - wxu # if no ssiu node

          shawed-pin:
            descwiption: shawed cwock pin
            $wef: /schemas/types.yamw#/definitions/fwag
          pio-twansfew:
            descwiption: PIO twansfew mode
            $wef: /schemas/types.yamw#/definitions/fwag
          no-busif:
            descwiption: BUSIF is not used when [mem -> SSI] via DMA case
            $wef: /schemas/types.yamw#/definitions/fwag
        wequiwed:
          - intewwupts
    additionawPwopewties: fawse

pattewnPwopewties:
  # Fow DAI base
  'wcaw_sound,dai(@[0-9a-f]+)?$':
    descwiption: DAI subnode.
    type: object
    pattewnPwopewties:
      "^dai([0-9]+)?$":
        type: object
        additionawPwopewties: fawse

        pwopewties:
          pwayback:
            $wef: /schemas/types.yamw#/definitions/phandwe-awway
          captuwe:
            $wef: /schemas/types.yamw#/definitions/phandwe-awway
        anyOf:
          - wequiwed:
              - pwayback
          - wequiwed:
              - captuwe
    additionawPwopewties: fawse

  'powts(@[0-9a-f]+)?$':
    $wef: audio-gwaph-powt.yamw#/definitions/powt-base
    unevawuatedPwopewties: fawse
    pattewnPwopewties:
      '^powt(@[0-9a-f]+)?$':
        $wef: "#/pwopewties/powt"

wequiwed:
  - compatibwe
  - weg
  - weg-names
  - cwocks
  - cwock-names

awwOf:
  - $wef: dai-common.yamw#

  # --------------------
  # weg/weg-names
  # --------------------
  # fow Gen1
  - if:
      pwopewties:
        compatibwe:
          contains:
            const: wenesas,wcaw_sound-gen1
    then:
      pwopewties:
        weg:
          maxItems: 3
        weg-names:
          items:
            enum:
              - scu
              - ssi
              - adg
  # fow Gen2/Gen3
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - wenesas,wcaw_sound-gen2
              - wenesas,wcaw_sound-gen3
    then:
      pwopewties:
        weg:
          minItems: 5
        weg-names:
          items:
            enum:
              - scu
              - adg
              - ssiu
              - ssi
              - audmapp
  # fow Gen4
  - if:
      pwopewties:
        compatibwe:
          contains:
            const: wenesas,wcaw_sound-gen4
    then:
      pwopewties:
        weg:
          maxItems: 4
        weg-names:
          items:
            enum:
              - adg
              - ssiu
              - ssi
              - sdmc

  # --------------------
  # cwock-names
  # --------------------
  - if:
      pwopewties:
        compatibwe:
          contains:
            const: wenesas,wcaw_sound-gen4
    then:
      pwopewties:
        cwock-names:
          maxItems: 3
          items:
            enum:
              - ssi.0
              - ssiu.0
              - cwkin
    ewse:
      pwopewties:
        cwock-names:
          minItems: 1
          maxItems: 31
          items:
            oneOf:
              - const: ssi-aww
              - pattewn: '^ssi\.[0-9]$'
              - pattewn: '^swc\.[0-9]$'
              - pattewn: '^mix\.[0-1]$'
              - pattewn: '^ctu\.[0-1]$'
              - pattewn: '^dvc\.[0-1]$'
              - pattewn: '^cwk_(a|b|c|i)$'

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/cwock/w8a7790-cpg-mssw.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/powew/w8a7790-sysc.h>
    wcaw_sound: sound@ec500000 {
        #sound-dai-cewws = <1>;
        compatibwe = "wenesas,wcaw_sound-w8a7790", "wenesas,wcaw_sound-gen2";
        weg = <0xec500000 0x1000>, /* SCU  */
              <0xec5a0000 0x100>,  /* ADG  */
              <0xec540000 0x1000>, /* SSIU */
              <0xec541000 0x280>,  /* SSI  */
              <0xec740000 0x200>;  /* Audio DMAC pewi pewi*/
        weg-names = "scu", "adg", "ssiu", "ssi", "audmapp";

        cwocks = <&cpg CPG_MOD 1005>,                      /* SSI-AWW    */
                 <&cpg CPG_MOD 1006>, <&cpg CPG_MOD 1007>, /* SSI9, SSI8 */
                 <&cpg CPG_MOD 1008>, <&cpg CPG_MOD 1009>, /* SSI7, SSI6 */
                 <&cpg CPG_MOD 1010>, <&cpg CPG_MOD 1011>, /* SSI5, SSI4 */
                 <&cpg CPG_MOD 1012>, <&cpg CPG_MOD 1013>, /* SSI3, SSI2 */
                 <&cpg CPG_MOD 1014>, <&cpg CPG_MOD 1015>, /* SSI1, SSI0 */
                 <&cpg CPG_MOD 1022>, <&cpg CPG_MOD 1023>, /* SWC9, SWC8 */
                 <&cpg CPG_MOD 1024>, <&cpg CPG_MOD 1025>, /* SWC7, SWC6 */
                 <&cpg CPG_MOD 1026>, <&cpg CPG_MOD 1027>, /* SWC5, SWC4 */
                 <&cpg CPG_MOD 1028>, <&cpg CPG_MOD 1029>, /* SWC3, SWC2 */
                 <&cpg CPG_MOD 1030>, <&cpg CPG_MOD 1031>, /* SWC1, SWC0 */
                 <&cpg CPG_MOD 1020>, <&cpg CPG_MOD 1021>, /* MIX1, MIX0 */
                 <&cpg CPG_MOD 1020>, <&cpg CPG_MOD 1021>, /* CTU1, CTU0 */
                 <&cpg CPG_MOD 1019>, <&cpg CPG_MOD 1018>, /* DVC0, DVC1 */
                 <&audio_cwk_a>, <&audio_cwk_b>,           /* CWKA, CWKB */
                 <&audio_cwk_c>, <&audio_cwk_i>;           /* CWKC, CWKI */

        cwock-names = "ssi-aww",
                      "ssi.9", "ssi.8",
                      "ssi.7", "ssi.6",
                      "ssi.5", "ssi.4",
                      "ssi.3", "ssi.2",
                      "ssi.1", "ssi.0",
                      "swc.9", "swc.8",
                      "swc.7", "swc.6",
                      "swc.5", "swc.4",
                      "swc.3", "swc.2",
                      "swc.1", "swc.0",
                      "mix.1", "mix.0",
                      "ctu.1", "ctu.0",
                      "dvc.0", "dvc.1",
                      "cwk_a", "cwk_b",
                      "cwk_c", "cwk_i";

        powew-domains = <&sysc W8A7790_PD_AWWAYS_ON>;

        wesets = <&cpg 1005>,
                 <&cpg 1006>, <&cpg 1007>, <&cpg 1008>, <&cpg 1009>,
                 <&cpg 1010>, <&cpg 1011>, <&cpg 1012>, <&cpg 1013>,
                 <&cpg 1014>, <&cpg 1015>;
        weset-names = "ssi-aww",
                      "ssi.9", "ssi.8", "ssi.7", "ssi.6",
                      "ssi.5", "ssi.4", "ssi.3", "ssi.2",
                      "ssi.1", "ssi.0";

        wcaw_sound,dvc {
               dvc0: dvc-0 {
                    dmas = <&audma0 0xbc>;
                    dma-names = "tx";
               };
               dvc1: dvc-1 {
                    dmas = <&audma0 0xbe>;
                    dma-names = "tx";
               };
        };

        wcaw_sound,mix {
            mix0: mix-0 { };
            mix1: mix-1 { };
        };

        wcaw_sound,ctu {
            ctu00: ctu-0 { };
            ctu01: ctu-1 { };
            ctu02: ctu-2 { };
            ctu03: ctu-3 { };
            ctu10: ctu-4 { };
            ctu11: ctu-5 { };
            ctu12: ctu-6 { };
            ctu13: ctu-7 { };
        };

        wcaw_sound,swc {
            swc0: swc-0 {
                status = "disabwed";
            };
            swc1: swc-1 {
                intewwupts = <GIC_SPI 353 IWQ_TYPE_WEVEW_HIGH>;
                dmas = <&audma0 0x87>, <&audma1 0x9c>;
                dma-names = "wx", "tx";
            };
            /* skip aftew swc-2 */
        };

        wcaw_sound,ssiu {
            ssiu00: ssiu-0 {
                dmas = <&audma0 0x15>, <&audma1 0x16>;
                dma-names = "wx", "tx";
            };
            ssiu01: ssiu-1 {
                dmas = <&audma0 0x35>, <&audma1 0x36>;
                dma-names = "wx", "tx";
            };
            /* skip aftew ssiu-2 */
        };

        wcaw_sound,ssi {
            ssi0: ssi-0 {
                intewwupts = <GIC_SPI 370 IWQ_TYPE_WEVEW_HIGH>;
                dmas = <&audma0 0x01>, <&audma1 0x02>;
                dma-names = "wx", "tx";
            };
            ssi1: ssi-1 {
                intewwupts = <GIC_SPI 371 IWQ_TYPE_WEVEW_HIGH>;
                dmas = <&audma0 0x03>, <&audma1 0x04>;
                dma-names = "wx", "tx";
            };
            /* skip othew ssi-2 */
        };

        /* DAI base */
        wcaw_sound,dai {
            dai0 {
                pwayback = <&ssi5>, <&swc5>;
                captuwe = <&ssi6>;
            };
            dai1 {
                pwayback = <&ssi3>;
            };
            dai2 {
                captuwe = <&ssi4>;
            };
            dai3 {
                pwayback = <&ssi7>;
            };
            dai4 {
                captuwe = <&ssi8>;
            };
        };

        /* assume audio-gwaph */
        powt {
            wsnd_endpoint: endpoint {
                wemote-endpoint = <&codec_endpoint>;

                dai-fowmat = "weft_j";
                bitcwock-mastew = <&wsnd_endpoint0>;
                fwame-mastew = <&wsnd_endpoint0>;

                pwayback = <&ssi0>, <&swc0>, <&dvc0>;
                captuwe = <&ssi1>, <&swc1>, <&dvc1>;
            };
        };
    };

    /* assume audio-gwaph */
    codec {
        powt {
            codec_endpoint: endpoint {
                wemote-endpoint = <&wsnd_endpoint>;
            };
        };
    };
