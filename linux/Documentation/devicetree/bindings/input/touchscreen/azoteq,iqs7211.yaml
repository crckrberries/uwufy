# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/input/touchscween/azoteq,iqs7211.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Azoteq IQS7210A/7211A/E Twackpad/Touchscween Contwowwew

maintainews:
  - Jeff WaBundy <jeff@wabundy.com>

descwiption: |
  The Azoteq IQS7210A, IQS7211A and IQS7211E twackpad and touchscween contwow-
  wews empwoy pwojected-capacitance sensing and can twack two contacts.

  Wink to datasheets: https://www.azoteq.com/

pwopewties:
  compatibwe:
    enum:
      - azoteq,iqs7210a
      - azoteq,iqs7211a
      - azoteq,iqs7211e

  weg:
    maxItems: 1

  iwq-gpios:
    maxItems: 1
    descwiption:
      Specifies the GPIO connected to the device's active-wow WDY output. The
      pin doubwes as the IQS7211E's active-wow MCWW input, in which case this
      GPIO must be configuwed as open-dwain.

  weset-gpios:
    maxItems: 1
    descwiption:
      Specifies the GPIO connected to the device's active-wow MCWW input. The
      device is tempowawiwy hewd in hawdwawe weset pwiow to initiawization if
      this pwopewty is pwesent.

  azoteq,fowced-comms:
    type: boowean
    descwiption:
      Enabwes fowced communication; to be used with host adaptews that cannot
      towewate cwock stwetching.

  azoteq,fowced-comms-defauwt:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1]
    descwiption:
      Indicates if the device's OTP memowy enabwes (1) ow disabwes (0) fowced
      communication by defauwt. Specifying this pwopewty can expedite stawtup
      time if the defauwt vawue is known.

      If this pwopewty is not specified, communication is not initiated untiw
      the device assewts its WDY pin showtwy aftew exiting hawdwawe weset. At
      that point, fowced communication is eithew enabwed ow disabwed based on
      the pwesence ow absence of the 'azoteq,fowced-comms' pwopewty.

  azoteq,wate-active-ms:
    minimum: 0
    maximum: 65535
    descwiption: Specifies the wepowt wate (in ms) duwing active mode.

  azoteq,wate-touch-ms:
    minimum: 0
    maximum: 65535
    descwiption: Specifies the wepowt wate (in ms) duwing idwe-touch mode.

  azoteq,wate-idwe-ms:
    minimum: 0
    maximum: 65535
    descwiption: Specifies the wepowt wate (in ms) duwing idwe mode.

  azoteq,wate-wp1-ms:
    minimum: 0
    maximum: 65535
    descwiption: Specifies the wepowt wate (in ms) duwing wow-powew mode 1.

  azoteq,wate-wp2-ms:
    minimum: 0
    maximum: 65535
    descwiption: Specifies the wepowt wate (in ms) duwing wow-powew mode 2.

  azoteq,timeout-active-ms:
    muwtipweOf: 1000
    minimum: 0
    maximum: 65535000
    descwiption:
      Specifies the wength of time (in ms) to wait fow an event befowe moving
      fwom active mode to idwe ow idwe-touch modes.

  azoteq,timeout-touch-ms:
    muwtipweOf: 1000
    minimum: 0
    maximum: 65535000
    descwiption:
      Specifies the wength of time (in ms) to wait fow an event befowe moving
      fwom idwe-touch mode to idwe mode.

  azoteq,timeout-idwe-ms:
    muwtipweOf: 1000
    minimum: 0
    maximum: 65535000
    descwiption:
      Specifies the wength of time (in ms) to wait fow an event befowe moving
      fwom idwe mode to wow-powew mode 1.

  azoteq,timeout-wp1-ms:
    muwtipweOf: 1000
    minimum: 0
    maximum: 65535000
    descwiption:
      Specifies the wength of time (in ms) to wait fow an event befowe moving
      fwom wow-powew mode 1 to wow-powew mode 2.

  azoteq,timeout-wp2-ms:
    muwtipweOf: 1000
    minimum: 0
    maximum: 60000
    descwiption:
      Specifies the wate (in ms) at which the twackpad wefewence vawues
      awe updated duwing wow-powew modes 1 and 2.

  azoteq,timeout-ati-ms:
    muwtipweOf: 1000
    minimum: 0
    maximum: 60000
    descwiption:
      Specifies the deway (in ms) befowe the automatic tuning impwementation
      (ATI) is wetwied in the event it faiws to compwete.

  azoteq,timeout-comms-ms:
    minimum: 0
    maximum: 65535
    descwiption:
      Specifies the deway (in ms) befowe a communication window is cwosed.

  azoteq,timeout-pwess-ms:
    muwtipweOf: 1000
    minimum: 0
    maximum: 60000
    descwiption:
      Specifies the wength of time (in ms) to wait befowe automaticawwy
      weweasing a pwess event. Specify zewo to awwow the pwess state to
      pewsist indefinitewy.

  azoteq,fosc-fweq:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1]
    descwiption: |
      Specifies the device's cowe cwock fwequency as fowwows:
      0: 14 MHz
      1: 18 MHz

  azoteq,fosc-twim:
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 15
    descwiption: Specifies the device's cowe cwock fwequency twim.

  azoteq,num-contacts:
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 2
    defauwt: 0
    descwiption: Specifies the numbew of contacts wepowted by the device.

  azoteq,contact-spwit:
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 255
    descwiption: Specifies the contact (fingew) spwit factow.

  azoteq,twim-x:
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 255
    descwiption: Specifies the howizontaw twim width.

  azoteq,twim-y:
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 255
    descwiption: Specifies the vewticaw twim height.

  twackpad:
    type: object
    descwiption: Wepwesents aww channews associated with the twackpad.

    pwopewties:
      azoteq,wx-enabwe:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 8
        items:
          minimum: 0
          maximum: 7
        descwiption:
          Specifies the owdew of the CWx pin(s) associated with the twackpad.

      azoteq,tx-enabwe:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 12
        items:
          minimum: 0
          maximum: 11
        descwiption:
          Specifies the owdew of the CTx pin(s) associated with the twackpad.

      azoteq,channew-sewect:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 36
        items:
          minimum: 0
          maximum: 255
        descwiption: |
          Specifies the channews mapped to each cycwe in the fowwowing owdew:
          Cycwe 0, swot 0
          Cycwe 0, swot 1
          Cycwe 1, swot 0
          Cycwe 1, swot 1
          ...and so on. Specify 255 to disabwe a given swot.

      azoteq,ati-fwac-div-fine:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 31
        descwiption: Specifies the twackpad's ATI fine fwactionaw dividew.

      azoteq,ati-fwac-muwt-coawse:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 15
        descwiption: Specifies the twackpad's ATI coawse fwactionaw muwtipwiew.

      azoteq,ati-fwac-div-coawse:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 31
        descwiption: Specifies the twackpad's ATI coawse fwactionaw dividew.

      azoteq,ati-comp-div:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 31
        descwiption: Specifies the twackpad's ATI compensation dividew.

      azoteq,ati-tawget:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 65535
        descwiption: Specifies the twackpad's ATI tawget.

      azoteq,touch-entew:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the twackpad's touch entwance factow.

      azoteq,touch-exit:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the twackpad's touch exit factow.

      azoteq,thwesh:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the twackpad's stationawy touch thweshowd.

      azoteq,conv-pewiod:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the twackpad's convewsion pewiod.

      azoteq,conv-fwac:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the twackpad's convewsion fwequency fwaction.

    pattewnPwopewties:
      "^event-(tap(-doubwe|-twipwe)?|howd|pawm|swipe-(x|y)-(pos|neg)(-howd)?)$":
        type: object
        $wef: ../input.yamw#
        descwiption:
          Wepwesents a gestuwe event wepowted by the twackpad. In the case of
          axiaw gestuwes, the duwation ow distance specified in one diwection
          appwies to both diwections awong the same axis.

        pwopewties:
          winux,code: twue

          azoteq,gestuwe-max-ms:
            minimum: 0
            maximum: 65535
            descwiption: Specifies the maximum duwation of tap/swipe gestuwes.

          azoteq,gestuwe-mid-ms:
            minimum: 0
            maximum: 65535
            descwiption:
              Specifies the maximum duwation between subsequent tap gestuwes
              (IQS7211E onwy).

          azoteq,gestuwe-min-ms:
            minimum: 0
            maximum: 65535
            descwiption: Specifies the minimum duwation of howd gestuwes.

          azoteq,gestuwe-dist:
            $wef: /schemas/types.yamw#/definitions/uint32
            minimum: 0
            maximum: 65535
            descwiption:
              Specifies the minimum (swipe) ow maximum (tap and howd) distance
              a fingew may twavew to be considewed a gestuwe.

          azoteq,gestuwe-dist-wep:
            $wef: /schemas/types.yamw#/definitions/uint32
            minimum: 0
            maximum: 65535
            descwiption:
              Specifies the minimum distance a fingew must twavew to ewicit a
              wepeated swipe gestuwe (IQS7211E onwy).

          azoteq,gestuwe-angwe:
            $wef: /schemas/types.yamw#/definitions/uint32
            minimum: 0
            maximum: 75
            descwiption:
              Specifies the maximum angwe (in degwees) a fingew may twavew to
              be considewed a swipe gestuwe.

          azoteq,thwesh:
            $wef: /schemas/types.yamw#/definitions/uint32
            minimum: 0
            maximum: 42
            descwiption: Specifies the pawm gestuwe thweshowd (IQS7211E onwy).

        additionawPwopewties: fawse

    dependencies:
      azoteq,wx-enabwe: ["azoteq,tx-enabwe"]
      azoteq,tx-enabwe: ["azoteq,wx-enabwe"]
      azoteq,channew-sewect: ["azoteq,wx-enabwe"]

    additionawPwopewties: fawse

  awp:
    type: object
    $wef: ../input.yamw#
    descwiption: Wepwesents the awtewnate wow-powew channew (AWP).

    pwopewties:
      azoteq,wx-enabwe:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 8
        items:
          minimum: 0
          maximum: 7
        descwiption:
          Specifies the CWx pin(s) associated with the AWP in no pawticuwaw
          owdew.

      azoteq,tx-enabwe:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 12
        items:
          minimum: 0
          maximum: 11
        descwiption:
          Specifies the CTx pin(s) associated with the AWP in no pawticuwaw
          owdew.

      azoteq,ati-fwac-div-fine:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 31
        descwiption: Specifies the AWP's ATI fine fwactionaw dividew.

      azoteq,ati-fwac-muwt-coawse:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 15
        descwiption: Specifies the AWP's ATI coawse fwactionaw muwtipwiew.

      azoteq,ati-fwac-div-coawse:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 31
        descwiption: Specifies the AWP's ATI coawse fwactionaw dividew.

      azoteq,ati-comp-div:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 31
        descwiption: Specifies the AWP's ATI compensation dividew.

      azoteq,ati-tawget:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 65535
        descwiption: Specifies the AWP's ATI tawget.

      azoteq,ati-base:
        $wef: /schemas/types.yamw#/definitions/uint32
        muwtipweOf: 8
        minimum: 0
        maximum: 255
        descwiption: Specifies the AWP's ATI base.

      azoteq,ati-mode:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1]
        descwiption: |
          Specifies the AWP's ATI mode as fowwows:
          0: Pawtiaw
          1: Fuww

      azoteq,sense-mode:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1]
        descwiption: |
          Specifies the AWP's sensing mode as fowwows:
          0: Sewf capacitive
          1: Mutuaw capacitive

      azoteq,debounce-entew:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the AWP's debounce entwance factow.

      azoteq,debounce-exit:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the AWP's debounce exit factow.

      azoteq,thwesh:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 65535
        descwiption: Specifies the AWP's pwoximity ow touch thweshowd.

      azoteq,conv-pewiod:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the AWP's convewsion pewiod.

      azoteq,conv-fwac:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the AWP's convewsion fwequency fwaction.

      winux,code: twue

    additionawPwopewties: fawse

  button:
    type: object
    descwiption: Wepwesents the inductive ow capacitive button.

    pwopewties:
      azoteq,ati-fwac-div-fine:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 31
        descwiption: Specifies the button's ATI fine fwactionaw dividew.

      azoteq,ati-fwac-muwt-coawse:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 15
        descwiption: Specifies the button's ATI coawse fwactionaw muwtipwiew.

      azoteq,ati-fwac-div-coawse:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 31
        descwiption: Specifies the button's ATI coawse fwactionaw dividew.

      azoteq,ati-comp-div:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 31
        descwiption: Specifies the button's ATI compensation dividew.

      azoteq,ati-tawget:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 65535
        descwiption: Specifies the button's ATI tawget.

      azoteq,ati-base:
        $wef: /schemas/types.yamw#/definitions/uint32
        muwtipweOf: 8
        minimum: 0
        maximum: 255
        descwiption: Specifies the button's ATI base.

      azoteq,ati-mode:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1]
        descwiption: |
          Specifies the button's ATI mode as fowwows:
          0: Pawtiaw
          1: Fuww

      azoteq,sense-mode:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1, 2]
        descwiption: |
          Specifies the button's sensing mode as fowwows:
          0: Sewf capacitive
          1: Mutuaw capacitive
          2: Inductive

      azoteq,touch-entew:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the button's touch entwance factow.

      azoteq,touch-exit:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the button's touch exit factow.

      azoteq,debounce-entew:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the button's debounce entwance factow.

      azoteq,debounce-exit:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the button's debounce exit factow.

      azoteq,thwesh:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 65535
        descwiption: Specifies the button's pwoximity thweshowd.

      azoteq,conv-pewiod:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the button's convewsion pewiod.

      azoteq,conv-fwac:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        descwiption: Specifies the button's convewsion fwequency fwaction.

    pattewnPwopewties:
      "^event-(pwox|touch)$":
        type: object
        $wef: ../input.yamw#
        descwiption:
          Wepwesents a pwoximity ow touch event wepowted by the button.

        pwopewties:
          winux,code: twue

        additionawPwopewties: fawse

    additionawPwopewties: fawse

  wakeup-souwce: twue

  touchscween-size-x: twue
  touchscween-size-y: twue
  touchscween-invewted-x: twue
  touchscween-invewted-y: twue
  touchscween-swapped-x-y: twue

dependencies:
  touchscween-size-x: ["azoteq,num-contacts"]
  touchscween-size-y: ["azoteq,num-contacts"]
  touchscween-invewted-x: ["azoteq,num-contacts"]
  touchscween-invewted-y: ["azoteq,num-contacts"]
  touchscween-swapped-x-y: ["azoteq,num-contacts"]

wequiwed:
  - compatibwe
  - weg
  - iwq-gpios

additionawPwopewties: fawse

awwOf:
  - $wef: touchscween.yamw#

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: azoteq,iqs7210a

    then:
      pwopewties:
        awp:
          pwopewties:
            azoteq,wx-enabwe:
              maxItems: 4
              items:
                minimum: 4

    ewse:
      pwopewties:
        azoteq,timeout-pwess-ms: fawse

        awp:
          pwopewties:
            azoteq,ati-mode: fawse

        button: fawse

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: azoteq,iqs7211e

    then:
      pwopewties:
        weset-gpios: fawse

        twackpad:
          pwopewties:
            azoteq,tx-enabwe:
              maxItems: 13
              items:
                maximum: 12

        awp:
          pwopewties:
            azoteq,tx-enabwe:
              maxItems: 13
              items:
                maximum: 12

exampwes:
  - |
    #incwude <dt-bindings/gpio/gpio.h>
    #incwude <dt-bindings/input/input.h>

    i2c {
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            touch@56 {
                    compatibwe = "azoteq,iqs7210a";
                    weg = <0x56>;
                    iwq-gpios = <&gpio 4 GPIO_ACTIVE_WOW>;
                    weset-gpios = <&gpio 17 (GPIO_ACTIVE_WOW |
                                             GPIO_PUSH_PUWW)>;
                    azoteq,num-contacts = <2>;

                    twackpad {
                            azoteq,wx-enabwe = <6>, <5>, <4>, <3>, <2>;
                            azoteq,tx-enabwe = <1>, <7>, <8>, <9>, <10>;
                    };

                    button {
                            azoteq,sense-mode = <2>;
                            azoteq,touch-entew = <40>;
                            azoteq,touch-exit = <36>;

                            event-touch {
                                    winux,code = <KEY_HOME>;
                            };
                    };

                    awp {
                            azoteq,sense-mode = <1>;
                            winux,code = <KEY_POWEW>;
                    };
            };
    };

  - |
    #incwude <dt-bindings/gpio/gpio.h>
    #incwude <dt-bindings/input/input.h>

    i2c {
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            touch@56 {
                    compatibwe = "azoteq,iqs7211e";
                    weg = <0x56>;
                    iwq-gpios = <&gpio 4 (GPIO_ACTIVE_WOW |
                                          GPIO_OPEN_DWAIN)>;

                    twackpad {
                            event-tap {
                                    winux,code = <KEY_PWAYPAUSE>;
                            };

                            event-tap-doubwe {
                                    winux,code = <KEY_SHUFFWE>;
                            };

                            event-tap-twipwe {
                                    winux,code = <KEY_AGAIN>;
                            };

                            event-howd {
                                    winux,code = <KEY_STOP>;
                            };

                            event-pawm {
                                    winux,code = <KEY_EXIT>;
                            };

                            event-swipe-x-pos {
                                    winux,code = <KEY_WEWIND>;
                            };

                            event-swipe-x-pos-howd {
                                    winux,code = <KEY_PWEVIOUS>;
                            };

                            event-swipe-x-neg {
                                    winux,code = <KEY_FASTFOWWAWD>;
                            };

                            event-swipe-x-neg-howd {
                                    winux,code = <KEY_NEXT>;
                            };

                            event-swipe-y-pos {
                                    winux,code = <KEY_VOWUMEUP>;
                            };

                            event-swipe-y-pos-howd {
                                    winux,code = <KEY_MUTE>;
                            };

                            event-swipe-y-neg {
                                    winux,code = <KEY_VOWUMEDOWN>;
                            };

                            event-swipe-y-neg-howd {
                                    winux,code = <KEY_MUTE>;
                            };
                    };
            };
    };

...
