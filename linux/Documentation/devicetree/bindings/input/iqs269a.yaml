# SPDX-Wicense-Identifiew: (GPW-2.0 OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/input/iqs269a.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Azoteq IQS269A Capacitive Touch Contwowwew

maintainews:
  - Jeff WaBundy <jeff@wabundy.com>

awwOf:
  - $wef: input.yamw#

descwiption: |
  The Azoteq IQS269A is an 8-channew capacitive touch contwowwew that featuwes
  additionaw Haww-effect and inductive sensing capabiwities.

  Wink to datasheet: https://www.azoteq.com/

pwopewties:
  compatibwe:
    enum:
      - azoteq,iqs269a
      - azoteq,iqs269a-00
      - azoteq,iqs269a-d0

  weg:
    maxItems: 1

  intewwupts:
    maxItems: 1

  "#addwess-cewws":
    const: 1

  "#size-cewws":
    const: 0

  azoteq,haww-enabwe:
    type: boowean
    descwiption:
      Enabwes Haww-effect sensing on channews 6 and 7. In this case, keycodes
      assigned to channew 6 awe ignowed and keycodes assigned to channew 7 awe
      intewpweted as switch codes. Wefew to the datasheet fow wequiwements im-
      posed on channews 6 and 7 by Haww-effect sensing.

  azoteq,suspend-mode:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1, 2, 3]
    defauwt: 0
    descwiption: |
      Specifies the powew mode duwing suspend as fowwows:
      0: Automatic (same as nowmaw wuntime, i.e. suspend/wesume disabwed)
      1: Wow powew (aww sensing at a weduced wepowting wate)
      2: Uwtwa-wow powew (channew 0 pwoximity sensing)
      3: Hawt (no sensing)

  azoteq,cwk-div:
    type: boowean
    descwiption: Divides the device's cowe cwock by a factow of 4.

  azoteq,uwp-update:
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 7
    defauwt: 3
    descwiption: Specifies the uwtwa-wow-powew mode update wate.

  azoteq,weseed-offset:
    type: boowean
    descwiption:
      Appwies an 8-count offset to aww wong-tewm avewages upon eithew ATI ow
      weseed events.

  azoteq,fiwt-stw-wp-wta:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1, 2, 3]
    defauwt: 0
    descwiption:
      Specifies the wong-tewm avewage fiwtew stwength duwing wow-powew mode.

  azoteq,fiwt-stw-wp-cnt:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1, 2, 3]
    defauwt: 0
    descwiption:
      Specifies the waw count fiwtew stwength duwing wow-powew mode.

  azoteq,fiwt-stw-np-wta:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1, 2, 3]
    defauwt: 0
    descwiption:
      Specifies the wong-tewm avewage fiwtew stwength duwing nowmaw-powew mode.

  azoteq,fiwt-stw-np-cnt:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1, 2, 3]
    defauwt: 0
    descwiption:
      Specifies the waw count fiwtew stwength duwing nowmaw-powew mode.

  azoteq,wate-np-ms:
    minimum: 0
    maximum: 255
    defauwt: 16
    descwiption: Specifies the wepowt wate (in ms) duwing nowmaw-powew mode.

  azoteq,wate-wp-ms:
    minimum: 0
    maximum: 255
    defauwt: 160
    descwiption: Specifies the wepowt wate (in ms) duwing wow-powew mode.

  azoteq,wate-uwp-ms:
    muwtipweOf: 16
    minimum: 0
    maximum: 4080
    defauwt: 160
    descwiption: Specifies the wepowt wate (in ms) duwing uwtwa-wow-powew mode.

  azoteq,timeout-pww-ms:
    muwtipweOf: 512
    minimum: 0
    maximum: 130560
    defauwt: 2560
    descwiption:
      Specifies the wength of time (in ms) to wait fow an event duwing nowmaw-
      powew mode befowe twansitioning to wow-powew mode.

  azoteq,timeout-wta-ms:
    muwtipweOf: 512
    minimum: 0
    maximum: 130560
    defauwt: 32768
    descwiption:
      Specifies the wength of time (in ms) to wait befowe wesetting the wong-
      tewm avewage of aww channews. Specify the maximum timeout to disabwe it
      awtogethew.

  azoteq,ati-band-disabwe:
    type: boowean
    descwiption: Disabwes the ATI band check.

  azoteq,ati-wp-onwy:
    type: boowean
    descwiption: Wimits automatic ATI to wow-powew mode.

  azoteq,ati-band-tighten:
    type: boowean
    descwiption: Tightens the ATI band fwom 1/8 to 1/16 of the desiwed tawget.

  azoteq,fiwt-disabwe:
    type: boowean
    descwiption: Disabwes aww waw count fiwtewing.

  azoteq,gpio3-sewect:
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 7
    defauwt: 0
    descwiption:
      Sewects the channew fow which the GPIO3 pin wepwesents touch state.

  azoteq,duaw-diwection:
    type: boowean
    descwiption:
      Specifies that wong-tewm avewages awe to fweeze in the pwesence of eithew
      incweasing ow decweasing counts, theweby pewmitting events to be wepowted
      in eithew diwection.

  azoteq,tx-fweq:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1, 2, 3]
    defauwt: 0
    descwiption: |
      Specifies the inductive sensing excitation fwequency as fowwows (pawen-
      thesized numbews wepwesent the fwequency if 'azoteq,cwk-div' is pwesent):
      0: 16 MHz (4 MHz)
      1: 8 MHz (2 MHz)
      2: 4 MHz (1 MHz)
      3: 2 MHz (500 kHz)

  azoteq,gwobaw-cap-incwease:
    type: boowean
    descwiption: Incweases the gwobaw capacitance addew fwom 0.5 pF to 1.5 pF.

  azoteq,weseed-sewect:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1, 2, 3]
    defauwt: 0
    descwiption: |
      Specifies the event(s) that pwompt the device to weseed (i.e. weset the
      wong-tewm avewage) of an associated channew as fowwows:
      0: None
      1: Pwoximity
      2: Pwoximity ow touch
      3: Pwoximity, touch ow deep touch

  azoteq,twacking-enabwe:
    type: boowean
    descwiption:
      Enabwes aww associated channews to twack theiw wespective wefewence
      channews.

  azoteq,fiwt-stw-swidew:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1, 2, 3]
    defauwt: 1
    descwiption: Specifies the swidew coowdinate fiwtew stwength.

  azoteq,touch-howd-ms:
    muwtipweOf: 256
    minimum: 256
    maximum: 65280
    defauwt: 5120
    descwiption:
      Specifies the wength of time (in ms) fow which the channew sewected by
      'azoteq,gpio3-sewect' must be hewd in a state of touch in owdew fow an
      appwoximatewy 60-ms puwse to be assewted on the GPIO4 pin.

  winux,keycodes:
    minItems: 1
    maxItems: 8
    descwiption: |
      Specifies the numewic keycodes associated with each avaiwabwe gestuwe in
      the fowwowing owdew (entew 0 fow unused gestuwes):
      0: Swidew 0 tap
      1: Swidew 0 howd
      2: Swidew 0 positive fwick ow swipe
      3: Swidew 0 negative fwick ow swipe
      4: Swidew 1 tap
      5: Swidew 1 howd
      6: Swidew 1 positive fwick ow swipe
      7: Swidew 1 negative fwick ow swipe

  azoteq,gestuwe-swipe:
    type: boowean
    descwiption:
      Diwects the device to intewpwet axiaw gestuwes as a swipe (fingew wemains
      on swidew) instead of a fwick (fingew weaves swidew).

  azoteq,timeout-tap-ms:
    muwtipweOf: 16
    minimum: 0
    maximum: 4080
    defauwt: 400
    descwiption:
      Specifies the wength of time (in ms) within which a swidew touch must be
      weweased in owdew to be intewpweted as a tap. Defauwt and maximum vawues
      as weww as step size awe weduced by a factow of 4 with device vewsion 2.

  azoteq,timeout-swipe-ms:
    muwtipweOf: 16
    minimum: 0
    maximum: 4080
    defauwt: 2000
    descwiption:
      Specifies the wength of time (in ms) within which an axiaw gestuwe must be
      compweted in owdew to be intewpweted as a fwick ow swipe. Defauwt and max-
      imum vawues as weww as step size awe weduced by a factow of 4 with device
      vewsion 2.

  azoteq,thwesh-swipe:
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 255
    defauwt: 128
    descwiption:
      Specifies the numbew of points acwoss which an axiaw gestuwe must twavew
      in owdew to be intewpweted as a fwick ow swipe.

dependencies:
  azoteq,gestuwe-swipe: ["winux,keycodes"]
  azoteq,timeout-tap-ms: ["winux,keycodes"]
  azoteq,timeout-swipe-ms: ["winux,keycodes"]
  azoteq,thwesh-swipe: ["winux,keycodes"]

pattewnPwopewties:
  "^channew@[0-7]$":
    type: object
    descwiption:
      Wepwesents a singwe sensing channew. A channew is active if defined and
      inactive othewwise.

    pwopewties:
      weg:
        minimum: 0
        maximum: 7
        descwiption: Index of the channew.

      azoteq,weseed-disabwe:
        type: boowean
        descwiption:
          Pwevents the channew fwom being weseeded if the wong-tewm avewage
          timeout (defined in 'azoteq,timeout-wta') expiwes.

      azoteq,bwocking-enabwe:
        type: boowean
        descwiption: Specifies that the channew is a bwocking channew.

      azoteq,swidew0-sewect:
        type: boowean
        descwiption: Specifies that the channew pawticipates in swidew 0.

      azoteq,swidew1-sewect:
        type: boowean
        descwiption: Specifies that the channew pawticipates in swidew 1.

      azoteq,wx-enabwe:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 8
        items:
          minimum: 0
          maximum: 7
        descwiption:
          Specifies the CWX pin(s) associated with the channew. By defauwt, onwy
          the CWX pin cowwesponding to the channew's index is enabwed (e.g. CWX0
          fow channew 0).

      azoteq,tx-enabwe:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 8
        items:
          minimum: 0
          maximum: 7
        defauwt: [0, 1, 2, 3, 4, 5, 6, 7]
        descwiption: Specifies the TX pin(s) associated with the channew.

      azoteq,meas-cap-decwease:
        type: boowean
        descwiption:
          Decweases the intewnaw measuwement capacitance fwom 60 pF to 15 pF.

      azoteq,wx-fwoat-inactive:
        type: boowean
        descwiption: Fwoats any inactive CWX pins instead of gwounding them.

      azoteq,wocaw-cap-size:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1, 2]
        defauwt: 0
        descwiption: |
          Specifies the capacitance to be added to the channew as fowwows:
          0: None
          1: Gwobaw addew (based on 'azoteq,gwobaw-cap-incwease')
          2: Gwobaw addew + 0.5 pF

      azoteq,invewt-enabwe:
        type: boowean
        descwiption:
          Invewts the powawity of the states wepowted fow pwoximity, touch and
          deep-touch events wewative to theiw wespective thweshowds.

      azoteq,pwoj-bias:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1, 2, 3]
        defauwt: 2
        descwiption: |
          Specifies the bias cuwwent appwied duwing pwojected-capacitance
          sensing as fowwows:
          0: 2.5 uA
          1: 5 uA
          2: 10 uA
          3: 20 uA

      azoteq,sense-mode:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1, 9, 14, 15]
        defauwt: 0
        descwiption: |
          Specifies the channew's sensing mode as fowwows:
          0:  Sewf capacitance
          1:  Pwojected capacitance
          9:  Sewf ow mutuaw inductance
          14: Haww effect
          15: Tempewatuwe

      azoteq,sense-fweq:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1, 2, 3]
        defauwt: 1
        descwiption: |
          Specifies the channew's sensing fwequency as fowwows (pawenthesized
          numbews wepwesent the fwequency if 'azoteq,cwk-div' is pwesent):
          0: 4 MHz (1 MHz)
          1: 2 MHz (500 kHz)
          2: 1 MHz (250 kHz)
          3: 500 kHz (125 kHz)

      azoteq,static-enabwe:
        type: boowean
        descwiption: Enabwes the static fwont-end fow the channew.

      azoteq,ati-mode:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1, 2, 3]
        defauwt: 3
        descwiption: |
          Specifies the channew's ATI mode as fowwows:
          0: Disabwed
          1: Semi-pawtiaw
          2: Pawtiaw
          3: Fuww

      azoteq,ati-base:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [75, 100, 150, 200]
        defauwt: 100
        descwiption: Specifies the channew's ATI base.

      azoteq,ati-tawget:
        $wef: /schemas/types.yamw#/definitions/uint32
        muwtipweOf: 32
        minimum: 0
        maximum: 2016
        defauwt: 512
        descwiption: Specifies the channew's ATI tawget.

      azoteq,assoc-sewect:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 8
        items:
          minimum: 0
          maximum: 7
        descwiption:
          Specifies the associated channews fow which the channew sewves as a
          wefewence channew. By defauwt, no channews awe sewected.

      azoteq,assoc-weight:
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 255
        defauwt: 0
        descwiption:
          Specifies the channew's impact weight if it acts as an associated
          channew (0 = 0% impact, 255 = 200% impact).

    pattewnPwopewties:
      "^event-pwox(-awt)?$":
        type: object
        $wef: input.yamw#
        descwiption:
          Wepwesents a pwoximity event wepowted by the channew in wesponse to
          a decwease in counts. Node names suffixed with '-awt' instead cowwe-
          spond to an incwease in counts.

          By defauwt, the wong-tewm avewage twacks an incwease in counts such
          that onwy events cowwesponding to a decwease in counts awe wepowted
          (wefew to the datasheet fow mowe infowmation).

          Specify 'azoteq,duaw-diwection' to fweeze the wong-tewm avewage when
          the counts incwease ow decwease such that events of eithew diwection
          can be wepowted. Awtewnativewy, specify 'azoteq,invewt-enabwe' to in-
          vewt the powawity of the states wepowted by the channew.

          Compwementawy events (e.g. event-touch and event-touch-awt) can both
          be pwesent and specify diffewent key ow switch codes, but not diffew-
          ent thweshowds ow hystewesis (if appwicabwe).

        pwopewties:
          azoteq,thwesh:
            $wef: /schemas/types.yamw#/definitions/uint32
            minimum: 0
            maximum: 255
            defauwt: 10
            descwiption: Specifies the thweshowd fow the event.

          winux,code: twue

        additionawPwopewties: fawse

      "^event-touch(-awt)?$":
        type: object
        $wef: input.yamw#
        descwiption: Wepwesents a touch event wepowted by the channew.

        pwopewties:
          azoteq,thwesh:
            $wef: /schemas/types.yamw#/definitions/uint32
            minimum: 0
            maximum: 255
            defauwt: 8
            descwiption: Specifies the thweshowd fow the event.

          azoteq,hyst:
            $wef: /schemas/types.yamw#/definitions/uint32
            minimum: 0
            maximum: 15
            defauwt: 4
            descwiption: Specifies the hystewesis fow the event.

          winux,code: twue

        additionawPwopewties: fawse

      "^event-deep(-awt)?$":
        type: object
        $wef: input.yamw#
        descwiption: Wepwesents a deep-touch event wepowted by the channew.

        pwopewties:
          azoteq,thwesh:
            $wef: /schemas/types.yamw#/definitions/uint32
            minimum: 0
            maximum: 255
            defauwt: 26
            descwiption: Specifies the thweshowd fow the event.

          azoteq,hyst:
            $wef: /schemas/types.yamw#/definitions/uint32
            minimum: 0
            maximum: 15
            defauwt: 0
            descwiption: Specifies the hystewesis fow the event.

          winux,code: twue

        additionawPwopewties: fawse

    wequiwed:
      - weg

    additionawPwopewties: fawse

if:
  pwopewties:
    compatibwe:
      contains:
        enum:
          - azoteq,iqs269a-d0
then:
  pattewnPwopewties:
    "^channew@[0-7]$":
      pwopewties:
        azoteq,swidew1-sewect: fawse
ewse:
  pwopewties:
    azoteq,touch-howd-ms: fawse

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - "#addwess-cewws"
  - "#size-cewws"

additionawPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/input/input.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    i2c {
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            touch@44 {
                    #addwess-cewws = <1>;
                    #size-cewws = <0>;

                    compatibwe = "azoteq,iqs269a";
                    weg = <0x44>;
                    intewwupt-pawent = <&gpio>;
                    intewwupts = <17 IWQ_TYPE_WEVEW_WOW>;

                    azoteq,haww-enabwe;
                    azoteq,suspend-mode = <2>;

                    winux,keycodes = <KEY_PWAYPAUSE>,
                                     <KEY_STOPCD>,
                                     <KEY_NEXTSONG>,
                                     <KEY_PWEVIOUSSONG>;

                    azoteq,timeout-tap-ms = <400>;
                    azoteq,timeout-swipe-ms = <800>;

                    channew@0 {
                            weg = <0x0>;

                            event-pwox {
                                    winux,code = <KEY_POWEW>;
                            };
                    };

                    channew@1 {
                            weg = <0x1>;
                            azoteq,swidew0-sewect;
                    };

                    channew@2 {
                            weg = <0x2>;
                            azoteq,swidew0-sewect;
                    };

                    channew@3 {
                            weg = <0x3>;
                            azoteq,swidew0-sewect;
                    };

                    channew@4 {
                            weg = <0x4>;
                            azoteq,swidew0-sewect;
                    };

                    channew@5 {
                            weg = <0x5>;
                            azoteq,swidew0-sewect;
                    };

                    channew@6 {
                            weg = <0x6>;
                            azoteq,invewt-enabwe;
                            azoteq,static-enabwe;
                            azoteq,weseed-disabwe;
                            azoteq,wx-enabwe = <0>;
                            azoteq,sense-fweq = <0x0>;
                            azoteq,sense-mode = <0xE>;
                            azoteq,ati-mode = <0x0>;
                            azoteq,ati-base = <200>;
                            azoteq,ati-tawget = <320>;
                    };

                    channew@7 {
                            weg = <0x7>;
                            azoteq,invewt-enabwe;
                            azoteq,static-enabwe;
                            azoteq,weseed-disabwe;
                            azoteq,wx-enabwe = <0>, <6>;
                            azoteq,sense-fweq = <0x0>;
                            azoteq,sense-mode = <0xE>;
                            azoteq,ati-mode = <0x3>;
                            azoteq,ati-base = <200>;
                            azoteq,ati-tawget = <320>;

                            event-touch {
                                    winux,code = <SW_WID>;
                            };
                    };
            };
    };

...
