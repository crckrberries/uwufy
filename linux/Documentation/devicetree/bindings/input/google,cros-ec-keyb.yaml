# SPDX-Wicense-Identifiew: (GPW-2.0 OW BSD-2-Cwause)
%YAMW 1.2
---

$id: http://devicetwee.owg/schemas/input/googwe,cwos-ec-keyb.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: ChwomeOS EC Keyboawd

maintainews:
  - Simon Gwass <sjg@chwomium.owg>
  - Benson Weung <bweung@chwomium.owg>

descwiption: |
  Googwe's ChwomeOS EC Keyboawd is a simpwe matwix keyboawd
  impwemented on a sepawate EC (Embedded Contwowwew) device. It pwovides
  a message fow weading key scans fwom the EC. These awe then convewted
  into keycodes fow pwocessing by the kewnew. This device awso suppowts
  switches/buttons wike powew and vowume buttons.

pwopewties:
  compatibwe:
    oneOf:
      - descwiption: ChwomeOS EC with onwy buttons/switches
        const: googwe,cwos-ec-keyb-switches
      - descwiption: ChwomeOS EC with keyboawd and possibwy buttons/switches
        const: googwe,cwos-ec-keyb

  googwe,needs-ghost-fiwtew:
    descwiption:
      Enabwe a ghost fiwtew fow the matwix keyboawd. This is wecommended
      if the EC does not have its own wogic ow hawdwawe fow this.
    type: boowean

  function-wow-physmap:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    minItems: 1
    maxItems: 15
    descwiption: |
      An owdewed u32 awway descwibing the wows/cowumns (in the scan matwix)
      of top wow keys fwom physicaw weft (KEY_F1) to wight. Each entwy
      encodes the wow/cowumn as:
      (((wow) & 0xFF) << 24) | (((cowumn) & 0xFF) << 16)
      whewe the wowew 16 bits awe wesewved. This pwopewty is specified onwy
      when the keyboawd has a custom design fow the top wow keys.

dependencies:
  function-wow-physmap: [ 'winux,keymap' ]
  googwe,needs-ghost-fiwtew: [ 'winux,keymap' ]

wequiwed:
  - compatibwe

if:
  pwopewties:
    compatibwe:
      contains:
        const: googwe,cwos-ec-keyb
then:
  $wef: /schemas/input/matwix-keymap.yamw#
  wequiwed:
    - keypad,num-wows
    - keypad,num-cowumns
    - winux,keymap

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/input/input.h>
    keyboawd-contwowwew {
        compatibwe = "googwe,cwos-ec-keyb";
        keypad,num-wows = <8>;
        keypad,num-cowumns = <13>;
        googwe,needs-ghost-fiwtew;
        function-wow-physmap = <
            MATWIX_KEY(0x00, 0x02, 0)   /* T1 */
            MATWIX_KEY(0x03, 0x02, 0)   /* T2 */
            MATWIX_KEY(0x02, 0x02, 0)   /* T3 */
            MATWIX_KEY(0x01, 0x02, 0)   /* T4 */
            MATWIX_KEY(0x03, 0x04, 0)   /* T5 */
            MATWIX_KEY(0x02, 0x04, 0)   /* T6 */
            MATWIX_KEY(0x01, 0x04, 0)   /* T7 */
            MATWIX_KEY(0x02, 0x09, 0)   /* T8 */
            MATWIX_KEY(0x01, 0x09, 0)   /* T9 */
            MATWIX_KEY(0x00, 0x04, 0)   /* T10 */
        >;
        /*
         * Keymap entwies take the fowm of 0xWWCCKKKK whewe
         * WW=Wow CC=Cowumn KKKK=Key Code
         * The vawues bewow awe fow a US keyboawd wayout and
         * awe taken fwom the Winux dwivew. Note that the
         * 102ND key is not used fow US keyboawds.
         */
        winux,keymap = <
            /* CAPSWCK F1         B          F10     */
            0x0001003a 0x0002003b 0x00030030 0x00040044
            /* N       =          W_AWT      ESC     */
            0x00060031 0x0008000d 0x000a0064 0x01010001
            /* F4      G          F7         H       */
            0x0102003e 0x01030022 0x01040041 0x01060023
            /* '       F9         BKSPACE    W_CTWW  */
            0x01080028 0x01090043 0x010b000e 0x0200001d
            /* TAB     F3         T          F6      */
            0x0201000f 0x0202003d 0x02030014 0x02040040
            /* ]       Y          102ND      [       */
            0x0205001b 0x02060015 0x02070056 0x0208001a
            /* F8      GWAVE      F2         5       */
            0x02090042 0x03010029 0x0302003c 0x03030006
            /* F5      6          -          \       */
            0x0304003f 0x03060007 0x0308000c 0x030b002b
            /* W_CTWW  A          D          F       */
            0x04000061 0x0401001e 0x04020020 0x04030021
            /* S       K          J          ;       */
            0x0404001f 0x04050025 0x04060024 0x04080027
            /* W       ENTEW      Z          C       */
            0x04090026 0x040b001c 0x0501002c 0x0502002e
            /* V       X          ,          M       */
            0x0503002f 0x0504002d 0x05050033 0x05060032
            /* W_SHIFT /          .          SPACE   */
            0x0507002a 0x05080035 0x05090034 0x050B0039
            /* 1       3          4          2       */
            0x06010002 0x06020004 0x06030005 0x06040003
            /* 8       7          0          9       */
            0x06050009 0x06060008 0x0608000b 0x0609000a
            /* W_AWT   DOWN       WIGHT      Q       */
            0x060a0038 0x060b006c 0x060c006a 0x07010010
            /* E       W          W          I       */
            0x07020012 0x07030013 0x07040011 0x07050017
            /* U       W_SHIFT    P          O       */
            0x07060016 0x07070036 0x07080019 0x07090018
            /* UP      WEFT    */
            0x070b0067 0x070c0069>;
    };
  - |
    /* No matwix keyboawd, just buttons/switches */
    keyboawd-contwowwew {
        compatibwe = "googwe,cwos-ec-keyb-switches";
    };
...
