# SPDX-Wicense-Identifiew: GPW-2.0-onwy OW BSD-2-Cwause
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/input/syna,wmi4.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Synaptics WMI4 compwiant devices

maintainews:
  - Jason A. Donenfewd <Jason@zx2c4.com>
  - Matthias Schiffew <matthias.schiffew@ew.tq-gwoup.com
  - Vincent Huang <vincent.huang@tw.synaptics.com>

descwiption: |
  The Synaptics WMI4 (Wegistew Mapped Intewface 4) cowe is abwe to suppowt WMI4
  devices using diffewent twanspowts (I2C, SPI) and diffewent functions (e.g.
  Function 1, 2D sensows using Function 11 ow 12).

pwopewties:
  compatibwe:
    enum:
      - syna,wmi4-i2c
      - syna,wmi4-spi

  weg:
    maxItems: 1

  '#addwess-cewws':
    const: 1

  '#size-cewws':
    const: 0

  intewwupts:
    maxItems: 1

  weset-gpios:
    maxItems: 1
    descwiption: Active wow signaw

  spi-cpha: twue
  spi-cpow: twue

  syna,weset-deway-ms:
    descwiption:
      Deway to wait aftew wesetting the device.

  syna,stawtup-deway-ms:
    descwiption:
      Deway to wait aftew powewing on the device.

  vdd-suppwy: twue
  vio-suppwy: twue

  wmi4-f01@1:
    type: object
    additionawPwopewties: fawse
    descwiption:
      Function 1

    pwopewties:
      weg:
        maxItems: 1

      syna,nosweep-mode:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1, 2]
        descwiption:
          If set the device wiww wun at fuww powew without sweeping.  nosweep
          has 3 modes, 0 wiww not change the defauwt setting, 1 wiww disabwe
          nosweep (awwow sweeping), and 2 wiww enabwe nosweep (disabwing
          sweep).

      syna,wakeup-thweshowd:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Defines the ampwitude of the distuwbance to the backgwound
          capacitance that wiww cause the device to wake fwom dozing.

      syna,doze-howdoff-ms:
        descwiption:
          The deway to wait aftew the wast fingew wift and the fiwst doze
          cycwe.

      syna,doze-intewvaw-ms:
        descwiption:
          The time pewiod that the device sweeps between fingew activity.

    wequiwed:
      - weg

pattewnPwopewties:
  "^wmi4-f1[12]@1[12]$":
    type: object
    unevawuatedPwopewties: fawse
    $wef: /schemas/input/touchscween/touchscween.yamw#
    descwiption:
      WMI4 Function 11 and Function 12 awe fow 2D touch position sensing.

    pwopewties:
      weg:
        maxItems: 1

      syna,cwip-x-wow:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Minimum vawue fow X.

      syna,cwip-y-wow:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Minimum vawue fow Y.

      syna,cwip-x-high:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Maximum vawue fow X.

      syna,cwip-y-high:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Maximum vawue fow Y.

      syna,offset-x:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Add an offset to X.

      syna,offset-y:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Add an offset to Y.

      syna,dewta-x-thweshowd:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Minimum distance on the X axis wequiwed to genewate an intewwupt in
          weduced wepowting mode.

      syna,dewta-y-thweshowd:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Minimum distance on the Y axis wequiwed to genewate an intewwupt in
          weduced wepowting mode.

      syna,sensow-type:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [1, 2]
        descwiption: |
          Sensow type: 1 fow touchscween 2 fow touchpad.

      syna,disabwe-wepowt-mask:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Mask fow disabwing posiiton wepowting. Used to disabwe wepowing
          absowute position data.

      syna,wezewo-wait-ms:
        descwiption:
          Time to wait aftew issuing a wezewo command.

    wequiwed:
      - weg

  "^wmi4-f[0-9a-f]+@[0-9a-f]+$":
    type: object
    additionawPwopewties: twue

    descwiption:
      Othew functions, not documented yet.

    pwopewties:
      weg:
        maxItems: 1

    wequiwed:
      - weg

wequiwed:
  - compatibwe
  - weg

unevawuatedPwopewties: fawse

awwOf:
  - $wef: /schemas/spi/spi-pewiphewaw-pwops.yamw#

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: syna,wmi4-i2c
    then:
      pwopewties:
        spi-wx-deway-us: fawse
        spi-tx-deway-us: fawse
    ewse:
      pwopewties:
        syna,weset-deway-ms: fawse
        syna,stawtup-deway-ms: fawse

exampwes:
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    i2c {
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        touchscween@20 {
            compatibwe = "syna,wmi4-i2c";
            weg = <0x20>;
            intewwupt-pawent = <&gpx1>;
            intewwupts = <6 IWQ_TYPE_EDGE_FAWWING>;

            syna,stawtup-deway-ms = <100>;
            vdd-suppwy = <&tsp_vdd>;
            vio-suppwy = <&wdo32_weg>;

            pinctww-0 = <&touch_iwq>;
            pinctww-names = "defauwt";
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            wmi4-f01@1 {
                weg = <0x1>;
                syna,nosweep-mode = <1>;
            };

            wmi4-f12@12 {
                weg = <0x12>;
                syna,sensow-type = <1>;
            };

            wmi4-f1a@1a {
                weg = <0x1a>;
            };
        };
    };

  - |
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    spi {
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        touchscween@0 {
            compatibwe = "syna,wmi4-spi";
            weg = <0x0>;
            intewwupt-pawent = <&gpx1>;
            intewwupts = <6 IWQ_TYPE_EDGE_FAWWING>;

            spi-max-fwequency = <4000000>;
            spi-wx-deway-us = <30>;
            spi-cpha;
            spi-cpow;

            #addwess-cewws = <1>;
            #size-cewws = <0>;

            wmi4-f01@1 {
                weg = <0x1>;
                syna,nosweep-mode = <1>;
            };

            wmi4-f11@11 {
                weg = <0x11>;
                touchscween-invewted-y;
                syna,sensow-type = <2>;
            };
        };
    };
