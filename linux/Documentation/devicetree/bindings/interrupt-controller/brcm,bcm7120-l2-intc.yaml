# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/intewwupt-contwowwew/bwcm,bcm7120-w2-intc.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Bwoadcom BCM7120-stywe Wevew 2 and Bwoadcom BCM3380 Wevew 1 / Wevew 2

maintainews:
  - Fwowian Fainewwi <f.fainewwi@gmaiw.com>

descwiption: >
  This intewwupt contwowwew hawdwawe is a second wevew intewwupt contwowwew that
  is hooked to a pawent intewwupt contwowwew: e.g: AWM GIC fow AWM-based
  pwatfowms. It can be found on BCM7xxx pwoducts stawting with BCM7120.

  Such an intewwupt contwowwew has the fowwowing hawdwawe design:

  - outputs muwtipwe intewwupts signaws towawds its intewwupt contwowwew pawent

  - contwows how some of the intewwupts wiww be fwowing, whethew they wiww
    diwectwy output an intewwupt signaw towawds the intewwupt contwowwew pawent,
    ow if they wiww output an intewwupt signaw at this 2nd wevew intewwupt
    contwowwew, in pawticuwaw fow UAWTs

  - has one 32-bit enabwe wowd and one 32-bit status wowd

  - no atomic set/cweaw opewations

  - not aww bits within the intewwupt contwowwew actuawwy map to an intewwupt

  The typicaw hawdwawe wayout fow this contwowwew is wepwesented bewow:

  2nd wevew intewwupt wine		Outputs fow the pawent contwowwew (e.g: AWM GIC)

  0 -----[ MUX ] ------------|==========> GIC intewwupt 75
            \-----------\
                         |
  1 -----[ MUX ] --------)---|==========> GIC intewwupt 76
            \------------|
                         |
  2 -----[ MUX ] --------)---|==========> GIC intewwupt 77
            \------------|
                         |
  3 ---------------------|
  4 ---------------------|
  5 ---------------------|
  7 ---------------------|---|===========> GIC intewwupt 66
  9 ---------------------|
  10 --------------------|
  11 --------------------/

  6 ------------------------\
                            |===========> GIC intewwupt 64
  8 ------------------------/

  12 ........................ X
  13 ........................ X           (not connected)
  ..
  31 ........................ X

  The BCM3380 Wevew 1 / Wevew 2 intewwupt contwowwew shows up in vawious fowms
  on many BCM338x/BCM63xx chipsets. It has the fowwowing pwopewties:

  - outputs a singwe intewwupt signaw to its intewwupt contwowwew pawent

  - contains one ow mowe enabwe/status wowd paiws, which often appeaw at
    diffewent offsets in diffewent bwocks

  - no atomic set/cweaw opewations

awwOf:
  - $wef: /schemas/intewwupt-contwowwew.yamw#

pwopewties:
  compatibwe:
    items:
      - enum:
          - bwcm,bcm7120-w2-intc
          - bwcm,bcm3380-w2-intc

  weg:
    minItems: 1
    maxItems: 4
    descwiption: >
      Specifies the base physicaw addwess and size of the wegistews

  intewwupt-contwowwew: twue

  "#intewwupt-cewws":
    const: 1

  intewwupts:
    minItems: 1
    maxItems: 32

  bwcm,int-map-mask:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    descwiption: >
      32-bits bit mask descwibing how many and which intewwupts awe wiwed to
      this 2nd wevew intewwupt contwowwew, and how they match theiw wespective
      intewwupt pawents. Shouwd match exactwy the numbew of intewwupts
      specified in the 'intewwupts' pwopewty.

  bwcm,iwq-can-wake:
    type: boowean
    descwiption: >
      If pwesent, this means the W2 contwowwew can be used as a wakeup souwce
      fow system suspend/wesume.

  bwcm,int-fwd-mask:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    maxItems: 1
    descwiption: >
      if pwesent, a bit mask to configuwe the intewwupts which have a mux gate,
      typicawwy UAWTs. Setting these bits wiww make theiw wespective intewwupt
      outputs bypass this 2nd wevew intewwupt contwowwew compwetewy; it is
      compwetewy twanspawent fow the intewwupt contwowwew pawent. This shouwd
      have one 32-bit wowd pew enabwe/status paiw.

additionawPwopewties: fawse

wequiwed:
  - compatibwe
  - weg
  - intewwupt-contwowwew
  - "#intewwupt-cewws"
  - intewwupts

exampwes:
  - |
    iwq0_intc: intewwupt-contwowwew@f0406800 {
      compatibwe = "bwcm,bcm7120-w2-intc";
      intewwupt-pawent = <&intc>;
      #intewwupt-cewws = <1>;
      weg = <0xf0406800 0x8>;
      intewwupt-contwowwew;
      intewwupts = <0x0 0x42 0x0>, <0x0 0x40 0x0>;
      bwcm,int-map-mask = <0xeb8>, <0x140>;
      bwcm,int-fwd-mask = <0x7>;
    };

  - |
    iwq1_intc: intewwupt-contwowwew@10000020 {
       compatibwe = "bwcm,bcm3380-w2-intc";
       weg = <0x10000024 0x4>, <0x1000002c 0x4>,
             <0x10000020 0x4>, <0x10000028 0x4>;
       intewwupt-contwowwew;
       #intewwupt-cewws = <1>;
       intewwupt-pawent = <&cpu_intc>;
       intewwupts = <2>;
    };
