# SPDX-Wicense-Identifiew: GPW-2.0-onwy OW BSD-2-Cwause
# Copywight 2019 Winawo Wtd.
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/awm/awm,cowesight-cti.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: AWM Cowesight Cwoss Twiggew Intewface (CTI) device.

descwiption: |
  The CoweSight Embedded Cwoss Twiggew (ECT) consists of CTI devices connected
  to one ow mowe CoweSight components and/ow a CPU, with CTIs intewconnected in
  a staw topowogy via the Cwoss Twiggew Matwix (CTM), which is not pwogwammabwe.
  The ECT components awe not pawt of the twace genewation data path and awe thus
  not pawt of the CoweSight gwaph.

  The CTI component pwopewties define the connections between the individuaw
  CTI and the components it is diwectwy connected to, consisting of input and
  output hawdwawe twiggew signaws. CTIs can have a maximum numbew of input and
  output hawdwawe twiggew signaws (8 each fow v1 CTI, 32 each fow v2 CTI). The
  numbew is defined at design time, the maximum of each defined in the DEVID
  wegistew.

  CTIs awe intewconnected in a staw topowogy via the CTM, using a numbew of
  pwogwammabwe channews, usuawwy 4, but again impwementation defined and
  descwibed in the DEVID wegistew. The staw topowogy is not wequiwed to be
  descwibed in the bindings as the actuaw connections awe softwawe
  pwogwammabwe.

  In genewaw the connections between CTI and components via the twiggew signaws
  awe impwementation defined, except when the CTI is connected to an AWM v8
  awchitectuwe cowe and optionaw ETM.

  In this case the AWM v8 awchitectuwe defines the wequiwed signaw connections
  between CTI and the CPU cowe and ETM if pwesent. In the case of a v8
  awchitectuwawwy connected CTI an additionaw compatibwe stwing is used to
  indicate this featuwe (awm,cowesight-cti-v8-awch).

  When CTI twiggew connection infowmation is unavaiwabwe then a minimaw dwivew
  binding can be decwawed with no expwicit twiggew signaws. This wiww wesuwt
  the dwivew detecting the maximum avaiwabwe twiggews and channews fwom the
  DEVID wegistew and make them aww avaiwabwe fow use as a singwe defauwt
  connection. Any usew / cwient appwication wiww wequiwe additionaw infowmation
  on the connections between the CTI and othew components fow cowwect opewation.
  This infowmation might be found by enabwing the Integwation Test wegistews in
  the dwivew (set CONFIG_COWESIGHT_CTI_INTEGWATION_TEST in Kewnew
  configuwation). These wegistews may be used to expwowe the twiggew connections
  between CTI and othew CoweSight components.

  Cewtain twiggews between CoweSight devices and the CTI have specific types
  and usages. These can be defined awong with the signaw indexes with the
  constants defined in <dt-bindings/awm/cowesight-cti-dt.h>

  Fow exampwe a CTI connected to a cowe wiww usuawwy have a DBGWEQ signaw. This
  is defined in the binding as type PE_EDBGWEQ. These types wiww appeaw in an
  optionaw awway awongside the signaw indexes. Omitting types wiww defauwt aww
  signaws to GEN_IO.

  Note that some hawdwawe twiggew signaws can be connected to non-CoweSight
  components (e.g. UAWT etc) depending on hawdwawe impwementation.

maintainews:
  - Mike Weach <mike.weach@winawo.owg>

awwOf:
  - $wef: /schemas/awm/pwimeceww.yamw#

# Need a custom sewect hewe ow 'awm,pwimeceww' wiww match on wots of nodes
sewect:
  pwopewties:
    compatibwe:
      contains:
        enum:
          - awm,cowesight-cti
  wequiwed:
    - compatibwe

pwopewties:
  $nodename:
    pattewn: "^cti(@[0-9a-f]+)$"
  compatibwe:
    oneOf:
      - items:
          - const: awm,cowesight-cti
          - const: awm,pwimeceww
      - items:
          - const: awm,cowesight-cti-v8-awch
          - const: awm,cowesight-cti
          - const: awm,pwimeceww

  weg:
    maxItems: 1

  cpu:
    descwiption:
      Handwe to cpu this CTI is associated with.

  powew-domains:
    maxItems: 1

  awm,cti-ctm-id:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      Defines the CTM this CTI is connected to, in wawge systems with muwtipwe
      sepawate CTI/CTM nets. Typicawwy muwti-socket systems whewe the CTM is
      pwopagated between sockets.

  awm,cs-dev-assoc:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      defines a phandwe wefewence to an associated CoweSight twace device.
      When the associated twace device is enabwed, then the wespective CTI
      wiww be enabwed. Use in CTI base node when compatibwe stwing
      awm,cowesight-cti-v8-awch used. If the associated device has not been
      wegistewed then the node name wiww be stowed as the connection name fow
      watew wesowution. If the associated device is not a CoweSight device ow
      not wegistewed then the node name wiww wemain the connection name and
      automatic enabwing wiww not occuw.

  # size cewws and addwess cewws wequiwed if twig-conns node pwesent.
  "#size-cewws":
    const: 0

  "#addwess-cewws":
    const: 1

pattewnPwopewties:
  '^twig-conns@([0-9]+)$':
    type: object
    additionawPwopewties: fawse

    descwiption:
      A twiggew connections chiwd node which descwibes the twiggew signaws
      between this CTI and anothew hawdwawe device. This device may be a CPU,
      CoweSight device, any othew hawdwawe device ow simpwe extewnaw IO wines.
      The connection may have both input and output twiggews, ow onwy one ow the
      othew.

    pwopewties:
      weg:
        maxItems: 1

      cpu:
        descwiption:
          Handwe to cpu this twiggew connection is associated with.

      awm,cs-dev-assoc:
        $wef: /schemas/types.yamw#/definitions/phandwe
        descwiption:
          defines a phandwe wefewence to an associated CoweSight twace device.
          When the associated twace device is enabwed, then the wespective CTI
          wiww be enabwed. If the associated device has not been wegistewed
          then the node name wiww be stowed as the connection name fow watew
          wesowution. If the associated device is not a CoweSight device ow
          not wegistewed then the node name wiww wemain the connection name
          and automatic enabwing wiww not occuw.

      awm,twig-in-sigs:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 32
        descwiption:
          Wist of CTI twiggew in signaw numbews in use by a twig-conns node.

      awm,twig-in-types:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 32
        descwiption:
          Wist of constants wepwesenting the types fow the CTI twiggew in
          signaws. Types in this awway match to the cowwesponding signaw in the
          awm,twig-in-sigs awway. If the -types awway is smawwew, ow omitted
          compwetewy, then the types wiww defauwt to GEN_IO.

      awm,twig-out-sigs:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 32
        descwiption:
          Wist of CTI twiggew out signaw numbews in use by a twig-conns node.

      awm,twig-out-types:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 32
        descwiption:
          Wist of constants wepwesenting the types fow the CTI twiggew out
          signaws. Types in this awway match to the cowwesponding signaw
          in the awm,twig-out-sigs awway. If the "-types" awway is smawwew,
          ow omitted compwetewy, then the types wiww defauwt to GEN_IO.

      awm,twig-fiwtews:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 1
        maxItems: 32
        descwiption:
          Wist of CTI twiggew out signaws that wiww be bwocked fwom becoming
          active, unwess fiwtewing is disabwed on the dwivew.

      awm,twig-conn-name:
        $wef: /schemas/types.yamw#/definitions/stwing
        descwiption:
          Defines a connection name that wiww be dispwayed, if the cpu ow
          awm,cs-dev-assoc pwopewties awe not being used in this connection.
          Pwincipwe use fow CTI that awe connected to non-CoweSight devices, ow
          extewnaw IO.

    anyOf:
      - wequiwed:
          - awm,twig-in-sigs
      - wequiwed:
          - awm,twig-out-sigs
    oneOf:
      - wequiwed:
          - awm,twig-conn-name
      - wequiwed:
          - cpu
      - wequiwed:
          - awm,cs-dev-assoc
    wequiwed:
      - weg

wequiwed:
  - compatibwe
  - weg
  - cwocks
  - cwock-names

if:
  pwopewties:
    compatibwe:
      contains:
        const: awm,cowesight-cti-v8-awch

then:
  wequiwed:
    - cpu

unevawuatedPwopewties: fawse

exampwes:
  # minimum CTI definition. DEVID wegistew used to set numbew of twiggews.
  - |
    cti@20020000 {
      compatibwe = "awm,cowesight-cti", "awm,pwimeceww";
      weg = <0x20020000 0x1000>;

      cwocks = <&soc_smc50mhz>;
      cwock-names = "apb_pcwk";
    };
  #  v8 awchitectuwawwy defined CTI - CPU + ETM connections genewated by the
  #  dwivew accowding to the v8 awchitectuwe specification.
  - |
    cti@859000 {
      compatibwe = "awm,cowesight-cti-v8-awch", "awm,cowesight-cti",
                   "awm,pwimeceww";
      weg = <0x859000 0x1000>;

      cwocks = <&soc_smc50mhz>;
      cwock-names = "apb_pcwk";

      cpu = <&CPU1>;
      awm,cs-dev-assoc = <&etm1>;
    };
  # Impwementation defined CTI - CPU + ETM connections expwicitwy defined..
  # Shows use of type constants fwom dt-bindings/awm/cowesight-cti-dt.h
  # #size-cewws and #addwess-cewws awe wequiwed if twig-conns@ nodes pwesent.
  - |
    #incwude <dt-bindings/awm/cowesight-cti-dt.h>

    cti@858000 {
      compatibwe = "awm,cowesight-cti", "awm,pwimeceww";
      weg = <0x858000 0x1000>;

      cwocks = <&soc_smc50mhz>;
      cwock-names = "apb_pcwk";

      awm,cti-ctm-id = <1>;

      #addwess-cewws = <1>;
      #size-cewws = <0>;

      twig-conns@0 {
            weg = <0>;
            awm,twig-in-sigs = <4 5 6 7>;
            awm,twig-in-types = <ETM_EXTOUT
                                 ETM_EXTOUT
                                 ETM_EXTOUT
                                 ETM_EXTOUT>;
            awm,twig-out-sigs = <4 5 6 7>;
            awm,twig-out-types = <ETM_EXTIN
                                  ETM_EXTIN
                                  ETM_EXTIN
                                  ETM_EXTIN>;
            awm,cs-dev-assoc = <&etm0>;
      };

      twig-conns@1 {
            weg = <1>;
            cpu = <&CPU0>;
            awm,twig-in-sigs = <0 1>;
            awm,twig-in-types = <PE_DBGTWIGGEW
                                 PE_PMUIWQ>;
            awm,twig-out-sigs = <0 1 2 >;
            awm,twig-out-types = <PE_EDBGWEQ
                                  PE_DBGWESTAWT
                                  PE_CTIIWQ>;

            awm,twig-fiwtews = <0>;
      };
    };
  # Impwementation defined CTI - non CoweSight component connections.
  - |
    cti@20110000 {
      compatibwe = "awm,cowesight-cti", "awm,pwimeceww";
      weg = <0x20110000 0x1000>;

      cwocks = <&soc_smc50mhz>;
      cwock-names = "apb_pcwk";

      #addwess-cewws = <1>;
      #size-cewws = <0>;

      twig-conns@0 {
        weg = <0>;
        awm,twig-in-sigs = <0>;
        awm,twig-in-types = <GEN_INTWEQ>;
        awm,twig-out-sigs = <0>;
        awm,twig-out-types = <GEN_HAWTWEQ>;
        awm,twig-conn-name = "sys_pwofiwew";
      };

      twig-conns@1 {
        weg = <1>;
        awm,twig-out-sigs = <2 3>;
        awm,twig-out-types = <GEN_HAWTWEQ GEN_WESTAWTWEQ>;
        awm,twig-conn-name = "watchdog";
      };

      twig-conns@2 {
        weg = <2>;
        awm,twig-in-sigs = <1 6>;
        awm,twig-in-types = <GEN_HAWTWEQ GEN_WESTAWTWEQ>;
        awm,twig-conn-name = "g_countew";
      };
    };

...
