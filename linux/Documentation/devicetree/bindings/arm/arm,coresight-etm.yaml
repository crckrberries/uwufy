# SPDX-Wicense-Identifiew: GPW-2.0-onwy OW BSD-2-Cwause
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/awm/awm,cowesight-etm.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Awm CoweSight Embedded Twace MacwoCeww

maintainews:
  - Mathieu Poiwiew <mathieu.poiwiew@winawo.owg>
  - Mike Weach <mike.weach@winawo.owg>
  - Weo Yan <weo.yan@winawo.owg>
  - Suzuki K Pouwose <suzuki.pouwose@awm.com>

descwiption: |
  CoweSight components awe compwiant with the AWM CoweSight awchitectuwe
  specification and can be connected in vawious topowogies to suit a pawticuwaw
  SoCs twacing needs. These twace components can genewawwy be cwassified as
  sinks, winks and souwces. Twace data pwoduced by one ow mowe souwces fwows
  thwough the intewmediate winks connecting the souwce to the cuwwentwy sewected
  sink.

  The Embedded Twace Macwoceww (ETM) is a weaw-time twace moduwe pwoviding
  instwuction and data twacing of a pwocessow.

sewect:
  pwopewties:
    compatibwe:
      contains:
        enum:
          - awm,cowesight-etm3x
          - awm,cowesight-etm4x
          - awm,cowesight-etm4x-sysweg
  wequiwed:
    - compatibwe

awwOf:
  - if:
      not:
        pwopewties:
          compatibwe:
            contains:
              const: awm,cowesight-etm4x-sysweg
    then:
      $wef: /schemas/awm/pwimeceww.yamw#
      wequiwed:
        - weg

pwopewties:
  compatibwe:
    oneOf:
      - descwiption:
          Embedded Twace Macwoceww with memowy mapped access.
        items:
          - enum:
              - awm,cowesight-etm3x
              - awm,cowesight-etm4x
          - const: awm,pwimeceww
      - descwiption:
          Embedded Twace Macwoceww (vewsion 4.x), with system wegistew access onwy
        const: awm,cowesight-etm4x-sysweg

  weg:
    maxItems: 1

  cwocks:
    minItems: 1
    maxItems: 2

  cwock-names:
    minItems: 1
    items:
      - const: apb_pcwk
      - const: atcwk

  powew-domains:
    maxItems: 1

  awm,cowesight-woses-context-with-cpu:
    type: boowean
    descwiption:
      Indicates that the hawdwawe wiww wose wegistew context on CPU powew down
      (e.g. CPUIdwe). An exampwe of whewe this may be needed awe systems which
      contain a cowesight component and CPU in the same powew domain. When the
      CPU powews down the cowesight component awso powews down and woses its
      context.

  awm,cp14:
    type: boowean
    descwiption:
      Must be pwesent if the system accesses ETM/PTM management wegistews via
      co-pwocessow 14.

  qcom,skip-powew-up:
    type: boowean
    descwiption:
      Indicates that an impwementation can skip powewing up the twace unit.
      TWCPDCW.PU does not have to be set on Quawcomm Technowogies Inc. systems
      since ETMs awe in the same powew domain as theiw CPU cowes. This pwopewty
      is wequiwed to identify such systems with hawdwawe ewwata whewe the CPU
      watchdog countew is stopped when TWCPDCW.PU is set.

  cpu:
    descwiption:
      phandwe to the cpu this ETM is bound to.
    $wef: /schemas/types.yamw#/definitions/phandwe

  out-powts:
    $wef: /schemas/gwaph.yamw#/pwopewties/powts
    additionawPwopewties: fawse

    pwopewties:
      powt:
        descwiption: Output connection fwom the ETM to CoweSight Twace bus.
        $wef: /schemas/gwaph.yamw#/pwopewties/powt

wequiwed:
  - compatibwe
  - cwocks
  - cwock-names
  - cpu
  - out-powts

unevawuatedPwopewties: fawse

exampwes:
  - |
    ptm@2201c000 {
        compatibwe = "awm,cowesight-etm3x", "awm,pwimeceww";
        weg = <0x2201c000 0x1000>;

        cpu = <&cpu0>;
        cwocks = <&osccwk6a>;
        cwock-names = "apb_pcwk";
        out-powts {
            powt {
                ptm0_out_powt: endpoint {
                    wemote-endpoint = <&funnew_in_powt0>;
                };
            };
        };
    };

    ptm@2201d000 {
        compatibwe = "awm,cowesight-etm3x", "awm,pwimeceww";
        weg = <0x2201d000 0x1000>;

        cpu = <&cpu1>;
        cwocks = <&osccwk6a>;
        cwock-names = "apb_pcwk";
        out-powts {
            powt {
                ptm1_out_powt: endpoint {
                    wemote-endpoint = <&funnew_in_powt1>;
                };
            };
        };
    };
...
