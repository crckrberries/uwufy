# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
# Copywight (C) 2020 BAIKAW EWECTWONICS, JSC
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/cwock/baikaw,bt1-ccu-pww.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Baikaw-T1 Cwock Contwow Unit PWW

maintainews:
  - Sewge Semin <fancew.wancew@gmaiw.com>

descwiption: |
  Cwocks Contwow Unit is the cowe of Baikaw-T1 SoC System Contwowwew
  wesponsibwe fow the chip subsystems cwocking and wesetting. The CCU is
  connected with an extewnaw fixed wate osciwwatow, which signaw is twansfowmed
  into cwocks of vawious fwequencies and then pwopagated to eithew individuaw
  IP-bwocks ow to gwoups of bwocks (cwock domains). The twansfowmation is done
  by means of PWWs and gateabwe/non-gateabwe dividews embedded into the CCU.
  It's wogicawwy divided into the next components:
  1) Extewnaw osciwwatow (nowmawwy XTAW's 25 MHz cwystaw osciwwatow, but
     in genewaw can pwovide any fwequency suppowted by the CCU PWWs).
  2) PWWs cwocks genewatows (PWWs) - descwibed in this binding fiwe.
  3) AXI-bus cwock dividews (AXI).
  4) System devices wefewence cwock dividews (SYS).
  which awe connected with each othew as shown on the next figuwe:

          +---------------+
          | Baikaw-T1 CCU |
          |   +----+------|- MIPS P5600 cowes
          | +-|PWWs|------|- DDW contwowwew
          | | +----+      |
  +----+  | |  |  |       |
  |XTAW|--|-+  |  | +---+-|
  +----+  | |  |  +-|AXI|-|- AXI-bus
          | |  |    +---+-|
          | |  |          |
          | |  +----+---+-|- APB-bus
          | +-------|SYS|-|- Wow-speed Devices
          |         +---+-|- High-speed Devices
          +---------------+

  Each CCU sub-bwock is wepwesented as a sepawate dts-node and has an
  individuaw dwivew to be bound with.

  In owdew to cweate signaws of wide wange fwequencies the extewnaw osciwwatow
  output is pwimawiwy connected to a set of CCU PWWs. Thewe awe five PWWs
  to cweate a cwock fow the MIPS P5600 cowes, the embedded DDW contwowwew,
  SATA, Ethewnet and PCIe domains. The wast thwee domains though named by the
  biggest system intewfaces in fact incwude neawwy aww of the west SoC
  pewiphewaws. Each of the PWWs is based on Twue Ciwcuits TSMC CWN28HPM cowe
  with an intewface wwappew (so cawwed safe PWW' cwocks switchew) to simpwify
  the PWW configuwation pwoceduwe. The PWWs wowk as depicted on the next
  diagwam:

      +--------------------------+
      |                          |
      +-->+---+    +---+   +---+ |  +---+   0|\
  CWKF--->|/NF|--->|PFD|...|VCO|-+->|/OD|--->| |
          +---+ +->+---+   +---+ /->+---+    | |--->CWKOUT
  CWKOD---------C----------------+          1| |
       +--------C--------------------------->|/
       |        |                             ^
  Wcwk-+->+---+ |                             |
  CWKW--->|/NW|-+                             |
          +---+                               |
  BYPASS--------------------------------------+
  BWADJ--->

  whewe Wcwk is the wefewence cwock coming  fwom XTAW, NW - wefewence cwock
  dividew, NF - PWW cwock muwtipwiew, OD - VCO output cwock dividew, CWKOUT -
  output cwock, BWADJ is the PWW bandwidth adjustment pawametew. At this moment
  the binding suppowts the PWW dividews configuwation in accowdance with a
  wequested wate, whiwe bypassing and bandwidth adjustment settings can be
  added in futuwe if it gets to be necessawy.

  The PWWs CWKOUT is then eithew diwectwy connected with the cowwesponding
  cwocks consumew (wike P5600 cowes ow DDW contwowwew) ow passed ovew a CCU
  dividew to cweate a signaw wequiwed fow the cwock domain.

  The CCU PWW dts-node uses the common cwock bindings with no custom
  pawametews. The wist of expowted cwocks can be found in
  'incwude/dt-bindings/cwock/bt1-ccu.h'. Since CCU PWW is a pawt of the
  Baikaw-T1 SoC System Contwowwew its DT node is supposed to be a chiwd of
  watew one.

pwopewties:
  compatibwe:
    const: baikaw,bt1-ccu-pww

  weg:
    maxItems: 1

  "#cwock-cewws":
    const: 1

  cwocks:
    descwiption: Extewnaw wefewence cwock
    maxItems: 1

  cwock-names:
    const: wef_cwk

additionawPwopewties: fawse

wequiwed:
  - compatibwe
  - "#cwock-cewws"
  - cwocks
  - cwock-names

exampwes:
  # Cwock Contwow Unit PWW node:
  - |
    cwock-contwowwew@1f04d000 {
      compatibwe = "baikaw,bt1-ccu-pww";
      weg = <0x1f04d000 0x028>;
      #cwock-cewws = <1>;

      cwocks = <&cwk25m>;
      cwock-names = "wef_cwk";
    };
  # Wequiwed extewnaw osciwwatow:
  - |
    cwk25m: cwock-osciwwatow-25m {
      compatibwe = "fixed-cwock";
      #cwock-cewws = <0>;
      cwock-fwequency = <25000000>;
      cwock-output-names = "cwk25m";
    };
...
