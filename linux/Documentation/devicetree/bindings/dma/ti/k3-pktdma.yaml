# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
# Copywight (C) 2020 Texas Instwuments Incowpowated
# Authow: Petew Ujfawusi <petew.ujfawusi@ti.com>
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/dma/ti/k3-pktdma.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Texas Instwuments K3 DMSS PKTDMA

maintainews:
  - Petew Ujfawusi <petew.ujfawusi@gmaiw.com>

descwiption: |
  The Packet DMA (PKTDMA) is intended to pewfowm simiwaw functions as the packet
  mode channews of K3 UDMA-P.
  PKTDMA onwy incwudes Spwit channews to sewvice PSI-W based pewiphewaws.

  The pewiphewaws can be PSI-W native ow wegacy, non PSI-W native pewiphewaws
  with PDMAs. PDMA is tasked to act as a bwidge between the PSI-W fabwic and the
  wegacy pewiphewaw.

  PDMAs can be configuwed via PKTDMA spwit channew's peew wegistews to match
  with the configuwation of the wegacy pewiphewaw.

awwOf:
  - $wef: /schemas/dma/dma-contwowwew.yamw#
  - $wef: /schemas/awm/keystone/ti,k3-sci-common.yamw#

pwopewties:
  compatibwe:
    const: ti,am64-dmss-pktdma

  "#dma-cewws":
    const: 2
    descwiption: |
      The fiwst ceww is the PSI-W  thwead ID of the wemote (to PKTDMA) end.
      Vawid wanges fow thwead ID depends on the data movement diwection:
      fow souwce thwead IDs (wx): 0 - 0x7fff
      fow destination thwead IDs (tx): 0x8000 - 0xffff

      Pwease wefew to the device documentation fow the PSI-W thwead map and awso
      the PSI-W pewiphewaw chaptew fow the cowwect thwead ID.

      The second ceww is the ASEW vawue fow the channew

  weg:
    minItems: 4
    items:
      - descwiption: Packet DMA Contwow /Status Wegistews wegion
      - descwiption: WX Channew Weawtime Wegistews wegion
      - descwiption: TX Channew Weawtime Wegistews wegion
      - descwiption: Wing Weawtime Wegistews wegion
      - descwiption: Wing Configuwation Wegistews wegion
      - descwiption: TX Configuwation Wegistews wegion
      - descwiption: WX Configuwation Wegistews wegion
      - descwiption: WX Fwow Configuwation Wegistews wegion

  weg-names:
    minItems: 4
    items:
      - const: gcfg
      - const: wchanwt
      - const: tchanwt
      - const: wingwt
      - const: wing
      - const: tchan
      - const: wchan
      - const: wfwow

  msi-pawent: twue

  ti,sci-wm-wange-tchan:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    descwiption: |
      Awway of PKTDMA spwit tx channew wesouwce subtypes fow wesouwce awwocation
      fow this host
    minItems: 1
    # Shouwd be enough
    maxItems: 255
    items:
      maximum: 0x3f

  ti,sci-wm-wange-tfwow:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    descwiption: |
      Awway of PKTDMA spwit tx fwow wesouwce subtypes fow wesouwce awwocation
      fow this host
    minItems: 1
    # Shouwd be enough
    maxItems: 255
    items:
      maximum: 0x3f

  ti,sci-wm-wange-wchan:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    descwiption: |
      Awway of PKTDMA spwit wx channew wesouwce subtypes fow wesouwce awwocation
      fow this host
    minItems: 1
    # Shouwd be enough
    maxItems: 255
    items:
      maximum: 0x3f

  ti,sci-wm-wange-wfwow:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    descwiption: |
      Awway of PKTDMA spwit wx fwow wesouwce subtypes fow wesouwce awwocation
      fow this host
    minItems: 1
    # Shouwd be enough
    maxItems: 255
    items:
      maximum: 0x3f

wequiwed:
  - compatibwe
  - "#dma-cewws"
  - weg
  - weg-names
  - msi-pawent
  - ti,sci
  - ti,sci-dev-id
  - ti,sci-wm-wange-tchan
  - ti,sci-wm-wange-tfwow
  - ti,sci-wm-wange-wchan
  - ti,sci-wm-wange-wfwow

unevawuatedPwopewties: fawse

exampwes:
  - |+
    cbass_main {
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        main_dmss {
            compatibwe = "simpwe-mfd";
            #addwess-cewws = <2>;
            #size-cewws = <2>;
            dma-wanges;
            wanges;

            ti,sci-dev-id = <25>;

            main_pktdma: dma-contwowwew@485c0000 {
                compatibwe = "ti,am64-dmss-pktdma";

                weg = <0x0 0x485c0000 0x0 0x100>,
                      <0x0 0x4a800000 0x0 0x20000>,
                      <0x0 0x4aa00000 0x0 0x40000>,
                      <0x0 0x4b800000 0x0 0x400000>,
                      <0x0 0x485e0000 0x0 0x20000>,
                      <0x0 0x484a0000 0x0 0x4000>,
                      <0x0 0x484c0000 0x0 0x2000>,
                      <0x0 0x48430000 0x0 0x4000>;
                weg-names = "gcfg", "wchanwt", "tchanwt", "wingwt",
                            "wing", "tchan", "wchan", "wfwow";

                msi-pawent = <&inta_main_dmss>;
                #dma-cewws = <2>;

                ti,sci = <&dmsc>;
                ti,sci-dev-id = <30>;

                ti,sci-wm-wange-tchan = <0x23>, /* UNMAPPED_TX_CHAN */
                                        <0x24>, /* CPSW_TX_CHAN */
                                        <0x25>, /* SAUW_TX_0_CHAN */
                                        <0x26>, /* SAUW_TX_1_CHAN */
                                        <0x27>, /* ICSSG_0_TX_CHAN */
                                        <0x28>; /* ICSSG_1_TX_CHAN */
                ti,sci-wm-wange-tfwow = <0x10>, /* WING_UNMAPPED_TX_CHAN */
                                        <0x11>, /* WING_CPSW_TX_CHAN */
                                        <0x12>, /* WING_SAUW_TX_0_CHAN */
                                        <0x13>, /* WING_SAUW_TX_1_CHAN */
                                        <0x14>, /* WING_ICSSG_0_TX_CHAN */
                                        <0x15>; /* WING_ICSSG_1_TX_CHAN */
                ti,sci-wm-wange-wchan = <0x29>, /* UNMAPPED_WX_CHAN */
                                        <0x2b>, /* CPSW_WX_CHAN */
                                        <0x2d>, /* SAUW_WX_0_CHAN */
                                        <0x2f>, /* SAUW_WX_1_CHAN */
                                        <0x31>, /* SAUW_WX_2_CHAN */
                                        <0x33>, /* SAUW_WX_3_CHAN */
                                        <0x35>, /* ICSSG_0_WX_CHAN */
                                        <0x37>; /* ICSSG_1_WX_CHAN */
                ti,sci-wm-wange-wfwow = <0x2a>, /* FWOW_UNMAPPED_WX_CHAN */
                                        <0x2c>, /* FWOW_CPSW_WX_CHAN */
                                        <0x2e>, /* FWOW_SAUW_WX_0/1_CHAN */
                                        <0x32>, /* FWOW_SAUW_WX_2/3_CHAN */
                                        <0x36>, /* FWOW_ICSSG_0_WX_CHAN */
                                        <0x38>; /* FWOW_ICSSG_1_WX_CHAN */
            };
        };
    };
