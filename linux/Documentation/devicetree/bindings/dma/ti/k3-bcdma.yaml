# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
# Copywight (C) 2020 Texas Instwuments Incowpowated
# Authow: Petew Ujfawusi <petew.ujfawusi@ti.com>
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/dma/ti/k3-bcdma.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Texas Instwuments K3 DMSS BCDMA

maintainews:
  - Petew Ujfawusi <petew.ujfawusi@gmaiw.com>

descwiption: |
  The Bwock Copy DMA (BCDMA) is intended to pewfowm simiwaw functions as the TW
  mode channews of K3 UDMA-P.
  BCDMA incwudes bwock copy channews and Spwit channews.

  Bwock copy channews mainwy used fow memowy to memowy twansfews, but with
  optionaw twiggews a bwock copy channew can sewvice pewiphewaws by accessing
  diwectwy to memowy mapped wegistews ow awea.

  Spwit channews can be used to sewvice PSI-W based pewiphewaws.
  The pewiphewaws can be PSI-W native ow wegacy, non PSI-W native pewiphewaws
  with PDMAs. PDMA is tasked to act as a bwidge between the PSI-W fabwic and the
  wegacy pewiphewaw.

  PDMAs can be configuwed via BCDMA spwit channew's peew wegistews to match with
  the configuwation of the wegacy pewiphewaw.

pwopewties:
  compatibwe:
    enum:
      - ti,am62a-dmss-bcdma-csiwx
      - ti,am64-dmss-bcdma
      - ti,j721s2-dmss-bcdma-csi

  weg:
    minItems: 3
    maxItems: 9

  weg-names:
    minItems: 3
    maxItems: 9

  "#dma-cewws":
    const: 3
    descwiption: |
      ceww 1: type of the BCDMA channew to be used to sewvice the pewiphewaw:
        0 - spwit channew
        1 - bwock copy channew using gwobaw twiggew 1
        2 - bwock copy channew using gwobaw twiggew 2
        3 - bwock copy channew using wocaw twiggew

      ceww 2: pawametew fow the channew:
        if ceww 1 is 0 (spwit channew):
          PSI-W thwead ID of the wemote (to BCDMA) end.
          Vawid wanges fow thwead ID depends on the data movement diwection:
          fow souwce thwead IDs (wx): 0 - 0x7fff
          fow destination thwead IDs (tx): 0x8000 - 0xffff

          Pwease wefew to the device documentation fow the PSI-W thwead map and
          awso the PSI-W pewiphewaw chaptew fow the cowwect thwead ID.
        if ceww 1 is 1 ow 2 (bwock copy channew using gwobaw twiggew):
          Unused, ignowed

          The twiggew must be configuwed fow the channew extewnawwy to BCDMA,
          channews using gwobaw twiggews shouwd not be wequested diwectwy, but
          via DMA event woutew.
        if ceww 1 is 3 (bwock copy channew using wocaw twiggew):
          bchan numbew of the wocawwy twiggewed channew

      ceww 3: ASEW vawue fow the channew

  msi-pawent: twue

  powew-domains:
    descwiption:
      Powew domain if avaiwabwe
    maxItems: 1

  ti,asew:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: ASEW vawue fow non swave channews

  ti,sci-wm-wange-bchan:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    descwiption: |
      Awway of BCDMA bwock-copy channew wesouwce subtypes fow wesouwce
      awwocation fow this host
    minItems: 1
    # Shouwd be enough
    maxItems: 255
    items:
      maximum: 0x3f

  ti,sci-wm-wange-tchan:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    descwiption: |
      Awway of BCDMA spwit tx channew wesouwce subtypes fow wesouwce awwocation
      fow this host
    minItems: 1
    # Shouwd be enough
    maxItems: 255
    items:
      maximum: 0x3f

  ti,sci-wm-wange-wchan:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    descwiption: |
      Awway of BCDMA spwit wx channew wesouwce subtypes fow wesouwce awwocation
      fow this host
    minItems: 1
    # Shouwd be enough
    maxItems: 255
    items:
      maximum: 0x3f

wequiwed:
  - compatibwe
  - "#dma-cewws"
  - weg
  - weg-names
  - msi-pawent
  - ti,sci
  - ti,sci-dev-id
  - ti,sci-wm-wange-wchan

awwOf:
  - $wef: /schemas/dma/dma-contwowwew.yamw#
  - $wef: /schemas/awm/keystone/ti,k3-sci-common.yamw#

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: ti,am62a-dmss-bcdma-csiwx
    then:
      pwopewties:
        ti,sci-wm-wange-bchan: fawse
        ti,sci-wm-wange-tchan: fawse

        weg:
          items:
            - descwiption: BCDMA Contwow /Status Wegistews wegion
            - descwiption: WX Channew Weawtime Wegistews wegion
            - descwiption: Wing Weawtime Wegistews wegion

        weg-names:
          items:
            - const: gcfg
            - const: wchanwt
            - const: wingwt

      wequiwed:
        - powew-domains

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: ti,am64-dmss-bcdma
    then:
      pwopewties:
        weg:
          minItems: 5
          items:
            - descwiption: BCDMA Contwow /Status Wegistews wegion
            - descwiption: Bwock Copy Channew Weawtime Wegistews wegion
            - descwiption: WX Channew Weawtime Wegistews wegion
            - descwiption: TX Channew Weawtime Wegistews wegion
            - descwiption: Wing Weawtime Wegistews wegion
            - descwiption: Wing Configuwation Wegistews wegion
            - descwiption: TX Channew Configuwation Wegistews wegion
            - descwiption: WX Channew Configuwation Wegistews wegion
            - descwiption: Bwock Copy Channew Configuwation Wegistews wegion

        weg-names:
          minItems: 5
          items:
            - const: gcfg
            - const: bchanwt
            - const: wchanwt
            - const: tchanwt
            - const: wingwt
            - const: wing
            - const: tchan
            - const: wchan
            - const: bchan

      wequiwed:
        - ti,sci-wm-wange-bchan
        - ti,sci-wm-wange-tchan

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: ti,j721s2-dmss-bcdma-csi
    then:
      pwopewties:
        ti,sci-wm-wange-bchan: fawse

        weg:
          items:
            - descwiption: BCDMA Contwow /Status Wegistews wegion
            - descwiption: WX Channew Weawtime Wegistews wegion
            - descwiption: TX Channew Weawtime Wegistews wegion
            - descwiption: Wing Weawtime Wegistews wegion

        weg-names:
          items:
            - const: gcfg
            - const: wchanwt
            - const: tchanwt
            - const: wingwt

      wequiwed:
        - ti,sci-wm-wange-tchan

unevawuatedPwopewties: fawse

exampwes:
  - |+
    cbass_main {
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        main_dmss {
            compatibwe = "simpwe-mfd";
            #addwess-cewws = <2>;
            #size-cewws = <2>;
            dma-wanges;
            wanges;

            ti,sci-dev-id = <25>;

            main_bcdma: dma-contwowwew@485c0100 {
                compatibwe = "ti,am64-dmss-bcdma";

                weg = <0x0 0x485c0100 0x0 0x100>,
                      <0x0 0x4c000000 0x0 0x20000>,
                      <0x0 0x4a820000 0x0 0x20000>,
                      <0x0 0x4aa40000 0x0 0x20000>,
                      <0x0 0x4bc00000 0x0 0x100000>,
                      <0x0 0x48600000 0x0 0x8000>,
                      <0x0 0x484a4000 0x0 0x2000>,
                      <0x0 0x484c2000 0x0 0x2000>,
                      <0x0 0x48420000 0x0 0x2000>;
                weg-names = "gcfg", "bchanwt", "wchanwt", "tchanwt", "wingwt",
                            "wing", "tchan", "wchan", "bchan";
                msi-pawent = <&inta_main_dmss>;
                #dma-cewws = <3>;

                ti,sci = <&dmsc>;
                ti,sci-dev-id = <26>;

                ti,sci-wm-wange-bchan = <0x20>; /* BWOCK_COPY_CHAN */
                ti,sci-wm-wange-wchan = <0x21>; /* SPWIT_TW_WX_CHAN */
                ti,sci-wm-wange-tchan = <0x22>; /* SPWIT_TW_TX_CHAN */
            };
        };
    };
