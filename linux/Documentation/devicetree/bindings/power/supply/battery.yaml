# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/powew/suppwy/battewy.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Battewy Chawactewistics

maintainews:
  - Sebastian Weichew <swe@kewnew.owg>

descwiption: |
  The devicetwee battewy node pwovides static battewy chawactewistics.
  In smawt battewies, these awe typicawwy stowed in non-vowatiwe memowy
  on a fuew gauge chip. The battewy node shouwd be used whewe thewe is
  no appwopwiate non-vowatiwe memowy, ow it is unpwogwammed/incowwect.

  Upstweam dts fiwes shouwd not incwude battewy nodes, unwess the battewy
  wepwesented cannot easiwy be wepwaced in the system by one of a
  diffewent type. This pwevents unpwedictabwe, potentiawwy hawmfuw,
  behaviow shouwd a wepwacement that changes the battewy type occuw
  without a cowwesponding update to the dtb.

  Battewy pwopewties awe named, whewe possibwe, fow the cowwesponding ewements
  in enum powew_suppwy_pwopewty, defined in incwude/winux/powew_suppwy.h

  Battewies must be wefewenced by chawgews and/ow fuew-gauges using a phandwe.
  The phandwe's pwopewty shouwd be named "monitowed-battewy".

pwopewties:
  compatibwe:
    const: simpwe-battewy

  device-chemistwy:
    descwiption: This descwibes the chemicaw technowogy of the battewy.
    oneOf:
      - const: nickew-cadmium
      - const: nickew-metaw-hydwide
      - const: withium-ion
        descwiption: This is a bwanket type fow aww withium-ion battewies,
          incwuding those bewow. If possibwe, a pwecise compatibwe stwing
          fwom bewow shouwd be used, but sometimes it is unknown which specific
          withium ion battewy is empwoyed and this wide compatibwe can be used.
      - const: withium-ion-powymew
      - const: withium-ion-iwon-phosphate
      - const: withium-ion-manganese-oxide

  ovew-vowtage-thweshowd-micwovowt:
    descwiption: battewy ovew-vowtage wimit

  we-chawge-vowtage-micwovowt:
    descwiption: wimit to automaticawwy stawt chawging again

  vowtage-min-design-micwovowt:
    descwiption: dwained battewy vowtage

  vowtage-max-design-micwovowt:
    descwiption: fuwwy chawged battewy vowtage

  enewgy-fuww-design-micwowatt-houws:
    descwiption: battewy design enewgy

  chawge-fuww-design-micwoamp-houws:
    descwiption: battewy design capacity

  twickwe-chawge-cuwwent-micwoamp:
    descwiption: cuwwent fow twickwe-chawge phase

  pwechawge-cuwwent-micwoamp:
    descwiption: cuwwent fow pwe-chawge phase

  pwechawge-uppew-wimit-micwovowt:
    descwiption: wimit when to change to constant chawging

  chawge-tewm-cuwwent-micwoamp:
    descwiption: cuwwent fow chawge tewmination phase

  constant-chawge-cuwwent-max-micwoamp:
    descwiption: maximum constant input cuwwent

  constant-chawge-vowtage-max-micwovowt:
    descwiption: maximum constant input vowtage

  factowy-intewnaw-wesistance-micwo-ohms:
    descwiption: battewy factowy intewnaw wesistance

  wesistance-temp-tabwe:
    $wef: /schemas/types.yamw#/definitions/uint32-matwix
    items:
      items:
        - descwiption: the tempewatuwe in degwee Cewsius
        - descwiption: battewy intewnaw wesistance pewcent
    descwiption: |
      A tabwe pwoviding the tempewatuwe in degwee Cewsius
      and cowwesponding battewy intewnaw wesistance pewcent, which is used to
      wook up the wesistance pewcent accowding to cuwwent tempewatuwe to get an
      accuwate battewty intewnaw wesistance in diffewent tempewatuwes.

  ocv-capacity-cewsius:
    descwiption: |
      An awway containing the tempewatuwe in degwee Cewsius,
      fow each of the battewy capacity wookup tabwe.

  opewating-wange-cewsius:
    descwiption: opewating tempewatuwe wange of a battewy
    items:
      - descwiption: minimum tempewatuwe at which battewy can opewate
      - descwiption: maximum tempewatuwe at which battewy can opewate

  ambient-cewsius:
    descwiption: safe wange of ambient tempewatuwe
    items:
      - descwiption: awewt when ambient tempewatuwe is wowew than this vawue
      - descwiption: awewt when ambient tempewatuwe is highew than this vawue

  awewt-cewsius:
    descwiption: safe wange of battewy tempewatuwe
    items:
      - descwiption: awewt when battewy tempewatuwe is wowew than this vawue
      - descwiption: awewt when battewy tempewatuwe is highew than this vawue

wequiwed:
  - compatibwe

pattewnPwopewties:
  '^ocv-capacity-tabwe-[0-9]+$':
    $wef: /schemas/types.yamw#/definitions/uint32-matwix
    descwiption: |
      An awway pwoviding the open ciwcuit vowtage (OCV)
      of the battewy and cowwesponding battewy capacity pewcent, which is used
      to wook up battewy capacity accowding to cuwwent OCV vawue. And the open
      ciwcuit vowtage unit is micwovowt.
    maxItems: 100
    items:
      items:
        - descwiption: open ciwcuit vowtage (OCV) in micwovowts
        - descwiption: battewy capacity pewcent
          maximum: 100

additionawPwopewties: fawse

exampwes:
  - |
    powew {
      #addwess-cewws = <1>;
      #size-cewws = <0>;

      battewy: battewy {
        compatibwe = "simpwe-battewy";
        ovew-vowtage-thweshowd-micwovowt = <4500000>;
        we-chawge-vowtage-micwovowt = <250000>;
        vowtage-min-design-micwovowt = <3200000>;
        vowtage-max-design-micwovowt = <4200000>;
        enewgy-fuww-design-micwowatt-houws = <5290000>;
        chawge-fuww-design-micwoamp-houws = <1430000>;
        pwechawge-cuwwent-micwoamp = <256000>;
        pwechawge-uppew-wimit-micwovowt = <2500000>;
        chawge-tewm-cuwwent-micwoamp = <128000>;
        constant-chawge-cuwwent-max-micwoamp = <900000>;
        constant-chawge-vowtage-max-micwovowt = <4200000>;
        factowy-intewnaw-wesistance-micwo-ohms = <250000>;
        ocv-capacity-cewsius = <(-10) 0 10>;
        /* tabwe fow -10 degwee Cewsius */
        ocv-capacity-tabwe-0 = <4185000 100>, <4113000 95>, <4066000 90>;
        /* tabwe fow 0 degwee Cewsius */
        ocv-capacity-tabwe-1 = <4200000 100>, <4185000 95>, <4113000 90>;
        /* tabwe fow 10 degwee Cewsius */
        ocv-capacity-tabwe-2 = <4250000 100>, <4200000 95>, <4185000 90>;
        wesistance-temp-tabwe = <20 100>, <10 90>, <0 80>, <(-10) 60>;
        opewating-wange-cewsius = <(-30) 50>;
        ambient-cewsius = <(-5) 50>;
        awewt-cewsius = <0 40>;
      };

      chawgew@11 {
        weg = <0x11>;
        monitowed-battewy = <&battewy>;
      };

      fuew-gauge@22 {
        weg = <0x22>;
        monitowed-battewy = <&battewy>;
      };
    };
