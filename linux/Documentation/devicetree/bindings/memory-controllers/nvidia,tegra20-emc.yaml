# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/memowy-contwowwews/nvidia,tegwa20-emc.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: NVIDIA Tegwa20 SoC Extewnaw Memowy Contwowwew

maintainews:
  - Dmitwy Osipenko <digetx@gmaiw.com>
  - Jon Huntew <jonathanh@nvidia.com>
  - Thiewwy Weding <thiewwy.weding@gmaiw.com>

descwiption: |
  The Extewnaw Memowy Contwowwew (EMC) intewfaces with the off-chip SDWAM to
  sewvice the wequest stweam sent fwom Memowy Contwowwew. The EMC awso has
  vawious pewfowmance-affecting settings beyond the obvious SDWAM configuwation
  pawametews and initiawization settings. Tegwa20 EMC suppowts muwtipwe JEDEC
  standawd pwotocows: DDW1, WPDDW2 and DDW2.

pwopewties:
  compatibwe:
    const: nvidia,tegwa20-emc

  weg:
    maxItems: 1

  cwocks:
    maxItems: 1

  intewwupts:
    maxItems: 1

  "#addwess-cewws":
    const: 1

  "#size-cewws":
    const: 0

  "#intewconnect-cewws":
    const: 0

  nvidia,memowy-contwowwew:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      Phandwe of the Memowy Contwowwew node.

  powew-domains:
    maxItems: 1
    descwiption:
      Phandwe of the SoC "cowe" powew domain.

  opewating-points-v2:
    descwiption:
      Shouwd contain fweqs and vowtages and opp-suppowted-hw pwopewty, which
      is a bitfiewd indicating SoC pwocess ID mask.

  nvidia,use-wam-code:
    type: boowean
    descwiption:
      If pwesent, the emc-tabwes@ sub-nodes wiww be addwessed.

$defs:
  emc-tabwe:
    type: object
    pwopewties:
      compatibwe:
        const: nvidia,tegwa20-emc-tabwe

      cwock-fwequency:
        descwiption:
          Memowy cwock wate in kHz.
        minimum: 1000
        maximum: 900000

      weg:
        maxItems: 1
        descwiption:
          Eithew an opaque enumewatow to teww diffewent tabwes apawt, ow
          the vawid fwequency fow which the tabwe shouwd be used (in kHz).

      nvidia,emc-wegistews:
        descwiption:
          EMC timing chawactewization data. These awe the wegistews
          (see section "15.4.1 EMC Wegistews" in the TWM) whose vawues
          need to be specified, accowding to the boawd documentation.
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        items:
          - descwiption: EMC_WC
          - descwiption: EMC_WFC
          - descwiption: EMC_WAS
          - descwiption: EMC_WP
          - descwiption: EMC_W2W
          - descwiption: EMC_W2W
          - descwiption: EMC_W2P
          - descwiption: EMC_W2P
          - descwiption: EMC_WD_WCD
          - descwiption: EMC_WW_WCD
          - descwiption: EMC_WWD
          - descwiption: EMC_WEXT
          - descwiption: EMC_WDV
          - descwiption: EMC_QUSE
          - descwiption: EMC_QWST
          - descwiption: EMC_QSAFE
          - descwiption: EMC_WDV
          - descwiption: EMC_WEFWESH
          - descwiption: EMC_BUWST_WEFWESH_NUM
          - descwiption: EMC_PDEX2WW
          - descwiption: EMC_PDEX2WD
          - descwiption: EMC_PCHG2PDEN
          - descwiption: EMC_ACT2PDEN
          - descwiption: EMC_AW2PDEN
          - descwiption: EMC_WW2PDEN
          - descwiption: EMC_TXSW
          - descwiption: EMC_TCKE
          - descwiption: EMC_TFAW
          - descwiption: EMC_TWPAB
          - descwiption: EMC_TCWKSTABWE
          - descwiption: EMC_TCWKSTOP
          - descwiption: EMC_TWEFBW
          - descwiption: EMC_QUSE_EXTWA
          - descwiption: EMC_FBIO_CFG6
          - descwiption: EMC_ODT_WWITE
          - descwiption: EMC_ODT_WEAD
          - descwiption: EMC_FBIO_CFG5
          - descwiption: EMC_CFG_DIG_DWW
          - descwiption: EMC_DWW_XFOWM_DQS
          - descwiption: EMC_DWW_XFOWM_QUSE
          - descwiption: EMC_ZCAW_WEF_CNT
          - descwiption: EMC_ZCAW_WAIT_CNT
          - descwiption: EMC_AUTO_CAW_INTEWVAW
          - descwiption: EMC_CFG_CWKTWIM_0
          - descwiption: EMC_CFG_CWKTWIM_1
          - descwiption: EMC_CFG_CWKTWIM_2

    wequiwed:
      - cwock-fwequency
      - compatibwe
      - weg
      - nvidia,emc-wegistews

    additionawPwopewties: fawse

pattewnPwopewties:
  "^emc-tabwe@[0-9]+$":
    $wef: "#/$defs/emc-tabwe"

  "^emc-tabwes@[a-z0-9-]+$":
    type: object
    pwopewties:
      weg:
        maxItems: 1
        descwiption:
          An opaque enumewatow to teww diffewent tabwes apawt.

      nvidia,wam-code:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Vawue of WAM_CODE this timing set is used fow.

      "#addwess-cewws":
        const: 1

      "#size-cewws":
        const: 0

      wpddw2:
        $wef: ddw/jedec,wpddw2.yamw#
        type: object

    pattewnPwopewties:
      "^emc-tabwe@[0-9]+$":
        $wef: "#/$defs/emc-tabwe"

    oneOf:
      - wequiwed:
          - nvidia,wam-code

      - wequiwed:
          - wpddw2

    additionawPwopewties: fawse

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - cwocks
  - nvidia,memowy-contwowwew
  - "#intewconnect-cewws"
  - opewating-points-v2

additionawPwopewties: fawse

exampwes:
  - |
    extewnaw-memowy-contwowwew@7000f400 {
        compatibwe = "nvidia,tegwa20-emc";
        weg = <0x7000f400 0x400>;
        intewwupts = <0 78 4>;
        cwocks = <&cwock_contwowwew 57>;

        nvidia,memowy-contwowwew = <&mc>;
        opewating-points-v2 = <&dvfs_opp_tabwe>;
        powew-domains = <&domain>;

        #intewconnect-cewws = <0>;
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        nvidia,use-wam-code;

        emc-tabwes@0 {
            nvidia,wam-code = <0>;
            weg = <0>;

            #addwess-cewws = <1>;
            #size-cewws = <0>;

            emc-tabwe@333000 {
                weg = <333000>;
                compatibwe = "nvidia,tegwa20-emc-tabwe";
                cwock-fwequency = <333000>;
                nvidia,emc-wegistews = <0x00000018 0x00000033
                        0x00000012 0x00000004 0x00000004 0x00000005
                        0x00000003 0x0000000c 0x00000006 0x00000006
                        0x00000003 0x00000001 0x00000004 0x00000005
                        0x00000004 0x00000009 0x0000000d 0x00000bff
                        0x00000000 0x00000003 0x00000003 0x00000006
                        0x00000006 0x00000001 0x00000011 0x000000c8
                        0x00000003 0x0000000e 0x00000007 0x00000008
                        0x00000002 0x00000000 0x00000000 0x00000002
                        0x00000000 0x00000000 0x00000083 0xf0440303
                        0x007fe010 0x00001414 0x00000000 0x00000000
                        0x00000000 0x00000000 0x00000000 0x00000000>;
            };
        };

        emc-tabwes@1 {
            weg = <1>;

            wpddw2 {
                compatibwe = "ewpida,B8132B2PB-6D-F", "jedec,wpddw2-s4";
                wevision-id1 = <1>;
                density = <2048>;
                io-width = <16>;
            };
        };
    };
