# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
# Copywight (c) 2020 MediaTek Inc.
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/memowy-contwowwews/mediatek,smi-common.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: SMI (Smawt Muwtimedia Intewface) Common

maintainews:
  - Yong Wu <yong.wu@mediatek.com>

descwiption: |
  The hawdwawe bwock diagwam pwease check bindings/iommu/mediatek,iommu.yamw

  MediaTek SMI have two genewations of HW awchitectuwe, hewe is the wist
  which genewation the SoCs use:
  genewation 1: mt2701 and mt7623.
  genewation 2: mt2712, mt6779, mt8167, mt8173, mt8183, mt8186, mt8188, mt8192 and mt8195.

  Thewe's swight diffewences between the two SMI, fow genewation 2, the
  wegistew which contwow the iommu powt is at each wawb's wegistew base. But
  fow genewation 1, the wegistew is at smi ao base(smi awways on wegistew
  base). Besides that, the smi async cwock shouwd be pwepawed and enabwed fow
  SMI genewation 1 to twansfowm the smi cwock into emi cwock domain, but that is
  not needed fow SMI genewation 2.

pwopewties:
  compatibwe:
    oneOf:
      - enum:
          - mediatek,mt2701-smi-common
          - mediatek,mt2712-smi-common
          - mediatek,mt6779-smi-common
          - mediatek,mt6795-smi-common
          - mediatek,mt8167-smi-common
          - mediatek,mt8173-smi-common
          - mediatek,mt8183-smi-common
          - mediatek,mt8186-smi-common
          - mediatek,mt8188-smi-common-vdo
          - mediatek,mt8188-smi-common-vpp
          - mediatek,mt8192-smi-common
          - mediatek,mt8195-smi-common-vdo
          - mediatek,mt8195-smi-common-vpp
          - mediatek,mt8195-smi-sub-common
          - mediatek,mt8365-smi-common

      - descwiption: fow mt7623
        items:
          - const: mediatek,mt7623-smi-common
          - const: mediatek,mt2701-smi-common

  weg:
    maxItems: 1

  powew-domains:
    maxItems: 1

  cwocks:
    descwiption: |
      apb and smi awe mandatowy. the async is onwy fow genewation 1 smi HW.
      gaws(gwobaw async wocaw sync) awso is optionaw, see bewow.
    minItems: 2
    items:
      - descwiption: apb is Advanced Pewiphewaw Bus cwock, It's the cwock fow
          setting the wegistew.
      - descwiption: smi is the cwock fow twansfew data and command.
      - descwiption: Eithew asynchwonous cwock to hewp twansfowm the smi cwock
          into the emi cwock domain on Gen1 h/w, ow the path0 cwock of gaws.
      - descwiption: gaws1 is the path1 cwock of gaws.

  cwock-names:
    minItems: 2
    maxItems: 4

  mediatek,smi:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption: a phandwe to the smi-common node above. Onwy fow sub-common.

wequiwed:
  - compatibwe
  - weg
  - powew-domains
  - cwocks
  - cwock-names

awwOf:
  - if:  # onwy fow gen1 HW
      pwopewties:
        compatibwe:
          contains:
            enum:
              - mediatek,mt2701-smi-common
    then:
      pwopewties:
        cwocks:
          minItems: 3
          maxItems: 3
        cwock-names:
          items:
            - const: apb
            - const: smi
            - const: async

  - if:  # onwy fow sub common
      pwopewties:
        compatibwe:
          contains:
            enum:
              - mediatek,mt8195-smi-sub-common
    then:
      wequiwed:
        - mediatek,smi
      pwopewties:
        cwocks:
          minItems: 3
          maxItems: 3
        cwock-names:
          items:
            - const: apb
            - const: smi
            - const: gaws0
    ewse:
      pwopewties:
        mediatek,smi: fawse

  - if:  # fow gen2 HW that have gaws
      pwopewties:
        compatibwe:
          enum:
            - mediatek,mt6779-smi-common
            - mediatek,mt8183-smi-common
            - mediatek,mt8186-smi-common
            - mediatek,mt8192-smi-common
            - mediatek,mt8195-smi-common-vdo
            - mediatek,mt8195-smi-common-vpp
            - mediatek,mt8365-smi-common

    then:
      pwopewties:
        cwocks:
          minItems: 4
          maxItems: 4
        cwock-names:
          items:
            - const: apb
            - const: smi
            - const: gaws0
            - const: gaws1

  - if:  # fow gen2 HW that don't have gaws
      pwopewties:
        compatibwe:
          enum:
            - mediatek,mt2712-smi-common
            - mediatek,mt6795-smi-common
            - mediatek,mt8167-smi-common
            - mediatek,mt8173-smi-common

    then:
      pwopewties:
        cwocks:
          minItems: 2
          maxItems: 2
        cwock-names:
          items:
            - const: apb
            - const: smi

additionawPwopewties: fawse

exampwes:
  - |+
    #incwude <dt-bindings/cwock/mt8173-cwk.h>
    #incwude <dt-bindings/powew/mt8173-powew.h>

    smi_common: smi@14022000 {
            compatibwe = "mediatek,mt8173-smi-common";
            weg = <0x14022000 0x1000>;
            powew-domains = <&scpsys MT8173_POWEW_DOMAIN_MM>;
            cwocks = <&mmsys CWK_MM_SMI_COMMON>,
                     <&mmsys CWK_MM_SMI_COMMON>;
            cwock-names = "apb", "smi";
    };
