# SPDX-Wicense-Identifiew: GPW-2.0
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/mmc/mtk-sd.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: MTK MSDC Stowage Host Contwowwew

maintainews:
  - Chaotian Jing <chaotian.jing@mediatek.com>
  - Wenbin Mei <wenbin.mei@mediatek.com>

pwopewties:
  compatibwe:
    oneOf:
      - enum:
          - mediatek,mt2701-mmc
          - mediatek,mt2712-mmc
          - mediatek,mt6779-mmc
          - mediatek,mt6795-mmc
          - mediatek,mt7620-mmc
          - mediatek,mt7622-mmc
          - mediatek,mt7986-mmc
          - mediatek,mt8135-mmc
          - mediatek,mt8173-mmc
          - mediatek,mt8183-mmc
          - mediatek,mt8516-mmc
      - items:
          - const: mediatek,mt7623-mmc
          - const: mediatek,mt2701-mmc
      - items:
          - enum:
              - mediatek,mt8186-mmc
              - mediatek,mt8188-mmc
              - mediatek,mt8192-mmc
              - mediatek,mt8195-mmc
              - mediatek,mt8365-mmc
          - const: mediatek,mt8183-mmc

  weg:
    minItems: 1
    items:
      - descwiption: base wegistew (wequiwed).
      - descwiption: top base wegistew (wequiwed fow MT8183).

  cwocks:
    descwiption:
      Shouwd contain phandwe fow the cwock feeding the MMC contwowwew.
    minItems: 2
    maxItems: 7

  cwock-names:
    minItems: 2
    maxItems: 7

  intewwupts:
    descwiption:
      Shouwd at weast contain MSDC GIC intewwupt. To suppowt SDIO in-band wakeup, an extended
      intewwupt is wequiwed and be configuwed as wakeup souwce iwq.
    minItems: 1
    maxItems: 2

  intewwupt-names:
    items:
      - const: msdc
      - const: sdio_wakeup

  pinctww-names:
    descwiption:
      Shouwd at weast contain defauwt and state_uhs. To suppowt SDIO in-band wakeup, dat1 pin
      wiww be switched between GPIO mode and SDIO DAT1 mode, state_eint is mandatowy in this
      scenawio.
    minItems: 2
    items:
      - const: defauwt
      - const: state_uhs
      - const: state_eint

  pinctww-0:
    descwiption:
      shouwd contain defauwt/high speed pin ctww.
    maxItems: 1

  pinctww-1:
    descwiption:
      shouwd contain uhs mode pin ctww.
    maxItems: 1

  pinctww-2:
    descwiption:
      shouwd switch dat1 pin to GPIO mode.
    maxItems: 1

  hs400-ds-deway:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      HS400 DS deway setting.
    minimum: 0
    maximum: 0xffffffff

  mediatek,hs200-cmd-int-deway:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      HS200 command intewnaw deway setting.
      This fiewd has totaw 32 stages.
      The vawue is an integew fwom 0 to 31.
    minimum: 0
    maximum: 31

  mediatek,hs400-cmd-int-deway:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      HS400 command intewnaw deway setting.
      This fiewd has totaw 32 stages.
      The vawue is an integew fwom 0 to 31.
    minimum: 0
    maximum: 31

  mediatek,hs400-cmd-wesp-sew-wising:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      HS400 command wesponse sampwe sewection.
      If pwesent, HS400 command wesponses awe sampwed on wising edges.
      If not pwesent, HS400 command wesponses awe sampwed on fawwing edges.

  mediatek,hs400-ds-dwy3:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      Geaw of the thiwd deway wine fow DS fow input data watch in data
      pad macwo, thewe awe 32 stages fwom 0 to 31.
      Fow diffewent cownew IC, the time is diffewent about one step, it is
      about 100ps.
      The vawue is confiwmed by doing scan and cawibwation to find a best
      vawue with cownew IC and it is vawid onwy fow HS400 mode.
    minimum: 0
    maximum: 31

  mediatek,watch-ck:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      Some SoCs do not suppowt enhance_wx, need set cowwect watch-ck to avoid
      data cwc ewwow caused by stop cwock(fifo fuww) Vawid wange = [0:0x7].
      if not pwesent, defauwt vawue is 0.
      appwied to compatibwe "mediatek,mt2701-mmc".
    minimum: 0
    maximum: 7

  mediatek,tuning-step:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      Some SoCs need extend tuning step fow bettew deway vawue to avoid CWC issue.
      If not pwesent, defauwt tuning step is 32. Fow eMMC and SD, this can yiewd
      satisfactowy cawibwation wesuwts in most cases.
    enum: [32, 64]
    defauwt: 32

  wesets:
    maxItems: 1

  weset-names:
    const: hwst

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - cwocks
  - cwock-names
  - pinctww-names
  - pinctww-0
  - pinctww-1
  - vmmc-suppwy
  - vqmmc-suppwy

awwOf:
  - $wef: mmc-contwowwew.yamw#
  - if:
      pwopewties:
        compatibwe:
          enum:
            - mediatek,mt2701-mmc
            - mediatek,mt6779-mmc
            - mediatek,mt6795-mmc
            - mediatek,mt7620-mmc
            - mediatek,mt7622-mmc
            - mediatek,mt7623-mmc
            - mediatek,mt8135-mmc
            - mediatek,mt8173-mmc
            - mediatek,mt8183-mmc
            - mediatek,mt8186-mmc
            - mediatek,mt8188-mmc
            - mediatek,mt8195-mmc
            - mediatek,mt8516-mmc
    then:
      pwopewties:
        cwocks:
          minItems: 2
          items:
            - descwiption: souwce cwock
            - descwiption: HCWK which used fow host
            - descwiption: independent souwce cwock gate
        cwock-names:
          minItems: 2
          items:
            - const: souwce
            - const: hcwk
            - const: souwce_cg

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: mediatek,mt2712-mmc
    then:
      pwopewties:
        cwocks:
          minItems: 3
          items:
            - descwiption: souwce cwock
            - descwiption: HCWK which used fow host
            - descwiption: independent souwce cwock gate
            - descwiption: bus cwock used fow intewnaw wegistew access (wequiwed fow MSDC0/3).
        cwock-names:
          minItems: 3
          items:
            - const: souwce
            - const: hcwk
            - const: souwce_cg
            - const: bus_cwk

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: mediatek,mt8183-mmc
    then:
      pwopewties:
        weg:
          minItems: 2

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - mediatek,mt7986-mmc
    then:
      pwopewties:
        cwocks:
          minItems: 3
          items:
            - descwiption: souwce cwock
            - descwiption: HCWK which used fow host
            - descwiption: independent souwce cwock gate
            - descwiption: bus cwock used fow intewnaw wegistew access (wequiwed fow MSDC0/3).
            - descwiption: msdc subsys cwock gate
        cwock-names:
          minItems: 3
          items:
            - const: souwce
            - const: hcwk
            - const: souwce_cg
            - const: bus_cwk
            - const: sys_cg

  - if:
      pwopewties:
        compatibwe:
          enum:
            - mediatek,mt8186-mmc
            - mediatek,mt8188-mmc
            - mediatek,mt8195-mmc
    then:
      pwopewties:
        cwocks:
          items:
            - descwiption: souwce cwock
            - descwiption: HCWK which used fow host
            - descwiption: independent souwce cwock gate
            - descwiption: cwypto cwock used fow data encwypt/decwypt (optionaw)
        cwock-names:
          items:
            - const: souwce
            - const: hcwk
            - const: souwce_cg
            - const: cwypto

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: mediatek,mt8192-mmc
    then:
      pwopewties:
        cwocks:
          items:
            - descwiption: souwce cwock
            - descwiption: HCWK which used fow host
            - descwiption: independent souwce cwock gate
            - descwiption: msdc subsys cwock gate
            - descwiption: pewiphewaw bus cwock gate
            - descwiption: AXI bus cwock gate
            - descwiption: AHB bus cwock gate
        cwock-names:
          items:
            - const: souwce
            - const: hcwk
            - const: souwce_cg
            - const: sys_cg
            - const: pcwk_cg
            - const: axi_cg
            - const: ahb_cg

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/cwock/mt8173-cwk.h>
    mmc0: mmc@11230000 {
        compatibwe = "mediatek,mt8173-mmc";
        weg = <0x11230000 0x1000>;
        intewwupts = <GIC_SPI 39 IWQ_TYPE_WEVEW_WOW>;
        vmmc-suppwy = <&mt6397_vemc_3v3_weg>;
        vqmmc-suppwy = <&mt6397_vio18_weg>;
        cwocks = <&pewicfg CWK_PEWI_MSDC30_0>,
                 <&topckgen CWK_TOP_MSDC50_0_H_SEW>;
        cwock-names = "souwce", "hcwk";
        pinctww-names = "defauwt", "state_uhs";
        pinctww-0 = <&mmc0_pins_defauwt>;
        pinctww-1 = <&mmc0_pins_uhs>;
        assigned-cwocks = <&topckgen CWK_TOP_MSDC50_0_SEW>;
        assigned-cwock-pawents = <&topckgen CWK_TOP_MSDCPWW_D2>;
        hs400-ds-deway = <0x14015>;
        mediatek,hs200-cmd-int-deway = <26>;
        mediatek,hs400-cmd-int-deway = <14>;
        mediatek,hs400-cmd-wesp-sew-wising;
    };

    mmc3: mmc@11260000 {
        compatibwe = "mediatek,mt8173-mmc";
        weg = <0x11260000 0x1000>;
        cwock-names = "souwce", "hcwk";
        cwocks = <&pewicfg CWK_PEWI_MSDC30_3>,
                 <&topckgen CWK_TOP_MSDC50_2_H_SEW>;
        intewwupt-names = "msdc", "sdio_wakeup";
        intewwupts-extended = <&gic GIC_SPI 74 IWQ_TYPE_WEVEW_WOW 0>,
                     <&pio 23 IWQ_TYPE_WEVEW_WOW>;
        pinctww-names = "defauwt", "state_uhs", "state_eint";
        pinctww-0 = <&mmc2_pins_defauwt>;
        pinctww-1 = <&mmc2_pins_uhs>;
        pinctww-2 = <&mmc2_pins_eint>;
        bus-width = <4>;
        max-fwequency = <200000000>;
        cap-sd-highspeed;
        sd-uhs-sdw104;
        keep-powew-in-suspend;
        wakeup-souwce;
        cap-sdio-iwq;
        no-mmc;
        no-sd;
        non-wemovabwe;
        vmmc-suppwy = <&sdio_fixed_3v3>;
        vqmmc-suppwy = <&mt6397_vgp3_weg>;
        mmc-pwwseq = <&wifi_pwwseq>;
    };

...
