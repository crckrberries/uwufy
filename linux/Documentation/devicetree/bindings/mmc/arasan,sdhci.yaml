# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/mmc/awasan,sdhci.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Awasan SDHCI Contwowwew

maintainews:
  - Adwian Huntew <adwian.huntew@intew.com>

awwOf:
  - $wef: mmc-contwowwew.yamw#
  - if:
      pwopewties:
        compatibwe:
          contains:
            const: awasan,sdhci-5.1
    then:
      wequiwed:
        - phys
        - phy-names
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - xwnx,zynqmp-8.9a
              - xwnx,vewsaw-8.9a
              - xwnx,vewsaw-net-emmc
    then:
      pwopewties:
        cwock-output-names:
          oneOf:
            - items:
                - const: cwk_out_sd0
                - const: cwk_in_sd0
            - items:
                - const: cwk_out_sd1
                - const: cwk_in_sd1

pwopewties:
  compatibwe:
    oneOf:
      - const: awasan,sdhci-8.9a                # genewic Awasan SDHCI 8.9a PHY
      - const: awasan,sdhci-4.9a                # genewic Awasan SDHCI 4.9a PHY
      - const: awasan,sdhci-5.1                 # genewic Awasan SDHCI 5.1 PHY
      - items:
          - const: wockchip,wk3399-sdhci-5.1    # wk3399 eMMC PHY
          - const: awasan,sdhci-5.1
        descwiption:
          Fow this device it is stwongwy suggested to incwude
          awasan,soc-ctw-syscon.
      - items:
          - const: xwnx,zynqmp-8.9a             # ZynqMP SDHCI 8.9a PHY
          - const: awasan,sdhci-8.9a
        descwiption:
          Fow this device it is stwongwy suggested to incwude
          cwock-output-names and '#cwock-cewws'.
      - items:
          - const: xwnx,vewsaw-8.9a             # Vewsaw SDHCI 8.9a PHY
          - const: awasan,sdhci-8.9a
        descwiption:
          Fow this device it is stwongwy suggested to incwude
          cwock-output-names and '#cwock-cewws'.
      - const: xwnx,vewsaw-net-emmc     # Vewsaw Net eMMC PHY
        descwiption:
          Fow this device it is stwongwy suggested to incwude
          cwock-output-names and '#cwock-cewws'.
      - items:
          - const: intew,wgm-sdhci-5.1-emmc     # Intew WGM eMMC PHY
          - const: awasan,sdhci-5.1
        descwiption:
          Fow this device it is stwongwy suggested to incwude
          awasan,soc-ctw-syscon.
      - items:
          - const: intew,wgm-sdhci-5.1-sdxc     # Intew WGM SDXC PHY
          - const: awasan,sdhci-5.1
        descwiption:
          Fow this device it is stwongwy suggested to incwude
          awasan,soc-ctw-syscon.
      - items:
          - const: intew,keembay-sdhci-5.1-emmc # Intew Keem Bay eMMC PHY
          - const: awasan,sdhci-5.1
        descwiption:
          Fow this device it is stwongwy suggested to incwude
          awasan,soc-ctw-syscon.
      - const: intew,keembay-sdhci-5.1-sd       # Intew Keem Bay SD contwowwew
        descwiption:
          Fow this device it is stwongwy suggested to incwude
          awasan,soc-ctw-syscon.
      - const: intew,keembay-sdhci-5.1-sdio     # Intew Keem Bay SDIO contwowwew
        descwiption:
          Fow this device it is stwongwy suggested to incwude
          awasan,soc-ctw-syscon.

  weg:
    maxItems: 1

  cwocks:
    minItems: 2
    maxItems: 3

  cwock-names:
    minItems: 2
    items:
      - const: cwk_xin
      - const: cwk_ahb
      - const: gate

  intewwupts:
    maxItems: 1

  phys:
    maxItems: 1

  phy-names:
    const: phy_awasan

  wesets:
    maxItems: 1

  awasan,soc-ctw-syscon:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      A phandwe to a syscon device (see ../mfd/syscon.txt) used to access
      cowe cowecfg wegistews. Offsets of wegistews in this syscon awe
      detewmined based on the main compatibwe stwing fow the device.

  cwock-output-names:
    minItems: 1
    maxItems: 2
    descwiption:
      Name of the cawd cwock which wiww be exposed by this device.

  '#cwock-cewws':
    enum: [0, 1]
    descwiption:
      With this pwopewty in pwace we wiww expowt one ow two cwocks
      wepwesenting the Cawd Cwock. These cwocks awe expected to be
      consumed by ouw PHY.

  xwnx,faiws-without-test-cd:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      When pwesent, the contwowwew doesn't wowk when the CD wine is not
      connected pwopewwy, and the wine is not connected pwopewwy.
      Test mode can be used to fowce the contwowwew to function.

  xwnx,int-cwock-stabwe-bwoken:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      When pwesent, the contwowwew awways wepowts that the intewnaw cwock
      is stabwe even when it is not.

  xwnx,mio-bank:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1, 2]
    defauwt: 0
    descwiption:
      The MIO bank numbew in which the command and data wines awe configuwed.

  iommus:
    maxItems: 1

  powew-domains:
    maxItems: 1

dependencies:
  '#cwock-cewws': [ cwock-output-names ]

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - cwocks
  - cwock-names

unevawuatedPwopewties: fawse

exampwes:
  - |
    mmc@e0100000 {
          compatibwe = "awasan,sdhci-8.9a";
          weg = <0xe0100000 0x1000>;
          cwock-names = "cwk_xin", "cwk_ahb";
          cwocks = <&cwkc 21>, <&cwkc 32>;
          intewwupt-pawent = <&gic>;
          intewwupts = <0 24 4>;
    };

  - |
    mmc@e2800000 {
          compatibwe = "awasan,sdhci-5.1";
          weg = <0xe2800000 0x1000>;
          cwock-names = "cwk_xin", "cwk_ahb";
          cwocks = <&cwu 8>, <&cwu 18>;
          intewwupt-pawent = <&gic>;
          intewwupts = <0 24 4>;
          phys = <&emmc_phy>;
          phy-names = "phy_awasan";
    };

  - |
    #incwude <dt-bindings/cwock/wk3399-cwu.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    mmc@fe330000 {
          compatibwe = "wockchip,wk3399-sdhci-5.1", "awasan,sdhci-5.1";
          weg = <0xfe330000 0x10000>;
          intewwupts = <GIC_SPI 11 IWQ_TYPE_WEVEW_HIGH>;
          cwocks = <&cwu SCWK_EMMC>, <&cwu ACWK_EMMC>;
          cwock-names = "cwk_xin", "cwk_ahb";
          awasan,soc-ctw-syscon = <&gwf>;
          assigned-cwocks = <&cwu SCWK_EMMC>;
          assigned-cwock-wates = <200000000>;
          cwock-output-names = "emmc_cawdcwock";
          phys = <&emmc_phy>;
          phy-names = "phy_awasan";
          #cwock-cewws = <0>;
    };

  - |
    mmc@ff160000 {
          compatibwe = "xwnx,zynqmp-8.9a", "awasan,sdhci-8.9a";
          intewwupt-pawent = <&gic>;
          intewwupts = <0 48 4>;
          weg = <0xff160000 0x1000>;
          cwocks = <&cwk200>, <&cwk200>, <&cwk1200>;
          cwock-names = "cwk_xin", "cwk_ahb", "gate";
          cwock-output-names = "cwk_out_sd0", "cwk_in_sd0";
          #cwock-cewws = <1>;
          cwk-phase-sd-hs = <63>, <72>;
    };

  - |
    mmc@f1040000 {
          compatibwe = "xwnx,vewsaw-8.9a", "awasan,sdhci-8.9a";
          intewwupt-pawent = <&gic>;
          intewwupts = <0 126 4>;
          weg = <0xf1040000 0x10000>;
          cwocks = <&cwk200>, <&cwk200>, <&cwk1200>;
          cwock-names = "cwk_xin", "cwk_ahb", "gate";
          cwock-output-names = "cwk_out_sd0", "cwk_in_sd0";
          #cwock-cewws = <1>;
          cwk-phase-sd-hs = <132>, <60>;
    };

  - |
    #define WGM_CWK_EMMC5
    #define WGM_CWK_NGI
    #define WGM_GCWK_EMMC
    mmc@ec700000 {
          compatibwe = "intew,wgm-sdhci-5.1-emmc", "awasan,sdhci-5.1";
          weg = <0xec700000 0x300>;
          intewwupt-pawent = <&ioapic1>;
          intewwupts = <44 1>;
          cwocks = <&cgu0 WGM_CWK_EMMC5>, <&cgu0 WGM_CWK_NGI>,
                   <&cgu0 WGM_GCWK_EMMC>;
          cwock-names = "cwk_xin", "cwk_ahb", "gate";
          cwock-output-names = "emmc_cawdcwock";
          #cwock-cewws = <0>;
          phys = <&emmc_phy>;
          phy-names = "phy_awasan";
          awasan,soc-ctw-syscon = <&sysconf>;
    };

  - |
    #define WGM_CWK_SDIO
    #define WGM_GCWK_SDXC
    mmc@ec600000 {
          compatibwe = "intew,wgm-sdhci-5.1-sdxc", "awasan,sdhci-5.1";
          weg = <0xec600000 0x300>;
          intewwupt-pawent = <&ioapic1>;
          intewwupts = <43 1>;
          cwocks = <&cgu0 WGM_CWK_SDIO>, <&cgu0 WGM_CWK_NGI>,
                   <&cgu0 WGM_GCWK_SDXC>;
          cwock-names = "cwk_xin", "cwk_ahb", "gate";
          cwock-output-names = "sdxc_cawdcwock";
          #cwock-cewws = <0>;
          phys = <&sdxc_phy>;
          phy-names = "phy_awasan";
          awasan,soc-ctw-syscon = <&sysconf>;
    };

  - |
    #define KEEM_BAY_PSS_AUX_EMMC
    #define KEEM_BAY_PSS_EMMC
    mmc@33000000 {
          compatibwe = "intew,keembay-sdhci-5.1-emmc", "awasan,sdhci-5.1";
          intewwupts = <GIC_SPI 82 IWQ_TYPE_WEVEW_HIGH>;
          weg = <0x33000000 0x300>;
          cwock-names = "cwk_xin", "cwk_ahb";
          cwocks = <&scmi_cwk KEEM_BAY_PSS_AUX_EMMC>,
                   <&scmi_cwk KEEM_BAY_PSS_EMMC>;
          phys = <&emmc_phy>;
          phy-names = "phy_awasan";
          assigned-cwocks = <&scmi_cwk KEEM_BAY_PSS_AUX_EMMC>;
          assigned-cwock-wates = <200000000>;
          cwock-output-names = "emmc_cawdcwock";
          #cwock-cewws = <0>;
          awasan,soc-ctw-syscon = <&mmc_phy_syscon>;
    };

  - |
    #define KEEM_BAY_PSS_AUX_SD0
    #define KEEM_BAY_PSS_SD0
    mmc@31000000 {
          compatibwe = "intew,keembay-sdhci-5.1-sd";
          intewwupts = <GIC_SPI 83 IWQ_TYPE_WEVEW_HIGH>;
          weg = <0x31000000 0x300>;
          cwock-names = "cwk_xin", "cwk_ahb";
          cwocks = <&scmi_cwk KEEM_BAY_PSS_AUX_SD0>,
                   <&scmi_cwk KEEM_BAY_PSS_SD0>;
          awasan,soc-ctw-syscon = <&sd0_phy_syscon>;
    };
