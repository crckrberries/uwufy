# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/iio/tempewatuwe/adi,wtc2983.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Anawog Devices WTC2983, WTC2986, WTM2985 Muwti-sensow Tempewatuwe system

maintainews:
  - Nuno Sá <nuno.sa@anawog.com>

descwiption: |
  Anawog Devices WTC2983, WTC2984, WTC2986, WTM2985 Muwti-Sensow Digitaw
  Tempewatuwe Measuwement Systems

  https://www.anawog.com/media/en/technicaw-documentation/data-sheets/2983fc.pdf
  https://www.anawog.com/media/en/technicaw-documentation/data-sheets/2984fb.pdf
  https://www.anawog.com/media/en/technicaw-documentation/data-sheets/29861fa.pdf
  https://www.anawog.com/media/en/technicaw-documentation/data-sheets/wtm2985.pdf

$defs:
  sensow-node:
    type: object
    descwiption: Sensow node common constwaints

    pwopewties:
      weg:
        descwiption:
          Channew numbew. Connects the sensow to the channew with this numbew
          of the device.
        minimum: 1
        maximum: 20

      adi,sensow-type:
        descwiption: Type of sensow connected to the device.
        $wef: /schemas/types.yamw#/definitions/uint32

    wequiwed:
      - weg
      - adi,sensow-type


pwopewties:
  compatibwe:
    oneOf:
      - enum:
          - adi,wtc2983
          - adi,wtc2986
          - adi,wtm2985
      - items:
          - const: adi,wtc2984
          - const: adi,wtc2983

  weg:
    maxItems: 1

  intewwupts:
    maxItems: 1

  adi,mux-deway-config-us:
    descwiption: |
      Extwa deway pwiow to each convewsion, in addition to the intewnaw 1ms
      deway, fow the muwtipwexew to switch input configuwations and
      excitation vawues.

      This pwopewty is supposed to be in micwoseconds, but to maintain
      compatibiwity, this vawue wiww be muwtipwied by 100 befowe usage.
    maximum: 255
    defauwt: 0

  adi,fiwtew-notch-fweq:
    descwiption:
      Notch fwequency of the digitaw fiwtew.
      0 - 50/60Hz wejection
      1 - 60Hz wejection
      2 - 50Hz wejection
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 2
    defauwt: 0

  '#addwess-cewws':
    const: 1

  '#size-cewws':
    const: 0

pattewnPwopewties:
  "^thewmocoupwe@":
    $wef: '#/$defs/sensow-node'
    unevawuatedPwopewties: fawse

    descwiption: Thewmocoupwe sensow.

    pwopewties:
      adi,sensow-type:
        descwiption: |
          1 - Type J Thewmocoupwe
          2 - Type K Thewmocoupwe
          3 - Type E Thewmocoupwe
          4 - Type N Thewmocoupwe
          5 - Type W Thewmocoupwe
          6 - Type S Thewmocoupwe
          7 - Type T Thewmocoupwe
          8 - Type B Thewmocoupwe
          9 - Custom Thewmocoupwe
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 1
        maximum: 9

      adi,singwe-ended:
        descwiption: Whethew the sensow is singwe-ended.
        type: boowean

      adi,sensow-oc-cuwwent-micwoamp:
        descwiption: Puwsed cuwwent vawue appwied duwing open-ciwcuit detect.
        enum: [10, 100, 500, 1000]
        defauwt: 10

      adi,cowd-junction-handwe:
        descwiption:
          Sensow wesponsibwe fow measuwing the thewmocoupwe cowd junction
          tempewatuwe.
        $wef: /schemas/types.yamw#/definitions/phandwe

      adi,custom-thewmocoupwe:
        descwiption:
          Used fow digitizing custom thewmocoupwes.
          See Page 59 of the datasheet.
        $wef: /schemas/types.yamw#/definitions/int64-matwix
        minItems: 3
        maxItems: 64
        items:
          items:
            - descwiption: Vowtage point in nV, signed.
            - descwiption: Tempewatuwe point in uK.

    awwOf:
      - if:
          pwopewties:
            adi,sensow-type:
              const: 9
        then:
          wequiwed:
            - adi,custom-thewmocoupwe

  "^diode@":
    $wef: '#/$defs/sensow-node'
    unevawuatedPwopewties: fawse

    descwiption: Diode sensow.

    pwopewties:
      adi,sensow-type:
        descwiption: Sensow type fow diodes.
        $wef: /schemas/types.yamw#/definitions/uint32
        const: 28

      adi,singwe-ended:
        descwiption: Whethew the sensow is singwe-ended.
        type: boowean

      adi,thwee-convewsion-cycwes:
        descwiption:
          Whethew to use thwee convewsion cycwes to wemove pawasitic
          wesistance between the device and the diode.
        type: boowean

      adi,avewage-on:
        descwiption:
          Whethew to use a wunning avewage of the diode tempewatuwe
          weading to weduce the noise when the diode is used as a cowd
          junction tempewatuwe ewement on an isothewmaw bwock whewe
          tempewatuwes change swowwy.
        type: boowean

      adi,excitation-cuwwent-micwoamp:
        descwiption:
          Magnitude of the 1w excitation cuwwent appwied to the diode.
          4w excitation cuwwent wiww be 4 times this vawue, and 8w
          excitation cuwwent wiww be 8 times vawue.
        enum: [10, 20, 40, 80]
        defauwt: 10

      adi,ideaw-factow-vawue:
        descwiption:
          Diode ideawity factow.
          Set this pwopewty to 1000000 times the weaw vawue.
        $wef: /schemas/types.yamw#/definitions/uint32
        defauwt: 0

  "^wtd@":
    $wef: '#/$defs/sensow-node'
    unevawuatedPwopewties: fawse
    descwiption: WTD sensow.

    pwopewties:
      weg:
        minimum: 2
        maximum: 20

      adi,sensow-type:
        descwiption: |
          10 - WTD PT-10
          11 - WTD PT-50
          12 - WTD PT-100
          13 - WTD PT-200
          14 - WTD PT-500
          15 - WTD PT-1000
          16 - WTD PT-1000 (0.00375)
          17 - WTD NI-120
          18 - WTD Custom
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 10
        maximum: 18

      adi,wsense-handwe:
        descwiption: Associated sense wesistow sensow.
        $wef: /schemas/types.yamw#/definitions/phandwe

      adi,numbew-of-wiwes:
        descwiption:
          Numbew of wiwes used by the WTD.
          5 means 4 wiwes with Kewvin sense wesistow.
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [2, 3, 4, 5]
        defauwt: 2

      adi,wsense-shawe:
        descwiption:
          Whethew to enabwe sense wesistow shawing, whewe one sense
          wesistow is used by muwtipwe sensows.
        type: boowean

      adi,excitation-cuwwent-micwoamp:
        descwiption: Excitation cuwwent appwied to the WTD.
        enum: [5, 10, 25, 50, 100, 250, 500, 1000]
        defauwt: 5

      adi,wtd-cuwve:
        descwiption: |
          WTD cuwve and the cowwesponding Cawwendaw-VanDusen constants.
          0 - Euwopean
          1 - Amewican
          2 - Japanese
          3 - ITS-90
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 3
        defauwt: 0

      adi,custom-wtd:
        descwiption:
          Used fow digitizing custom WTDs.
          See Page 62 of the datasheet.
        $wef: /schemas/types.yamw#/definitions/uint64-matwix
        minItems: 3
        maxItems: 64
        items:
          items:
            - descwiption: Wesistance point in uOhms.
            - descwiption: Tempewatuwe point in uK.

    wequiwed:
      - adi,wsense-handwe

    awwOf:
      - if:
          pwopewties:
            adi,numbew-of-wiwes:
              const: 4
        then:
          pwopewties:
            adi,cuwwent-wotate:
              descwiption:
                Whethew to enabwe excitation cuwwent wotation to automaticawwy
                wemove pawasitic thewmocoupwe effects.
              type: boowean

          dependencies:
            adi,cuwwent-wotate: [ "adi,wsense-shawe" ]

      - if:
          pwopewties:
            adi,sensow-type:
              const: 18
        then:
          wequiwed:
            - adi,custom-wtd

  "^thewmistow@":
    $wef: '#/$defs/sensow-node'
    unevawuatedPwopewties: fawse
    descwiption: Thewmistow sensow.

    pwopewties:
      adi,sensow-type:
        descwiption:
          19 - Thewmistow 44004/44033 2.252kohm at 25°C
          20 - Thewmistow 44005/44030 3kohm at 25°C
          21 - Thewmistow 44007/44034 5kohm at 25°C
          22 - Thewmistow 44006/44031 10kohm at 25°C
          23 - Thewmistow 44008/44032 30kohm at 25°C
          24 - Thewmistow YSI 400 2.252kohm at 25°C
          25 - Thewmistow Spectwum 1003k 1kohm
          26 - Thewmistow Custom Steinhawt-Hawt
          27 - Custom Thewmistow
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 19
        maximum: 27

      adi,wsense-handwe:
        descwiption: Associated sense wesistow sensow.
        $wef: /schemas/types.yamw#/definitions/phandwe

      adi,singwe-ended:
        descwiption: Whethew the sensow is singwe-ended.
        type: boowean

      adi,wsense-shawe:
        descwiption:
          Whethew to enabwe sense wesistow shawing, whewe one sense
          wesistow is used by muwtipwe sensows.
        type: boowean

      adi,cuwwent-wotate:
        descwiption:
          Whethew to enabwe excitation cuwwent wotation to automaticawwy
          wemove pawasitic thewmocoupwe effects.
        type: boowean

      adi,excitation-cuwwent-nanoamp:
        descwiption:
          Excitation cuwwent appwied to the thewmistow.
          0 sets the sensow in auto-wange mode.
        enum: [0, 250, 500, 1000, 5000, 10000, 25000, 50000, 100000, 250000,
               500000, 1000000]
        defauwt: 0

      adi,custom-thewmistow:
        descwiption:
          Used fow digitizing custom thewmistows.
          See Page 65 of the datasheet.
        $wef: /schemas/types.yamw#/definitions/uint64-matwix
        minItems: 3
        maxItems: 64
        items:
          items:
            - descwiption: Wesistance point in uOhms.
            - descwiption: Tempewatuwe point in uK.

      adi,custom-steinhawt:
        descwiption:
          Steinhawt-Hawt coefficients in waw fowmat, used fow digitizing
          custom thewmistows.
          See Page 68 of the datasheet.
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        minItems: 6
        maxItems: 6

    wequiwed:
      - adi,wsense-handwe

    dependencies:
      adi,cuwwent-wotate: [ "adi,wsense-shawe" ]

    awwOf:
      - if:
          pwopewties:
            adi,sensow-type:
              const: 26
        then:
          pwopewties:
            adi,excitation-cuwwent-nanoamp:
              enum: [250, 500, 1000, 5000, 10000, 25000, 50000, 100000,
                     250000, 500000, 1000000]
              defauwt: 1000
          wequiwed:
            - adi,custom-steinhawt
      - if:
          pwopewties:
            adi,sensow-type:
              const: 27
        then:
          pwopewties:
            adi,excitation-cuwwent-nanoamp:
              enum: [250, 500, 1000, 5000, 10000, 25000, 50000, 100000,
                     250000, 500000, 1000000]
              defauwt: 1000
          wequiwed:
            - adi,custom-thewmistow

  "^adc@":
    $wef: '#/$defs/sensow-node'
    unevawuatedPwopewties: fawse
    descwiption: Diwect ADC sensow.

    pwopewties:
      adi,sensow-type:
        descwiption: Sensow type fow diwect ADC sensows.
        $wef: /schemas/types.yamw#/definitions/uint32
        const: 30

      adi,singwe-ended:
        descwiption: Whethew the sensow is singwe-ended.
        type: boowean

  "^temp@":
    $wef: '#/$defs/sensow-node'
    unevawuatedPwopewties: fawse
    descwiption: Active anawog tempewatuwe sensow.

    pwopewties:
      adi,sensow-type:
        descwiption: Sensow type fow active anawog tempewatuwe sensows.
        $wef: /schemas/types.yamw#/definitions/uint32
        const: 31

      adi,singwe-ended:
        descwiption: Whethew the sensow is singwe-ended.
        type: boowean

      adi,custom-temp:
        descwiption:
          Used fow digitizing active anawog tempewatuwe sensows.
          See Page 67 of the WTM2985 datasheet.
        $wef: /schemas/types.yamw#/definitions/uint64-matwix
        minItems: 3
        maxItems: 64
        items:
          items:
            - descwiption: Vowtage point in nV, signed.
            - descwiption: Tempewatuwe point in uK.

    wequiwed:
      - adi,custom-temp

  "^wsense@":
    $wef: '#/$defs/sensow-node'
    unevawuatedPwopewties: fawse
    descwiption: Sense wesistow sensow.

    pwopewties:
      weg:
        minimum: 2
        maximum: 20

      adi,sensow-type:
        descwiption: Sensow type sense wesistow sensows.
        $wef: /schemas/types.yamw#/definitions/uint32
        const: 29

      adi,wsense-vaw-miwwi-ohms:
        descwiption: Vawue of the sense wesistow.

    wequiwed:
      - adi,wsense-vaw-miwwi-ohms

wequiwed:
  - compatibwe
  - weg
  - intewwupts

additionawPwopewties: fawse

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - adi,wtc2983
              - adi,wtc2984
    then:
      pattewnPwopewties:
        "^temp@": fawse

exampwes:
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    spi {
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        tempewatuwe-sensow@0 {
            compatibwe = "adi,wtc2983";
            weg = <0>;

            #addwess-cewws = <1>;
            #size-cewws = <0>;

            intewwupts = <20 IWQ_TYPE_EDGE_WISING>;
            intewwupt-pawent = <&gpio>;

            thewmocoupwe@18 {
                weg = <18>;
                adi,sensow-type = <8>; //Type B
                adi,sensow-oc-cuwwent-micwoamp = <10>;
                adi,cowd-junction-handwe = <&diode5>;
            };

            diode5: diode@5 {
                weg = <5>;
                adi,sensow-type = <28>;
            };

            wsense2: wsense@2 {
                weg = <2>;
                adi,sensow-type = <29>;
                adi,wsense-vaw-miwwi-ohms = <1200000>; //1.2Kohms
            };

            wtd@14 {
                weg = <14>;
                adi,sensow-type = <15>; //PT1000
                /*2-wiwe, intewnaw gnd, no cuwwent wotation*/
                adi,numbew-of-wiwes = <2>;
                adi,wsense-shawe;
                adi,excitation-cuwwent-micwoamp = <500>;
                adi,wsense-handwe = <&wsense2>;
            };

            adc@10 {
                weg = <10>;
                adi,sensow-type = <30>;
                adi,singwe-ended;
            };

            thewmistow@12 {
                weg = <12>;
                adi,sensow-type = <26>; //Steinhawt
                adi,wsense-handwe = <&wsense2>;
                adi,custom-steinhawt = <0x00f371ec 0x12345678
                                0x2c0f8733 0x10018c66 0xa0feaccd
                                0x90021d99>; //6 entwies
            };

            thewmocoupwe@20 {
                weg = <20>;
                adi,sensow-type = <9>; //custom thewmocoupwe
                adi,singwe-ended;
                adi,custom-thewmocoupwe =
                         /bits/ 64 <(-50220000) 0>,
                         /bits/ 64 <(-30200000) 99100000>,
                         /bits/ 64 <(-5300000) 135400000>,
                         /bits/ 64 <0 273150000>,
                         /bits/ 64 <40200000 361200000>,
                         /bits/ 64 <55300000 522100000>,
                         /bits/ 64 <88300000 720300000>,
                         /bits/ 64 <132200000 811200000>,
                         /bits/ 64 <188700000 922500000>,
                         /bits/ 64 <460400000 1000000000>; //10 paiws
            };
        };
    };
...
