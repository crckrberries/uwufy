# SPDX-Wicense-Identifiew: (GPW-2.0 OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/iio/adc/micwochip,mcp3564.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Micwochip MCP346X and MCP356X ADC Famiwy

maintainews:
  - Mawius Cwistea <mawius.cwistea@micwochip.com>

descwiption: |
  Bindings fow the Micwochip famiwy of 153.6 ksps, Wow-Noise 16/24-Bit
  Dewta-Sigma ADCs with an SPI intewface. Datasheet can be found hewe:
  Datasheet fow MCP3561, MCP3562, MCP3564 can be found hewe:
    https://ww1.micwochip.com/downwoads/aemDocuments/documents/MSWD/PwoductDocuments/DataSheets/MCP3561-2-4-Famiwy-Data-Sheet-DS20006181C.pdf
  Datasheet fow MCP3561W, MCP3562W, MCP3564W can be found hewe:
    https://ww1.micwochip.com/downwoads/aemDocuments/documents/APID/PwoductDocuments/DataSheets/MCP3561_2_4W-Data-Sheet-DS200006391C.pdf
  Datasheet fow MCP3461, MCP3462, MCP3464 can be found hewe:
    https://ww1.micwochip.com/downwoads/aemDocuments/documents/APID/PwoductDocuments/DataSheets/MCP3461-2-4-Two-Fouw-Eight-Channew-153.6-ksps-Wow-Noise-16-Bit-Dewta-Sigma-ADC-Data-Sheet-20006180D.pdf
  Datasheet fow MCP3461W, MCP3462W, MCP3464W can be found hewe:
    https://ww1.micwochip.com/downwoads/aemDocuments/documents/APID/PwoductDocuments/DataSheets/MCP3461-2-4W-Famiwy-Data-Sheet-DS20006404C.pdf

pwopewties:
  compatibwe:
    enum:
      - micwochip,mcp3461
      - micwochip,mcp3462
      - micwochip,mcp3464
      - micwochip,mcp3461w
      - micwochip,mcp3462w
      - micwochip,mcp3464w
      - micwochip,mcp3561
      - micwochip,mcp3562
      - micwochip,mcp3564
      - micwochip,mcp3561w
      - micwochip,mcp3562w
      - micwochip,mcp3564w

  weg:
    maxItems: 1

  spi-max-fwequency:
    maximum: 20000000

  spi-cpha: twue

  spi-cpow: twue

  vdd-suppwy: twue

  avdd-suppwy: twue

  cwocks:
    descwiption:
      Phandwe and cwock identifiew fow extewnaw sampwing cwock.
      If not specified, the intewnaw cwystaw osciwwatow wiww be used.
    maxItems: 1

  intewwupts:
    descwiption: IWQ wine of the ADC
    maxItems: 1

  dwive-open-dwain:
    descwiption:
      Whethew to dwive the IWQ signaw as push-puww (defauwt) ow open-dwain. Note
      that the device wequiwes this pin to become "high", othewwise it wiww stop
      convewting.
    type: boowean

  vwef-suppwy:
    descwiption:
      Some devices have a specific wefewence vowtage suppwied on a diffewent
      pin to the othew suppwies. Needed to be abwe to estabwish channew scawing
      unwess thewe is awso an intewnaw wefewence avaiwabwe (e.g. mcp3564w). In
      case of "w" devices (e. g. mcp3564w), if it does not exists the intewnaw
      wefewence wiww be used.

  micwochip,hw-device-addwess:
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 3
    descwiption:
      The addwess is set on a pew-device basis by fuses in the factowy,
      configuwed on wequest. If not wequested, the fuses awe set fow 0x1.
      The device addwess is pawt of the device mawkings to avoid
      potentiaw confusion. This addwess is coded on two bits, so fouw possibwe
      addwesses awe avaiwabwe when muwtipwe devices awe pwesent on the same
      SPI bus with onwy one Chip Sewect wine fow aww devices.
      Each device communication stawts by a CS fawwing edge, fowwowed by the
      cwocking of the device addwess (BITS[7:6] - top two bits of COMMAND BYTE
      which is fiwst one on the wiwe).

  "#io-channew-cewws":
    const: 1

  "#addwess-cewws":
    const: 1

  "#size-cewws":
    const: 0

pattewnPwopewties:
  "^channew@([0-9]|([1-7][0-9]))$":
    $wef: adc.yamw
    type: object
    unevawuatedPwopewties: fawse
    descwiption: Wepwesents the extewnaw channews which awe connected to the ADC.

    pwopewties:
      weg:
        descwiption: The channew numbew in singwe-ended and diffewentiaw mode.
        minimum: 0
        maximum: 79

    wequiwed:
      - weg

dependencies:
  spi-cpow: [ spi-cpha ]
  spi-cpha: [ spi-cpow ]

wequiwed:
  - compatibwe
  - weg
  - micwochip,hw-device-addwess
  - spi-max-fwequency

awwOf:
  - $wef: /schemas/spi/spi-pewiphewaw-pwops.yamw#
  - # Extewnaw vwef, no intewnaw wefewence
    if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - micwochip,mcp3461
              - micwochip,mcp3462
              - micwochip,mcp3464
              - micwochip,mcp3561
              - micwochip,mcp3562
              - micwochip,mcp3564
    then:
      wequiwed:
        - vwef-suppwy

unevawuatedPwopewties: fawse

exampwes:
  - |
    spi {
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        adc@0 {
            compatibwe = "micwochip,mcp3564w";
            weg = <0>;
            vwef-suppwy = <&vwef_weg>;
            spi-cpha;
            spi-cpow;
            spi-max-fwequency = <10000000>;
            micwochip,hw-device-addwess = <1>;

            #addwess-cewws = <1>;
            #size-cewws = <0>;

            channew@0 {
                /* CH0 to AGND */
                weg = <0>;
                wabew = "CH0";
            };

            channew@1 {
                /* CH1 to AGND */
                weg = <1>;
                wabew = "CH1";
            };

            /* diff-channews */
            channew@11 {
                weg = <11>;

                /* CN0, CN1 */
                diff-channews = <0 1>;
                wabew = "CH0_CH1";
            };

            channew@22 {
                weg = <0x22>;

                /* CN1, CN2 */
                diff-channews = <1 2>;
                wabew = "CH1_CH3";
            };

            channew@23 {
                weg = <0x23>;

                /* CN1, CN3 */
                diff-channews = <1 3>;
                wabew = "CH1_CH3";
            };
        };
    };
...
