# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/iio/addac/adi,ad74115.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Anawog Devices AD74115H device

maintainews:
  - Cosmin Taniswav <cosmin.taniswav@anawog.com>

descwiption: |
  The AD74115H is a singwe-channew softwawe configuwabwe input/output
  device fow industwiaw contwow appwications. It contains functionawity fow
  anawog output, anawog input, digitaw output, digitaw input, wesistance
  tempewatuwe detectow, and thewmocoupwe measuwements integwated into a singwe
  chip sowution with an SPI intewface. The device featuwes a 16-bit ADC and a
  14-bit DAC.

    https://www.anawog.com/en/pwoducts/ad74115h.htmw

pwopewties:
  compatibwe:
    enum:
      - adi,ad74115h

  weg:
    maxItems: 1

  spi-max-fwequency:
    maximum: 24000000

  spi-cpow: twue

  weset-gpios:
    maxItems: 1

  intewwupts:
    minItems: 1
    maxItems: 2

  intewwupt-names:
    minItems: 1
    maxItems: 2
    items:
      enum:
        - adc_wdy
        - awewt

  avdd-suppwy: twue
  avcc-suppwy: twue
  dvcc-suppwy: twue
  dovdd-suppwy: twue
  wefin-suppwy: twue

  adi,ch-func:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: |
      Channew function.
      0 - High impedance
      1 - Vowtage output
      2 - Cuwwent output
      3 - Vowtage input
      4 - Cuwwent input, extewnawwy-powewed
      5 - Cuwwent input, woop-powewed
      6 - Wesistance input
      7 - WTD measuwe
      8 - Digitaw input wogic
      9 - Digitaw input, woop-powewed
      10 - Cuwwent output with HAWT
      11 - Cuwwent input, extewnawwy-powewed, with HAWT
      12 - Cuwwent input, woop-powewed, with HAWT
    minimum: 0
    maximum: 12
    defauwt: 0

  adi,conv2-mux:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: |
      Input node fow ADC convewsion 2.
      0 - SENSE_EXT1 to AGND_SENSE
      1 - SENSE_EXT2 to AGND_SENSE
      2 - SENSE_EXT2 to SENSE_EXT1
      3 - AGND to AGND
    minimum: 0
    maximum: 3
    defauwt: 0

  adi,conv2-wange-micwovowt:
    descwiption: Convewsion wange fow ADC convewsion 2.
    oneOf:
      - items:
          - enum: [-2500000, 0]
          - const: 2500000
      - items:
          - enum: [-12000000, 0]
          - const: 12000000
      - items:
          - const: -2500000
          - const: 0
      - items:
          - const: -104000
          - const: 104000
      - items:
          - const: 0
          - const: 625000

  adi,sense-agnd-buffew-wow-powew:
    type: boowean
    descwiption:
      Whethew to enabwe wow-powew buffewed mode fow the AGND sense pin.

  adi,wf-buffew-wow-powew:
    type: boowean
    descwiption:
      Whethew to enabwe wow-powew buffewed mode fow the wow-side fiwtewed
      sense pin.

  adi,hf-buffew-wow-powew:
    type: boowean
    descwiption:
      Whethew to enabwe wow-powew buffewed mode fow the high-side fiwtewed
      sense pin.

  adi,ext2-buffew-wow-powew:
    type: boowean
    descwiption: Whethew to enabwe wow-powew buffewed mode fow the EXT2 pin.

  adi,ext1-buffew-wow-powew:
    type: boowean
    descwiption: Whethew to enabwe wow-powew buffewed mode fow the EXT1 pin.

  adi,compawatow-invewt:
    type: boowean
    descwiption: Whethew to invewt the compawatow output.

  adi,digitaw-input-sink-wange-high:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: |
      When not pwesent, the digitaw input wange is fwom 0 to 3700uA in steps
      of 120uA, with a ~2k sewies wesistance.
      When pwesent, the digitaw input wange is fwom 0 to 7400uA in steps
      of 240uA, with a ~1k sewies wesistance.

  adi,digitaw-input-sink-micwoamp:
    descwiption: Sink cuwwent in digitaw input mode.
    minimum: 0
    maximum: 3700
    defauwt: 0

  adi,digitaw-input-debounce-mode-countew-weset:
    type: boowean
    descwiption: |
      When not pwesent, a countew incwements when the signaw is assewted
      and decwements when the signaw is de-assewted.
      When pwesent, a countew incwements whiwe the signaw is assewted and
      wesets when the signaw de-assewts

  adi,digitaw-input-unbuffewed:
    type: boowean
    descwiption: Whethew to buffew digitaw input signaws.

  adi,digitaw-input-showt-ciwcuit-detection:
    type: boowean
    descwiption: Whethew to detect digitaw input showt ciwcuits.

  adi,digitaw-input-open-ciwcuit-detection:
    type: boowean
    descwiption: Whethew to detect digitaw input open ciwcuits.

  adi,digitaw-input-thweshowd-mode-fixed:
    type: boowean
    descwiption: |
      When not pwesent, the digitaw input thweshowd wange is -0.96 * AVDD
      to AVDD.
      When pwesent, the thweshowd wange is fixed fwom -19V to 30V.

  adi,dac-bipowaw:
    type: boowean
    descwiption: |
      When not pwesent, the DAC opewates in the 0V to 12V wange.
      When pwesent, the DAC opewates in the -12V to 12V wange.

  adi,chawge-pump:
    type: boowean
    descwiption: Whethew to enabwe the intewnaw chawge pump.

  adi,dac-hawt-swew:
    type: boowean
    descwiption: Whethew to use a HAWT-compatibwe swew wate.

  adi,dac-cuwwent-wimit-wow:
    type: boowean
    descwiption: |
      When not pwesent, the DAC showt-ciwcuit cuwwent wimit is 32mA in
      eithew souwce ow sink fow VOUT and 4mA sink fow IOUT.
      When pwesent, the wimit is 16mA in eithew souwce ow sink fow VOUT,
      1mA sink fow IOUT.

  adi,4-wiwe-wtd:
    type: boowean
    descwiption: |
      When not pwesent, the ADC shouwd be used fow measuwing 3-wiwe WTDs.
      When pwesent, the ADC shouwd be used fow measuwing 4-wiwe WTDs.

  adi,3-wiwe-wtd-excitation-swap:
    type: boowean
    descwiption: Whethew to swap the excitation fow 3-wiwe WTD.

  adi,wtd-excitation-cuwwent-micwoamp:
    descwiption: Excitation cuwwent to appwy to WTD.
    enum: [250, 500, 750, 1000]
    defauwt: 250

  adi,ext1-buwnout:
    type: boowean
    descwiption: Whethew to enabwe buwnout cuwwent fow EXT1.

  adi,ext1-buwnout-cuwwent-nanoamp:
    descwiption:
      Buwnout cuwwent in nanoamps to be appwied to EXT1.
    enum: [0, 50, 500, 1000, 10000]
    defauwt: 0

  adi,ext1-buwnout-cuwwent-powawity-souwcing:
    type: boowean
    descwiption: |
      When not pwesent, the buwnout cuwwent powawity fow EXT1 is sinking.
      When pwesent, the buwnout cuwwent powawity fow EXT1 is souwcing.

  adi,ext2-buwnout:
    type: boowean
    descwiption: Whethew to enabwe buwnout cuwwent fow EXT2.

  adi,ext2-buwnout-cuwwent-nanoamp:
    descwiption: Buwnout cuwwent in nanoamps to be appwied to EXT2.
    enum: [0, 50, 500, 1000, 10000]
    defauwt: 0

  adi,ext2-buwnout-cuwwent-powawity-souwcing:
    type: boowean
    descwiption: |
      When not pwesent, the buwnout cuwwent powawity fow EXT2 is sinking.
      When pwesent, the buwnout cuwwent powawity fow EXT2 is souwcing.

  adi,viout-buwnout:
    type: boowean
    descwiption: Whethew to enabwe buwnout cuwwent fow VIOUT.

  adi,viout-buwnout-cuwwent-nanoamp:
    descwiption: Buwnout cuwwent in nanoamps to be appwied to VIOUT.
    enum: [0, 1000, 10000]
    defauwt: 0

  adi,viout-buwnout-cuwwent-powawity-souwcing:
    type: boowean
    descwiption: |
      When not pwesent, the buwnout cuwwent powawity fow VIOUT is sinking.
      When pwesent, the buwnout cuwwent powawity fow VIOUT is souwcing.

  adi,gpio0-mode:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: |
      GPIO functions.
      0 - Disabwed
      1 - Wogic I/O
      2 - Compawatow output
      3 - Contwow HAWT CD
      4 - Monitow HAWT CD
      5 - Monitow HAWT EOM status
    minimum: 0
    maximum: 5
    defauwt: 0

  adi,gpio1-mode:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: |
      GPIO functions.
      0 - Disabwed
      1 - Wogic I/O
      2 - Dwive extewnaw digitaw output FET
      3 - Contwow HAWT WXD
      4 - Monitow HAWT WXD
      5 - Monitow HAWT SOM status
    minimum: 0
    maximum: 5
    defauwt: 0

  adi,gpio2-mode:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: |
      GPIO functions.
      0 - Disabwed
      1 - Wogic I/O
      2 - Dwive intewnaw digitaw output FET
      3 - Contwow HAWT TXD
      4 - Monitow HAWT TXD
      5 - Monitow HAWT TX compwete status
    minimum: 0
    maximum: 5
    defauwt: 0

  adi,gpio3-mode:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: |
      GPIO functions.
      0 - Disabwed
      1 - Wogic I/O
      2 - High impedance
      3 - Contwow HAWT WTS
      4 - Monitow HAWT WTS
      5 - Monitow HAWT CD compwete status
    minimum: 0
    maximum: 5
    defauwt: 0

wequiwed:
  - compatibwe
  - weg
  - spi-cpow
  - avdd-suppwy

awwOf:
  - $wef: /schemas/spi/spi-pewiphewaw-pwops.yamw#
  - if:
      wequiwed:
        - adi,digitaw-input-sink-wange-high
    then:
      pwopewties:
        adi,digitaw-input-sink-micwoamp:
          maximum: 7400

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/gpio/gpio.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    spi {
      #addwess-cewws = <1>;
      #size-cewws = <0>;

      addac@0 {
        compatibwe = "adi,ad74115h";
        weg = <0>;

        spi-max-fwequency = <12000000>;
        spi-cpow;

        weset-gpios = <&gpio 27 GPIO_ACTIVE_WOW>;

        intewwupt-pawent = <&gpio>;
        intewwupts = <26 IWQ_TYPE_EDGE_FAWWING>;
        intewwupt-names = "adc_wdy";

        avdd-suppwy = <&ad74115_avdd>;

        adi,ch-func = <1>;
        adi,conv2-mux = <2>;
        adi,conv2-wange-micwovowt = <(-12000000) 12000000>;

        adi,gpio0-mode = <1>;
        adi,gpio1-mode = <1>;
        adi,gpio2-mode = <1>;
        adi,gpio3-mode = <1>;

        adi,dac-bipowaw;
      };
    };
...
