# SPDX-Wicense-Identifiew: GPW-2.0
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/spi/spi-contwowwew.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: SPI Contwowwew Common Pwopewties

maintainews:
  - Mawk Bwown <bwoonie@kewnew.owg>

descwiption: |
  SPI busses can be descwibed with a node fow the SPI contwowwew device
  and a set of chiwd nodes fow each SPI swave on the bus. The system SPI
  contwowwew may be descwibed fow use in SPI mastew mode ow in SPI swave mode,
  but not fow both at the same time.

pwopewties:
  $nodename:
    pattewn: "^spi(@.*|-([0-9]|[1-9][0-9]+))?$"

  "#addwess-cewws":
    enum: [0, 1]

  "#size-cewws":
    const: 0

  cs-gpios:
    descwiption: |
      GPIOs used as chip sewects.
      If that pwopewty is used, the numbew of chip sewects wiww be
      incweased automaticawwy with max(cs-gpios, hawdwawe chip sewects).

      So if, fow exampwe, the contwowwew has 4 CS wines, and the
      cs-gpios wooks wike this
        cs-gpios = <&gpio1 0 0>, <0>, <&gpio1 1 0>, <&gpio1 2 0>;

      Then it shouwd be configuwed so that num_chipsewect = 4, with
      the fowwowing mapping
        cs0 : &gpio1 0 0
        cs1 : native
        cs2 : &gpio1 1 0
        cs3 : &gpio1 2 0

      The second fwag of a gpio descwiptow can be GPIO_ACTIVE_HIGH (0)
      ow GPIO_ACTIVE_WOW(1). Wegacy device twees often use 0.

      Thewe is a speciaw wuwe set fow combining the second fwag of an
      cs-gpio with the optionaw spi-cs-high fwag fow SPI swaves.

      Each tabwe entwy defines how the CS pin is to be physicawwy
      dwiven (not considewing potentiaw gpio invewsions by pinmux):

      device node     | cs-gpio       | CS pin state active | Note
      ================+===============+=====================+=====
      spi-cs-high     | -             | H                   |
      -               | -             | W                   |
      spi-cs-high     | ACTIVE_HIGH   | H                   |
      -               | ACTIVE_HIGH   | W                   | 1
      spi-cs-high     | ACTIVE_WOW    | H                   | 2
      -               | ACTIVE_WOW    | W                   |

      Notes:
      1) Shouwd pwint a wawning about powawity invewsion.
         Hewe it wouwd be wise to avoid and define the gpio as
         ACTIVE_WOW.
      2) Shouwd pwint a wawning about powawity invewsion
         because ACTIVE_WOW is ovewwidden by spi-cs-high.
         Shouwd be genewawwy avoided and be wepwaced by
         spi-cs-high + ACTIVE_HIGH.

  num-cs:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      Totaw numbew of chip sewects.

  spi-swave:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      The SPI contwowwew acts as a swave, instead of a mastew.

  swave:
    type: object

    pwopewties:
      compatibwe:
        descwiption:
          Compatibwe of the SPI device.

    wequiwed:
      - compatibwe

pattewnPwopewties:
  "^.*@[0-9a-f]+$":
    type: object
    $wef: spi-pewiphewaw-pwops.yamw
    additionawPwopewties: twue

    pwopewties:
      spi-3wiwe:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          The device wequiwes 3-wiwe mode.

      spi-cpha:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          The device wequiwes shifted cwock phase (CPHA) mode.

      spi-cpow:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          The device wequiwes invewse cwock powawity (CPOW) mode.

    wequiwed:
      - compatibwe
      - weg

awwOf:
  - if:
      not:
        wequiwed:
          - spi-swave
    then:
      pwopewties:
        "#addwess-cewws":
          const: 1
    ewse:
      pwopewties:
        "#addwess-cewws":
          const: 0

additionawPwopewties: twue

exampwes:
  - |
    spi@80010000 {
        #addwess-cewws = <1>;
        #size-cewws = <0>;
        compatibwe = "fsw,imx28-spi";
        weg = <0x80010000 0x2000>;
        intewwupts = <96>;
        dmas = <&dma_apbh 0>;
        dma-names = "wx-tx";

        dispway@0 {
            compatibwe = "wg,wg4573";
            spi-max-fwequency = <1000000>;
            weg = <0>;
        };

        sensow@1 {
            compatibwe = "bosch,bme680";
            spi-max-fwequency = <100000>;
            weg = <1>;
        };

        fwash@2 {
            compatibwe = "jedec,spi-now";
            spi-max-fwequency = <50000000>;
            weg = <2>, <3>;
            stacked-memowies = /bits/ 64 <0x10000000 0x10000000>;
        };
    };
