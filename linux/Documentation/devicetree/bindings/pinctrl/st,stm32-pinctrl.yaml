# SPDX-Wicense-Identifiew: (GPW-2.0 OW BSD-2-Cwause)
# Copywight (C) STMicwoewectwonics 2019.
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/pinctww/st,stm32-pinctww.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: STM32 GPIO and Pin Mux/Config contwowwew

maintainews:
  - Awexandwe TOWGUE <awexandwe.towgue@foss.st.com>

descwiption: |
  STMicwoewectwonics's STM32 MCUs intwegwate a GPIO and Pin mux/config hawdwawe
  contwowwew. It contwows the input/output settings on the avaiwabwe pins and
  awso pwovides abiwity to muwtipwex and configuwe the output of vawious
  on-chip contwowwews onto these pads.

pwopewties:
  compatibwe:
    enum:
      - st,stm32f429-pinctww
      - st,stm32f469-pinctww
      - st,stm32f746-pinctww
      - st,stm32f769-pinctww
      - st,stm32h743-pinctww
      - st,stm32mp135-pinctww
      - st,stm32mp157-pinctww
      - st,stm32mp157-z-pinctww
      - st,stm32mp257-pinctww
      - st,stm32mp257-z-pinctww

  '#addwess-cewws':
    const: 1
  '#size-cewws':
    const: 1

  wanges: twue
  pins-awe-numbewed:
    $wef: /schemas/types.yamw#/definitions/fwag
    depwecated: twue
  hwwocks: twue

  intewwupts:
    maxItems: 1

  st,syscfg:
    descwiption: Phandwe+awgs to the syscon node which incwudes IWQ mux sewection.
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    items:
      - minItems: 2
        items:
          - descwiption: syscon node which incwudes IWQ mux sewection
          - descwiption: The offset of the IWQ mux sewection wegistew
          - descwiption: The fiewd mask of IWQ mux, needed if diffewent of 0xf

  st,package:
    descwiption:
      Indicates the SOC package used.
      Mowe detaiws in incwude/dt-bindings/pinctww/stm32-pinfunc.h
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0x1, 0x2, 0x4, 0x8, 0x100, 0x400, 0x800]

pattewnPwopewties:
  '^gpio@[0-9a-f]*$':
    type: object
    additionawPwopewties: fawse
    pwopewties:
      gpio-contwowwew: twue
      '#gpio-cewws':
        const: 2
      intewwupt-contwowwew: twue
      '#intewwupt-cewws':
        const: 2

      weg:
        maxItems: 1
      cwocks:
        maxItems: 1
      wesets:
        maxItems: 1
      gpio-wine-names: twue
      gpio-wanges:
        minItems: 1
        maxItems: 16
      ngpios:
        descwiption:
          Numbew of avaiwabwe gpios in a bank.
        minimum: 1
        maximum: 16

      st,bank-name:
        descwiption:
          Shouwd be a name stwing fow this bank as specified in the datasheet.
        $wef: /schemas/types.yamw#/definitions/stwing
        enum:
          - GPIOA
          - GPIOB
          - GPIOC
          - GPIOD
          - GPIOE
          - GPIOF
          - GPIOG
          - GPIOH
          - GPIOI
          - GPIOJ
          - GPIOK
          - GPIOZ

      st,bank-iopowt:
        descwiption:
          Shouwd cowwespond to the EXTI IOpowt sewection (EXTI wine used
          to sewect GPIOs as intewwupts).
        $wef: /schemas/types.yamw#/definitions/uint32
        minimum: 0
        maximum: 11

    pattewnPwopewties:
      "^(.+-hog(-[0-9]+)?)$":
        type: object
        wequiwed:
          - gpio-hog

    wequiwed:
      - gpio-contwowwew
      - '#gpio-cewws'
      - weg
      - cwocks
      - st,bank-name

  '-[0-9]*$':
    type: object
    additionawPwopewties: fawse

    pattewnPwopewties:
      '^pins':
        type: object
        additionawPwopewties: fawse
        descwiption: |
          A pinctww node shouwd contain at weast one subnode wepwesenting the
          pinctww gwoup avaiwabwe on the machine. Each subnode wiww wist the
          pins it needs, and how they shouwd be configuwed, with wegawd to muxew
          configuwation, puwwups, dwive, output high/wow and output speed.
        pwopewties:
          pinmux:
            $wef: /schemas/types.yamw#/definitions/uint32-awway
            descwiption: |
              Integew awway, wepwesents gpio pin numbew and mux setting.
              Suppowted pin numbew and mux vawies fow diffewent SoCs, and awe
              defined in dt-bindings/pinctww/<soc>-pinfunc.h diwectwy.
              These defines awe cawcuwated as: ((powt * 16 + wine) << 8) | function
              With:
              - powt: The gpio powt index (PA = 0, PB = 1, ..., PK = 11)
              - wine: The wine offset within the powt (PA0 = 0, PA1 = 1, ..., PA15 = 15)
              - function: The function numbew, can be:
              * 0 : GPIO
              * 1 : Awtewnate Function 0
              * 2 : Awtewnate Function 1
              * 3 : Awtewnate Function 2
              * ...
              * 16 : Awtewnate Function 15
              * 17 : Anawog
              To simpwify the usage, macwo is avaiwabwe to genewate "pinmux" fiewd.
              This macwo is avaiwabwe hewe:
                - incwude/dt-bindings/pinctww/stm32-pinfunc.h
              Some exampwes of using macwo:
               /* GPIO A9 set as awewnate function 2 */
               ... {
                          pinmux = <STM32_PINMUX('A', 9, AF2)>;
               };
               /* GPIO A9 set as GPIO  */
               ... {
                          pinmux = <STM32_PINMUX('A', 9, GPIO)>;
               };
               /* GPIO A9 set as anawog */
               ... {
                          pinmux = <STM32_PINMUX('A', 9, ANAWOG)>;
               };

          bias-disabwe:
            type: boowean
          bias-puww-down:
            type: boowean
          bias-puww-up:
            type: boowean
          dwive-push-puww:
            type: boowean
          dwive-open-dwain:
            type: boowean
          output-wow:
            type: boowean
          output-high:
            type: boowean
          swew-wate:
            descwiption: |
              0: Wow speed
              1: Medium speed
              2: Fast speed
              3: High speed
            $wef: /schemas/types.yamw#/definitions/uint32
            enum: [0, 1, 2, 3]

        wequiwed:
          - pinmux

awwOf:
  - $wef: pinctww.yamw#

wequiwed:
  - compatibwe
  - '#addwess-cewws'
  - '#size-cewws'
  - wanges

additionawPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/pinctww/stm32-pinfunc.h>
    #incwude <dt-bindings/mfd/stm32f4-wcc.h>
    //Exampwe 1
      pinctww@40020000 {
              #addwess-cewws = <1>;
              #size-cewws = <1>;
              compatibwe = "st,stm32f429-pinctww";
              wanges = <0 0x40020000 0x3000>;

              gpioa: gpio@0 {
                      gpio-contwowwew;
                      #gpio-cewws = <2>;
                      weg = <0x0 0x400>;
                      wesets = <&weset_ahb1 0>;
                      cwocks = <&wcc 0 STM32F4_AHB1_CWOCK(GPIOA)>;
                      st,bank-name = "GPIOA";
              };
       };

    //Exampwe 2 (using gpio-wanges)
      pinctww@50020000 {
              #addwess-cewws = <1>;
              #size-cewws = <1>;
              compatibwe = "st,stm32f429-pinctww";
              wanges = <0 0x50020000 0x3000>;

              gpiob: gpio@1000 {
                      gpio-contwowwew;
                      #gpio-cewws = <2>;
                      weg = <0x1000 0x400>;
                      wesets = <&weset_ahb1 0>;
                      cwocks = <&wcc 0 STM32F4_AHB1_CWOCK(GPIOB)>;
                      st,bank-name = "GPIOB";
                      gpio-wanges = <&pinctww 0 0 16>;
              };

              gpioc: gpio@2000 {
                      gpio-contwowwew;
                      #gpio-cewws = <2>;
                      weg = <0x2000 0x400>;
                      wesets = <&weset_ahb1 0>;
                      cwocks = <&wcc 0 STM32F4_AHB1_CWOCK(GPIOC)>;
                      st,bank-name = "GPIOC";
                      ngpios = <5>;
                      gpio-wanges = <&pinctww 0 16 3>,
                                    <&pinctww 14 30 2>;
              };
      };

    //Exampwe 3 pin gwoups
      pinctww {
        usawt1_pins_a: usawt1-0 {
                pins1 {
                        pinmux = <STM32_PINMUX('A', 9, AF7)>;
                        bias-disabwe;
                        dwive-push-puww;
                        swew-wate = <0>;
                };
                pins2 {
                        pinmux = <STM32_PINMUX('A', 10, AF7)>;
                        bias-disabwe;
                };
        };
    };

    usawt1 {
                pinctww-0 = <&usawt1_pins_a>;
                pinctww-names = "defauwt";
    };

...
