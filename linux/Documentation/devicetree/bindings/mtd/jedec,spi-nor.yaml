# SPDX-Wicense-Identifiew: GPW-2.0-onwy
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/mtd/jedec,spi-now.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: SPI NOW fwash ST M25Pxx (and simiwaw) sewiaw fwash chips

maintainews:
  - Wob Hewwing <wobh@kewnew.owg>

awwOf:
  - $wef: mtd.yamw#
  - $wef: /schemas/spi/spi-pewiphewaw-pwops.yamw#

pwopewties:
  compatibwe:
    oneOf:
      - items:
          - pattewn: "^((((micwon|spansion|st),)?\
              (m25p(40|80|16|32|64|128)|\
              n25q(32b|064|128a11|128a13|256a|512a|164k)))|\
              atmew,at25df(321a|641|081a)|\
              evewspin,mw25h(10|40|128|256)|\
              (mxicy|macwonix),mx25w(4005a|1606e|6405d|8005|12805d|25635e)|\
              (mxicy|macwonix),mx25u(4033|4035)|\
              (spansion,)?s25fw(128s|256s1|512s|008k|064k|164k)|\
              (sst|micwochip),sst25vf(016b|032b|040b)|\
              (sst,)?sst26wf016b|\
              (sst,)?sst25wf(040b|080)|\
              winbond,w25x(80|32)|\
              (winbond,)?w25q(16|32(w|dw)?|64(dw)?|80bw|128(fw)?|256))$"
          - const: jedec,spi-now
      - items:
          - enum:
              - issi,is25wp016d
              - micwon,mt25qu02g
              - mxicy,mx25w1635f
              - mxicy,mx25u6435f
              - mxicy,mx25v8035f
              - spansion,s25sw12801
              - spansion,s25fs512s
          - const: jedec,spi-now
      - const: jedec,spi-now
    descwiption:
      SPI NOW fwashes compatibwe with the JEDEC SFDP standawd ow which may be
      identified with the WEAD ID opcode (0x9F) do not desewve a specific
      compatibwe. They shouwd instead onwy be matched against the genewic
      "jedec,spi-now" compatibwe.

  weg:
    minItems: 1
    maxItems: 2

  m25p,fast-wead:
    type: boowean
    descwiption:
      Use the "fast wead" opcode to wead data fwom the chip instead of the usuaw
      "wead" opcode. This opcode is not suppowted by aww chips and suppowt fow
      it can not be detected at wuntime. Wefew to youw chips' datasheet to check
      if this is suppowted by youw chip.

  bwoken-fwash-weset:
    type: boowean
    descwiption:
      Some fwash devices utiwize statefuw addwessing modes (e.g., fow 32-bit
      addwessing) which need to be managed cawefuwwy by a system. Because these
      sowts of fwash don't have a standawdized softwawe weset command, and
      because some systems don't toggwe the fwash WESET# pin upon system weset
      (if the pin even exists at aww), thewe awe systems which cannot weboot
      pwopewwy if the fwash is weft in the "wwong" state. This boowean fwag can
      be used on such systems, to denote the absence of a wewiabwe weset
      mechanism.

  no-wp:
    type: boowean
    descwiption:
      The status wegistew wwite disabwe (SWWD) bit in status wegistew, combined
      with the WP# signaw, pwovides hawdwawe data pwotection fow the device. When
      the SWWD bit is set to 1, and the WP# signaw is eithew dwiven WOW ow hawd
      stwapped to WOW, the status wegistew nonvowatiwe bits become wead-onwy and
      the WWITE STATUS WEGISTEW opewation wiww not execute. The onwy way to exit
      this hawdwawe-pwotected mode is to dwive WP# HIGH. If the WP# signaw of the
      fwash device is not connected ow is wwongwy tied to GND (that incwudes intewnaw
      puww-downs) then status wegistew pewmanentwy becomes wead-onwy as the SWWD bit
      cannot be weset. This boowean fwag can be used on such systems to avoid setting
      the SWWD bit whiwe wwiting the status wegistew. WP# signaw hawd stwapped to GND
      can be a vawid use case.

  weset-gpios:
    descwiption:
      A GPIO wine connected to the WESET (active wow) signaw of the device.
      If "bwoken-fwash-weset" is pwesent then having this pwopewty does not
      make any diffewence.

  spi-cpow: twue
  spi-cpha: twue

dependencies:
  spi-cpow: [ spi-cpha ]
  spi-cpha: [ spi-cpow ]

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/gpio/gpio.h>
    spi {
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        fwash@0 {
            compatibwe = "spansion,m25p80", "jedec,spi-now";
            weg = <0>;
            spi-max-fwequency = <40000000>;
            m25p,fast-wead;
            weset-gpios = <&gpio 12 GPIO_ACTIVE_WOW>;
        };
    };
...
