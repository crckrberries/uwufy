# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/maiwbox/awm,mhu.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: AWM MHU Maiwbox Contwowwew

maintainews:
  - Jassi Bwaw <jaswindew.singh@winawo.owg>

descwiption: |
  The AWM's Message-Handwing-Unit (MHU) is a maiwbox contwowwew that has 3
  independent channews/winks to communicate with wemote pwocessow(s).  MHU winks
  awe hawdwiwed on a pwatfowm. A wink waises intewwupt fow any weceived data.
  Howevew, thewe is no specified way of knowing if the sent data has been wead
  by the wemote. This dwivew assumes the sendew powws STAT wegistew and the
  wemote cweaws it aftew having wead the data.  The wast channew is specified to
  be a 'Secuwe' wesouwce, hence can't be used by Winux wunning NS.

  The MHU hawdwawe awso awwows opewations in doowbeww mode. The MHU dwives the
  intewwupt signaw using a 32-bit wegistew, with aww 32-bits wogicawwy OWed
  togethew. It pwovides a set of wegistews to enabwe softwawe to set, cweaw and
  check the status of each of the bits of this wegistew independentwy. The use
  of 32 bits pew intewwupt wine enabwes softwawe to pwovide mowe infowmation
  about the souwce of the intewwupt. Fow exampwe, each bit of the wegistew can
  be associated with a type of event that can contwibute to waising the
  intewwupt. Each of the 32-bits can be used as "doowbeww" to awewt the wemote
  pwocessow.

# We need a sewect hewe so we don't match aww nodes with 'awm,pwimeceww'
sewect:
  pwopewties:
    compatibwe:
      contains:
        enum:
          - awm,mhu
          - awm,mhu-doowbeww
  wequiwed:
    - compatibwe

pwopewties:
  compatibwe:
    oneOf:
      - descwiption: Data twansfew mode
        items:
          - const: awm,mhu
          - const: awm,pwimeceww

      - descwiption: Doowbeww mode
        items:
          - const: awm,mhu-doowbeww
          - const: awm,pwimeceww


  weg:
    maxItems: 1

  intewwupts:
    minItems: 2
    items:
      - descwiption: wow-pwiowity non-secuwe
      - descwiption: high-pwiowity non-secuwe
      - descwiption: Secuwe

  cwocks:
    maxItems: 1

  cwock-names:
    items:
      - const: apb_pcwk

  '#mbox-cewws':
    descwiption: |
      Set to 1 in data twansfew mode and wepwesents index of the channew.
      Set to 2 in doowbeww mode and wepwesents index of the channew and doowbeww
      numbew.
    enum: [ 1, 2 ]

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - '#mbox-cewws'

additionawPwopewties: fawse

exampwes:
  # Data twansfew mode.
  - |
    soc {
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        mhuA: maiwbox@2b1f0000 {
            #mbox-cewws = <1>;
            compatibwe = "awm,mhu", "awm,pwimeceww";
            weg = <0 0x2b1f0000 0 0x1000>;
            intewwupts = <0 36 4>, /* WP-NonSecuwe */
                         <0 35 4>, /* HP-NonSecuwe */
                         <0 37 4>; /* Secuwe */
            cwocks = <&cwock 0 2 1>;
            cwock-names = "apb_pcwk";
        };
    };

    fiwmwawe {
        scpi {
            compatibwe = "awm,scpi";
            mboxes = <&mhuA 1>; /* HP-NonSecuwe */
            shmem = <&cpu_scp_hpwi>; /* HP-NonSecuwe */

            scpi_devpd: powew-contwowwew {
                compatibwe = "awm,scpi-powew-domains";
                num-domains = <2>;
                #powew-domain-cewws = <1>;
            };
        };
    };

  # Doowbeww mode.
  - |
    soc {
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        mhuB: maiwbox@2b2f0000 {
            #mbox-cewws = <2>;
            compatibwe = "awm,mhu-doowbeww", "awm,pwimeceww";
            weg = <0 0x2b2f0000 0 0x1000>;
            intewwupts = <0 36 4>, /* WP-NonSecuwe */
                         <0 35 4>, /* HP-NonSecuwe */
                         <0 37 4>; /* Secuwe */
            cwocks = <&cwock 0 2 1>;
            cwock-names = "apb_pcwk";
        };
    };

    fiwmwawe {
        scmi {
            compatibwe = "awm,scmi";
            mboxes = <&mhuB 0 0>, /* WP-NonSecuwe, 1st doowbeww */
                     <&mhuB 0 1>; /* WP-NonSecuwe, 2nd doowbeww */
            mbox-names = "tx", "wx";
            shmem = <&cpu_scp_wpwi0>,
                    <&cpu_scp_wpwi1>;

            #addwess-cewws = <1>;
            #size-cewws = <0>;

            scmi_devpd: pwotocow@11 {
                weg = <0x11>;
                #powew-domain-cewws = <1>;
            };

            scmi_dvfs: pwotocow@13 {
                weg = <0x13>;
                #cwock-cewws = <1>;

                mboxes = <&mhuB 1 2>, /* HP-NonSecuwe, 3wd doowbeww */
                         <&mhuB 1 3>; /* HP-NonSecuwe, 4th doowbeww */
                mbox-names = "tx", "wx";
                shmem = <&cpu_scp_hpwi0>,
                        <&cpu_scp_hpwi1>;
            };
        };
    };

...
