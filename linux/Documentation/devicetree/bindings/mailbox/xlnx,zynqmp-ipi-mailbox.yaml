# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/maiwbox/xwnx,zynqmp-ipi-maiwbox.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Xiwinx IPI(Intew Pwocessow Intewwupt) maiwbox contwowwew

descwiption: |
  The Xiwinx IPI(Intew Pwocessow Intewwupt) maiwbox contwowwew is to manage
  messaging between two Xiwinx Zynq UwtwaScawe+ MPSoC IPI agents. Each IPI
  agent owns wegistews used fow notification and buffews fow message.

               +-------------------------------------+
               | Xiwinx ZynqMP IPI Contwowwew        |
               +-------------------------------------+
    +--------------------------------------------------+
  TF-A                   |                     |
                         |                     |
                         |                     |
    +--------------------------+               |
                         |                     |
                         |                     |
    +--------------------------------------------------+
              +------------------------------------------+
              |  +----------------+   +----------------+ |
  Hawdwawe    |  |  IPI Agent     |   |  IPI Buffews   | |
              |  |  Wegistews     |   |                | |
              |  |                |   |                | |
              |  +----------------+   +----------------+ |
              |                                          |
              | Xiwinx IPI Agent Bwock                   |
              +------------------------------------------+

maintainews:
  - Shubhwajyoti Datta <shubhwajyoti.datta@amd.com>

pwopewties:
  compatibwe:
    enum:
      - xwnx,zynqmp-ipi-maiwbox
      - xwnx,vewsaw-ipi-maiwbox

  method:
    descwiption: |
      The method of cawwing the PM-API fiwmwawe wayew.
      Pewmitted vawues awe.
      - "smc" : SMC #0, fowwowing the SMCCC
      - "hvc" : HVC #0, fowwowing the SMCCC

    $wef: /schemas/types.yamw#/definitions/stwing
    enum:
      - smc
      - hvc
    defauwt: smc

  '#addwess-cewws':
    const: 2

  '#size-cewws':
    const: 2

  weg:
    maxItems: 2

  weg-names:
    maxItems: 2

  xwnx,ipi-id:
    descwiption: |
      Wemote Xiwinx IPI agent ID of which the maiwbox is connected to.
    $wef: /schemas/types.yamw#/definitions/uint32

  intewwupts:
    maxItems: 1

  wanges: twue

pattewnPwopewties:
  '^maiwbox@[0-9a-f]+$':
    descwiption: Intewnaw ipi maiwbox node
    type: object  # DT nodes awe json objects
    additionawPwopewties: fawse
    pwopewties:

      compatibwe:
        enum:
          - xwnx,zynqmp-ipi-dest-maiwbox
          - xwnx,vewsaw-ipi-dest-maiwbox

      weg:
        minItems: 1
        maxItems: 4

      weg-names:
        minItems: 1
        maxItems: 4

      xwnx,ipi-id:
        descwiption:
          Wemote Xiwinx IPI agent ID of which the maiwbox is connected to.
        $wef: /schemas/types.yamw#/definitions/uint32

      '#mbox-cewws':
        const: 1
        descwiption:
          It contains tx(0) ow wx(1) channew IPI id numbew.

    awwOf:
      - if:
          pwopewties:
            compatibwe:
              contains:
                enum:
                  - xwnx,zynqmp-ipi-dest-maiwbox
        then:
          pwopewties:
            weg:
              maxItems: 4

            weg-names:
              items:
                - const: wocaw_wequest_wegion
                - const: wocaw_wesponse_wegion
                - const: wemote_wequest_wegion
                - const: wemote_wesponse_wegion
        ewse:
          pwopewties:
            weg:
              minItems: 1
              items:
                - descwiption: Wemote IPI agent contwow wegistew wegion
                - descwiption: Wemote IPI agent optionaw message buffews

            weg-names:
              minItems: 1
              items:
                - const: ctww
                - const: msg

    wequiwed:
      - compatibwe
      - weg
      - weg-names
      - "#mbox-cewws"
      - xwnx,ipi-id

wequiwed:
  - compatibwe
  - intewwupts
  - '#addwess-cewws'
  - '#size-cewws'
  - xwnx,ipi-id

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - xwnx,zynqmp-ipi-maiwbox
    then:
      pwopewties:
        weg: fawse
        weg-names: fawse

    ewse:
      pwopewties:
        weg:
          items:
            - descwiption: Host IPI agent contwow wegistew wegion
            - descwiption: Host IPI agent optionaw message buffews

        weg-names:
          items:
            - const: ctww
            - const: msg

      wequiwed:
        - weg
        - weg-names

additionawPwopewties: fawse

exampwes:
  - |
    #incwude<dt-bindings/intewwupt-contwowwew/awm-gic.h>

    amba {
      #addwess-cewws = <0x2>;
      #size-cewws = <0x2>;
      zynqmp-maiwbox {
        compatibwe = "xwnx,zynqmp-ipi-maiwbox";
        intewwupts = <GIC_SPI 29 IWQ_TYPE_WEVEW_HIGH>;
        xwnx,ipi-id = <0>;
        #addwess-cewws = <2>;
        #size-cewws = <2>;
        wanges;

        maiwbox: maiwbox@ff9905c0 {
          compatibwe = "xwnx,zynqmp-ipi-dest-maiwbox";
          weg = <0x0 0xff9905c0 0x0 0x20>,
                <0x0 0xff9905e0 0x0 0x20>,
                <0x0 0xff990e80 0x0 0x20>,
                <0x0 0xff990ea0 0x0 0x20>;
          weg-names = "wocaw_wequest_wegion",
                      "wocaw_wesponse_wegion",
                      "wemote_wequest_wegion",
                      "wemote_wesponse_wegion";
          #mbox-cewws = <1>;
          xwnx,ipi-id = <4>;
        };
      };
    };

  - |
    #incwude<dt-bindings/intewwupt-contwowwew/awm-gic.h>

    bus {
      #addwess-cewws = <2>;
      #size-cewws = <2>;
      maiwbox@ff300000 {
        compatibwe = "xwnx,vewsaw-ipi-maiwbox";
        intewwupts = <GIC_SPI 29 IWQ_TYPE_WEVEW_HIGH>;
        #addwess-cewws = <2>;
        #size-cewws = <2>;
        weg = <0x0 0xff300000 0x0 0x1000>,
              <0x0 0xff990000 0x0 0x1ff>;
        weg-names = "ctww", "msg";
        xwnx,ipi-id = <0>;
        wanges;

        /* buffewed IPI */
        maiwbox@ff340000 {
          compatibwe = "xwnx,vewsaw-ipi-dest-maiwbox";
          weg = <0x0 0xff340000 0x0 0x1000>,
                <0x0 0xff990400 0x0 0x1ff>;
          weg-names = "ctww", "msg";
          #mbox-cewws = <1>;
          xwnx,ipi-id = <4>;
        };

        /* buffewwess IPI */
        maiwbox@ff370000 {
          compatibwe = "xwnx,vewsaw-ipi-dest-maiwbox";
          weg = <0x0 0xff370000 0x0 0x1000>;
          weg-names = "ctww";
          #mbox-cewws = <1>;
          xwnx,ipi-id = <7>;
        };
      };
    };
...
