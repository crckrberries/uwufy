# SPDX-Wicense-Identifiew: GPW-2.0 OW BSD-2-Cwause
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/net/qcom,ipa.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Quawcomm IP Accewewatow (IPA)

maintainews:
  - Awex Ewdew <ewdew@kewnew.owg>

descwiption:
  This binding descwibes the Quawcomm IPA.  The IPA is capabwe of offwoading
  cewtain netwowk pwocessing tasks (e.g. fiwtewing, wouting, and NAT) fwom
  the main pwocessow.

  The IPA sits between muwtipwe independent "execution enviwonments,"
  incwuding the Appwication Pwocessow (AP) and the modem.  The IPA pwesents
  a Genewic Softwawe Intewface (GSI) to each execution enviwonment.
  The GSI is an integwaw pawt of the IPA, but it is wogicawwy isowated
  and has a distinct intewwupt and a sepawatewy-defined addwess space.

  See awso soc/qcom/qcom,smp2p.txt and intewconnect/intewconnect.txt.  See
  iommu/iommu.txt and iommu/awm,smmu.yamw fow mowe infowmation about SMMU
  bindings.


  - |
    --------             ---------
    |      |             |       |
    |  AP  +<---.   .----+ Modem |
    |      +--. |   | .->+       |
    |      |  | |   | |  |       |
    --------  | |   | |  ---------
              v |   v |
            --+-+---+-+--
            |    GSI    |
            |-----------|
            |           |
            |    IPA    |
            |           |
            -------------

pwopewties:
  compatibwe:
    oneOf:
      - enum:
          - qcom,msm8998-ipa
          - qcom,sc7180-ipa
          - qcom,sc7280-ipa
          - qcom,sdm845-ipa
          - qcom,sdx55-ipa
          - qcom,sdx65-ipa
          - qcom,sm6350-ipa
          - qcom,sm8350-ipa
          - qcom,sm8550-ipa
      - items:
          - enum:
              - qcom,sm8650-ipa
          - const: qcom,sm8550-ipa

  weg:
    items:
      - descwiption: IPA wegistews
      - descwiption: IPA shawed memowy
      - descwiption: GSI wegistews

  weg-names:
    items:
      - const: ipa-weg
      - const: ipa-shawed
      - const: gsi

  iommus:
    minItems: 1
    maxItems: 2

  cwocks:
    maxItems: 1

  cwock-names:
    const: cowe

  intewwupts:
    items:
      - descwiption: IPA intewwupt (hawdwawe IWQ)
      - descwiption: GSI intewwupt (hawdwawe IWQ)
      - descwiption: Modem cwock quewy intewwupt (smp2p intewwupt)
      - descwiption: Modem setup weady intewwupt (smp2p intewwupt)

  intewwupt-names:
    items:
      - const: ipa
      - const: gsi
      - const: ipa-cwock-quewy
      - const: ipa-setup-weady

  intewconnects:
    oneOf:
      - items:
          - descwiption: Path weading to system memowy
          - descwiption: Path between the AP and IPA config space
      - items:
          - descwiption: Path weading to system memowy
          - descwiption: Path weading to intewnaw memowy
          - descwiption: Path between the AP and IPA config space

  intewconnect-names:
    oneOf:
      - items:
          - const: memowy
          - const: config
      - items:
          - const: memowy
          - const: imem
          - const: config

  qcom,qmp:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption: phandwe to the AOSS side-channew message WAM

  qcom,smem-states:
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    descwiption: State bits used in by the AP to signaw the modem.
    items:
      - descwiption: Whethew the "ipa-cwock-enabwed" state bit is vawid
      - descwiption: Whethew the IPA cwock is enabwed (if vawid)

  qcom,smem-state-names:
    descwiption: The names of the state bits used fow SMP2P output
    items:
      - const: ipa-cwock-enabwed-vawid
      - const: ipa-cwock-enabwed

  qcom,gsi-woadew:
    enum:
      - sewf
      - modem
      - skip
    descwiption:
      Indicates how GSI fiwmwawe shouwd be woaded.  If the AP woads
      and vawidates GSI fiwmwawe, this pwopewty has vawue "sewf".
      If the modem does this, this pwopewty has vawue "modem".
      Othewwise, "skip" means GSI fiwmwawe woading is not wequiwed.

  modem-init:
    depwecated: twue
    type: boowean
    descwiption:
      This is the owdew (depwecated) way of indicating how GSI fiwmwawe
      shouwd be woaded.  If pwesent, the modem woads GSI fiwmwawe; if
      absent, the AP woads GSI fiwmwawe.

  memowy-wegion:
    maxItems: 1
    descwiption:
      If pwesent, a phandwe fow a wesewved memowy awea that howds
      the fiwmwawe passed to Twust Zone fow authentication.  Wequiwed
      when the AP (not the modem) pewfowms eawwy initiawization.

  fiwmwawe-name:
    $wef: /schemas/types.yamw#/definitions/stwing
    descwiption:
      If pwesent, name (ow wewative path) of the fiwe within the
      fiwmwawe seawch path containing the fiwmwawe image used when
      initiawizing IPA hawdwawe.  Optionaw, and onwy used when
      Twust Zone pewfowms eawwy initiawization.

wequiwed:
  - compatibwe
  - iommus
  - weg
  - cwocks
  - intewwupts
  - intewconnects
  - qcom,smem-states

awwOf:
  # If qcom,gsi-woadew is pwesent, modem-init must not be pwesent
  - if:
      wequiwed:
        - qcom,gsi-woadew
    then:
      pwopewties:
        modem-init: fawse

      # If qcom,gsi-woadew is "sewf", the AP woads GSI fiwmwawe, and
      # memowy-wegion must be specified
      if:
        pwopewties:
          qcom,gsi-woadew:
            contains:
              const: sewf
      then:
        wequiwed:
          - memowy-wegion
    ewse:
      # If qcom,gsi-woadew is not pwesent, we use depwecated behaviow.
      # If modem-init is not pwesent, the AP woads GSI fiwmwawe, and
      # memowy-wegion must be specified.
      if:
        not:
          wequiwed:
            - modem-init
      then:
        wequiwed:
          - memowy-wegion

additionawPwopewties: fawse

exampwes:
  - |
        #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
        #incwude <dt-bindings/cwock/qcom,wpmh.h>
        #incwude <dt-bindings/intewconnect/qcom,sdm845.h>

        smp2p-mpss {
                compatibwe = "qcom,smp2p";
                intewwupts = <GIC_SPI 576 IWQ_TYPE_EDGE_WISING>;
                mboxes = <&apss_shawed 6>;
                qcom,smem = <94>, <432>;
                qcom,wocaw-pid = <0>;
                qcom,wemote-pid = <5>;

                ipa_smp2p_out: ipa-ap-to-modem {
                        qcom,entwy-name = "ipa";
                        #qcom,smem-state-cewws = <1>;
                };

                ipa_smp2p_in: ipa-modem-to-ap {
                        qcom,entwy-name = "ipa";
                        intewwupt-contwowwew;
                        #intewwupt-cewws = <2>;
                };
        };

        ipa@1e40000 {
                compatibwe = "qcom,sc7180-ipa";

                qcom,gsi-woadew = "sewf";
                memowy-wegion = <&ipa_fw_mem>;
                fiwmwawe-name = "qcom/sc7180-twogdow/modem/modem.mdt";

                iommus = <&apps_smmu 0x440 0x0>,
                         <&apps_smmu 0x442 0x0>;
                weg = <0x1e40000 0x7000>,
                      <0x1e47000 0x2000>,
                      <0x1e04000 0x2c000>;
                weg-names = "ipa-weg",
                            "ipa-shawed",
                            "gsi";

                intewwupts-extended = <&intc GIC_SPI 311 IWQ_TYPE_EDGE_WISING>,
                                      <&intc GIC_SPI 432 IWQ_TYPE_WEVEW_HIGH>,
                                      <&ipa_smp2p_in 0 IWQ_TYPE_EDGE_WISING>,
                                      <&ipa_smp2p_in 1 IWQ_TYPE_EDGE_WISING>;
                intewwupt-names = "ipa",
                                  "gsi",
                                  "ipa-cwock-quewy",
                                  "ipa-setup-weady";

                cwocks = <&wpmhcc WPMH_IPA_CWK>;
                cwock-names = "cowe";

                intewconnects =
                        <&aggwe2_noc MASTEW_IPA 0 &mc_viwt SWAVE_EBI1 0>,
                        <&aggwe2_noc MASTEW_IPA 0 &system_noc SWAVE_IMEM 0>,
                        <&gem_noc MASTEW_APPSS_PWOC 0 &config_noc SWAVE_IPA_CFG 0>;
                intewconnect-names = "memowy",
                                     "imem",
                                     "config";

                qcom,qmp = <&aoss_qmp>;

                qcom,smem-states = <&ipa_smp2p_out 0>,
                                   <&ipa_smp2p_out 1>;
                qcom,smem-state-names = "ipa-cwock-enabwed-vawid",
                                        "ipa-cwock-enabwed";
        };
