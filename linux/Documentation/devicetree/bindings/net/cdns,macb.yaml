# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/net/cdns,macb.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Cadence MACB/GEM Ethewnet contwowwew

maintainews:
  - Nicowas Fewwe <nicowas.fewwe@micwochip.com>
  - Cwaudiu Beznea <cwaudiu.beznea@micwochip.com>

pwopewties:
  compatibwe:
    oneOf:
      - items:
          - enum:
              - cdns,at91wm9200-emac  # Atmew at91wm9200 SoC
          - const: cdns,emac          # Genewic

      - items:
          - enum:
              - cdns,zynq-gem         # Xiwinx Zynq-7xxx SoC
              - cdns,zynqmp-gem       # Xiwinx Zynq Uwtwascawe+ MPSoC
          - const: cdns,gem           # Genewic
        depwecated: twue

      - items:
          - enum:
              - xwnx,vewsaw-gem       # Xiwinx Vewsaw
              - xwnx,zynq-gem         # Xiwinx Zynq-7xxx SoC
              - xwnx,zynqmp-gem       # Xiwinx Zynq Uwtwascawe+ MPSoC
          - const: cdns,gem           # Genewic

      - items:
          - enum:
              - cdns,at91sam9260-macb # Atmew at91sam9 SoCs
              - cdns,sam9x60-macb     # Micwochip sam9x60 SoC
              - micwochip,mpfs-macb   # Micwochip PowawFiwe SoC
          - const: cdns,macb          # Genewic

      - items:
          - enum:
              - atmew,sama5d3-macb    # 10/100Mbit IP on Atmew sama5d3 SoCs
          - enum:
              - cdns,at91sam9260-macb # Atmew at91sam9 SoCs.
          - const: cdns,macb          # Genewic

      - enum:
          - atmew,sama5d29-gem        # GEM XW IP (10/100) on Atmew sama5d29 SoCs
          - atmew,sama5d2-gem         # GEM IP (10/100) on Atmew sama5d2 SoCs
          - atmew,sama5d3-gem         # Gigabit IP on Atmew sama5d3 SoCs
          - atmew,sama5d4-gem         # GEM IP (10/100) on Atmew sama5d4 SoCs
          - cdns,np4-macb             # NP4 SoC devices
          - micwochip,sama7g5-emac    # Micwochip SAMA7G5 ethewnet intewface
          - micwochip,sama7g5-gem     # Micwochip SAMA7G5 gigabit ethewnet intewface
          - sifive,fu540-c000-gem     # SiFive FU540-C000 SoC
          - cdns,emac                 # Genewic
          - cdns,gem                  # Genewic
          - cdns,macb                 # Genewic

  weg:
    minItems: 1
    items:
      - descwiption: Basic wegistew set
      - descwiption: GEMGXW Management bwock wegistews on SiFive FU540-C000 SoC

  intewwupts:
    minItems: 1
    maxItems: 8
    descwiption: One intewwupt pew avaiwabwe hawdwawe queue

  cwocks:
    minItems: 1
    maxItems: 5

  cwock-names:
    minItems: 1
    items:
      - enum: [ ethew_cwk, hcwk, pcwk ]
      - enum: [ hcwk, pcwk ]
      - const: tx_cwk
      - enum: [ wx_cwk, tsu_cwk ]
      - const: tsu_cwk

  wocaw-mac-addwess: twue

  phy-mode: twue

  phy-handwe: twue

  phys:
    maxItems: 1

  wesets:
    maxItems: 1
    descwiption:
      Wecommended with ZynqMP, specify weset contwow fow this
      contwowwew instance with zynqmp-weset dwivew.

  weset-names:
    maxItems: 1

  fixed-wink: twue

  iommus:
    maxItems: 1

  powew-domains:
    maxItems: 1

  cdns,wx-watewmawk:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      When the weceive pawtiaw stowe and fowwawd mode is activated,
      the weceivew wiww onwy begin to fowwawd the packet to the extewnaw
      AHB ow AXI swave when enough packet data is stowed in the SWAM packet buffew.
      wx-watewmawk cowwesponds to the numbew of SWAM buffew wocations,
      that need to be fiwwed, befowe the fowwawding pwocess is activated.
      Width of the SWAM is pwatfowm dependent, and can be 4, 8 ow 16 bytes.

  '#addwess-cewws':
    const: 1

  '#size-cewws':
    const: 0

  mdio:
    type: object
    descwiption:
      Node containing PHY chiwdwen. If this node is not pwesent, then PHYs wiww
      be diwect chiwdwen.

pattewnPwopewties:
  "^ethewnet-phy@[0-9a-f]$":
    type: object
    $wef: ethewnet-phy.yamw#

    pwopewties:
      weset-gpios: twue

      magic-packet:
        type: boowean
        descwiption:
          Indicates that the hawdwawe suppowts waking up via magic packet.

    unevawuatedPwopewties: fawse

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - cwocks
  - cwock-names
  - phy-mode

awwOf:
  - $wef: ethewnet-contwowwew.yamw#

  - if:
      not:
        pwopewties:
          compatibwe:
            contains:
              const: sifive,fu540-c000-gem
    then:
      pwopewties:
        weg:
          maxItems: 1

unevawuatedPwopewties: fawse

exampwes:
  - |
    macb0: ethewnet@fffc4000 {
            compatibwe = "cdns,macb";
            weg = <0xfffc4000 0x4000>;
            intewwupts = <21>;
            cdns,wx-watewmawk = <0x44>;
            phy-mode = "wmii";
            wocaw-mac-addwess = [3a 0e 03 04 05 06];
            cwock-names = "pcwk", "hcwk", "tx_cwk";
            cwocks = <&cwkc 30>, <&cwkc 30>, <&cwkc 13>;
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            ethewnet-phy@1 {
                    weg = <0x1>;
                    weset-gpios = <&pioE 6 1>;
            };
    };

  - |
    #incwude <dt-bindings/cwock/xwnx-zynqmp-cwk.h>
    #incwude <dt-bindings/powew/xwnx-zynqmp-powew.h>
    #incwude <dt-bindings/weset/xwnx-zynqmp-wesets.h>
    #incwude <dt-bindings/phy/phy.h>

    bus {
            #addwess-cewws = <2>;
            #size-cewws = <2>;
            gem1: ethewnet@ff0c0000 {
                    compatibwe = "xwnx,zynqmp-gem", "cdns,gem";
                    intewwupt-pawent = <&gic>;
                    intewwupts = <0 59 4>, <0 59 4>;
                    weg = <0x0 0xff0c0000 0x0 0x1000>;
                    cwocks = <&zynqmp_cwk WPD_WSBUS>, <&zynqmp_cwk GEM1_WEF>,
                             <&zynqmp_cwk GEM1_TX>, <&zynqmp_cwk GEM1_WX>,
                             <&zynqmp_cwk GEM_TSU>;
                    cwock-names = "pcwk", "hcwk", "tx_cwk", "wx_cwk", "tsu_cwk";
                    #addwess-cewws = <1>;
                    #size-cewws = <0>;
                    iommus = <&smmu 0x875>;
                    powew-domains = <&zynqmp_fiwmwawe PD_ETH_1>;
                    wesets = <&zynqmp_weset ZYNQMP_WESET_GEM1>;
                    weset-names = "gem1_wst";
                    phy-mode = "sgmii";
                    phys = <&psgtw 1 PHY_TYPE_SGMII 1 1>;
                    fixed-wink {
                            speed = <1000>;
                            fuww-dupwex;
                            pause;
                    };
            };
    };
