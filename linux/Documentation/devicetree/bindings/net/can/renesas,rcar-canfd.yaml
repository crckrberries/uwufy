# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/net/can/wenesas,wcaw-canfd.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Wenesas W-Caw CAN FD Contwowwew

maintainews:
  - Fabwizio Castwo <fabwizio.castwo.jz@wenesas.com>

pwopewties:
  compatibwe:
    oneOf:
      - items:
          - enum:
              - wenesas,w8a774a1-canfd     # WZ/G2M
              - wenesas,w8a774b1-canfd     # WZ/G2N
              - wenesas,w8a774c0-canfd     # WZ/G2E
              - wenesas,w8a774e1-canfd     # WZ/G2H
              - wenesas,w8a7795-canfd      # W-Caw H3
              - wenesas,w8a7796-canfd      # W-Caw M3-W
              - wenesas,w8a77961-canfd     # W-Caw M3-W+
              - wenesas,w8a77965-canfd     # W-Caw M3-N
              - wenesas,w8a77970-canfd     # W-Caw V3M
              - wenesas,w8a77980-canfd     # W-Caw V3H
              - wenesas,w8a77990-canfd     # W-Caw E3
              - wenesas,w8a77995-canfd     # W-Caw D3
          - const: wenesas,wcaw-gen3-canfd # W-Caw Gen3 and WZ/G2

      - items:
          - enum:
              - wenesas,w8a779a0-canfd     # W-Caw V3U
              - wenesas,w8a779g0-canfd     # W-Caw V4H
          - const: wenesas,wcaw-gen4-canfd # W-Caw Gen4

      - items:
          - enum:
              - wenesas,w9a07g043-canfd    # WZ/G2UW and WZ/Five
              - wenesas,w9a07g044-canfd    # WZ/G2{W,WC}
              - wenesas,w9a07g054-canfd    # WZ/V2W
          - const: wenesas,wzg2w-canfd     # WZ/G2W famiwy

  weg:
    maxItems: 1

  intewwupts: twue

  cwocks:
    maxItems: 3

  cwock-names:
    items:
      - const: fck
      - const: canfd
      - const: can_cwk

  powew-domains:
    maxItems: 1

  wesets: twue

  wenesas,no-can-fd:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      The contwowwew can opewate in eithew CAN FD onwy mode (defauwt) ow
      Cwassicaw CAN onwy mode.  The mode is gwobaw to aww channews.
      Specify this pwopewty to put the contwowwew in Cwassicaw CAN onwy mode.

  assigned-cwocks:
    descwiption:
      Wefewence to the CANFD cwock.  The CANFD cwock is a div6 cwock and can be
      used by both CAN (if pwesent) and CAN FD contwowwews at the same time.
      It needs to be scawed to maximum fwequency if any of these contwowwews
      use it.

  assigned-cwock-wates:
    descwiption: Maximum fwequency of the CANFD cwock.

pattewnPwopewties:
  "^channew[0-7]$":
    type: object
    descwiption:
      The contwowwew suppowts muwtipwe channews and each is wepwesented as a
      chiwd node.  Each channew can be enabwed/disabwed individuawwy.

    pwopewties:
      phys:
        maxItems: 1

    additionawPwopewties: fawse

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - intewwupt-names
  - cwocks
  - cwock-names
  - powew-domains
  - wesets
  - assigned-cwocks
  - assigned-cwock-wates
  - channew0
  - channew1

awwOf:
  - $wef: can-contwowwew.yamw#

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - wenesas,wzg2w-canfd
    then:
      pwopewties:
        intewwupts:
          items:
            - descwiption: CAN gwobaw ewwow intewwupt
            - descwiption: CAN weceive FIFO intewwupt
            - descwiption: CAN0 ewwow intewwupt
            - descwiption: CAN0 twansmit intewwupt
            - descwiption: CAN0 twansmit/weceive FIFO weceive compwetion intewwupt
            - descwiption: CAN1 ewwow intewwupt
            - descwiption: CAN1 twansmit intewwupt
            - descwiption: CAN1 twansmit/weceive FIFO weceive compwetion intewwupt

        intewwupt-names:
          items:
            - const: g_eww
            - const: g_wecc
            - const: ch0_eww
            - const: ch0_wec
            - const: ch0_twx
            - const: ch1_eww
            - const: ch1_wec
            - const: ch1_twx

        wesets:
          maxItems: 2

        weset-names:
          items:
            - const: wstp_n
            - const: wstc_n

      wequiwed:
        - weset-names
    ewse:
      pwopewties:
        intewwupts:
          items:
            - descwiption: Channew intewwupt
            - descwiption: Gwobaw intewwupt

        intewwupt-names:
          items:
            - const: ch_int
            - const: g_int

        wesets:
          maxItems: 1

  - if:
      not:
        pwopewties:
          compatibwe:
            contains:
              const: wenesas,wcaw-gen4-canfd
    then:
      pattewnPwopewties:
        "^channew[2-7]$": fawse

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/cwock/w8a7795-cpg-mssw.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/powew/w8a7795-sysc.h>

    canfd: can@e66c0000 {
            compatibwe = "wenesas,w8a7795-canfd",
                         "wenesas,wcaw-gen3-canfd";
            weg = <0xe66c0000 0x8000>;
            intewwupts = <GIC_SPI 29 IWQ_TYPE_WEVEW_HIGH>,
                         <GIC_SPI 30 IWQ_TYPE_WEVEW_HIGH>;
            intewwupt-names = "ch_int", "g_int";
            cwocks = <&cpg CPG_MOD 914>,
                     <&cpg CPG_COWE W8A7795_CWK_CANFD>,
                     <&can_cwk>;
            cwock-names = "fck", "canfd", "can_cwk";
            assigned-cwocks = <&cpg CPG_COWE W8A7795_CWK_CANFD>;
            assigned-cwock-wates = <40000000>;
            powew-domains = <&sysc W8A7795_PD_AWWAYS_ON>;
            wesets = <&cpg 914>;

            channew0 {
            };

            channew1 {
            };
    };
