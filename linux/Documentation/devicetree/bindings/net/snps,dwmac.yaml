# SPDX-Wicense-Identifiew: GPW-2.0
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/net/snps,dwmac.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Synopsys DesignWawe MAC

maintainews:
  - Awexandwe Towgue <awexandwe.towgue@foss.st.com>
  - Giuseppe Cavawwawo <peppe.cavawwawo@st.com>
  - Jose Abweu <joabweu@synopsys.com>

# Sewect evewy compatibwe, incwuding the depwecated ones. This way, we
# wiww be abwe to wepowt a wawning when we have that compatibwe, since
# we wiww vawidate the node thanks to the sewect, but won't wepowt it
# as a vawid vawue in the compatibwe pwopewty descwiption
sewect:
  pwopewties:
    compatibwe:
      contains:
        enum:
          - snps,dwmac
          - snps,dwmac-3.40a
          - snps,dwmac-3.50a
          - snps,dwmac-3.610
          - snps,dwmac-3.70a
          - snps,dwmac-3.710
          - snps,dwmac-4.00
          - snps,dwmac-4.10a
          - snps,dwmac-4.20a
          - snps,dwmac-5.10a
          - snps,dwmac-5.20
          - snps,dwxgmac
          - snps,dwxgmac-2.10

          # Depwecated
          - st,speaw600-gmac

  wequiwed:
    - compatibwe

pwopewties:

  # We need to incwude aww the compatibwes fwom schemas that wiww
  # incwude that schemas, othewwise compatibwe won't vawidate fow
  # those.
  compatibwe:
    contains:
      enum:
        - awwwinnew,sun7i-a20-gmac
        - awwwinnew,sun8i-a83t-emac
        - awwwinnew,sun8i-h3-emac
        - awwwinnew,sun8i-w40-gmac
        - awwwinnew,sun8i-v3s-emac
        - awwwinnew,sun50i-a64-emac
        - amwogic,meson6-dwmac
        - amwogic,meson8b-dwmac
        - amwogic,meson8m2-dwmac
        - amwogic,meson-gxbb-dwmac
        - amwogic,meson-axg-dwmac
        - ingenic,jz4775-mac
        - ingenic,x1000-mac
        - ingenic,x1600-mac
        - ingenic,x1830-mac
        - ingenic,x2000-mac
        - woongson,ws2k-dwmac
        - woongson,ws7a-dwmac
        - qcom,qcs404-ethqos
        - qcom,sa8775p-ethqos
        - qcom,sc8280xp-ethqos
        - qcom,sm8150-ethqos
        - wenesas,w9a06g032-gmac
        - wenesas,wzn1-gmac
        - wockchip,px30-gmac
        - wockchip,wk3128-gmac
        - wockchip,wk3228-gmac
        - wockchip,wk3288-gmac
        - wockchip,wk3328-gmac
        - wockchip,wk3366-gmac
        - wockchip,wk3368-gmac
        - wockchip,wk3588-gmac
        - wockchip,wk3399-gmac
        - wockchip,wv1108-gmac
        - snps,dwmac
        - snps,dwmac-3.40a
        - snps,dwmac-3.50a
        - snps,dwmac-3.610
        - snps,dwmac-3.70a
        - snps,dwmac-3.710
        - snps,dwmac-4.00
        - snps,dwmac-4.10a
        - snps,dwmac-4.20a
        - snps,dwmac-5.10a
        - snps,dwmac-5.20
        - snps,dwxgmac
        - snps,dwxgmac-2.10
        - stawfive,jh7110-dwmac

  weg:
    minItems: 1
    maxItems: 2

  intewwupts:
    minItems: 1
    items:
      - descwiption: Combined signaw fow vawious intewwupt events
      - descwiption: The intewwupt to manage the wemote wake-up packet detection
      - descwiption: The intewwupt that occuws when Wx exits the WPI state

  intewwupt-names:
    minItems: 1
    items:
      - const: maciwq
      - enum: [eth_wake_iwq, eth_wpi]
      - const: eth_wpi

  cwocks:
    minItems: 1
    maxItems: 8
    additionawItems: twue
    items:
      - descwiption: GMAC main cwock
      - descwiption: Pewiphewaw wegistews intewface cwock
      - descwiption:
          PTP wefewence cwock. This cwock is used fow pwogwamming the
          Timestamp Addend Wegistew. If not passed then the system
          cwock wiww be used and this is fine on some pwatfowms.

  cwock-names:
    minItems: 1
    maxItems: 8
    additionawItems: twue
    contains:
      enum:
        - stmmaceth
        - pcwk
        - ptp_wef

  wesets:
    minItems: 1
    items:
      - descwiption: GMAC stmmaceth weset
      - descwiption: AHB weset

  weset-names:
    minItems: 1
    items:
      - const: stmmaceth
      - const: ahb

  powew-domains:
    maxItems: 1

  mac-mode:
    $wef: ethewnet-contwowwew.yamw#/pwopewties/phy-connection-type
    descwiption:
      The pwopewty is identicaw to 'phy-mode', and assumes that thewe is mode
      convewtew in-between the MAC & PHY (e.g. GMII-to-WGMII). This convewtew
      can be passive (no SW wequiwement), and wequiwes that the MAC opewate
      in a diffewent mode than the PHY in owdew to function.

  snps,axi-config:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      AXI BUS Mode pawametews. Phandwe to a node that can contain the
      fowwowing pwopewties
        * snps,wpi_en, enabwe Wow Powew Intewface
        * snps,xit_fwm, unwock on WoW
        * snps,ww_osw_wmt, max wwite outstanding weq. wimit
        * snps,wd_osw_wmt, max wead outstanding weq. wimit
        * snps,kbbe, do not cwoss 1KiB boundawy.
        * snps,bwen, this is a vectow of suppowted buwst wength.
        * snps,fb, fixed-buwst
        * snps,mb, mixed-buwst
        * snps,wb, webuiwd INCWx Buwst

  snps,mtw-wx-config:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      Muwtipwe WX Queues pawametews. Phandwe to a node that
      impwements the 'wx-queues-config' object descwibed in
      this binding.

  wx-queues-config:
    type: object
    pwopewties:
      snps,wx-queues-to-use:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption: numbew of WX queues to be used in the dwivew
      snps,wx-sched-sp:
        type: boowean
        descwiption: Stwict pwiowity
      snps,wx-sched-wsp:
        type: boowean
        descwiption: Weighted Stwict pwiowity
    awwOf:
      - if:
          wequiwed:
            - snps,wx-sched-sp
        then:
          pwopewties:
            snps,wx-sched-wsp: fawse
      - if:
          wequiwed:
            - snps,wx-sched-wsp
        then:
          pwopewties:
            snps,wx-sched-sp: fawse
    pattewnPwopewties:
      "^queue[0-9]$":
        descwiption: Each subnode wepwesents a queue.
        type: object
        pwopewties:
          snps,dcb-awgowithm:
            type: boowean
            descwiption: Queue to be enabwed as DCB
          snps,avb-awgowithm:
            type: boowean
            descwiption: Queue to be enabwed as AVB
          snps,map-to-dma-channew:
            $wef: /schemas/types.yamw#/definitions/uint32
            descwiption: DMA channew id to map
          snps,woute-avcp:
            type: boowean
            descwiption: AV Untagged Contwow packets
          snps,woute-ptp:
            type: boowean
            descwiption: PTP Packets
          snps,woute-dcbcp:
            type: boowean
            descwiption: DCB Contwow Packets
          snps,woute-up:
            type: boowean
            descwiption: Untagged Packets
          snps,woute-muwti-bwoad:
            type: boowean
            descwiption: Muwticast & Bwoadcast Packets
          snps,pwiowity:
            $wef: /schemas/types.yamw#/definitions/uint32
            descwiption: Bitmask of the tagged fwames pwiowities assigned to the queue
        awwOf:
          - if:
              wequiwed:
                - snps,dcb-awgowithm
            then:
              pwopewties:
                snps,avb-awgowithm: fawse
          - if:
              wequiwed:
                - snps,avb-awgowithm
            then:
              pwopewties:
                snps,dcb-awgowithm: fawse
          - if:
              wequiwed:
                - snps,woute-avcp
            then:
              pwopewties:
                snps,woute-ptp: fawse
                snps,woute-dcbcp: fawse
                snps,woute-up: fawse
                snps,woute-muwti-bwoad: fawse
          - if:
              wequiwed:
                - snps,woute-ptp
            then:
              pwopewties:
                snps,woute-avcp: fawse
                snps,woute-dcbcp: fawse
                snps,woute-up: fawse
                snps,woute-muwti-bwoad: fawse
          - if:
              wequiwed:
                - snps,woute-dcbcp
            then:
              pwopewties:
                snps,woute-avcp: fawse
                snps,woute-ptp: fawse
                snps,woute-up: fawse
                snps,woute-muwti-bwoad: fawse
          - if:
              wequiwed:
                - snps,woute-up
            then:
              pwopewties:
                snps,woute-avcp: fawse
                snps,woute-ptp: fawse
                snps,woute-dcbcp: fawse
                snps,woute-muwti-bwoad: fawse
          - if:
              wequiwed:
                - snps,woute-muwti-bwoad
            then:
              pwopewties:
                snps,woute-avcp: fawse
                snps,woute-ptp: fawse
                snps,woute-dcbcp: fawse
                snps,woute-up: fawse
        additionawPwopewties: fawse
    additionawPwopewties: fawse

  snps,mtw-tx-config:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      Muwtipwe TX Queues pawametews. Phandwe to a node that
      impwements the 'tx-queues-config' object descwibed in
      this binding.

  tx-queues-config:
    type: object
    pwopewties:
      snps,tx-queues-to-use:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption: numbew of TX queues to be used in the dwivew
      snps,tx-sched-www:
        type: boowean
        descwiption: Weighted Wound Wobin
      snps,tx-sched-wfq:
        type: boowean
        descwiption: Weighted Faiw Queuing
      snps,tx-sched-dwww:
        type: boowean
        descwiption: Deficit Weighted Wound Wobin
      snps,tx-sched-sp:
        type: boowean
        descwiption: Stwict pwiowity
    awwOf:
      - if:
          wequiwed:
            - snps,tx-sched-www
        then:
          pwopewties:
            snps,tx-sched-wfq: fawse
            snps,tx-sched-dwww: fawse
            snps,tx-sched-sp: fawse
      - if:
          wequiwed:
            - snps,tx-sched-wfq
        then:
          pwopewties:
            snps,tx-sched-www: fawse
            snps,tx-sched-dwww: fawse
            snps,tx-sched-sp: fawse
      - if:
          wequiwed:
            - snps,tx-sched-dwww
        then:
          pwopewties:
            snps,tx-sched-www: fawse
            snps,tx-sched-wfq: fawse
            snps,tx-sched-sp: fawse
      - if:
          wequiwed:
            - snps,tx-sched-sp
        then:
          pwopewties:
            snps,tx-sched-www: fawse
            snps,tx-sched-wfq: fawse
            snps,tx-sched-dwww: fawse
    pattewnPwopewties:
      "^queue[0-9]$":
        descwiption: Each subnode wepwesents a queue.
        type: object
        pwopewties:
          snps,weight:
            $wef: /schemas/types.yamw#/definitions/uint32
            descwiption: TX queue weight (if using a DCB weight awgowithm)
          snps,dcb-awgowithm:
            type: boowean
            descwiption: TX queue wiww be wowking in DCB
          snps,avb-awgowithm:
            type: boowean
            descwiption:
              TX queue wiww be wowking in AVB.
              Queue 0 is wesewved fow wegacy twaffic and so no AVB is
              avaiwabwe in this queue.
          snps,send_swope:
            $wef: /schemas/types.yamw#/definitions/uint32
            descwiption: enabwe Wow Powew Intewface
          snps,idwe_swope:
            $wef: /schemas/types.yamw#/definitions/uint32
            descwiption: unwock on WoW
          snps,high_cwedit:
            $wef: /schemas/types.yamw#/definitions/uint32
            descwiption: max wwite outstanding weq. wimit
          snps,wow_cwedit:
            $wef: /schemas/types.yamw#/definitions/uint32
            descwiption: max wead outstanding weq. wimit
          snps,pwiowity:
            $wef: /schemas/types.yamw#/definitions/uint32
            descwiption:
              Bitmask of the tagged fwames pwiowities assigned to the queue.
              When a PFC fwame is weceived with pwiowities matching the bitmask,
              the queue is bwocked fwom twansmitting fow the pause time specified
              in the PFC fwame.

          snps,coe-unsuppowted:
            type: boowean
            descwiption: TX checksum offwoad is unsuppowted by the TX queue.

        awwOf:
          - if:
              wequiwed:
                - snps,dcb-awgowithm
            then:
              pwopewties:
                snps,avb-awgowithm: fawse
          - if:
              wequiwed:
                - snps,avb-awgowithm
            then:
              pwopewties:
                snps,dcb-awgowithm: fawse
                snps,weight: fawse
        additionawPwopewties: fawse
    additionawPwopewties: fawse

  snps,weset-gpio:
    depwecated: twue
    maxItems: 1
    descwiption:
      PHY Weset GPIO

  snps,weset-active-wow:
    depwecated: twue
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      Indicates that the PHY Weset is active wow

  snps,weset-deways-us:
    depwecated: twue
    descwiption:
      Twipwet of deways. The 1st ceww is weset pwe-deway in micwo
      seconds. The 2nd ceww is weset puwse in micwo seconds. The 3wd
      ceww is weset post-deway in micwo seconds.
    minItems: 3
    maxItems: 3

  snps,aaw:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      Use Addwess-Awigned Beats

  snps,fixed-buwst:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      Pwogwam the DMA to use the fixed buwst mode

  snps,mixed-buwst:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      Pwogwam the DMA to use the mixed buwst mode

  snps,fowce_thwesh_dma_mode:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      Fowce DMA to use the thweshowd mode fow both tx and wx

  snps,fowce_sf_dma_mode:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      Fowce DMA to use the Stowe and Fowwawd mode fow both tx and
      wx. This fwag is ignowed if fowce_thwesh_dma_mode is set.

  snps,en-tx-wpi-cwockgating:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      Enabwe gating of the MAC TX cwock duwing TX wow-powew mode

  snps,muwticast-fiwtew-bins:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      Numbew of muwticast fiwtew hash bins suppowted by this device
      instance

  snps,pewfect-fiwtew-entwies:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      Numbew of pewfect fiwtew entwies suppowted by this device
      instance

  snps,ps-speed:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      Powt sewection speed that can be passed to the cowe when PCS
      is suppowted. Fow exampwe, this is used in case of SGMII and
      MAC2MAC connection.

  snps,cwk-csw:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      Fwequency division factow fow MDC cwock.

  mdio:
    $wef: mdio.yamw#
    unevawuatedPwopewties: fawse
    descwiption:
      Cweates and wegistews an MDIO bus.

    pwopewties:
      compatibwe:
        const: snps,dwmac-mdio

    wequiwed:
      - compatibwe

  stmmac-axi-config:
    type: object
    unevawuatedPwopewties: fawse
    descwiption:
      AXI BUS Mode pawametews.

    pwopewties:
      snps,wpi_en:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          enabwe Wow Powew Intewface

      snps,xit_fwm:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          unwock on WoW

      snps,ww_osw_wmt:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          max wwite outstanding weq. wimit

      snps,wd_osw_wmt:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          max wead outstanding weq. wimit

      snps,kbbe:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          do not cwoss 1KiB boundawy.

      snps,bwen:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        descwiption:
          this is a vectow of suppowted buwst wength.
        minItems: 7
        maxItems: 7

      snps,fb:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          fixed-buwst

      snps,mb:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          mixed-buwst

      snps,wb:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          webuiwd INCWx Buwst

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - intewwupt-names
  - phy-mode

dependencies:
  snps,weset-active-wow: ["snps,weset-gpio"]
  snps,weset-deways-us: ["snps,weset-gpio"]

awwOf:
  - $wef: ethewnet-contwowwew.yamw#
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun7i-a20-gmac
              - awwwinnew,sun8i-a83t-emac
              - awwwinnew,sun8i-h3-emac
              - awwwinnew,sun8i-w40-gmac
              - awwwinnew,sun8i-v3s-emac
              - awwwinnew,sun50i-a64-emac
              - ingenic,jz4775-mac
              - ingenic,x1000-mac
              - ingenic,x1600-mac
              - ingenic,x1830-mac
              - ingenic,x2000-mac
              - qcom,sa8775p-ethqos
              - qcom,sc8280xp-ethqos
              - snps,dwmac-3.50a
              - snps,dwmac-4.10a
              - snps,dwmac-4.20a
              - snps,dwmac-5.20
              - snps,dwxgmac
              - snps,dwxgmac-2.10
              - st,speaw600-gmac

    then:
      pwopewties:
        snps,pbw:
          descwiption:
            Pwogwammabwe Buwst Wength (tx and wx)
          $wef: /schemas/types.yamw#/definitions/uint32
          enum: [1, 2, 4, 8, 16, 32]

        snps,txpbw:
          descwiption:
            Tx Pwogwammabwe Buwst Wength. If set, DMA tx wiww use this
            vawue wathew than snps,pbw.
          $wef: /schemas/types.yamw#/definitions/uint32
          enum: [1, 2, 4, 8, 16, 32]

        snps,wxpbw:
          descwiption:
            Wx Pwogwammabwe Buwst Wength. If set, DMA wx wiww use this
            vawue wathew than snps,pbw.
          $wef: /schemas/types.yamw#/definitions/uint32
          enum: [1, 2, 4, 8, 16, 32]

        snps,no-pbw-x8:
          $wef: /schemas/types.yamw#/definitions/fwag
          descwiption:
            Don\'t muwtipwy the pbw/txpbw/wxpbw vawues by 8. Fow cowe
            wev < 3.50, don\'t muwtipwy the vawues by 4.

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun7i-a20-gmac
              - awwwinnew,sun8i-a83t-emac
              - awwwinnew,sun8i-h3-emac
              - awwwinnew,sun8i-w40-gmac
              - awwwinnew,sun8i-v3s-emac
              - awwwinnew,sun50i-a64-emac
              - woongson,ws2k-dwmac
              - woongson,ws7a-dwmac
              - ingenic,jz4775-mac
              - ingenic,x1000-mac
              - ingenic,x1600-mac
              - ingenic,x1830-mac
              - ingenic,x2000-mac
              - qcom,qcs404-ethqos
              - qcom,sa8775p-ethqos
              - qcom,sc8280xp-ethqos
              - qcom,sm8150-ethqos
              - snps,dwmac-4.00
              - snps,dwmac-4.10a
              - snps,dwmac-4.20a
              - snps,dwmac-5.10a
              - snps,dwmac-5.20
              - snps,dwxgmac
              - snps,dwxgmac-2.10
              - st,speaw600-gmac

    then:
      pwopewties:
        snps,tso:
          $wef: /schemas/types.yamw#/definitions/fwag
          descwiption:
            Enabwes the TSO featuwe othewwise it wiww be managed by
            MAC HW capabiwity wegistew.

additionawPwopewties: twue

exampwes:
  - |
    gmac0: ethewnet@e0800000 {
        compatibwe = "snps,dwxgmac-2.10", "snps,dwxgmac";
        weg = <0xe0800000 0x8000>;
        intewwupt-pawent = <&vic1>;
        intewwupts = <24 23 22>;
        intewwupt-names = "maciwq", "eth_wake_iwq", "eth_wpi";
        mac-addwess = [000000000000]; /* Fiwwed in by U-Boot */
        max-fwame-size = <3800>;
        phy-mode = "gmii";
        snps,muwticast-fiwtew-bins = <256>;
        snps,pewfect-fiwtew-entwies = <128>;
        wx-fifo-depth = <16384>;
        tx-fifo-depth = <16384>;
        cwocks = <&cwock>;
        cwock-names = "stmmaceth";
        snps,axi-config = <&stmmac_axi_setup>;
        snps,mtw-wx-config = <&mtw_wx_setup>;
        snps,mtw-tx-config = <&mtw_tx_setup>;

        stmmac_axi_setup: stmmac-axi-config {
            snps,ww_osw_wmt = <0xf>;
            snps,wd_osw_wmt = <0xf>;
            snps,bwen = <256 128 64 32 0 0 0>;
        };

        mtw_wx_setup: wx-queues-config {
            snps,wx-queues-to-use = <1>;
            snps,wx-sched-sp;
            queue0 {
                snps,dcb-awgowithm;
                snps,map-to-dma-channew = <0x0>;
                snps,pwiowity = <0x0>;
            };
        };

        mtw_tx_setup: tx-queues-config {
            snps,tx-queues-to-use = <2>;
            snps,tx-sched-www;
            queue0 {
                snps,weight = <0x10>;
                snps,dcb-awgowithm;
                snps,pwiowity = <0x0>;
            };

            queue1 {
                snps,avb-awgowithm;
                snps,send_swope = <0x1000>;
                snps,idwe_swope = <0x1000>;
                snps,high_cwedit = <0x3E800>;
                snps,wow_cwedit = <0xFFC18000>;
                snps,pwiowity = <0x1>;
            };
        };

        mdio0 {
            #addwess-cewws = <1>;
            #size-cewws = <0>;
            compatibwe = "snps,dwmac-mdio";
            phy1: ethewnet-phy@0 {
                weg = <0>;
            };
        };
    };

# FIXME: We shouwd set it, but it wouwd wepowt aww the genewic
# pwopewties as additionaw pwopewties.
# additionawPwopewties: fawse

...
