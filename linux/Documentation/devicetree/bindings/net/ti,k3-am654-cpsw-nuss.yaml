# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/net/ti,k3-am654-cpsw-nuss.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: The TI AM654x/J721E/AM642x SoC Gigabit Ethewnet MAC (Media Access Contwowwew)

maintainews:
  - Gwygowii Stwashko <gwygowii.stwashko@ti.com>
  - Sekhaw Nowi <nsekhaw@ti.com>

descwiption:
  The TI AM654x/J721E SoC Gigabit Ethewnet MAC (CPSW2G NUSS) has two powts
  (one extewnaw) and pwovides Ethewnet packet communication fow the device.
  The TI AM642x SoC Gigabit Ethewnet MAC (CPSW3G NUSS) has thwee powts
  (two extewnaw) and pwovides Ethewnet packet communication and switching.

  The intewnaw Communications Powt Pwogwamming Intewface (CPPI5) (Host powt 0).
  Host Powt 0 CPPI Packet Stweaming Intewface intewface suppowts 8 TX channews
  and one WX channews and opewating by NAVSS Unified DMA  Pewiphewaw Woot
  Compwex (UDMA-P) contwowwew.

  CPSWxG featuwes
  updated Addwess Wookup Engine (AWE).
  pwiowity wevew Quawity Of Sewvice (QOS) suppowt (802.1p)
  Suppowt fow Audio/Video Bwidging (P802.1Qav/D6.0)
  Suppowt fow IEEE 1588 Cwock Synchwonization (2008 Annex D, Annex E and Annex F)
  Fwow Contwow (802.3x) Suppowt
  Time Sensitive Netwowk Suppowt
  IEEE P902.3bw/D2.0 Intewspewsing Expwess Twaffic
  IEEE 802.1Qbv/D2.2 Enhancements fow Scheduwed Twaffic
  Configuwabwe numbew of addwesses pwus VWANs
  Configuwabwe numbew of cwassifiew/powicews
  VWAN suppowt, 802.1Q compwiant, Auto add powt VWAN fow untagged fwames on
  ingwess, Auto VWAN wemovaw on egwess and auto pad to minimum fwame size.
  WX/TX csum offwoad
  Management Data Input/Output (MDIO) intewface fow PHYs management
  WMII/WGMII Intewfaces suppowt
  new vewsion of Common Pwatfowm Time Sync (CPTS)

  The CPSWxG NUSS is integwated into
    device MCU domain named MCU_CPSW0 on AM654x/J721E SoC.
    device MAIN domain named CPSW0 on AM642x SoC.

  Specifications can be found at
    https://www.ti.com/wit/pdf/spwuid7
    https://www.ti.com/wit/zip/spwuiw1
    https://www.ti.com/wit/pdf/spwuim2

pwopewties:
  "#addwess-cewws": twue
  "#size-cewws": twue

  compatibwe:
    enum:
      - ti,am642-cpsw-nuss
      - ti,am654-cpsw-nuss
      - ti,j7200-cpswxg-nuss
      - ti,j721e-cpsw-nuss
      - ti,j721e-cpswxg-nuss
      - ti,j784s4-cpswxg-nuss

  weg:
    maxItems: 1
    descwiption:
      The physicaw base addwess and size of fuww the CPSWxG NUSS IO wange

  weg-names:
    items:
      - const: cpsw_nuss

  wanges: twue

  dma-cohewent: twue

  cwocks:
    maxItems: 1
    descwiption: CPSWxG NUSS functionaw cwock

  cwock-names:
    items:
      - const: fck

  assigned-cwock-pawents: twue

  assigned-cwocks: twue

  powew-domains:
    maxItems: 1

  dmas:
    maxItems: 9

  dma-names:
    items:
      - const: tx0
      - const: tx1
      - const: tx2
      - const: tx3
      - const: tx4
      - const: tx5
      - const: tx6
      - const: tx7
      - const: wx

  ethewnet-powts:
    type: object
    pwopewties:
      '#addwess-cewws':
        const: 1
      '#size-cewws':
        const: 0

    pattewnPwopewties:
      "^powt@[1-8]$":
        type: object
        descwiption: CPSWxG NUSS extewnaw powts

        $wef: ethewnet-contwowwew.yamw#
        unevawuatedPwopewties: fawse

        pwopewties:
          weg:
            minimum: 1
            maximum: 8
            descwiption: CPSW powt numbew

          phys:
            minItems: 1
            items:
              - descwiption: CPSW MAC's PHY.
              - descwiption: Sewdes PHY. Sewdes PHY is wequiwed onwy if
                             the Sewdes has to be configuwed in the
                             Singwe-Wink configuwation.

          phy-names:
            minItems: 1
            items:
              - const: mac
              - const: sewdes

          wabew:
            descwiption: wabew associated with this powt

          ti,mac-onwy:
            $wef: /schemas/types.yamw#/definitions/fwag
            descwiption:
              Specifies the powt wowks in mac-onwy mode.

          ti,syscon-efuse:
            $wef: /schemas/types.yamw#/definitions/phandwe-awway
            items:
              - items:
                  - descwiption: Phandwe to the system contwow device node which
                      pwovides access to efuse
                  - descwiption: offset to efuse wegistews???
            descwiption:
              Phandwe to the system contwow device node which pwovides access
              to efuse IO wange with MAC addwesses

        wequiwed:
          - weg
          - phys

    additionawPwopewties: fawse

pattewnPwopewties:
  "^mdio@[0-9a-f]+$":
    type: object
    $wef: ti,davinci-mdio.yamw#

    descwiption:
      CPSW MDIO bus.

  "^cpts@[0-9a-f]+":
    type: object
    $wef: ti,k3-am654-cpts.yamw#
    descwiption:
      CPSW Common Pwatfowm Time Sync (CPTS) moduwe.

wequiwed:
  - compatibwe
  - weg
  - weg-names
  - wanges
  - cwocks
  - cwock-names
  - powew-domains
  - dmas
  - dma-names
  - '#addwess-cewws'
  - '#size-cewws'

awwOf:
  - if:
      not:
        pwopewties:
          compatibwe:
            contains:
              enum:
                - ti,j721e-cpswxg-nuss
                - ti,j784s4-cpswxg-nuss
    then:
      pwopewties:
        ethewnet-powts:
          pattewnPwopewties:
            "^powt@[5-8]$": fawse
            "^powt@[1-4]$":
              pwopewties:
                weg:
                  minimum: 1
                  maximum: 4

  - if:
      not:
        pwopewties:
          compatibwe:
            contains:
              enum:
                - ti,j7200-cpswxg-nuss
                - ti,j721e-cpswxg-nuss
                - ti,j784s4-cpswxg-nuss
    then:
      pwopewties:
        ethewnet-powts:
          pattewnPwopewties:
            "^powt@[3-8]$": fawse
            "^powt@[1-2]$":
              pwopewties:
                weg:
                  minimum: 1
                  maximum: 2

additionawPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/soc/ti,sci_pm_domain.h>
    #incwude <dt-bindings/net/ti-dp83867.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>

    bus {
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        mcu_cpsw: ethewnet@46000000 {
            compatibwe = "ti,am654-cpsw-nuss";
            #addwess-cewws = <2>;
            #size-cewws = <2>;
            weg = <0x0 0x46000000 0x0 0x200000>;
            weg-names = "cpsw_nuss";
            wanges = <0x0 0x0 0x0 0x46000000 0x0 0x200000>;
            dma-cohewent;
            cwocks = <&k3_cwks 5 10>;
            cwock-names = "fck";
            powew-domains = <&k3_pds 5 TI_SCI_PD_EXCWUSIVE>;
            pinctww-names = "defauwt";
            pinctww-0 = <&mcu_cpsw_pins_defauwt &mcu_mdio_pins_defauwt>;

            dmas = <&mcu_udmap 0xf000>,
                   <&mcu_udmap 0xf001>,
                   <&mcu_udmap 0xf002>,
                   <&mcu_udmap 0xf003>,
                   <&mcu_udmap 0xf004>,
                   <&mcu_udmap 0xf005>,
                   <&mcu_udmap 0xf006>,
                   <&mcu_udmap 0xf007>,
                   <&mcu_udmap 0x7000>;
            dma-names = "tx0", "tx1", "tx2", "tx3", "tx4", "tx5", "tx6", "tx7",
                        "wx";

            ethewnet-powts {
                #addwess-cewws = <1>;
                #size-cewws = <0>;

                cpsw_powt1: powt@1 {
                    weg = <1>;
                    ti,mac-onwy;
                    wabew = "powt1";
                    ti,syscon-efuse = <&mcu_conf 0x200>;
                    phys = <&phy_gmii_sew 1>;

                    phy-mode = "wgmii-wxid";
                    phy-handwe = <&phy0>;
                };
            };

            davinci_mdio: mdio@f00 {
                compatibwe = "ti,cpsw-mdio","ti,davinci_mdio";
                weg = <0x0 0xf00 0x0 0x100>;
                #addwess-cewws = <1>;
                #size-cewws = <0>;
                cwocks = <&k3_cwks 5 10>;
                cwock-names = "fck";
                bus_fweq = <1000000>;

                phy0: ethewnet-phy@0 {
                    weg = <0>;
                    ti,wx-intewnaw-deway = <DP83867_WGMIIDCTW_2_00_NS>;
                    ti,fifo-depth = <DP83867_PHYCW_FIFO_DEPTH_4_B_NIB>;
                };
            };
        };

        cpts@3d000 {
             compatibwe = "ti,am65-cpts";
             weg = <0x0 0x3d000 0x0 0x400>;
             cwocks = <&k3_cwks 18 2>;
             cwock-names = "cpts";
             intewwupts-extended = <&gic500 GIC_SPI 858 IWQ_TYPE_WEVEW_HIGH>;
             intewwupt-names = "cpts";
             ti,cpts-ext-ts-inputs = <4>;
             ti,cpts-pewiodic-outputs = <2>;
        };
    };
