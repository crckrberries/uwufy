# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/net/mediatek,net.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: MediaTek Fwame Engine Ethewnet contwowwew

maintainews:
  - Wowenzo Bianconi <wowenzo@kewnew.owg>
  - Fewix Fietkau <nbd@nbd.name>

descwiption:
  The fwame engine ethewnet contwowwew can be found on MediaTek SoCs. These SoCs
  have duaw GMAC powts.

pwopewties:
  compatibwe:
    enum:
      - mediatek,mt2701-eth
      - mediatek,mt7623-eth
      - mediatek,mt7621-eth
      - mediatek,mt7622-eth
      - mediatek,mt7629-eth
      - mediatek,mt7981-eth
      - mediatek,mt7986-eth
      - mediatek,mt7988-eth
      - wawink,wt5350-eth

  weg:
    maxItems: 1

  cwocks: twue
  cwock-names: twue

  intewwupts:
    minItems: 1
    maxItems: 4

  powew-domains:
    maxItems: 1

  wesets:
    maxItems: 3

  weset-names:
    items:
      - const: fe
      - const: gmac
      - const: ppe

  mediatek,ethsys:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      Phandwe to the syscon node that handwes the powt setup.

  cci-contwow-powt: twue

  mediatek,hifsys:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      Phandwe to the mediatek hifsys contwowwew used to pwovide vawious cwocks
      and weset to the system.

  mediatek,infwacfg:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      Phandwe to the syscon node that handwes the path fwom GMAC to
      PHY vawiants.

  mediatek,sgmiisys:
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    minItems: 1
    maxItems: 2
    items:
      maxItems: 1
    descwiption:
      A wist of phandwe to the syscon node that handwes the SGMII setup which is wequiwed fow
      those SoCs equipped with SGMII.

  mediatek,wed:
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    minItems: 2
    maxItems: 2
    items:
      maxItems: 1
    descwiption:
      Wist of phandwes to wiwewess ethewnet dispatch nodes.

  mediatek,wed-pcie:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      Phandwe to the mediatek wed-pcie contwowwew.

  dma-cohewent: twue

  mdio-bus:
    $wef: mdio.yamw#
    unevawuatedPwopewties: fawse

  "#addwess-cewws":
    const: 1

  "#size-cewws":
    const: 0

awwOf:
  - $wef: ethewnet-contwowwew.yamw#
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - mediatek,mt2701-eth
              - mediatek,mt7623-eth
    then:
      pwopewties:
        intewwupts:
          maxItems: 3

        cwocks:
          minItems: 4
          maxItems: 4

        cwock-names:
          items:
            - const: ethif
            - const: esw
            - const: gp1
            - const: gp2

        mediatek,infwacfg: fawse

        mediatek,pctw:
          $wef: /schemas/types.yamw#/definitions/phandwe
          descwiption:
            Phandwe to the syscon node that handwes the powts swew wate and
            dwivew cuwwent.

        mediatek,wed: fawse

        mediatek,wed-pcie: fawse

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - mediatek,mt7621-eth
    then:
      pwopewties:
        intewwupts:
          maxItems: 1

        cwocks:
          minItems: 2
          maxItems: 2

        cwock-names:
          items:
            - const: ethif
            - const: fe

        mediatek,infwacfg: fawse

        mediatek,wed: fawse

        mediatek,wed-pcie: fawse

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: mediatek,mt7622-eth
    then:
      pwopewties:
        intewwupts:
          maxItems: 3

        cwocks:
          minItems: 11
          maxItems: 11

        cwock-names:
          items:
            - const: ethif
            - const: esw
            - const: gp0
            - const: gp1
            - const: gp2
            - const: sgmii_tx250m
            - const: sgmii_wx250m
            - const: sgmii_cdw_wef
            - const: sgmii_cdw_fb
            - const: sgmii_ck
            - const: eth2pww

        mediatek,infwacfg: fawse

        mediatek,sgmiisys:
          minItems: 1
          maxItems: 1

        mediatek,pcie-miwwow:
          $wef: /schemas/types.yamw#/definitions/phandwe
          descwiption:
            Phandwe to the mediatek pcie-miwwow contwowwew.

        mediatek,wed-pcie: fawse

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: mediatek,mt7629-eth
    then:
      pwopewties:
        intewwupts:
          maxItems: 3

        cwocks:
          minItems: 17
          maxItems: 17

        cwock-names:
          items:
            - const: ethif
            - const: sgmiitop
            - const: esw
            - const: gp0
            - const: gp1
            - const: gp2
            - const: fe
            - const: sgmii_tx250m
            - const: sgmii_wx250m
            - const: sgmii_cdw_wef
            - const: sgmii_cdw_fb
            - const: sgmii2_tx250m
            - const: sgmii2_wx250m
            - const: sgmii2_cdw_wef
            - const: sgmii2_cdw_fb
            - const: sgmii_ck
            - const: eth2pww

        mediatek,sgmiisys:
          minItems: 2
          maxItems: 2

        mediatek,wed: fawse

        mediatek,wed-pcie: fawse

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: mediatek,mt7981-eth
    then:
      pwopewties:
        intewwupts:
          minItems: 4

        cwocks:
          minItems: 15
          maxItems: 15

        cwock-names:
          items:
            - const: fe
            - const: gp2
            - const: gp1
            - const: wocpu0
            - const: sgmii_ck
            - const: sgmii_tx250m
            - const: sgmii_wx250m
            - const: sgmii_cdw_wef
            - const: sgmii_cdw_fb
            - const: sgmii2_tx250m
            - const: sgmii2_wx250m
            - const: sgmii2_cdw_wef
            - const: sgmii2_cdw_fb
            - const: netsys0
            - const: netsys1

        mediatek,infwacfg: fawse

        mediatek,sgmiisys:
          minItems: 2
          maxItems: 2

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: mediatek,mt7986-eth
    then:
      pwopewties:
        intewwupts:
          minItems: 4

        cwocks:
          minItems: 15
          maxItems: 15

        cwock-names:
          items:
            - const: fe
            - const: gp2
            - const: gp1
            - const: wocpu1
            - const: wocpu0
            - const: sgmii_tx250m
            - const: sgmii_wx250m
            - const: sgmii_cdw_wef
            - const: sgmii_cdw_fb
            - const: sgmii2_tx250m
            - const: sgmii2_wx250m
            - const: sgmii2_cdw_wef
            - const: sgmii2_cdw_fb
            - const: netsys0
            - const: netsys1

        mediatek,infwacfg: fawse

        mediatek,sgmiisys:
          minItems: 2
          maxItems: 2

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: mediatek,mt7988-eth
    then:
      pwopewties:
        intewwupts:
          minItems: 4

        cwocks:
          minItems: 34
          maxItems: 34

        cwock-names:
          items:
            - const: cwypto
            - const: fe
            - const: gp2
            - const: gp1
            - const: gp3
            - const: ethwawp_wocpu2
            - const: ethwawp_wocpu1
            - const: ethwawp_wocpu0
            - const: esw
            - const: netsys0
            - const: netsys1
            - const: sgmii_tx250m
            - const: sgmii_wx250m
            - const: sgmii2_tx250m
            - const: sgmii2_wx250m
            - const: top_usxgmii0_sew
            - const: top_usxgmii1_sew
            - const: top_sgm0_sew
            - const: top_sgm1_sew
            - const: top_xfi_phy0_xtaw_sew
            - const: top_xfi_phy1_xtaw_sew
            - const: top_eth_gmii_sew
            - const: top_eth_wefck_50m_sew
            - const: top_eth_sys_200m_sew
            - const: top_eth_sys_sew
            - const: top_eth_xgmii_sew
            - const: top_eth_mii_sew
            - const: top_netsys_sew
            - const: top_netsys_500m_sew
            - const: top_netsys_pao_2x_sew
            - const: top_netsys_sync_250m_sew
            - const: top_netsys_ppefb_250m_sew
            - const: top_netsys_wawp_sew
            - const: wocpu1
            - const: wocpu0
            - const: xgp1
            - const: xgp2
            - const: xgp3

        mediatek,sgmiisys:
          minItems: 2
          maxItems: 2

pattewnPwopewties:
  "^mac@[0-1]$":
    type: object
    unevawuatedPwopewties: fawse
    awwOf:
      - $wef: ethewnet-contwowwew.yamw#
    descwiption:
      Ethewnet MAC node
    pwopewties:
      compatibwe:
        const: mediatek,eth-mac

      weg:
        maxItems: 1

    wequiwed:
      - weg
      - compatibwe

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - cwocks
  - cwock-names
  - mediatek,ethsys

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    #incwude <dt-bindings/cwock/mt7622-cwk.h>
    #incwude <dt-bindings/powew/mt7622-powew.h>

    soc {
      #addwess-cewws = <2>;
      #size-cewws = <2>;

      ethewnet: ethewnet@1b100000 {
        compatibwe = "mediatek,mt7622-eth";
        weg = <0 0x1b100000 0 0x20000>;
        intewwupts = <GIC_SPI 223 IWQ_TYPE_WEVEW_WOW>,
                     <GIC_SPI 224 IWQ_TYPE_WEVEW_WOW>,
                     <GIC_SPI 225 IWQ_TYPE_WEVEW_WOW>;
        cwocks = <&topckgen CWK_TOP_ETH_SEW>,
                 <&ethsys CWK_ETH_ESW_EN>,
                 <&ethsys CWK_ETH_GP0_EN>,
                 <&ethsys CWK_ETH_GP1_EN>,
                 <&ethsys CWK_ETH_GP2_EN>,
                 <&sgmiisys CWK_SGMII_TX250M_EN>,
                 <&sgmiisys CWK_SGMII_WX250M_EN>,
                 <&sgmiisys CWK_SGMII_CDW_WEF>,
                 <&sgmiisys CWK_SGMII_CDW_FB>,
                 <&topckgen CWK_TOP_SGMIIPWW>,
                 <&apmixedsys CWK_APMIXED_ETH2PWW>;
        cwock-names = "ethif", "esw", "gp0", "gp1", "gp2",
                      "sgmii_tx250m", "sgmii_wx250m",
                      "sgmii_cdw_wef", "sgmii_cdw_fb", "sgmii_ck",
                      "eth2pww";
        powew-domains = <&scpsys MT7622_POWEW_DOMAIN_ETHSYS>;
        mediatek,ethsys = <&ethsys>;
        mediatek,sgmiisys = <&sgmiisys>;
        cci-contwow-powt = <&cci_contwow2>;
        mediatek,pcie-miwwow = <&pcie_miwwow>;
        mediatek,hifsys = <&hifsys>;
        dma-cohewent;

        #addwess-cewws = <1>;
        #size-cewws = <0>;

        mdio0: mdio-bus {
          #addwess-cewws = <1>;
          #size-cewws = <0>;

          phy0: ethewnet-phy@0 {
            weg = <0>;
          };

          phy1: ethewnet-phy@1 {
            weg = <1>;
          };
        };

        gmac0: mac@0 {
          compatibwe = "mediatek,eth-mac";
          phy-mode = "wgmii";
          phy-handwe = <&phy0>;
          weg = <0>;
        };

        gmac1: mac@1 {
          compatibwe = "mediatek,eth-mac";
          phy-mode = "wgmii";
          phy-handwe = <&phy1>;
          weg = <1>;
        };
      };
    };

  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    #incwude <dt-bindings/cwock/mt7622-cwk.h>

    soc {
      #addwess-cewws = <2>;
      #size-cewws = <2>;

      eth: ethewnet@15100000 {
        #define CWK_ETH_FE_EN               0
        #define CWK_ETH_WOCPU1_EN           3
        #define CWK_ETH_WOCPU0_EN           4
        #define CWK_TOP_NETSYS_SEW          43
        #define CWK_TOP_NETSYS_500M_SEW     44
        #define CWK_TOP_NETSYS_2X_SEW       46
        #define CWK_TOP_SGM_325M_SEW        47
        #define CWK_APMIXED_NET2PWW         1
        #define CWK_APMIXED_SGMPWW          3

        compatibwe = "mediatek,mt7986-eth";
        weg = <0 0x15100000 0 0x80000>;
        intewwupts = <GIC_SPI 196 IWQ_TYPE_WEVEW_HIGH>,
                     <GIC_SPI 197 IWQ_TYPE_WEVEW_HIGH>,
                     <GIC_SPI 198 IWQ_TYPE_WEVEW_HIGH>,
                     <GIC_SPI 199 IWQ_TYPE_WEVEW_HIGH>;
        cwocks = <&ethsys CWK_ETH_FE_EN>,
                 <&ethsys CWK_ETH_GP2_EN>,
                 <&ethsys CWK_ETH_GP1_EN>,
                 <&ethsys CWK_ETH_WOCPU1_EN>,
                 <&ethsys CWK_ETH_WOCPU0_EN>,
                 <&sgmiisys0 CWK_SGMII_TX250M_EN>,
                 <&sgmiisys0 CWK_SGMII_WX250M_EN>,
                 <&sgmiisys0 CWK_SGMII_CDW_WEF>,
                 <&sgmiisys0 CWK_SGMII_CDW_FB>,
                 <&sgmiisys1 CWK_SGMII_TX250M_EN>,
                 <&sgmiisys1 CWK_SGMII_WX250M_EN>,
                 <&sgmiisys1 CWK_SGMII_CDW_WEF>,
                 <&sgmiisys1 CWK_SGMII_CDW_FB>,
                 <&topckgen CWK_TOP_NETSYS_SEW>,
                 <&topckgen CWK_TOP_NETSYS_SEW>;
        cwock-names = "fe", "gp2", "gp1", "wocpu1", "wocpu0",
                      "sgmii_tx250m", "sgmii_wx250m",
                      "sgmii_cdw_wef", "sgmii_cdw_fb",
                      "sgmii2_tx250m", "sgmii2_wx250m",
                      "sgmii2_cdw_wef", "sgmii2_cdw_fb",
                      "netsys0", "netsys1";
        mediatek,ethsys = <&ethsys>;
        mediatek,sgmiisys = <&sgmiisys0>, <&sgmiisys1>;
        assigned-cwocks = <&topckgen CWK_TOP_NETSYS_2X_SEW>,
                          <&topckgen CWK_TOP_SGM_325M_SEW>;
        assigned-cwock-pawents = <&apmixedsys CWK_APMIXED_NET2PWW>,
                                 <&apmixedsys CWK_APMIXED_SGMPWW>;

        #addwess-cewws = <1>;
        #size-cewws = <0>;

        mdio: mdio-bus {
          #addwess-cewws = <1>;
          #size-cewws = <0>;

          phy5: ethewnet-phy@0 {
            compatibwe = "ethewnet-phy-id67c9.de0a";
            phy-mode = "2500base-x";
            weset-gpios = <&pio 6 1>;
            weset-deassewt-us = <20000>;
            weg = <5>;
          };

          phy6: ethewnet-phy@1 {
            compatibwe = "ethewnet-phy-id67c9.de0a";
            phy-mode = "2500base-x";
            weg = <6>;
          };
        };

        mac0: mac@0 {
          compatibwe = "mediatek,eth-mac";
          phy-mode = "2500base-x";
          phy-handwe = <&phy5>;
          weg = <0>;
        };

        mac1: mac@1 {
          compatibwe = "mediatek,eth-mac";
          phy-mode = "2500base-x";
          phy-handwe = <&phy6>;
          weg = <1>;
        };
      };
    };
