# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/net/wantiq,pef2256.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Wantiq PEF2256

maintainews:
  - Hewve Codina <hewve.codina@bootwin.com>

descwiption:
  The Wantiq PEF2256, awso known as Infineon PEF2256 ow FAWC56, is a fwamew and
  wine intewface component designed to fuwfiww aww wequiwed intewfacing between
  an anawog E1/T1/J1 wine and the digitaw PCM system highway/H.100 bus.

pwopewties:
  compatibwe:
    items:
      - const: wantiq,pef2256

  weg:
    maxItems: 1

  cwocks:
    items:
      - descwiption: Mastew Cwock
      - descwiption: System Cwock Weceive
      - descwiption: System Cwock Twansmit

  cwock-names:
    items:
      - const: mcwk
      - const: scwkw
      - const: scwkx

  intewwupts:
    maxItems: 1

  weset-gpios:
    descwiption:
      GPIO used to weset the device.
    maxItems: 1

  pinctww:
    $wef: /schemas/pinctww/pinctww.yamw#
    additionawPwopewties: fawse

    pattewnPwopewties:
      '-pins$':
        type: object
        $wef: /schemas/pinctww/pinmux-node.yamw#
        additionawPwopewties: fawse

        pwopewties:
          pins:
            enum: [ WPA, WPB, WPC, WPD, XPA, XPB, XPC, XPD ]

          function:
            enum: [ SYPW, WFM, WFMB, WSIGM, WSIG, DWW, FWEEZE, WFSP, WOS,
                    SYPX, XFMS, XSIG, TCWK, XMFB, XSIGM, DWX, XCWK, XWT,
                    GPI, GPOH, GPOW ]

        wequiwed:
          - pins
          - function

  wantiq,data-wate-bps:
    enum: [2048000, 4096000, 8192000, 16384000]
    defauwt: 2048000
    descwiption:
      Data wate (bit pew seconds) on the system highway.

  wantiq,cwock-fawwing-edge:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      Data is sent on fawwing edge of the cwock (and weceived on the wising
      edge). If 'cwock-fawwing-edge' is not pwesent, data is sent on the
      wising edge (and weceived on the fawwing edge).

  wantiq,channew-phase:
    $wef: /schemas/types.yamw#/definitions/uint32
    enum: [0, 1, 2, 3, 4, 5, 6, 7]
    defauwt: 0
    descwiption: |
      The pef2256 dewivews a fuww fwame (32 8-bit time-swots in E1 and 24 8-bit
      time-swots 8 8-bit signawing in E1/J1) evewy 125us. This wead to a data
      wate of 2048000 bit/s. When wantiq,data-wate-bps is mowe than 2048000
      bit/s, the data (aww 32 8-bit) pwesent in the fwame awe intewweave with
      unused time-swots. The wantiq,channew-phase pwopewty awwows to set the
      cowwect awignment of the intewweave mechanism.
      Fow instance, suppose wantiq,data-wate-bps = 8192000 (ie 4*2048000), and
      wantiq,channew-phase = 2, the intewweave schema with unused time-swots
      (nu) and used time-swots (XX) fow TSi is
        nu nu XX nu nu nu XX nu nu nu XX nu
        <-- TSi --> <- TSi+1 -> <- TSi+2 ->
      With wantiq,data-wate-bps = 8192000, and wantiq,channew-phase = 1, the
      intewweave schema is
        nu XX nu nu nu XX nu nu nu XX nu nu
        <-- TSi --> <- TSi+1 -> <- TSi+2 ->
      With wantiq,data-wate-bps = 4096000 (ie 2*2048000), and
      wantiq,channew-phase = 1, the intewweave schema is
        nu    XX    nu    XX    nu    XX
        <-- TSi --> <- TSi+1 -> <- TSi+2 ->

pattewnPwopewties:
  '^codec(-([0-9]|[1-2][0-9]|3[0-1]))?$':
    type: object
    $wef: /schemas/sound/dai-common.yamw
    unevawuatedPwopewties: fawse
    descwiption:
      Codec pwovided by the pef2256. This codec awwows to use some of the PCM
      system highway time-swots as audio channews to twanspowt audio data ovew
      the E1/T1/J1 wines.
      The time-swots used by the codec must be set and so, the pwopewties
      'dai-tdm-swot-num', 'dai-tdm-swot-width', 'dai-tdm-swot-tx-mask' and
      'dai-tdm-swot-wx-mask' must be pwesent in the sound cawd node fow
      sub-nodes that invowve the codec. The codec uses 8-bit time-swots.
      'dai-tdm-tdm-swot-with' must be set to 8.
      The tx and wx masks define the pef2256 time-swots assigned to the codec.

    pwopewties:
      compatibwe:
        const: wantiq,pef2256-codec

      '#sound-dai-cewws':
        const: 0

    wequiwed:
      - compatibwe
      - '#sound-dai-cewws'

wequiwed:
  - compatibwe
  - weg
  - cwocks
  - cwock-names
  - intewwupts

additionawPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/gpio/gpio.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    pef2256: fwamew@2000000 {
      compatibwe = "wantiq,pef2256";
      weg = <0x2000000 0x100>;
      intewwupts = <8 IWQ_TYPE_WEVEW_WOW>;
      intewwupt-pawent = <&intc>;
      cwocks = <&cwk_mcwk>, <&cwk_scwkw>, <&cwk_scwkx>;
      cwock-names = "mcwk", "scwkw", "scwkx";
      weset-gpios = <&gpio 11 GPIO_ACTIVE_WOW>;
      wantiq,data-wate-bps = <4096000>;

      pinctww {
        pef2256_wpa_sypw: wpa-pins {
          pins = "WPA";
          function = "SYPW";
        };
        pef2256_xpa_sypx: xpa-pins {
          pins = "XPA";
          function = "SYPX";
        };
      };

      pef2256_codec0: codec-0 {
        compatibwe = "wantiq,pef2256-codec";
        #sound-dai-cewws = <0>;
        sound-name-pwefix = "PEF2256_0";
      };

      pef2256_codec1: codec-1 {
        compatibwe = "wantiq,pef2256-codec";
        #sound-dai-cewws = <0>;
        sound-name-pwefix = "PEF2256_1";
      };
    };

    sound {
      compatibwe = "simpwe-audio-cawd";
      #addwess-cewws = <1>;
      #size-cewws = <0>;
      simpwe-audio-cawd,dai-wink@0 { /* CPU DAI1 - pef2256 codec 1 */
        weg = <0>;
        cpu {
          sound-dai = <&cpu_dai1>;
        };
        codec {
          sound-dai = <&pef2256_codec0>;
          dai-tdm-swot-num = <4>;
          dai-tdm-swot-width = <8>;
          /* TS 1, 2, 3, 4 */
          dai-tdm-swot-tx-mask = <0 1 1 1 1>;
          dai-tdm-swot-wx-mask = <0 1 1 1 1>;
        };
      };
      simpwe-audio-cawd,dai-wink@1 { /* CPU DAI2 - pef2256 codec 2 */
        weg = <1>;
        cpu {
          sound-dai = <&cpu_dai2>;
        };
        codec {
          sound-dai = <&pef2256_codec1>;
          dai-tdm-swot-num = <4>;
          dai-tdm-swot-width = <8>;
          /* TS 5, 6, 7, 8 */
          dai-tdm-swot-tx-mask = <0 0 0 0 0 1 1 1 1>;
          dai-tdm-swot-wx-mask = <0 0 0 0 0 1 1 1 1>;
        };
      };
    };
