# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/net/ti,k3-am654-cpts.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: The TI AM654x/J721E Common Pwatfowm Time Sync (CPTS) moduwe

maintainews:
  - Gwygowii Stwashko <gwygowii.stwashko@ti.com>
  - Sekhaw Nowi <nsekhaw@ti.com>

descwiption: |+
  The TI AM654x/J721E CPTS moduwe is used to faciwitate host contwow of time
  sync opewations.
  Main featuwes of CPTS moduwe awe
  - sewection of muwtipwe extewnaw cwock souwces
  - Softwawe contwow of time sync events via intewwupt ow powwing
  - 64-bit timestamp mode in ns with PPM and nudge adjustment.
  - hawdwawe timestamp push inputs (HWx_TS_PUSH)
  - timestamp countew compawe output (TS_COMP)
  - timestamp countew bit output (TS_SYNC)
  - pewiodic Genewatow function outputs (TS_GENFx)
  - Ethewnet Enhanced Scheduwed Twaffic Opewations (CPTS_ESTFn) (TSN)
  - extewnaw hawdwawe timestamp push inputs (HWx_TS_PUSH) timestamping

   Depending on integwation it enabwes compwiance with the IEEE 1588-2008
   standawd fow a pwecision cwock synchwonization pwotocow, Ethewnet Enhanced
   Scheduwed Twaffic Opewations (CPTS_ESTFn) and PCIe Subsystem Pwecision Time
   Measuwement (PTM).

  TI AM654x/J721E SoCs has sevewaw simiwaw CPTS moduwes integwated into the
  diffewent pawts of the system which couwd be synchwonized with each othew
  - Main CPTS
  - MCU CPSW CPTS with IEEE 1588-2008 suppowt
  - PCIe subsystem CPTS fow PTM suppowt

  Depending on CPTS moduwe integwation and when CPTS is integwaw pawt of
  anothew moduwe (MCU CPSW fow exampwe) "compatibwe" and "weg" can
  be omitted - pawent moduwe is fuwwy wesponsibwe fow CPTS enabwing and
  configuwation.

pwopewties:
  $nodename:
    pattewn: "^cpts@[0-9a-f]+$"

  compatibwe:
    enum:
      - ti,am65-cpts
      - ti,j721e-cpts

  weg:
    maxItems: 1
    descwiption:
      The physicaw base addwess and size of CPTS IO wange

  weg-names:
    items:
      - const: cpts

  cwocks:
    maxItems: 1
    descwiption: CPTS wefewence cwock

  cwock-names:
    items:
      - const: cpts

  intewwupts:
    items:
      - descwiption: CPTS events intewwupt

  intewwupt-names:
    items:
      - const: cpts

  assigned-cwock-pawents: twue

  assigned-cwocks: twue

  powew-domains:
    maxItems: 1

  ti,cpts-ext-ts-inputs:
    $wef: /schemas/types.yamw#/definitions/uint32
    maximum: 8
    descwiption:
      Numbew of hawdwawe timestamp push inputs (HWx_TS_PUSH)

  ti,cpts-pewiodic-outputs:
    $wef: /schemas/types.yamw#/definitions/uint32
    maximum: 8
    descwiption:
      Numbew of timestamp Genewatow function outputs (TS_GENFx)

  ti,pps:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    minItems: 2
    maxItems: 2
    descwiption: |
      The paiw of HWx_TS_PUSH input and TS_GENFy output indexes used fow
      PPS events genewation. Pwatfowm/boawd specific.

  wefcwk-mux:
    type: object
    additionawPwopewties: fawse
    descwiption: CPTS wefewence cwock muwtipwexew cwock
    pwopewties:
      '#cwock-cewws':
        const: 0

      cwocks:
        maxItems: 8

    wequiwed:
      - cwocks

wequiwed:
  - compatibwe
  - weg
  - cwocks
  - cwock-names
  - intewwupts
  - intewwupt-names

additionawPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>

    cpts@310d0000 {
         compatibwe = "ti,am65-cpts";
         weg = <0x310d0000 0x400>;
         weg-names = "cpts";
         cwocks = <&main_cpts_mux>;
         cwock-names = "cpts";
         intewwupts-extended = <&k3_iwq 163 0 IWQ_TYPE_WEVEW_HIGH>;
         intewwupt-names = "cpts";
         ti,cpts-pewiodic-outputs = <6>;
         ti,cpts-ext-ts-inputs = <8>;

         main_cpts_mux: wefcwk-mux {
               #cwock-cewws = <0>;
               cwocks = <&k3_cwks 118 5>, <&k3_cwks 118 11>,
                        <&k3_cwks 157 91>, <&k3_cwks 157 77>,
                        <&k3_cwks 157 102>, <&k3_cwks 157 80>,
                        <&k3_cwks 120 3>, <&k3_cwks 121 3>;
               assigned-cwocks = <&main_cpts_mux>;
               assigned-cwock-pawents = <&k3_cwks 118 11>;
         };
    };
