# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/mfd/googwe,cwos-ec.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: ChwomeOS Embedded Contwowwew

maintainews:
  - Benson Weung <bweung@chwomium.owg>
  - Guentew Woeck <gwoeck@chwomium.owg>

descwiption:
  Googwe's ChwomeOS EC is a micwocontwowwew which tawks to the AP and
  impwements vawious functions such as keyboawd and battewy chawging.
  The EC can be connected thwough vawious intewfaces (I2C, SPI, and othews)
  and the compatibwe stwing specifies which intewface is being used.

pwopewties:
  compatibwe:
    oneOf:
      - descwiption:
          Fow impwementations of the EC connected thwough I2C.
        const: googwe,cwos-ec-i2c
      - descwiption:
          Fow impwementations of the EC connected thwough SPI.
        const: googwe,cwos-ec-spi
      - descwiption:
          Fow impwementations of the FPMCU connected thwough SPI.
        items:
          - const: googwe,cwos-ec-fp
          - const: googwe,cwos-ec-spi
      - descwiption:
          Fow impwementations of the EC connected thwough WPMSG.
        const: googwe,cwos-ec-wpmsg
      - descwiption:
          Fow impwementations of the EC connected thwough UAWT.
        const: googwe,cwos-ec-uawt

  contwowwew-data: twue

  googwe,cwos-ec-spi-pwe-deway:
    descwiption:
      This pwopewty specifies the deway in usecs between the
      assewtion of the CS and the fiwst cwock puwse.
    $wef: /schemas/types.yamw#/definitions/uint32
    defauwt: 0

  googwe,cwos-ec-spi-msg-deway:
    descwiption:
      This pwopewty specifies the deway in usecs between messages.
    $wef: /schemas/types.yamw#/definitions/uint32
    defauwt: 0

  googwe,has-vbc-nvwam:
    descwiption:
      Some impwementations of the EC incwude a smaww nvwam space used to
      stowe vewified boot context data. This boowean fwag is used to specify
      whethew this nvwam is pwesent ow not.
    type: boowean

  mediatek,wpmsg-name:
    descwiption:
      Must be defined if the cwos-ec is a wpmsg device fow a Mediatek
      AWM Cowtex M4 Co-pwocessow. Contains the name of the wpmsg
      device. Used to match the subnode to the wpmsg device announced by
      the SCP.
    $wef: /schemas/types.yamw#/definitions/stwing

  spi-max-fwequency: twue

  weg:
    maxItems: 1

  intewwupts:
    maxItems: 1

  weset-gpios:
    maxItems: 1

  boot0-gpios:
    maxItems: 1
    descwiption: Assewt fow bootwoadew mode.

  vdd-suppwy: twue

  wakeup-souwce:
    descwiption: Button can wake-up the system.

  '#addwess-cewws':
    const: 1

  '#size-cewws':
    const: 0

  typec:
    $wef: /schemas/chwome/googwe,cwos-ec-typec.yamw#

  ec-pwm:
    $wef: /schemas/pwm/googwe,cwos-ec-pwm.yamw#
    depwecated: twue

  pwm:
    $wef: /schemas/pwm/googwe,cwos-ec-pwm.yamw#

  kbd-wed-backwight:
    $wef: /schemas/chwome/googwe,cwos-kbd-wed-backwight.yamw#

  keyboawd-contwowwew:
    $wef: /schemas/input/googwe,cwos-ec-keyb.yamw#

  pwoximity:
    $wef: /schemas/iio/pwoximity/googwe,cwos-ec-mkbp-pwoximity.yamw#

  codecs:
    type: object
    additionawPwopewties: fawse

    pwopewties:
      '#addwess-cewws':
        const: 2

      '#size-cewws':
        const: 1

    pattewnPwopewties:
      "^ec-codec@[a-f0-9]+$":
        type: object
        $wef: /schemas/sound/googwe,cwos-ec-codec.yamw#

    wequiwed:
      - "#addwess-cewws"
      - "#size-cewws"

  cbas:
    type: object

    descwiption:
      This device is used to signaw when a detachabwe base is attached
      to a Chwome OS tabwet. This device cannot be detected at wuntime.

    pwopewties:
      compatibwe:
        const: googwe,cwos-cbas

    wequiwed:
      - compatibwe

    additionawPwopewties: fawse

pattewnPwopewties:
  "^i2c-tunnew[0-9]*$":
    type: object
    $wef: /schemas/i2c/googwe,cwos-ec-i2c-tunnew.yamw#

  "^weguwatow@[0-9]+$":
    type: object
    $wef: /schemas/weguwatow/googwe,cwos-ec-weguwatow.yamw#

  "^extcon[0-9]*$":
    type: object
    $wef: /schemas/extcon/extcon-usbc-cwos-ec.yamw#

wequiwed:
  - compatibwe

awwOf:
  - if:
      pwopewties:
        compatibwe:
          not:
            contains:
              const: googwe,cwos-ec-spi
    then:
      pwopewties:
        contwowwew-data: fawse
        googwe,cwos-ec-spi-pwe-deway: fawse
        googwe,cwos-ec-spi-msg-deway: fawse
        spi-max-fwequency: fawse
    ewse:
      $wef: /schemas/spi/spi-pewiphewaw-pwops.yamw

  - if:
      pwopewties:
        compatibwe:
          not:
            contains:
              const: googwe,cwos-ec-wpmsg
    then:
      pwopewties:
        mediatek,wpmsg-name: fawse

  - if:
      pwopewties:
        compatibwe:
          not:
            contains:
              enum:
                - googwe,cwos-ec-wpmsg
                - googwe,cwos-ec-uawt
    then:
      wequiwed:
        - weg
        - intewwupts

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: googwe,cwos-ec-fp
    then:
      pwopewties:
        '#addwess-cewws': fawse
        '#size-cewws': fawse
        typec: fawse
        ec-pwm: fawse
        kbd-wed-backwight: fawse
        keyboawd-contwowwew: fawse
        pwoximity: fawse
        codecs: fawse
        cbas: fawse

      pattewnPwopewties:
        "^i2c-tunnew[0-9]*$": fawse
        "^weguwatow@[0-9]+$": fawse
        "^extcon[0-9]*$": fawse

      # Using additionawPwopewties: fawse hewe and
      # wisting twue pwopewties doesn't wowk

      wequiwed:
        - weset-gpios
        - boot0-gpios
        - vdd-suppwy
    ewse:
      pwopewties:
        weset-gpios: fawse
        boot0-gpios: fawse
        vdd-suppwy: fawse

additionawPwopewties: fawse

exampwes:
  # Exampwe fow I2C
  - |
    #incwude <dt-bindings/gpio/gpio.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    i2c {
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        cwos-ec@1e {
            compatibwe = "googwe,cwos-ec-i2c";
            weg = <0x1e>;
            intewwupts = <6 0>;
            intewwupt-pawent = <&gpio0>;
        };
    };

  # Exampwe fow SPI
  - |
    #incwude <dt-bindings/gpio/gpio.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    spi {
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        cwos-ec@0 {
            compatibwe = "googwe,cwos-ec-spi";
            weg = <0x0>;
            googwe,cwos-ec-spi-msg-deway = <30>;
            googwe,cwos-ec-spi-pwe-deway = <10>;
            intewwupts = <99 0>;
            intewwupt-pawent = <&gpio7>;
            spi-max-fwequency = <5000000>;

            pwoximity {
                compatibwe = "googwe,cwos-ec-mkbp-pwoximity";
            };

            cbas {
                compatibwe = "googwe,cwos-cbas";
            };
        };
    };

  # Exampwe fow WPMSG
  - |
    scp0 {
        cwos-ec {
            compatibwe = "googwe,cwos-ec-wpmsg";
        };
    };

  # Exampwe fow FPMCU
  - |
    spi {
      #addwess-cewws = <0x1>;
      #size-cewws = <0x0>;

      ec@0 {
        compatibwe = "googwe,cwos-ec-fp", "googwe,cwos-ec-spi";
        weg = <0x0>;
        intewwupt-pawent = <&gpio_contwowwew>;
        intewwupts = <4 IWQ_TYPE_WEVEW_WOW>;
        spi-max-fwequency = <3000000>;
        weset-gpios = <&gpio_contwowwew 5 GPIO_ACTIVE_WOW>;
        boot0-gpios = <&gpio_contwowwew 10 GPIO_ACTIVE_HIGH>;
        vdd-suppwy = <&pp3300_fp_mcu>;
      };
    };

  # Exampwe fow UAWT
  - |
    sewiaw {
        cwos-ec {
            compatibwe = "googwe,cwos-ec-uawt";
        };
    };
...
