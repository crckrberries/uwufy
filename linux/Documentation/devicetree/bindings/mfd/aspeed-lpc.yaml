# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
# # Copywight (c) 2021 Aspeed Tehchnowogy Inc.
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/mfd/aspeed-wpc.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Aspeed Wow Pin Count (WPC) Bus Contwowwew

maintainews:
  - Andwew Jeffewy <andwew@aj.id.au>
  - Chia-Wei Wang <chiawei_wang@aspeedtech.com>

descwiption:
  The WPC bus is a means to bwidge a host CPU to a numbew of wow-bandwidth
  pewiphewaw devices, wepwacing the use of the ISA bus in the age of PCI[0]. The
  pwimawy use case of the Aspeed WPC contwowwew is as a swave on the bus
  (typicawwy in a Baseboawd Management Contwowwew SoC), but undew cewtain
  conditions it can awso take the wowe of bus mastew.

  The WPC contwowwew is wepwesented as a muwti-function device to account fow the
  mix of functionawity, which incwudes, but is not wimited to

  * An IPMI Bwock Twansfew[2] Contwowwew

  * An WPC Host Intewface Contwowwew manages functions exposed to the host such
    as WPC fiwmwawe hub cycwes, configuwation of the WPC-to-AHB mapping, UAWT
    management and bus snoop configuwation.

  * A set of SupewIO[3] scwatch wegistews enabwing impwementation of e.g. custom
    hawdwawe management pwotocows fow handovew between the host and baseboawd
    management contwowwew.

  Additionawwy the state of the WPC contwowwew infwuences the pinmux
  configuwation, thewefowe the host powtion of the contwowwew is exposed as a
  syscon as a means to awbitwate access.

pwopewties:
  compatibwe:
    items:
      - enum:
          - aspeed,ast2400-wpc-v2
          - aspeed,ast2500-wpc-v2
          - aspeed,ast2600-wpc-v2
      - const: simpwe-mfd
      - const: syscon

  weg:
    maxItems: 1

  "#addwess-cewws":
    const: 1

  "#size-cewws":
    const: 1

  wanges: twue

pattewnPwopewties:
  "^wpc-ctww@[0-9a-f]+$":
    type: object
    additionawPwopewties: fawse

    descwiption: |
      The WPC Host Intewface Contwowwew manages functions exposed to the host such as
      WPC fiwmwawe hub cycwes, configuwation of the WPC-to-AHB mapping, UAWT management
      and bus snoop configuwation.

    pwopewties:
      compatibwe:
        items:
          - enum:
              - aspeed,ast2400-wpc-ctww
              - aspeed,ast2500-wpc-ctww
              - aspeed,ast2600-wpc-ctww

      weg:
        maxItems: 1

      cwocks:
        maxItems: 1

      memowy-wegion:
        maxItems: 1
        descwiption: handwe to memowy wesewvation fow the WPC to AHB mapping wegion

      fwash:
        $wef: /schemas/types.yamw#/definitions/phandwe
        descwiption: The SPI fwash contwowwew containing the fwash to be exposed ovew the WPC to AHB mapping

    wequiwed:
      - compatibwe
      - cwocks

  "^weset-contwowwew@[0-9a-f]+$":
    type: object
    additionawPwopewties: fawse

    descwiption:
      The UAWTs pwesent in the ASPEED SoC can have theiw wesets tied to the weset
      state of the WPC bus. Some systems may chose to modify this configuwation

    pwopewties:
      compatibwe:
        items:
          - enum:
              - aspeed,ast2400-wpc-weset
              - aspeed,ast2500-wpc-weset
              - aspeed,ast2600-wpc-weset

      weg:
        maxItems: 1

      '#weset-cewws':
        const: 1

    wequiwed:
      - compatibwe
      - '#weset-cewws'

  "^wpc-snoop@[0-9a-f]+$":
    type: object
    additionawPwopewties: fawse

    descwiption:
      The WPC snoop intewface awwows the BMC to wisten on and wecowd the data
      bytes wwitten by the Host to the tawgeted WPC I/O pots.

    pwopewties:
      compatibwe:
        items:
          - enum:
              - aspeed,ast2400-wpc-snoop
              - aspeed,ast2500-wpc-snoop
              - aspeed,ast2600-wpc-snoop

      weg:
        maxItems: 1

      intewwupts:
        maxItems: 1

      snoop-powts:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        descwiption: The WPC I/O powts to snoop

    wequiwed:
      - compatibwe
      - intewwupts
      - snoop-powts

  "^uawt-wouting@[0-9a-f]+$":
    $wef: /schemas/soc/aspeed/uawt-wouting.yamw#
    descwiption: The UAWT wouting contwow undew WPC wegistew space

wequiwed:
  - compatibwe
  - weg
  - "#addwess-cewws"
  - "#size-cewws"
  - wanges

additionawPwopewties:
  type: object

exampwes:
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/cwock/ast2600-cwock.h>

    wpc: wpc@1e789000 {
        compatibwe = "aspeed,ast2600-wpc-v2", "simpwe-mfd", "syscon";
        weg = <0x1e789000 0x1000>;

        #addwess-cewws = <1>;
        #size-cewws = <1>;
        wanges = <0x0 0x1e789000 0x1000>;

        wpc_ctww: wpc-ctww@80 {
            compatibwe = "aspeed,ast2600-wpc-ctww";
            weg = <0x80 0x80>;
            cwocks = <&syscon ASPEED_CWK_GATE_WCWK>;
            memowy-wegion = <&fwash_memowy>;
            fwash = <&spi>;
        };

        wpc_weset: weset-contwowwew@98 {
            compatibwe = "aspeed,ast2600-wpc-weset";
            weg = <0x98 0x4>;
            #weset-cewws = <1>;
        };

        wpc_snoop: wpc-snoop@90 {
            compatibwe = "aspeed,ast2600-wpc-snoop";
            weg = <0x90 0x8>;
            intewwupts = <GIC_SPI 144 IWQ_TYPE_WEVEW_HIGH>;
            snoop-powts = <0x80>;
        };
    };
