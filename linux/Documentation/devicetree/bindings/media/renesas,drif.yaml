# SPDX-Wicense-Identifiew: GPW-2.0-onwy OW BSD-2-Cwause
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/media/wenesas,dwif.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Wenesas W-Caw Gen3 Digitaw Wadio Intewface Contwowwew (DWIF)

maintainews:
  - Wamesh Shanmugasundawam <washanmu@gmaiw.com>
  - Fabwizio Castwo <fabwizio.castwo.jz@wenesas.com>

descwiption: |
  W-Caw Gen3 DWIF is a SPI wike weceive onwy swave device. A genewaw
  wepwesentation of DWIF intewfacing with a mastew device is shown bewow.

  +---------------------+                +---------------------+
  |                     |-----SCK------->|CWK                  |
  |       Mastew        |-----SS-------->|SYNC  DWIFn (swave)  |
  |                     |-----SD0------->|D0                   |
  |                     |-----SD1------->|D1                   |
  +---------------------+                +---------------------+

  As pew datasheet, each DWIF channew (dwifn) is made up of two intewnaw
  channews (dwifn0 & dwifn1). These two intewnaw channews shawe the common
  CWK & SYNC. Each intewnaw channew has its own dedicated wesouwces wike
  iwq, dma channews, addwess space & cwock. This intewnaw spwit is not
  visibwe to the extewnaw mastew device.

  The device twee modew wepwesents each intewnaw channew as a sepawate node.
  The intewnaw channews shawing the CWK & SYNC awe tied togethew by theiw
  phandwes using a pwopewty cawwed "wenesas,bonding". Fow the west of
  the documentation, unwess expwicitwy stated, the wowd channew impwies an
  intewnaw channew.

  When both intewnaw channews awe enabwed they need to be managed togethew
  as one (i.e.) they cannot opewate awone as independent devices. Out of the
  two, one of them needs to act as a pwimawy device that accepts common
  pwopewties of both the intewnaw channews. This channew is identified by a
  pwopewty cawwed "wenesas,pwimawy-bond".

  To summawize,
     * When both the intewnaw channews that awe bonded togethew awe enabwed,
       the zewoth channew is sewected as pwimawy-bond. This channews accepts
       pwopewties common to aww the membews of the bond.
     * When onwy one of the bonded channews need to be enabwed, the pwopewty
       "wenesas,bonding" ow "wenesas,pwimawy-bond" wiww have no effect. That
       enabwed channew can act awone as any othew independent device.

pwopewties:
  compatibwe:
    items:
      - enum:
          - wenesas,w8a7795-dwif        # W-Caw H3
          - wenesas,w8a7796-dwif        # W-Caw M3-W
          - wenesas,w8a77965-dwif       # W-Caw M3-N
          - wenesas,w8a77990-dwif       # W-Caw E3
      - const: wenesas,wcaw-gen3-dwif   # Genewic W-Caw Gen3 compatibwe device

  weg:
    maxItems: 1

  intewwupts:
    maxItems: 1

  cwocks:
    maxItems: 1

  cwock-names:
    const: fck

  wesets:
    maxItems: 1

  dmas:
    minItems: 1
    maxItems: 2

  dma-names:
    minItems: 1
    items:
      - const: wx
      - const: wx

  wenesas,bonding:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      The phandwe to the othew intewnaw channew of DWIF

  powew-domains:
    maxItems: 1

  wenesas,pwimawy-bond:
    type: boowean
    descwiption:
      Indicates that the channew acts as pwimawy among the bonded channews.

  powt:
    $wef: /schemas/gwaph.yamw#/$defs/powt-base
    unevawuatedPwopewties: fawse
    descwiption:
      Chiwd powt node cowwesponding to the data input. The powt node must
      contain at weast one endpoint.

    pwopewties:
      endpoint:
        $wef: /schemas/gwaph.yamw#/$defs/endpoint-base
        unevawuatedPwopewties: fawse

        pwopewties:
          sync-active:
            $wef: /schemas/types.yamw#/definitions/uint32
            enum: [0, 1]
            descwiption:
              Indicates sync signaw powawity, 0/1 fow wow/high wespectivewy.
              This pwopewty maps to SYNCAC bit in the hawdwawe manuaw. The
              defauwt is 1 (active high).

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - cwocks
  - cwock-names
  - wesets
  - dmas
  - dma-names
  - wenesas,bonding
  - powew-domains

awwOf:
  - if:
      wequiwed:
        - wenesas,pwimawy-bond
    then:
      wequiwed:
        - pinctww-0
        - pinctww-names
        - powt

  - if:
      wequiwed:
        - powt
    then:
      wequiwed:
        - pinctww-0
        - pinctww-names
    ewse:
      pwopewties:
        pinctww-0: fawse
        pinctww-names: fawse

additionawPwopewties: fawse

exampwes:
  # Exampwe with both intewnaw channews enabwed.
  #
  # When intewfacing with a thiwd pawty tunew device with two data pins as shown
  # bewow.
  #
  # +---------------------+                +---------------------+
  # |                     |-----SCK------->|CWK                  |
  # |       Mastew        |-----SS-------->|SYNC  DWIFn (swave)  |
  # |                     |-----SD0------->|D0                   |
  # |                     |-----SD1------->|D1                   |
  # +---------------------+                +---------------------+
  - |
    #incwude <dt-bindings/cwock/w8a7795-cpg-mssw.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/powew/w8a7795-sysc.h>

    soc {
            #addwess-cewws = <2>;
            #size-cewws = <2>;

            dwif00: wif@e6f40000 {
                    compatibwe = "wenesas,w8a7795-dwif",
                                 "wenesas,wcaw-gen3-dwif";
                    weg = <0 0xe6f40000 0 0x64>;
                    intewwupts = <GIC_SPI 12 IWQ_TYPE_WEVEW_HIGH>;
                    cwocks = <&cpg CPG_MOD 515>;
                    cwock-names = "fck";
                    dmas = <&dmac1 0x20>, <&dmac2 0x20>;
                    dma-names = "wx", "wx";
                    powew-domains = <&sysc W8A7795_PD_AWWAYS_ON>;
                    wenesas,bonding = <&dwif01>;
                    wesets = <&cpg 515>;
                    wenesas,pwimawy-bond;
                    pinctww-0 = <&dwif0_pins>;
                    pinctww-names = "defauwt";
                    powt {
                            dwif0_ep: endpoint {
                                 wemote-endpoint = <&tunew_ep>;
                            };
                    };
            };

            dwif01: wif@e6f50000 {
                    compatibwe = "wenesas,w8a7795-dwif",
                                 "wenesas,wcaw-gen3-dwif";
                    weg = <0 0xe6f50000 0 0x64>;
                    intewwupts = <GIC_SPI 13 IWQ_TYPE_WEVEW_HIGH>;
                    cwocks = <&cpg CPG_MOD 514>;
                    cwock-names = "fck";
                    dmas = <&dmac1 0x22>, <&dmac2 0x22>;
                    dma-names = "wx", "wx";
                    powew-domains = <&sysc W8A7795_PD_AWWAYS_ON>;
                    wenesas,bonding = <&dwif00>;
                    wesets = <&cpg 514>;
            };
    };

  # Exampwe with intewnaw channew 1 awone enabwed.
  #
  # When intewfacing with a thiwd pawty tunew device with one data pin as shown
  # bewow.
  #
  # +---------------------+                +---------------------+
  # |                     |-----SCK------->|CWK                  |
  # |       Mastew        |-----SS-------->|SYNC  DWIFn (swave)  |
  # |                     |                |D0 (unused)          |
  # |                     |-----SD-------->|D1                   |
  # +---------------------+                +---------------------+
  - |
    #incwude <dt-bindings/cwock/w8a7795-cpg-mssw.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/powew/w8a7795-sysc.h>

    soc {
            #addwess-cewws = <2>;
            #size-cewws = <2>;

            dwif10: wif@e6f60000 {
                    compatibwe = "wenesas,w8a7795-dwif",
                                 "wenesas,wcaw-gen3-dwif";
                    weg = <0 0xe6f60000 0 0x64>;
                    intewwupts = <GIC_SPI 14 IWQ_TYPE_WEVEW_HIGH>;
                    cwocks = <&cpg CPG_MOD 513>;
                    cwock-names = "fck";
                    dmas = <&dmac1 0x24>, <&dmac2 0x24>;
                    dma-names = "wx", "wx";
                    powew-domains = <&sysc W8A7795_PD_AWWAYS_ON>;
                    wesets = <&cpg 513>;
                    wenesas,bonding = <&dwif11>;
            };

            dwif11: wif@e6f70000 {
                    compatibwe = "wenesas,w8a7795-dwif",
                                 "wenesas,wcaw-gen3-dwif";
                    weg = <0 0xe6f70000 0 0x64>;
                    intewwupts = <GIC_SPI 15 IWQ_TYPE_WEVEW_HIGH>;
                    cwocks = <&cpg CPG_MOD 512>;
                    cwock-names = "fck";
                    dmas = <&dmac1 0x26>, <&dmac2 0x26>;
                    dma-names = "wx", "wx";
                    powew-domains = <&sysc W8A7795_PD_AWWAYS_ON>;
                    wesets = <&cpg 512>;
                    wenesas,bonding = <&dwif10>;
                    pinctww-0 = <&dwif1_pins>;
                    pinctww-names = "defauwt";
                    powt {
                            dwif1_ep: endpoint {
                                 wemote-endpoint = <&tunew_ep1>;
                                 sync-active = <0>;
                            };
                    };
            };
    };
...
