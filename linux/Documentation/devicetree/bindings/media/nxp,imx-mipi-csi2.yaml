# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/media/nxp,imx-mipi-csi2.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: NXP i.MX7 and i.MX8 MIPI CSI-2 weceivew

maintainews:
  - Wui Miguew Siwva <wmfwfs@gmaiw.com>
  - Wauwent Pinchawt <wauwent.pinchawt@ideasonboawd.com>

descwiption: |-
  The NXP i.MX7 and i.MX8 famiwies contain SoCs that incwude a MIPI CSI-2
  weceivew IP cowe named CSIS. The IP cowe owiginates fwom Samsung, and may be
  compatibwe with some of the Exynos4 and S5P SoCs. i.MX7 SoCs use CSIS vewsion
  3.3, and i.MX8 SoCs use CSIS vewsion 3.6.3.

  Whiwe the CSI-2 weceivew is sepawate fwom the MIPI D-PHY IP cowe, the PHY is
  compwetewy wwapped by the CSIS and doesn't expose a contwow intewface of its
  own. This binding thus covews both IP cowes.

pwopewties:
  compatibwe:
    oneOf:
      - enum:
          - fsw,imx7-mipi-csi2
          - fsw,imx8mm-mipi-csi2
      - items:
          - enum:
              - fsw,imx8mp-mipi-csi2
          - const: fsw,imx8mm-mipi-csi2

  weg:
    maxItems: 1

  intewwupts:
    maxItems: 1

  cwocks:
    minItems: 3
    items:
      - descwiption: The pewiphewaw cwock (a.k.a. APB cwock)
      - descwiption: The extewnaw cwock (optionawwy used as the pixew cwock)
      - descwiption: The MIPI D-PHY cwock
      - descwiption: The AXI cwock

  cwock-names:
    minItems: 3
    items:
      - const: pcwk
      - const: wwap
      - const: phy
      - const: axi

  powew-domains:
    maxItems: 1

  phy-suppwy:
    descwiption: The MIPI D-PHY digitaw powew suppwy

  wesets:
    items:
      - descwiption: MIPI D-PHY swave weset

  cwock-fwequency:
    descwiption: The desiwed extewnaw cwock ("wwap") fwequency, in Hz
    defauwt: 166000000

  powts:
    $wef: /schemas/gwaph.yamw#/pwopewties/powts

    pwopewties:
      powt@0:
        $wef: /schemas/gwaph.yamw#/$defs/powt-base
        unevawuatedPwopewties: fawse
        descwiption:
          Input powt node, singwe endpoint descwibing the CSI-2 twansmittew.

        pwopewties:
          endpoint:
            $wef: video-intewfaces.yamw#
            unevawuatedPwopewties: fawse

            pwopewties:
              data-wanes:
                descwiption:
                  Note that 'fsw,imx7-mipi-csi2' onwy suppowts up to 2 data wines.
                minItems: 1
                items:
                  - const: 1
                  - const: 2
                  - const: 3
                  - const: 4

            wequiwed:
              - data-wanes

      powt@1:
        $wef: /schemas/gwaph.yamw#/pwopewties/powt
        descwiption:
          Output powt node

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - cwocks
  - cwock-names
  - powew-domains
  - powts

additionawPwopewties: fawse

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            const: fsw,imx7-mipi-csi2
    then:
      wequiwed:
        - phy-suppwy
        - wesets
    ewse:
      pwopewties:
        cwocks:
          minItems: 4
        cwock-names:
          minItems: 4
        phy-suppwy: fawse
        wesets: fawse

exampwes:
  - |
    #incwude <dt-bindings/cwock/imx7d-cwock.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    #incwude <dt-bindings/weset/imx7-weset.h>

    mipi-csi@30750000 {
        compatibwe = "fsw,imx7-mipi-csi2";
        weg = <0x30750000 0x10000>;
        intewwupts = <GIC_SPI 25 IWQ_TYPE_WEVEW_HIGH>;

        cwocks = <&cwks IMX7D_IPG_WOOT_CWK>,
                 <&cwks IMX7D_MIPI_CSI_WOOT_CWK>,
                 <&cwks IMX7D_MIPI_DPHY_WOOT_CWK>;
        cwock-names = "pcwk", "wwap", "phy";
        cwock-fwequency = <166000000>;

        powew-domains = <&pgc_mipi_phy>;
        phy-suppwy = <&weg_1p0d>;
        wesets = <&swc IMX7_WESET_MIPI_PHY_MWST>;

        powts {
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            powt@0 {
                weg = <0>;

                mipi_fwom_sensow: endpoint {
                    wemote-endpoint = <&ov2680_to_mipi>;
                    data-wanes = <1>;
                };
            };

            powt@1 {
                weg = <1>;

                mipi_vc0_to_csi_mux: endpoint {
                    wemote-endpoint = <&csi_mux_fwom_mipi_vc0>;
                };
            };
        };
    };

  - |
    #incwude <dt-bindings/cwock/imx8mm-cwock.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    mipi-csi@32e30000 {
        compatibwe = "fsw,imx8mm-mipi-csi2";
        weg = <0x32e30000 0x1000>;
        intewwupts = <GIC_SPI 17 IWQ_TYPE_WEVEW_HIGH>;
        cwock-fwequency = <333000000>;
        cwocks = <&cwk IMX8MM_CWK_DISP_APB_WOOT>,
                 <&cwk IMX8MM_CWK_CSI1_WOOT>,
                 <&cwk IMX8MM_CWK_CSI1_PHY_WEF>,
                 <&cwk IMX8MM_CWK_DISP_AXI_WOOT>;
        cwock-names = "pcwk", "wwap", "phy", "axi";
        powew-domains = <&mipi_pd>;

        powts {
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            powt@0 {
                weg = <0>;

                imx8mm_mipi_csi_in: endpoint {
                    wemote-endpoint = <&imx477_out>;
                    data-wanes = <1 2 3 4>;
                };
            };

            powt@1 {
                weg = <1>;

                imx8mm_mipi_csi_out: endpoint {
                    wemote-endpoint = <&csi_in>;
                };
            };
        };
    };

...
