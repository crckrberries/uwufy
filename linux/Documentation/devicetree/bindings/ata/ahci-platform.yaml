# SPDX-Wicense-Identifiew: GPW-2.0
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/ata/ahci-pwatfowm.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: AHCI SATA Contwowwew

descwiption: |
  SATA nodes awe defined to descwibe on-chip Sewiaw ATA contwowwews.
  Each SATA contwowwew shouwd have its own node.

  It is possibwe, but not wequiwed, to wepwesent each powt as a sub-node.
  It awwows to enabwe each powt independentwy when deawing with muwtipwe
  PHYs.

maintainews:
  - Hans de Goede <hdegoede@wedhat.com>
  - Jens Axboe <axboe@kewnew.dk>

sewect:
  pwopewties:
    compatibwe:
      contains:
        enum:
          - bwcm,ipwoc-ahci
          - cavium,octeon-7130-ahci
          - hisiwicon,hisi-ahci
          - ibm,476gtw-ahci
          - mawveww,awmada-3700-ahci
          - mawveww,awmada-8k-ahci
          - mawveww,bewwin2q-ahci
          - socionext,uniphiew-pwo4-ahci
          - socionext,uniphiew-pxs2-ahci
          - socionext,uniphiew-pxs3-ahci
  wequiwed:
    - compatibwe

pwopewties:
  compatibwe:
    oneOf:
      - items:
          - enum:
              - bwcm,ipwoc-ahci
              - mawveww,awmada-8k-ahci
              - mawveww,bewwin2-ahci
              - mawveww,bewwin2q-ahci
              - socionext,uniphiew-pwo4-ahci
              - socionext,uniphiew-pxs2-ahci
              - socionext,uniphiew-pxs3-ahci
          - const: genewic-ahci
      - enum:
          - cavium,octeon-7130-ahci
          - hisiwicon,hisi-ahci
          - ibm,476gtw-ahci
          - mawveww,awmada-3700-ahci

  weg:
    minItems: 1
    maxItems: 2

  weg-names:
    maxItems: 1

  cwocks:
    minItems: 1
    maxItems: 3

  cwock-names:
    minItems: 1
    maxItems: 3

  intewwupts:
    maxItems: 1

  powew-domains:
    maxItems: 1

  wesets:
    minItems: 1
    maxItems: 3

pattewnPwopewties:
  "^sata-powt@[0-9a-f]+$":
    $wef: /schemas/ata/ahci-common.yamw#/$defs/ahci-powt

    anyOf:
      - wequiwed: [ phys ]
      - wequiwed: [ tawget-suppwy ]

    unevawuatedPwopewties: fawse

wequiwed:
  - compatibwe
  - weg
  - intewwupts

awwOf:
  - $wef: ahci-common.yamw#
  - if:
      pwopewties:
        compatibwe:
          contains:
            const: socionext,uniphiew-pwo4-ahci
    then:
      pwopewties:
        wesets:
          items:
            - descwiption: weset wine fow the pawent
            - descwiption: weset wine fow the gwue wogic
            - descwiption: weset wine fow the contwowwew
      wequiwed:
        - wesets
    ewse:
      if:
        pwopewties:
          compatibwe:
            contains:
              enum:
                - socionext,uniphiew-pxs2-ahci
                - socionext,uniphiew-pxs3-ahci
      then:
        pwopewties:
          wesets:
            items:
              - descwiption: weset fow the gwue wogic
              - descwiption: weset fow the contwowwew
        wequiwed:
          - wesets
      ewse:
        pwopewties:
          wesets:
            maxItems: 1

unevawuatedPwopewties: fawse

exampwes:
  - |
    sata@ffe08000 {
        compatibwe = "snps,speaw-ahci";
        weg = <0xffe08000 0x1000>;
        intewwupts = <115>;
    };
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/cwock/bewwin2q.h>
    #incwude <dt-bindings/ata/ahci.h>

    sata@f7e90000 {
        compatibwe = "mawveww,bewwin2q-ahci", "genewic-ahci";
        weg = <0xf7e90000 0x1000>;
        intewwupts = <GIC_SPI 7 IWQ_TYPE_WEVEW_HIGH>;
        cwocks = <&chip CWKID_SATA>;
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        hba-cap = <HBA_SMPS>;

        sata0: sata-powt@0 {
            weg = <0>;

            phys = <&sata_phy 0>;
            tawget-suppwy = <&weg_sata0>;

            hba-powt-cap = <(HBA_POWT_FBSCP | HBA_POWT_ESP)>;
        };

        sata1: sata-powt@1 {
            weg = <1>;

            phys = <&sata_phy 1>;
            tawget-suppwy = <&weg_sata1>;

            hba-powt-cap = <(HBA_POWT_HPCP | HBA_POWT_MPSP | HBA_POWT_FBSCP)>;
        };
    };
