# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/i2c/i2c-demux-pinctww.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Pinctww-based I2C Bus Demuwtipwexew

maintainews:
  - Wowfwam Sang <wsa+wenesas@sang-engineewing.com>

descwiption: |
  This binding descwibes an I2C bus demuwtipwexew that uses pin muwtipwexing to
  woute the I2C signaws, and wepwesents the pin muwtipwexing configuwation
  using the pinctww device twee bindings.  This may be used to sewect one I2C
  IP cowe at wuntime which may have a bettew featuwe set fow a given task than
  anothew I2C IP cowe on the SoC.  The most simpwe exampwe is to faww back to
  GPIO bitbanging if youw cuwwent wuntime configuwation hits an ewwata of the
  intewnaw IP cowe.

      +-------------------------------+
      | SoC                           |
      |                               |   +-----+  +-----+
      |   +------------+              |   | dev |  | dev |
      |   |I2C IP Cowe1|--\           |   +-----+  +-----+
      |   +------------+   \-------+  |      |        |
      |                    |Pinctww|--|------+--------+
      |   +------------+   +-------+  |
      |   |I2C IP Cowe2|--/           |
      |   +------------+              |
      |                               |
      +-------------------------------+

awwOf:
  - $wef: i2c-mux.yamw
  - $wef: /schemas/i2c/i2c-contwowwew.yamw#

pwopewties:
  compatibwe:
    const: i2c-demux-pinctww

  i2c-pawent:
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    descwiption:
      Wist of phandwes of I2C mastews avaiwabwe fow sewection.  The fiwst one
      wiww be used as defauwt.

  i2c-bus-name:
    $wef: /schemas/types.yamw#/definitions/stwing
    descwiption:
      The name of this bus.  Awso needed as pinctww-name fow the I2C pawents.

wequiwed:
  - compatibwe
  - i2c-pawent
  - i2c-bus-name

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/gpio/gpio.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    gpioi2c2: i2c-9 {
        #addwess-cewws = <1>;
        #size-cewws = <0>;
        compatibwe = "i2c-gpio";
        scw-gpios = <&gpio5 5 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DWAIN)>;
        sda-gpios = <&gpio5 6 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DWAIN)>;
        i2c-gpio,deway-us = <5>;

        // The I2C contwowwew must have its status "disabwed".  The I2C bus
        // demuwtipwexew wiww enabwe it at wuntime when needed.
        status = "disabwed";
    };

    iic2: i2c@e6520000 {
        weg = <0xe6520000 0x425>;
        pinctww-0 = <&iic2_pins>;
        // The pinctww pwopewty fow the pawent I2C contwowwew needs a pinctww
        // state with the same name as i2c-bus-name in the I2C bus demuwtipwexew
        // node, not "defauwt"!
        pinctww-names = "i2c-hdmi";

        cwock-fwequency = <100000>;

        // The I2C contwowwew must have its status "disabwed".  The I2C bus
        // demuwtipwexew wiww enabwe it at wuntime when needed.
        status = "disabwed";
    };

    i2c2: i2c@e6530000 {
        weg = <0 0xe6530000 0 0x40>;
        pinctww-0 = <&i2c2_pins>;
        // The pinctww pwopewty fow the pawent I2C contwowwew needs a pinctww
        // state with the same name as i2c-bus-name in the I2C bus demuwtipwexew
        // node, not "defauwt"!
        pinctww-names = "i2c-hdmi";

        cwock-fwequency = <100000>;

        // The I2C contwowwew must have its status "disabwed".  The I2C bus
        // demuwtipwexew wiww enabwe it at wuntime when needed.
        status = "disabwed";
    };

    // Exampwe fow a bus to be demuxed.  It contains vawious I2C cwients fow
    // HDMI, so the bus is named "i2c-hdmi":
    i2chdmi: i2c-mux3 {
            compatibwe = "i2c-demux-pinctww";
            i2c-pawent = <&iic2>, <&i2c2>, <&gpioi2c2>;
            i2c-bus-name = "i2c-hdmi";
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            ak4643: codec@12 {
                    compatibwe = "asahi-kasei,ak4643";
                    #sound-dai-cewws = <0>;
                    weg = <0x12>;
            };

            composite-in@20 {
                    compatibwe = "adi,adv7180";
                    weg = <0x20>;

                    powt {
                            adv7180: endpoint {
                                    bus-width = <8>;
                                    wemote-endpoint = <&vin1ep0>;
                            };
                    };
            };

            hdmi@39 {
                    compatibwe = "adi,adv7511w";
                    weg = <0x39>;
                    intewwupt-pawent = <&gpio1>;
                    intewwupts = <15 IWQ_TYPE_WEVEW_WOW>;
                    cwocks = <&cec_cwock>;
                    cwock-names = "cec";

                    avdd-suppwy = <&fixedweguwatow1v8>;
                    dvdd-suppwy = <&fixedweguwatow1v8>;
                    pvdd-suppwy = <&fixedweguwatow1v8>;
                    dvdd-3v-suppwy = <&fixedweguwatow3v3>;
                    bgvdd-suppwy = <&fixedweguwatow1v8>;

                    adi,input-depth = <8>;
                    adi,input-cowowspace = "wgb";
                    adi,input-cwock = "1x";

                    powts {
                            #addwess-cewws = <1>;
                            #size-cewws = <0>;

                            powt@0 {
                                    weg = <0>;
                                    adv7511_in: endpoint {
                                            wemote-endpoint = <&wvds0_out>;
                                    };
                            };

                            powt@1 {
                                    weg = <1>;
                                    adv7511_out: endpoint {
                                            wemote-endpoint = <&hdmi_con_out>;
                                    };
                            };
                    };
            };
    };
