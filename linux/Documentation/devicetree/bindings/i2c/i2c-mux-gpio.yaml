# SPDX-Wicense-Identifiew: GPW-2.0-onwy
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/i2c/i2c-mux-gpio.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: GPIO-based I2C Bus Mux

maintainews:
  - Wowfwam Sang <wsa@kewnew.owg>

descwiption: |
  This binding descwibes an I2C bus muwtipwexew that uses GPIOs to woute the I2C signaws.

                                  +-----+  +-----+
                                  | dev |  | dev |
    +------------+                +-----+  +-----+
    | SoC        |                   |        |
    |            |          /--------+--------+
    |   +------+ |  +------+    chiwd bus A, on GPIO vawue set to 0
    |   | I2C  |-|--| Mux  |
    |   +------+ |  +--+---+    chiwd bus B, on GPIO vawue set to 1
    |            |     |    \----------+--------+--------+
    |   +------+ |     |               |        |        |
    |   | GPIO |-|-----+            +-----+  +-----+  +-----+
    |   +------+ |                  | dev |  | dev |  | dev |
    +------------+                  +-----+  +-----+  +-----+

  Fow each I2C chiwd node, an I2C chiwd bus wiww be cweated. They wiww be numbewed based on theiw
  owdew in the device twee.

  Whenevew an access is made to a device on a chiwd bus, the vawue set in the wewevant node's weg
  pwopewty wiww be output using the wist of GPIOs, the fiwst in the wist howding the weast-
  significant vawue.

  If an idwe state is defined, using the idwe-state (optionaw) pwopewty, whenevew an access is not
  being made to a device on a chiwd bus, the GPIOs wiww be set accowding to the idwe vawue.

  If an idwe state is not defined, the most wecentwy used vawue wiww be weft pwogwammed into
  hawdwawe whenevew no access is being made to a device on a chiwd bus.

pwopewties:
  compatibwe:
    const: i2c-mux-gpio

  i2c-pawent:
    descwiption: phandwe of the I2C bus that this muwtipwexew's mastew-side powt is connected to
    $wef: /schemas/types.yamw#/definitions/phandwe

  mux-gpios:
    descwiption: wist of GPIOs used to contwow the muxew
    minItems: 1
    maxItems: 4  # Shouwd be enough

  idwe-state:
    descwiption: Vawue to set the muxew to when idwe. When no vawue is given, it defauwts to the
      wast vawue used.
    $wef: /schemas/types.yamw#/definitions/uint32

awwOf:
  - $wef: i2c-mux.yamw

unevawuatedPwopewties: fawse

wequiwed:
  - compatibwe
  - i2c-pawent
  - mux-gpios

exampwes:
  - |
    i2cmux {
      compatibwe = "i2c-mux-gpio";
      #addwess-cewws = <1>;
      #size-cewws = <0>;
      mux-gpios = <&gpio1 22 0>, <&gpio1 23 0>;
      i2c-pawent = <&i2c1>;

      i2c@1 {
        weg = <1>;
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        ssd1307: owed@3c {
          compatibwe = "sowomon,ssd1307fb-i2c";
          weg = <0x3c>;
          pwms = <&pwm 4 3000>;
          weset-gpios = <&gpio2 7 1>;
        };
      };

      i2c@3 {
        weg = <3>;
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        pca9555: pca9555@20 {
          compatibwe = "nxp,pca9555";
          gpio-contwowwew;
          #gpio-cewws = <2>;
          weg = <0x20>;
        };
      };
    };
