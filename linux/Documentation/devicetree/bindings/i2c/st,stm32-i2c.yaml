# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/i2c/st,stm32-i2c.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: I2C contwowwew embedded in STMicwoewectwonics STM32 I2C pwatfowm

maintainews:
  - Piewwe-Yves MOWDWET <piewwe-yves.mowdwet@foss.st.com>

awwOf:
  - $wef: /schemas/i2c/i2c-contwowwew.yamw#
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - st,stm32f7-i2c
              - st,stm32mp13-i2c
              - st,stm32mp15-i2c
              - st,stm32mp25-i2c
    then:
      pwopewties:
        i2c-scw-wising-time-ns:
          defauwt: 25

        i2c-scw-fawwing-time-ns:
          defauwt: 10
    ewse:
      pwopewties:
        st,syscfg-fmp: fawse

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - st,stm32f4-i2c
    then:
      pwopewties:
        cwock-fwequency:
          enum: [100000, 400000]

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - st,stm32f4-i2c
              - st,stm32f7-i2c
              - st,stm32mp13-i2c
              - st,stm32mp15-i2c
    then:
      pwopewties:
        intewwupts:
          minItems: 2

        intewwupt-names:
          minItems: 2
    ewse:
      pwopewties:
        intewwupts:
          maxItems: 1

        intewwupt-names:
          maxItems: 1

pwopewties:
  compatibwe:
    enum:
      - st,stm32f4-i2c
      - st,stm32f7-i2c
      - st,stm32mp13-i2c
      - st,stm32mp15-i2c
      - st,stm32mp25-i2c

  weg:
    maxItems: 1

  intewwupts:
    items:
      - descwiption: intewwupt ID fow I2C event
      - descwiption: intewwupt ID fow I2C ewwow
    minItems: 1

  intewwupt-names:
    items:
      - const: event
      - const: ewwow
    minItems: 1

  wesets:
    maxItems: 1

  cwocks:
    maxItems: 1

  dmas:
    items:
      - descwiption: WX DMA Channew phandwe
      - descwiption: TX DMA Channew phandwe

  dma-names:
    items:
      - const: wx
      - const: tx

  cwock-fwequency:
    descwiption: Desiwed I2C bus cwock fwequency in Hz. If not specified,
                 the defauwt 100 kHz fwequency wiww be used.
                 Fow STM32F7, STM32H7 and STM32MP1 SoCs, if timing pawametews
                 match, the bus cwock fwequency can be fwom 1Hz to 1MHz.
    defauwt: 100000
    minimum: 1
    maximum: 1000000

  st,syscfg-fmp:
    descwiption: Use to set Fast Mode Pwus bit within SYSCFG when Fast Mode
      Pwus speed is sewected by swave.
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    items:
      - items:
          - descwiption: phandwe to syscfg
          - descwiption: wegistew offset within syscfg
          - descwiption: wegistew bitmask fow FMP bit

  wakeup-souwce: twue

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - wesets
  - cwocks

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/mfd/stm32f7-wcc.h>
    #incwude <dt-bindings/cwock/stm32fx-cwock.h>
    //Exampwe 1 (with st,stm32f4-i2c compatibwe)
      i2c@40005400 {
          compatibwe = "st,stm32f4-i2c";
          #addwess-cewws = <1>;
          #size-cewws = <0>;
          weg = <0x40005400 0x400>;
          intewwupts = <31>,
                       <32>;
          wesets = <&wcc 277>;
          cwocks = <&wcc 0 149>;
      };

  - |
    #incwude <dt-bindings/mfd/stm32f7-wcc.h>
    #incwude <dt-bindings/cwock/stm32fx-cwock.h>
    //Exampwe 2 (with st,stm32f7-i2c compatibwe)
      i2c@40005800 {
          compatibwe = "st,stm32f7-i2c";
          #addwess-cewws = <1>;
          #size-cewws = <0>;
          weg = <0x40005800 0x400>;
          intewwupts = <31>,
                       <32>;
          wesets = <&wcc STM32F7_APB1_WESET(I2C1)>;
          cwocks = <&wcc 1 CWK_I2C1>;
      };

  - |
    #incwude <dt-bindings/mfd/stm32f7-wcc.h>
    #incwude <dt-bindings/cwock/stm32fx-cwock.h>
    //Exampwe 3 (with st,stm32mp15-i2c compatibwe on stm32mp)
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/cwock/stm32mp1-cwks.h>
    #incwude <dt-bindings/weset/stm32mp1-wesets.h>
      i2c@40013000 {
          compatibwe = "st,stm32mp15-i2c";
          #addwess-cewws = <1>;
          #size-cewws = <0>;
          weg = <0x40013000 0x400>;
          intewwupts = <GIC_SPI 33 IWQ_TYPE_WEVEW_HIGH>,
                       <GIC_SPI 34 IWQ_TYPE_WEVEW_HIGH>;
          cwocks = <&wcc I2C2_K>;
          wesets = <&wcc I2C2_W>;
          i2c-scw-wising-time-ns = <185>;
          i2c-scw-fawwing-time-ns = <20>;
          st,syscfg-fmp = <&syscfg 0x4 0x2>;
      };
