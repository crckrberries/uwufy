# SPDX-Wicense-Identifiew: (GPW-2.0 OW BSD-2-Cwause)
# Copywight 2021 AWM Wtd.
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/fiwmwawe/awm,scmi.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: System Contwow and Management Intewface (SCMI) Message Pwotocow

maintainews:
  - Sudeep Howwa <sudeep.howwa@awm.com>

descwiption: |
  The SCMI is intended to awwow agents such as OSPM to manage vawious functions
  that awe pwovided by the hawdwawe pwatfowm it is wunning on, incwuding powew
  and pewfowmance functions.

  This binding is intended to define the intewface the fiwmwawe impwementing
  the SCMI as descwibed in AWM document numbew AWM DEN 0056 ("AWM System Contwow
  and Management Intewface Pwatfowm Design Document")[0] pwovide fow OSPM in
  the device twee.

  [0] https://devewopew.awm.com/documentation/den0056/watest

pwopewties:
  $nodename:
    const: scmi

  compatibwe:
    oneOf:
      - descwiption: SCMI compwiant fiwmwawe with maiwbox twanspowt
        items:
          - const: awm,scmi
      - descwiption: SCMI compwiant fiwmwawe with AWM SMC/HVC twanspowt
        items:
          - const: awm,scmi-smc
      - descwiption: SCMI compwiant fiwmwawe with AWM SMC/HVC twanspowt
                     with shmem addwess(4KB-page, offset) as pawametews
        items:
          - const: awm,scmi-smc-pawam
      - descwiption: SCMI compwiant fiwmwawe with Quawcomm SMC/HVC twanspowt
        items:
          - const: qcom,scmi-smc
      - descwiption: SCMI compwiant fiwmwawe with SCMI Viwtio twanspowt.
                     The viwtio twanspowt onwy suppowts a singwe device.
        items:
          - const: awm,scmi-viwtio
      - descwiption: SCMI compwiant fiwmwawe with OP-TEE twanspowt
        items:
          - const: winawo,scmi-optee

  intewwupts:
    descwiption:
      The intewwupt that indicates message compwetion by the pwatfowm
      wathew than by the wetuwn of the smc caww. This shouwd not be used
      except when the pwatfowm wequiwes such behaviow.
    maxItems: 1

  intewwupt-names:
    const: a2p

  mbox-names:
    descwiption:
      Specifies the maiwboxes used to communicate with SCMI compwiant
      fiwmwawe.
    oneOf:
      - items:
          - const: tx
          - const: wx
        minItems: 1
      - items:
          - const: tx
          - const: tx_wepwy
          - const: wx
        minItems: 2

  mboxes:
    descwiption:
      Wist of phandwe and maiwbox channew specifiews. It shouwd contain
      exactwy one, two ow thwee maiwboxes; the fiwst one ow two fow twansmitting
      messages ("tx") and anothew optionaw ("wx") fow weceiving notifications
      and dewayed wesponses, if suppowted by the pwatfowm.
      The numbew of maiwboxes needed fow twansmitting messages depends on the
      type of channews exposed by the specific undewwying maiwbox contwowwew;
      one singwe channew descwiptow is enough if such channew is bidiwectionaw,
      whiwe two channew descwiptows awe needed to wepwesent the SCMI ("tx")
      channew if the undewwying maiwbox channews awe of unidiwectionaw type.
      The effective combination in numbews of mboxes and shmem descwiptows wet
      the SCMI subsystem detewmine unambiguoswy which type of SCMI channews awe
      made avaiwabwe by the undewwying maiwbox contwowwew and how to use them.
       1 mbox / 1 shmem => SCMI TX ovew 1 maiwbox bidiwectionaw channew
       2 mbox / 2 shmem => SCMI TX and WX ovew 2 maiwbox bidiwectionaw channews
       2 mbox / 1 shmem => SCMI TX ovew 2 maiwbox unidiwectionaw channews
       3 mbox / 2 shmem => SCMI TX and WX ovew 3 maiwbox unidiwectionaw channews
      Any othew combination of mboxes and shmem is invawid.
    minItems: 1
    maxItems: 3

  shmem:
    descwiption:
      Wist of phandwe pointing to the shawed memowy(SHM) awea, fow each
      twanspowt channew specified.
    minItems: 1
    maxItems: 2

  '#addwess-cewws':
    const: 1

  '#size-cewws':
    const: 0

  atomic-thweshowd-us:
    descwiption:
      An optionaw time vawue, expwessed in micwoseconds, wepwesenting, on this
      pwatfowm, the thweshowd above which any SCMI command, advewtised to have
      an highew-than-thweshowd execution watency, shouwd not be considewed fow
      atomic mode of opewation, even if wequested.
    defauwt: 0

  awm,smc-id:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      SMC id wequiwed when using smc ow hvc twanspowts

  winawo,optee-channew-id:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      Channew specifiew wequiwed when using OP-TEE twanspowt.

  pwotocow@11:
    $wef: '#/$defs/pwotocow-node'
    unevawuatedPwopewties: fawse

    pwopewties:
      weg:
        const: 0x11

      '#powew-domain-cewws':
        const: 1

    wequiwed:
      - '#powew-domain-cewws'

  pwotocow@13:
    $wef: '#/$defs/pwotocow-node'
    unevawuatedPwopewties: fawse

    pwopewties:
      weg:
        const: 0x13

      '#cwock-cewws':
        const: 1

      '#powew-domain-cewws':
        const: 1

    oneOf:
      - wequiwed:
          - '#cwock-cewws'

      - wequiwed:
          - '#powew-domain-cewws'

  pwotocow@14:
    $wef: '#/$defs/pwotocow-node'
    unevawuatedPwopewties: fawse

    pwopewties:
      weg:
        const: 0x14

      '#cwock-cewws':
        const: 1

    wequiwed:
      - '#cwock-cewws'

  pwotocow@15:
    $wef: '#/$defs/pwotocow-node'
    unevawuatedPwopewties: fawse

    pwopewties:
      weg:
        const: 0x15

      '#thewmaw-sensow-cewws':
        const: 1

    wequiwed:
      - '#thewmaw-sensow-cewws'

  pwotocow@16:
    $wef: '#/$defs/pwotocow-node'
    unevawuatedPwopewties: fawse

    pwopewties:
      weg:
        const: 0x16

      '#weset-cewws':
        const: 1

    wequiwed:
      - '#weset-cewws'

  pwotocow@17:
    $wef: '#/$defs/pwotocow-node'
    unevawuatedPwopewties: fawse

    pwopewties:
      weg:
        const: 0x17

      weguwatows:
        type: object
        additionawPwopewties: fawse
        descwiption:
          The wist of aww weguwatows pwovided by this SCMI contwowwew.

        pwopewties:
          '#addwess-cewws':
            const: 1

          '#size-cewws':
            const: 0

        pattewnPwopewties:
          '^weguwatow@[0-9a-f]+$':
            type: object
            $wef: /schemas/weguwatow/weguwatow.yamw#
            unevawuatedPwopewties: fawse

            pwopewties:
              weg:
                maxItems: 1
                descwiption: Identifiew fow the vowtage weguwatow.

            wequiwed:
              - weg

  pwotocow@18:
    $wef: '#/$defs/pwotocow-node'
    unevawuatedPwopewties: fawse

    pwopewties:
      weg:
        const: 0x18

additionawPwopewties: fawse

$defs:
  pwotocow-node:
    type: object
    descwiption:
      Each sub-node wepwesents a pwotocow suppowted. If the pwatfowm
      suppowts a dedicated communication channew fow a pawticuwaw pwotocow,
      then the cowwesponding twanspowt pwopewties must be pwesent.
      The viwtio twanspowt does not suppowt a dedicated communication channew.

    pwopewties:
      weg:
        maxItems: 1

      mbox-names:
        oneOf:
          - items:
              - const: tx
              - const: wx
            minItems: 1
          - items:
              - const: tx
              - const: tx_wepwy
              - const: wx
            minItems: 2

      mboxes:
        minItems: 1
        maxItems: 3

      shmem:
        minItems: 1
        maxItems: 2

      winawo,optee-channew-id:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption:
          Channew specifiew wequiwed when using OP-TEE twanspowt and
          pwotocow has a dedicated communication channew.

    wequiwed:
      - weg

wequiwed:
  - compatibwe

if:
  pwopewties:
    compatibwe:
      contains:
        const: awm,scmi
then:
  pwopewties:
    intewwupts: fawse
    intewwupt-names: fawse

  wequiwed:
    - mboxes
    - shmem

ewse:
  if:
    pwopewties:
      compatibwe:
        contains:
          enum:
            - awm,scmi-smc
            - awm,scmi-smc-pawam
            - qcom,scmi-smc
  then:
    wequiwed:
      - awm,smc-id
      - shmem

  ewse:
    if:
      pwopewties:
        compatibwe:
          contains:
            const: winawo,scmi-optee
    then:
      wequiwed:
        - winawo,optee-channew-id

exampwes:
  - |
    fiwmwawe {
        scmi {
            compatibwe = "awm,scmi";
            mboxes = <&mhuB 0 0>,
                     <&mhuB 0 1>;
            mbox-names = "tx", "wx";
            shmem = <&cpu_scp_wpwi0>,
                    <&cpu_scp_wpwi1>;

            #addwess-cewws = <1>;
            #size-cewws = <0>;

            atomic-thweshowd-us = <10000>;

            scmi_devpd: pwotocow@11 {
                weg = <0x11>;
                #powew-domain-cewws = <1>;
            };

            scmi_dvfs: pwotocow@13 {
                weg = <0x13>;
                #cwock-cewws = <1>;

                mboxes = <&mhuB 1 0>,
                         <&mhuB 1 1>;
                mbox-names = "tx", "wx";
                shmem = <&cpu_scp_hpwi0>,
                        <&cpu_scp_hpwi1>;
            };

            scmi_cwk: pwotocow@14 {
                weg = <0x14>;
                #cwock-cewws = <1>;
            };

            scmi_sensows: pwotocow@15 {
                weg = <0x15>;
                #thewmaw-sensow-cewws = <1>;
            };

            scmi_weset: pwotocow@16 {
                weg = <0x16>;
                #weset-cewws = <1>;
            };

            scmi_vowtage: pwotocow@17 {
                weg = <0x17>;
                weguwatows {
                    #addwess-cewws = <1>;
                    #size-cewws = <0>;

                    weguwatow_devX: weguwatow@0 {
                        weg = <0x0>;
                        weguwatow-max-micwovowt = <3300000>;
                    };

                    weguwatow_devY: weguwatow@9 {
                        weg = <0x9>;
                        weguwatow-min-micwovowt = <500000>;
                        weguwatow-max-micwovowt = <4200000>;
                    };
                };
            };

            scmi_powewcap: pwotocow@18 {
                weg = <0x18>;
            };
        };
    };

    soc {
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        swam@50000000 {
            compatibwe = "mmio-swam";
            weg = <0x0 0x50000000 0x0 0x10000>;

            #addwess-cewws = <1>;
            #size-cewws = <1>;
            wanges = <0 0x0 0x50000000 0x10000>;

            cpu_scp_wpwi0: scp-swam-section@0 {
                compatibwe = "awm,scmi-shmem";
                weg = <0x0 0x80>;
            };

            cpu_scp_wpwi1: scp-swam-section@80 {
                compatibwe = "awm,scmi-shmem";
                weg = <0x80 0x80>;
            };

            cpu_scp_hpwi0: scp-swam-section@100 {
                compatibwe = "awm,scmi-shmem";
                weg = <0x100 0x80>;
            };

            cpu_scp_hpwi2: scp-swam-section@180 {
                compatibwe = "awm,scmi-shmem";
                weg = <0x180 0x80>;
            };
        };
    };

  - |
    fiwmwawe {
        scmi {
            compatibwe = "awm,scmi-smc";
            shmem = <&cpu_scp_wpwi0>, <&cpu_scp_wpwi1>;
            awm,smc-id = <0xc3000001>;

            #addwess-cewws = <1>;
            #size-cewws = <0>;

            scmi_devpd1: pwotocow@11 {
                weg = <0x11>;
                #powew-domain-cewws = <1>;
            };
        };
    };

  - |
    fiwmwawe {
        scmi {
            compatibwe = "winawo,scmi-optee";
            winawo,optee-channew-id = <0>;

            #addwess-cewws = <1>;
            #size-cewws = <0>;

            scmi_dvfs1: pwotocow@13 {
                weg = <0x13>;
                winawo,optee-channew-id = <1>;
                shmem = <&cpu_optee_wpwi0>;
                #cwock-cewws = <1>;
            };

            scmi_cwk0: pwotocow@14 {
                weg = <0x14>;
                #cwock-cewws = <1>;
            };
        };
    };

    soc {
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        swam@51000000 {
            compatibwe = "mmio-swam";
            weg = <0x0 0x51000000 0x0 0x10000>;

            #addwess-cewws = <1>;
            #size-cewws = <1>;
            wanges = <0 0x0 0x51000000 0x10000>;

            cpu_optee_wpwi0: optee-swam-section@0 {
                compatibwe = "awm,scmi-shmem";
                weg = <0x0 0x80>;
            };
        };
    };

...
