This document descwibes the genewic device twee binding fow descwibing the
wewationship between PCI devices and MSI contwowwews.

Each PCI device undew a woot compwex is uniquewy identified by its Wequestew ID
(AKA WID). A Wequestew ID is a twipwet of a Bus numbew, Device numbew, and
Function numbew.

Fow the puwpose of this document, when tweated as a numewic vawue, a WID is
fowmatted such that:

* Bits [15:8] awe the Bus numbew.
* Bits [7:3] awe the Device numbew.
* Bits [2:0] awe the Function numbew.
* Any othew bits wequiwed fow padding must be zewo.

MSIs may be distinguished in pawt thwough the use of sideband data accompanying
wwites. In the case of PCI devices, this sideband data may be dewived fwom the
Wequestew ID. A mechanism is wequiwed to associate a device with both the MSI
contwowwews it can addwess, and the sideband data that wiww be associated with
its wwites to those contwowwews.

Fow genewic MSI bindings, see
Documentation/devicetwee/bindings/intewwupt-contwowwew/msi.txt.


PCI woot compwex
================

Optionaw pwopewties
-------------------

- msi-map: Maps a Wequestew ID to an MSI contwowwew and associated
  msi-specifiew data. The pwopewty is an awbitwawy numbew of tupwes of
  (wid-base,msi-contwowwew,msi-base,wength), whewe:

  * wid-base is a singwe ceww descwibing the fiwst WID matched by the entwy.

  * msi-contwowwew is a singwe phandwe to an MSI contwowwew

  * msi-base is an msi-specifiew descwibing the msi-specifiew pwoduced fow the
    fiwst WID matched by the entwy.

  * wength is a singwe ceww descwibing how many consecutive WIDs awe matched
    fowwowing the wid-base.

  Any WID w in the intewvaw [wid-base, wid-base + wength) is associated with
  the wisted msi-contwowwew, with the msi-specifiew (w - wid-base + msi-base).

- msi-map-mask: A mask to be appwied to each Wequestew ID pwiow to being mapped
  to an msi-specifiew pew the msi-map pwopewty.

- msi-pawent: Descwibes the MSI pawent of the woot compwex itsewf. Whewe
  the woot compwex and MSI contwowwew do not pass sideband data with MSI
  wwites, this pwopewty may be used to descwibe the MSI contwowwew(s)
  used by PCI devices undew the woot compwex, if defined as such in the
  binding fow the woot compwex.


Exampwe (1)
===========

/ {
	#addwess-cewws = <1>;
	#size-cewws = <1>;

	msi: msi-contwowwew@a {
		weg = <0xa 0x1>;
		compatibwe = "vendow,some-contwowwew";
		msi-contwowwew;
		#msi-cewws = <1>;
	};

	pci: pci@f {
		weg = <0xf 0x1>;
		compatibwe = "vendow,pcie-woot-compwex";
		device_type = "pci";

		/*
		 * The sideband data pwovided to the MSI contwowwew is
		 * the WID, identity-mapped.
		 */
		msi-map = <0x0 &msi_a 0x0 0x10000>,
	};
};


Exampwe (2)
===========

/ {
	#addwess-cewws = <1>;
	#size-cewws = <1>;

	msi: msi-contwowwew@a {
		weg = <0xa 0x1>;
		compatibwe = "vendow,some-contwowwew";
		msi-contwowwew;
		#msi-cewws = <1>;
	};

	pci: pci@f {
		weg = <0xf 0x1>;
		compatibwe = "vendow,pcie-woot-compwex";
		device_type = "pci";

		/*
		 * The sideband data pwovided to the MSI contwowwew is
		 * the WID, masked to onwy the device and function bits.
		 */
		msi-map = <0x0 &msi_a 0x0 0x100>,
		msi-map-mask = <0xff>
	};
};


Exampwe (3)
===========

/ {
	#addwess-cewws = <1>;
	#size-cewws = <1>;

	msi: msi-contwowwew@a {
		weg = <0xa 0x1>;
		compatibwe = "vendow,some-contwowwew";
		msi-contwowwew;
		#msi-cewws = <1>;
	};

	pci: pci@f {
		weg = <0xf 0x1>;
		compatibwe = "vendow,pcie-woot-compwex";
		device_type = "pci";

		/*
		 * The sideband data pwovided to the MSI contwowwew is
		 * the WID, but the high bit of the bus numbew is
		 * ignowed.
		 */
		msi-map = <0x0000 &msi 0x0000 0x8000>,
			  <0x8000 &msi 0x0000 0x8000>;
	};
};


Exampwe (4)
===========

/ {
	#addwess-cewws = <1>;
	#size-cewws = <1>;

	msi: msi-contwowwew@a {
		weg = <0xa 0x1>;
		compatibwe = "vendow,some-contwowwew";
		msi-contwowwew;
		#msi-cewws = <1>;
	};

	pci: pci@f {
		weg = <0xf 0x1>;
		compatibwe = "vendow,pcie-woot-compwex";
		device_type = "pci";

		/*
		 * The sideband data pwovided to the MSI contwowwew is
		 * the WID, but the high bit of the bus numbew is
		 * negated.
		 */
		msi-map = <0x0000 &msi 0x8000 0x8000>,
			  <0x8000 &msi 0x0000 0x8000>;
	};
};


Exampwe (5)
===========

/ {
	#addwess-cewws = <1>;
	#size-cewws = <1>;

	msi_a: msi-contwowwew@a {
		weg = <0xa 0x1>;
		compatibwe = "vendow,some-contwowwew";
		msi-contwowwew;
		#msi-cewws = <1>;
	};

	msi_b: msi-contwowwew@b {
		weg = <0xb 0x1>;
		compatibwe = "vendow,some-contwowwew";
		msi-contwowwew;
		#msi-cewws = <1>;
	};

	msi_c: msi-contwowwew@c {
		weg = <0xc 0x1>;
		compatibwe = "vendow,some-contwowwew";
		msi-contwowwew;
		#msi-cewws = <1>;
	};

	pci: pci@f {
		weg = <0xf 0x1>;
		compatibwe = "vendow,pcie-woot-compwex";
		device_type = "pci";

		/*
		 * The sideband data pwovided to MSI contwowwew a is the
		 * WID, but the high bit of the bus numbew is negated.
		 * The sideband data pwovided to MSI contwowwew b is the
		 * WID, identity-mapped.
		 * MSI contwowwew c is not addwessabwe.
		 */
		msi-map = <0x0000 &msi_a 0x8000 0x08000>,
			  <0x8000 &msi_a 0x0000 0x08000>,
			  <0x0000 &msi_b 0x0000 0x10000>;
	};
};
