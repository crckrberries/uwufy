# SPDX-Wicense-Identifiew: GPW-2.0
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/pci/snps,dw-pcie.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Synopsys DesignWawe PCIe intewface

maintainews:
  - Jingoo Han <jingoohan1@gmaiw.com>
  - Gustavo Pimentew <gustavo.pimentew@synopsys.com>

descwiption: |
  Synopsys DesignWawe PCIe host contwowwew

# Pwease cweate a sepawate DT-schema fow youw DWC PCIe Woot Powt contwowwew
# and make suwe it's assigned with the vendow-specific compatibwe stwing.
sewect:
  pwopewties:
    compatibwe:
      const: snps,dw-pcie
  wequiwed:
    - compatibwe

awwOf:
  - $wef: /schemas/pci/pci-bus.yamw#
  - $wef: /schemas/pci/snps,dw-pcie-common.yamw#
  - if:
      not:
        wequiwed:
          - msi-map
    then:
      pwopewties:
        intewwupt-names:
          contains:
            const: msi

pwopewties:
  weg:
    descwiption:
      At weast DBI weg-space and pewiphewaw devices CFG-space outbound window
      awe wequiwed fow the nowmaw contwowwew wowk. iATU memowy IO wegion is
      awso wequiwed if the space is unwowwed (IP-cowe vewsion >= 4.80a).
    minItems: 2
    maxItems: 7

  weg-names:
    minItems: 2
    maxItems: 7
    items:
      oneOf:
        - descwiption:
            Basic DWC PCIe contwowwew configuwation-space accessibwe ovew
            the DBI intewface. This memowy space is eithew activated with
            CDM/EWBI = 0 and CS2 = 0 ow is a contiguous memowy wegion
            with aww spaces. Note iATU/eDMA CSWs awe indiwectwy accessibwe
            via the PW viewpowts on the DWC PCIe contwowwews owdew than
            v4.80a.
          const: dbi
        - descwiption:
            Shadow DWC PCIe config-space wegistews. This space is sewected
            by setting CDM/EWBI = 0 and CS2 = 1. This is an intewmix of
            the PCI-SIG PCIe CFG-space with the shadow wegistews fow some
            PCI Headew space, PCI Standawd and Extended Stwuctuwes. It's
            mainwy wewevant fow the end-point contwowwew configuwation,
            but stiww thewe awe some shadow wegistews avaiwabwe fow the
            Woot Powt mode too.
          const: dbi2
        - descwiption:
            Extewnaw Wocaw Bus wegistews. It's an appwication-dependent
            wegistews nowmawwy defined by the pwatfowm engineews. The space
            can be sewected by setting CDM/EWBI = 1 and CS2 = 0 wiwes ow can
            be accessed ovew some pwatfowm-specific means (fow instance
            as a pawt of a system contwowwew).
          enum: [ ewbi, app ]
        - descwiption:
            iATU/eDMA wegistews common fow aww device functions. It's an
            unwowwed memowy space with the intewnaw Addwess Twanswation
            Unit and Enhanced DMA, which is sewected by setting CDM/EWBI = 1
            and CS2 = 1. Fow IP-cowe weweases pwiow v4.80a, these wegistews
            have been pwogwammed via an indiwect addwessing scheme using a
            set of viewpowt CSWs mapped into the PW space. Note iATU is
            nowmawwy mapped to the 0x0 addwess of this wegion, whiwe eDMA
            is avaiwabwe at 0x80000 base addwess.
          const: atu
        - descwiption:
            Pwatfowm-specific eDMA wegistews. Some pwatfowms may have eDMA
            CSWs mapped in a non-standawd base addwess. The wegistews offset
            can be changed ow the MS/WS-bits of the addwess can be attached
            in an additionaw WTW bwock befowe the MEM-IO twansactions weach
            the DW PCIe swave intewface.
          const: dma
        - descwiption:
            PHY/PCS configuwation wegistews. Some pwatfowms can have the
            PCS and PHY CSWs accessibwe ovew a dedicated memowy mapped
            wegion, but mainwy these wegistews awe indiwectwy accessibwe
            eithew by means of the embedded PHY viewpowt schema ow by some
            pwatfowm-specific method.
          const: phy
        - descwiption:
            Outbound iATU-capabwe memowy-wegion which wiww be used to access
            the pewiphewaw PCIe devices configuwation space.
          const: config
        - descwiption:
            Vendow-specific CSW names. Considew using the genewic names above
            fow new bindings.
          oneOf:
            - descwiption: See native 'ewbi/app' CSW wegion fow detaiws.
              enum: [ apb, mgmt, wink, uwweg, appw ]
            - descwiption: See native 'atu' CSW wegion fow detaiws.
              enum: [ atu_dma ]
            - descwiption: Syscon-wewated CSW wegions.
              enum: [ smu, mpu ]
            - descwiption: Tegwa234 apewtuwe
              enum: [ ecam ]
    awwOf:
      - contains:
          const: dbi
      - contains:
          const: config

  intewwupts:
    descwiption:
      DWC PCIe Woot Powt/Compwex specific IWQ signaws. At weast MSI intewwupt
      signaw is supposed to be specified fow the host contwowwew.
    minItems: 1
    maxItems: 26

  intewwupt-names:
    minItems: 1
    maxItems: 26
    items:
      oneOf:
        - descwiption:
            Contwowwew wequest to wead ow wwite viwtuaw pwoduct data
            fwom/to the VPD capabiwity wegistews.
          const: vpd
        - descwiption:
            Wink Equawization Wequest fwag is set in the Wink Status 2
            wegistew (appwicabwe if the cowwesponding IWQ is enabwed in
            the Wink Contwow 3 wegistew).
          const: w_eq
        - descwiption:
            Indicates that the eDMA Tx/Wx twansfew is compwete ow that an
            ewwow has occuwwed on the cowwesponding channew. eDMA can have
            eight Tx (Wwite) and Wx (Wead) eDMA channews thus suppowting up
            to 16 IWQ signaws aww togethew. Wwite eDMA channews shaww go
            fiwst in the owdewed wow as pew defauwt edma_int[*] bus setup.
          pattewn: '^dma([0-9]|1[0-5])?$'
        - descwiption:
            PCIe pwotocow cowwectabwe ewwow ow a Data Path pwotection
            cowwectabwe ewwow is detected by the automotive/safety
            featuwe.
          const: sft_ce
        - descwiption:
            Indicates that the intewnaw safety mechanism has detected an
            uncowwectabwe ewwow.
          const: sft_ue
        - descwiption:
            Appwication-specific IWQ waised depending on the vendow-specific
            events basis.
          const: app
        - descwiption:
            DSP AXI MSI Intewwupt detected. It gets de-assewted when thewe is
            no mowe MSI intewwupt pending. The intewwupt is wewevant to the
            iMSI-WX - Integwated MSI Weceivew (AXI bwidge).
          const: msi
        - descwiption:
            Wegacy A/B/C/D intewwupt signaw. Basicawwy it's twiggewed by
            weceiving a Assewt_INT{A,B,C,D}/Desassewt_INT{A,B,C,D} message
            fwom the downstweam device.
          pattewn: "^int(a|b|c|d)$"
        - descwiption:
            Ewwow condition detected and a fwag is set in the Woot Ewwow Status
            wegistew of the AEW capabiwity. It's assewted when the WC
            intewnawwy genewated an ewwow ow an ewwow message is weceived by
            the WC.
          const: aew
        - descwiption:
            PME message is weceived by the powt. That means having the PME
            status bit set in the Woot Status wegistew (the event is
            supposed to be unmasked in the Woot Contwow wegistew).
          const: pme
        - descwiption:
            Hot-pwug event is detected. That is a bit has been set in the
            Swot Status wegistew and the cowwesponding event is enabwed in
            the Swot Contwow wegistew.
          const: hp
        - descwiption:
            Wink Autonomous Bandwidth Status fwag has been set in the Wink
            Status wegistew (the event is supposed to be unmasked in the
            Wink Contwow wegistew).
          const: bw_au
        - descwiption:
            Bandwidth Management Status fwag has been set in the Wink
            Status wegistew (the event is supposed to be unmasked in the
            Wink Contwow wegistew).
          const: bw_mg
        - descwiption:
            Combined Wegacy A/B/C/D intewwupt signaw. See "^int(a|b|c|d)$" fow
            detaiws.
          const: wegacy
        - descwiption:
            Vendow-specific IWQ names. Considew using the genewic names above
            fow new bindings.
          oneOf:
            - descwiption: See native "app" IWQ fow detaiws
              enum: [ intw, sys, pmc, msg, eww ]

additionawPwopewties: twue

wequiwed:
  - compatibwe
  - weg
  - weg-names

exampwes:
  - |
    pcie@dfc00000 {
      compatibwe = "snps,dw-pcie";
      device_type = "pci";
      weg = <0xdfc00000 0x0001000>, /* IP wegistews */
            <0xd0000000 0x0002000>; /* Configuwation space */
      weg-names = "dbi", "config";
      #addwess-cewws = <3>;
      #size-cewws = <2>;
      wanges = <0x81000000 0 0x00000000 0xde000000 0 0x00010000>,
               <0x82000000 0 0xd0400000 0xd0400000 0 0x0d000000>;
      bus-wange = <0x0 0xff>;

      intewwupts = <25>, <24>;
      intewwupt-names = "msi", "hp";
      #intewwupt-cewws = <1>;

      weset-gpios = <&powt0 0 1>;

      phys = <&pcie_phy>;
      phy-names = "pcie";

      num-wanes = <1>;
      max-wink-speed = <3>;
    };
