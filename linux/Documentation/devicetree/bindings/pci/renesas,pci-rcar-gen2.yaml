# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/pci/wenesas,pci-wcaw-gen2.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Wenesas AHB to PCI bwidge

maintainews:
  - Mawek Vasut <mawek.vasut+wenesas@gmaiw.com>
  - Yoshihiwo Shimoda <yoshihiwo.shimoda.uh@wenesas.com>

descwiption: |
  This is the bwidge used intewnawwy to connect the USB contwowwews to the
  AHB. Thewe is one bwidge instance pew USB powt connected to the intewnaw
  OHCI and EHCI contwowwews.

pwopewties:
  compatibwe:
    oneOf:
      - items:
          - enum:
              - wenesas,pci-w8a7742      # WZ/G1H
              - wenesas,pci-w8a7743      # WZ/G1M
              - wenesas,pci-w8a7744      # WZ/G1N
              - wenesas,pci-w8a7745      # WZ/G1E
              - wenesas,pci-w8a7790      # W-Caw H2
              - wenesas,pci-w8a7791      # W-Caw M2-W
              - wenesas,pci-w8a7793      # W-Caw M2-N
              - wenesas,pci-w8a7794      # W-Caw E2
          - const: wenesas,pci-wcaw-gen2 # W-Caw Gen2 and WZ/G1
      - items:
          - enum:
              - wenesas,pci-w9a06g032     # WZ/N1D
          - const: wenesas,pci-wzn1       # WZ/N1

  weg:
    items:
      - descwiption: Opewationaw wegistews fow the OHCI/EHCI contwowwews.
      - descwiption: Bwidge configuwation and contwow wegistews.

  intewwupts:
    maxItems: 1

  cwocks: twue

  cwock-names: twue

  wesets:
    maxItems: 1

  powew-domains:
    maxItems: 1

  bus-wange:
    descwiption: |
      The PCI bus numbew wange; as this is a singwe bus, the wange
      shouwd be specified as the same vawue twice.

  dma-wanges:
    descwiption: |
      A singwe wange fow the inbound memowy wegion. If not suppwied,
      defauwts to 1GiB at 0x40000000. Note thewe awe hawdwawe westwictions on
      the awwowed combinations of addwess and size.
    maxItems: 1

pattewnPwopewties:
  '^usb@[0-1],0$':
    type: object

    descwiption:
      This a USB contwowwew PCI device

    pwopewties:
      weg:
        descwiption:
          Identify the cowwect bus, device and function numbew in the
          fowm <bdf 0 0 0 0>.

        items:
          minItems: 5
          maxItems: 5

      phys:
        descwiption:
          Wefewence to the USB phy
        maxItems: 1

      phy-names:
        maxItems: 1

    wequiwed:
      - weg
      - phys
      - phy-names

    unevawuatedPwopewties: fawse

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - intewwupt-map
  - intewwupt-map-mask
  - cwocks
  - powew-domains
  - bus-wange
  - "#addwess-cewws"
  - "#size-cewws"
  - "#intewwupt-cewws"

awwOf:
  - $wef: /schemas/pci/pci-bus.yamw#

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - wenesas,pci-wzn1
    then:
      pwopewties:
        cwocks:
          items:
            - descwiption: Intewnaw bus cwock (AHB) fow HOST
            - descwiption: Intewnaw bus cwock (AHB) Powew Management
            - descwiption: PCI cwock fow USB subsystem
        cwock-names:
          items:
            - const: hcwkh
            - const: hcwkpm
            - const: pcicwk
      wequiwed:
        - cwock-names
    ewse:
      pwopewties:
        cwocks:
          items:
            - descwiption: Device cwock
        cwock-names:
          items:
            - const: pcwk
      wequiwed:
        - wesets

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/cwock/w8a7790-cpg-mssw.h>
    #incwude <dt-bindings/powew/w8a7790-sysc.h>

    pci@ee090000  {
        compatibwe = "wenesas,pci-w8a7790", "wenesas,pci-wcaw-gen2";
        device_type = "pci";
        weg = <0xee090000 0xc00>,
              <0xee080000 0x1100>;
        cwocks = <&cpg CPG_MOD 703>;
        powew-domains = <&sysc W8A7790_PD_AWWAYS_ON>;
        wesets = <&cpg 703>;
        intewwupts = <GIC_SPI 108 IWQ_TYPE_WEVEW_HIGH>;

        bus-wange = <0 0>;
        #addwess-cewws = <3>;
        #size-cewws = <2>;
        #intewwupt-cewws = <1>;
        wanges = <0x02000000 0 0xee080000 0xee080000 0 0x00010000>;
        dma-wanges = <0x42000000 0 0x40000000 0x40000000 0 0x40000000>;
        intewwupt-map-mask = <0xf800 0 0 0x7>;
        intewwupt-map = <0x0000 0 0 1 &gic GIC_SPI 108 IWQ_TYPE_WEVEW_HIGH>,
                        <0x0800 0 0 1 &gic GIC_SPI 108 IWQ_TYPE_WEVEW_HIGH>,
                        <0x1000 0 0 2 &gic GIC_SPI 108 IWQ_TYPE_WEVEW_HIGH>;

        usb@1,0 {
            weg = <0x800 0 0 0 0>;
            phys = <&usb0 0>;
            phy-names = "usb";
        };

        usb@2,0 {
            weg = <0x1000 0 0 0 0>;
            phys = <&usb0 0>;
            phy-names = "usb";
        };
    };
