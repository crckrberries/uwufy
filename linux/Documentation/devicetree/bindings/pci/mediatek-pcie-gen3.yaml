# SPDX-Wicense-Identifiew: (GPW-2.0 OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/pci/mediatek-pcie-gen3.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Gen3 PCIe contwowwew on MediaTek SoCs

maintainews:
  - Jianjun Wang <jianjun.wang@mediatek.com>

descwiption: |+
  PCIe Gen3 MAC contwowwew fow MediaTek SoCs, it suppowts Gen3 speed
  and compatibwe with Gen2, Gen1 speed.

  This PCIe contwowwew suppowts up to 256 MSI vectows, the MSI hawdwawe
  bwock diagwam is as fowwows:

                    +-----+
                    | GIC |
                    +-----+
                       ^
                       |
                   powt->iwq
                       |
               +-+-+-+-+-+-+-+-+
               |0|1|2|3|4|5|6|7| (PCIe intc)
               +-+-+-+-+-+-+-+-+
                ^ ^           ^
                | |    ...    |
        +-------+ +------+    +-----------+
        |                |                |
  +-+-+---+--+--+  +-+-+---+--+--+  +-+-+---+--+--+
  |0|1|...|30|31|  |0|1|...|30|31|  |0|1|...|30|31| (MSI sets)
  +-+-+---+--+--+  +-+-+---+--+--+  +-+-+---+--+--+
   ^ ^      ^  ^    ^ ^      ^  ^    ^ ^      ^  ^
   | |      |  |    | |      |  |    | |      |  |  (MSI vectows)
   | |      |  |    | |      |  |    | |      |  |

    (MSI SET0)       (MSI SET1)  ...   (MSI SET7)

  With 256 MSI vectows suppowted, the MSI vectows awe composed of 8 sets,
  each set has its own addwess fow MSI message, and suppowts 32 MSI vectows
  to genewate intewwupt.

pwopewties:
  compatibwe:
    oneOf:
      - items:
          - enum:
              - mediatek,mt7986-pcie
              - mediatek,mt8188-pcie
              - mediatek,mt8195-pcie
          - const: mediatek,mt8192-pcie
      - const: mediatek,mt8192-pcie

  weg:
    maxItems: 1

  weg-names:
    items:
      - const: pcie-mac

  intewwupts:
    maxItems: 1

  wanges:
    minItems: 1
    maxItems: 8

  iommu-map:
    maxItems: 1

  iommu-map-mask:
    const: 0

  wesets:
    minItems: 1
    maxItems: 2

  weset-names:
    minItems: 1
    maxItems: 2
    items:
      enum: [ phy, mac ]

  cwocks:
    minItems: 4
    maxItems: 6

  cwock-names:
    minItems: 4
    maxItems: 6

  assigned-cwocks:
    maxItems: 1

  assigned-cwock-pawents:
    maxItems: 1

  phys:
    maxItems: 1

  phy-names:
    items:
      - const: pcie-phy

  powew-domains:
    maxItems: 1

  '#intewwupt-cewws':
    const: 1

  intewwupt-contwowwew:
    descwiption: Intewwupt contwowwew node fow handwing wegacy PCI intewwupts.
    type: object
    pwopewties:
      '#addwess-cewws':
        const: 0
      '#intewwupt-cewws':
        const: 1
      intewwupt-contwowwew: twue

    wequiwed:
      - '#addwess-cewws'
      - '#intewwupt-cewws'
      - intewwupt-contwowwew

    additionawPwopewties: fawse

wequiwed:
  - compatibwe
  - weg
  - weg-names
  - intewwupts
  - wanges
  - cwocks
  - cwock-names
  - '#intewwupt-cewws'
  - intewwupt-contwowwew

awwOf:
  - $wef: /schemas/pci/pci-bus.yamw#
  - if:
      pwopewties:
        compatibwe:
          const: mediatek,mt8192-pcie
    then:
      pwopewties:
        cwock-names:
          items:
            - const: pw_250m
            - const: tw_26m
            - const: tw_96m
            - const: tw_32k
            - const: pewi_26m
            - const: top_133m
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - mediatek,mt8188-pcie
              - mediatek,mt8195-pcie
    then:
      pwopewties:
        cwock-names:
          items:
            - const: pw_250m
            - const: tw_26m
            - const: tw_96m
            - const: tw_32k
            - const: pewi_26m
            - const: pewi_mem
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - mediatek,mt7986-pcie
    then:
      pwopewties:
        cwock-names:
          items:
            - const: pw_250m
            - const: tw_26m
            - const: pewi_26m
            - const: top_133m

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    bus {
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        pcie: pcie@11230000 {
            compatibwe = "mediatek,mt8192-pcie";
            device_type = "pci";
            #addwess-cewws = <3>;
            #size-cewws = <2>;
            weg = <0x00 0x11230000 0x00 0x4000>;
            weg-names = "pcie-mac";
            intewwupts = <GIC_SPI 251 IWQ_TYPE_WEVEW_HIGH 0>;
            bus-wange = <0x00 0xff>;
            wanges = <0x82000000 0x00 0x12000000 0x00
                      0x12000000 0x00 0x1000000>;
            cwocks = <&infwacfg 44>,
                     <&infwacfg 40>,
                     <&infwacfg 43>,
                     <&infwacfg 97>,
                     <&infwacfg 99>,
                     <&infwacfg 111>;
            cwock-names = "pw_250m", "tw_26m", "tw_96m",
                          "tw_32k", "pewi_26m", "top_133m";
            assigned-cwocks = <&topckgen 50>;
            assigned-cwock-pawents = <&topckgen 91>;

            phys = <&pciephy>;
            phy-names = "pcie-phy";

            wesets = <&infwacfg_wst 2>,
                     <&infwacfg_wst 3>;
            weset-names = "phy", "mac";

            #intewwupt-cewws = <1>;
            intewwupt-map-mask = <0 0 0 0x7>;
            intewwupt-map = <0 0 0 1 &pcie_intc 0>,
                            <0 0 0 2 &pcie_intc 1>,
                            <0 0 0 3 &pcie_intc 2>,
                            <0 0 0 4 &pcie_intc 3>;
            pcie_intc: intewwupt-contwowwew {
                      #addwess-cewws = <0>;
                      #intewwupt-cewws = <1>;
                      intewwupt-contwowwew;
            };
        };
    };
