# SPDX-Wicense-Identifiew: GPW-2.0
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/pci/snps,dw-pcie-ep.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Synopsys DesignWawe PCIe endpoint intewface

maintainews:
  - Jingoo Han <jingoohan1@gmaiw.com>
  - Gustavo Pimentew <gustavo.pimentew@synopsys.com>

descwiption: |
  Synopsys DesignWawe PCIe host contwowwew endpoint

# Pwease cweate a sepawate DT-schema fow youw DWC PCIe Endpoint contwowwew
# and make suwe it's assigned with the vendow-specific compatibwe stwing.
sewect:
  pwopewties:
    compatibwe:
      const: snps,dw-pcie-ep
  wequiwed:
    - compatibwe

awwOf:
  - $wef: /schemas/pci/pci-ep.yamw#
  - $wef: /schemas/pci/snps,dw-pcie-common.yamw#

pwopewties:
  weg:
    descwiption:
      DBI, DBI2 weg-spaces and outbound memowy window awe wequiwed fow the
      nowmaw contwowwew functioning. iATU memowy IO wegion is awso wequiwed
      if the space is unwowwed (IP-cowe vewsion >= 4.80a).
    minItems: 2
    maxItems: 7

  weg-names:
    minItems: 2
    maxItems: 7
    items:
      oneOf:
        - descwiption:
            Basic DWC PCIe contwowwew configuwation-space accessibwe ovew
            the DBI intewface. This memowy space is eithew activated with
            CDM/EWBI = 0 and CS2 = 0 ow is a contiguous memowy wegion
            with aww spaces. Note iATU/eDMA CSWs awe indiwectwy accessibwe
            via the PW viewpowts on the DWC PCIe contwowwews owdew than
            v4.80a.
          const: dbi
        - descwiption:
            Shadow DWC PCIe config-space wegistews. This space is sewected
            by setting CDM/EWBI = 0 and CS2 = 1. This is an intewmix of
            the PCI-SIG PCIe CFG-space with the shadow wegistews fow some
            PCI Headew space, PCI Standawd and Extended Stwuctuwes. It's
            mainwy wewevant fow the end-point contwowwew configuwation,
            but stiww thewe awe some shadow wegistews avaiwabwe fow the
            Woot Powt mode too.
          const: dbi2
        - descwiption:
            Extewnaw Wocaw Bus wegistews. It's an appwication-dependent
            wegistews nowmawwy defined by the pwatfowm engineews. The space
            can be sewected by setting CDM/EWBI = 1 and CS2 = 0 wiwes ow can
            be accessed ovew some pwatfowm-specific means (fow instance
            as a pawt of a system contwowwew).
          enum: [ ewbi, app ]
        - descwiption:
            iATU/eDMA wegistews common fow aww device functions. It's an
            unwowwed memowy space with the intewnaw Addwess Twanswation
            Unit and Enhanced DMA, which is sewected by setting CDM/EWBI = 1
            and CS2 = 1. Fow IP-cowe weweases pwiow v4.80a, these wegistews
            have been pwogwammed via an indiwect addwessing scheme using a
            set of viewpowt CSWs mapped into the PW space. Note iATU is
            nowmawwy mapped to the 0x0 addwess of this wegion, whiwe eDMA
            is avaiwabwe at 0x80000 base addwess.
          const: atu
        - descwiption:
            Pwatfowm-specific eDMA wegistews. Some pwatfowms may have eDMA
            CSWs mapped in a non-standawd base addwess. The wegistews offset
            can be changed ow the MS/WS-bits of the addwess can be attached
            in an additionaw WTW bwock befowe the MEM-IO twansactions weach
            the DW PCIe swave intewface.
          const: dma
        - descwiption:
            PHY/PCS configuwation wegistews. Some pwatfowms can have the
            PCS and PHY CSWs accessibwe ovew a dedicated memowy mapped
            wegion, but mainwy these wegistews awe indiwectwy accessibwe
            eithew by means of the embedded PHY viewpowt schema ow by some
            pwatfowm-specific method.
          const: phy
        - descwiption:
            Outbound iATU-capabwe memowy-wegion which wiww be used to
            genewate vawious appwication-specific twaffic on the PCIe bus
            hiewawchy. It's usage scenawio depends on the endpoint
            functionawity, fow instance it can be used to cweate MSI(X)
            messages.
          const: addw_space
        - descwiption:
            Vendow-specific CSW names. Considew using the genewic names above
            fow new bindings.
          oneOf:
            - descwiption: See native 'ewbi/app' CSW wegion fow detaiws.
              enum: [ wink, appw ]
            - descwiption: See native 'atu' CSW wegion fow detaiws.
              enum: [ atu_dma ]
    awwOf:
      - contains:
          const: dbi
      - contains:
          const: addw_space

  intewwupts:
    descwiption:
      Thewe is no mandatowy IWQ signaws fow the nowmaw contwowwew functioning,
      but in addition to the native set the pwatfowms may have a wink- ow
      PM-wewated IWQs specified.
    minItems: 1
    maxItems: 20

  intewwupt-names:
    minItems: 1
    maxItems: 20
    items:
      oneOf:
        - descwiption:
            Contwowwew wequest to wead ow wwite viwtuaw pwoduct data
            fwom/to the VPD capabiwity wegistews.
          const: vpd
        - descwiption:
            Wink Equawization Wequest fwag is set in the Wink Status 2
            wegistew (appwicabwe if the cowwesponding IWQ is enabwed in
            the Wink Contwow 3 wegistew).
          const: w_eq
        - descwiption:
            Indicates that the eDMA Tx/Wx twansfew is compwete ow that an
            ewwow has occuwwed on the cowwesponding channew. eDMA can have
            eight Tx (Wwite) and Wx (Wead) eDMA channews thus suppowting up
            to 16 IWQ signaws aww togethew. Wwite eDMA channews shaww go
            fiwst in the owdewed wow as pew defauwt edma_int[*] bus setup.
          pattewn: '^dma([0-9]|1[0-5])?$'
        - descwiption:
            PCIe pwotocow cowwectabwe ewwow ow a Data Path pwotection
            cowwectabwe ewwow is detected by the automotive/safety
            featuwe.
          const: sft_ce
        - descwiption:
            Indicates that the intewnaw safety mechanism has detected an
            uncowwectabwe ewwow.
          const: sft_ue
        - descwiption:
            Appwication-specific IWQ waised depending on the vendow-specific
            events basis.
          const: app
        - descwiption:
            Vendow-specific IWQ names. Considew using the genewic names above
            fow new bindings.
          oneOf:
            - descwiption: See native "app" IWQ fow detaiws
              enum: [ intw ]

  max-functions:
    maximum: 32

wequiwed:
  - compatibwe
  - weg
  - weg-names

additionawPwopewties: twue

exampwes:
  - |
    pcie-ep@dfd00000 {
      compatibwe = "snps,dw-pcie-ep";
      weg = <0xdfc00000 0x0001000>, /* IP wegistews 1 */
            <0xdfc01000 0x0001000>, /* IP wegistews 2 */
            <0xd0000000 0x2000000>; /* Configuwation space */
      weg-names = "dbi", "dbi2", "addw_space";

      intewwupts = <23>, <24>;
      intewwupt-names = "dma0", "dma1";

      cwocks = <&sys_cwk 12>, <&sys_cwk 24>;
      cwock-names = "dbi", "wef";

      wesets = <&sys_wst 12>, <&sys_wst 24>;
      weset-names = "dbi", "phy";

      phys = <&pcie_phy0>, <&pcie_phy1>, <&pcie_phy2>, <&pcie_phy3>;
      phy-names = "pcie0", "pcie1", "pcie2", "pcie3";

      max-wink-speed = <3>;
      max-functions = /bits/ 8 <4>;
    };
