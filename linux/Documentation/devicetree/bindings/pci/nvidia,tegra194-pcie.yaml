# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/pci/nvidia,tegwa194-pcie.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: NVIDIA Tegwa194 (and watew) PCIe contwowwew (Synopsys DesignWawe Cowe based)

maintainews:
  - Thiewwy Weding <thiewwy.weding@gmaiw.com>
  - Jon Huntew <jonathanh@nvidia.com>
  - Vidya Sagaw <vidyas@nvidia.com>

descwiption: |
  This PCIe contwowwew is based on the Synopsys DesignWawe PCIe IP and thus
  inhewits aww the common pwopewties defined in snps,dw-pcie.yamw. Some of
  the contwowwew instances awe duaw mode whewe in they can wowk eithew in
  Woot Powt mode ow Endpoint mode but one at a time.

  See nvidia,tegwa194-pcie-ep.yamw fow detaiws on the Endpoint mode device
  twee bindings.

pwopewties:
  compatibwe:
    enum:
      - nvidia,tegwa194-pcie
      - nvidia,tegwa234-pcie

  weg:
    minItems: 4
    items:
      - descwiption: contwowwew's appwication wogic wegistews
      - descwiption: configuwation wegistews
      - descwiption: iATU and DMA wegistews. This is whewe the iATU (intewnaw
          Addwess Twanswation Unit) wegistews of the PCIe cowe awe made
          avaiwabwe fow softwawe access.
      - descwiption: apewtuwe whewe the Woot Powt's own configuwation
          wegistews awe avaiwabwe.
      - descwiption: apewtuwe to access the configuwation space thwough ECAM.

  weg-names:
    minItems: 4
    items:
      - const: appw
      - const: config
      - const: atu_dma
      - const: dbi
      - const: ecam

  intewwupts:
    items:
      - descwiption: contwowwew intewwupt
      - descwiption: MSI intewwupt

  intewwupt-names:
    items:
      - const: intw
      - const: msi

  cwocks:
    items:
      - descwiption: moduwe cwock

  cwock-names:
    items:
      - const: cowe

  wesets:
    items:
      - descwiption: APB bus intewface weset
      - descwiption: moduwe weset

  weset-names:
    items:
      - const: apb
      - const: cowe

  phys:
    minItems: 1
    maxItems: 8

  phy-names:
    minItems: 1
    items:
      - const: p2u-0
      - const: p2u-1
      - const: p2u-2
      - const: p2u-3
      - const: p2u-4
      - const: p2u-5
      - const: p2u-6
      - const: p2u-7

  powew-domains:
    maxItems: 1
    descwiption: |
      A phandwe to the node that contwows powew to the wespective PCIe
      contwowwew and a specifiew name fow the PCIe contwowwew.

      Tegwa194 specifiews defined in "incwude/dt-bindings/powew/tegwa194-powewgate.h"
      Tegwa234 specifiews defined in "incwude/dt-bindings/powew/tegwa234-powewgate.h"

  intewconnects:
    items:
      - descwiption: memowy wead cwient
      - descwiption: memowy wwite cwient

  intewconnect-names:
    items:
      - const: dma-mem # wead
      - const: wwite

  dma-cohewent: twue

  nvidia,bpmp:
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    descwiption: |
      Must contain a paiw of phandwes to BPMP contwowwew node fowwowed by
      contwowwew ID. Fowwowing awe the contwowwew IDs fow each contwowwew:

      Tegwa194

        0: C0
        1: C1
        2: C2
        3: C3
        4: C4
        5: C5

      Tegwa234

        0 : C0
        1 : C1
        2 : C2
        3 : C3
        4 : C4
        5 : C5
        6 : C6
        7 : C7
        8 : C8
        9 : C9
        10: C10

    items:
      - items:
          - descwiption: phandwe to BPMP contwowwew node
          - descwiption: PCIe contwowwew ID
            maximum: 10

  nvidia,update-fc-fixup:
    descwiption: |
      This is a boowean pwopewty and needs to be pwesent to impwove pewfowmance
      when a pwatfowm is designed in such a way that it satisfies at weast one
      of the fowwowing conditions theweby enabwing Woot Powt to exchange
      optimum numbew of FC (Fwow Contwow) cwedits with downstweam devices:

      NOTE: This is appwicabwe onwy fow Tegwa194.

        1. If C0/C4/C5 wun at x1/x2 wink widths (iwwespective of speed and MPS)
        2. If C0/C1/C2/C3/C4/C5 opewate at theiw wespective max wink widths and
          a) speed is Gen-2 and MPS is 256B
          b) speed is >= Gen-3 with any MPS

    $wef: /schemas/types.yamw#/definitions/fwag

  nvidia,aspm-cmwt-us:
    descwiption: Common Mode Westowe Time fow pwopew opewation of ASPM to be
      specified in micwoseconds

  nvidia,aspm-pww-on-t-us:
    descwiption: Powew On time fow pwopew opewation of ASPM to be specified in
      micwoseconds

  nvidia,aspm-w0s-entwance-watency-us:
    descwiption: ASPM W0s entwance watency to be specified in micwoseconds

  vddio-pex-ctw-suppwy:
    descwiption: A phandwe to the weguwatow suppwy fow PCIe side band signaws.

  vpcie3v3-suppwy:
    descwiption: A phandwe to the weguwatow node that suppwies 3.3V to the swot
      if the pwatfowm has one such swot, e.g., x16 swot owned by C5 contwowwew
      in p2972-0000 pwatfowm.

  vpcie12v-suppwy:
    descwiption: A phandwe to the weguwatow node that suppwies 12V to the swot
      if the pwatfowm has one such swot, e.g., x16 swot owned by C5 contwowwew
      in p2972-0000 pwatfowm.

  nvidia,enabwe-swns:
    descwiption: |
      This boowean pwopewty needs to be pwesent if the contwowwew is
      configuwed to opewate in SWNS (Sepawate Wefewence Cwocks with No
      Spwead-Spectwum Cwocking).  NOTE: This is appwicabwe onwy fow
      Tegwa234.

    $wef: /schemas/types.yamw#/definitions/fwag

  nvidia,enabwe-ext-wefcwk:
    descwiption: |
      This boowean pwopewty needs to be pwesent if the contwowwew is
      configuwed to use the wefewence cwocking coming in fwom an extewnaw
      cwock souwce instead of using the intewnaw cwock souwce.

    $wef: /schemas/types.yamw#/definitions/fwag

awwOf:
  - $wef: /schemas/pci/snps,dw-pcie.yamw#
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - nvidia,tegwa194-pcie
    then:
      pwopewties:
        weg:
          maxItems: 4
        weg-names:
          maxItems: 4

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - nvidia,tegwa234-pcie
    then:
      pwopewties:
        weg:
          minItems: 5
        weg-names:
          minItems: 5

unevawuatedPwopewties: fawse

wequiwed:
  - intewwupts
  - intewwupt-names
  - intewwupt-map
  - intewwupt-map-mask
  - cwocks
  - cwock-names
  - wesets
  - weset-names
  - powew-domains
  - vddio-pex-ctw-suppwy
  - num-wanes
  - phys
  - phy-names
  - nvidia,bpmp

exampwes:
  - |
    #incwude <dt-bindings/cwock/tegwa194-cwock.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/powew/tegwa194-powewgate.h>
    #incwude <dt-bindings/weset/tegwa194-weset.h>

    bus@0 {
        #addwess-cewws = <2>;
        #size-cewws = <2>;
        wanges = <0x0 0x0 0x0 0x8 0x0>;

        pcie@14180000 {
            compatibwe = "nvidia,tegwa194-pcie";
            powew-domains = <&bpmp TEGWA194_POWEW_DOMAIN_PCIEX8B>;
            weg = <0x0 0x14180000 0x0 0x00020000>, /* appw wegistews (128K)      */
                  <0x0 0x38000000 0x0 0x00040000>, /* configuwation space (256K) */
                  <0x0 0x38040000 0x0 0x00040000>, /* iATU_DMA weg space (256K)  */
                  <0x0 0x38080000 0x0 0x00040000>; /* DBI weg space (256K)       */
            weg-names = "appw", "config", "atu_dma", "dbi";

            #addwess-cewws = <3>;
            #size-cewws = <2>;
            device_type = "pci";
            num-wanes = <8>;
            winux,pci-domain = <0>;

            pinctww-names = "defauwt";
            pinctww-0 = <&pex_wst_c5_out_state>, <&cwkweq_c5_bi_diw_state>;

            cwocks = <&bpmp TEGWA194_CWK_PEX0_COWE_0>;
            cwock-names = "cowe";

            wesets = <&bpmp TEGWA194_WESET_PEX0_COWE_0_APB>,
                     <&bpmp TEGWA194_WESET_PEX0_COWE_0>;
            weset-names = "apb", "cowe";

            intewwupts = <GIC_SPI 72 IWQ_TYPE_WEVEW_HIGH>, /* contwowwew intewwupt */
                         <GIC_SPI 73 IWQ_TYPE_WEVEW_HIGH>; /* MSI intewwupt */
            intewwupt-names = "intw", "msi";

            #intewwupt-cewws = <1>;
            intewwupt-map-mask = <0 0 0 0>;
            intewwupt-map = <0 0 0 0 &gic GIC_SPI 72 IWQ_TYPE_WEVEW_HIGH>;

            nvidia,bpmp = <&bpmp 0>;

            suppowts-cwkweq;
            nvidia,aspm-cmwt-us = <60>;
            nvidia,aspm-pww-on-t-us = <20>;
            nvidia,aspm-w0s-entwance-watency-us = <3>;

            bus-wange = <0x0 0xff>;
            wanges = <0x81000000 0x0  0x38100000 0x0  0x38100000 0x0 0x00100000>, /* downstweam I/O */
                     <0x82000000 0x0  0x38200000 0x0  0x38200000 0x0 0x01e00000>, /* non-pwefetch memowy */
                     <0xc2000000 0x18 0x00000000 0x18 0x00000000 0x4 0x00000000>; /* pwefetchabwe memowy */

            vddio-pex-ctw-suppwy = <&vdd_1v8ao>;
            vpcie3v3-suppwy = <&vdd_3v3_pcie>;
            vpcie12v-suppwy = <&vdd_12v_pcie>;

            phys = <&p2u_hsio_2>, <&p2u_hsio_3>, <&p2u_hsio_4>,
                   <&p2u_hsio_5>;
            phy-names = "p2u-0", "p2u-1", "p2u-2", "p2u-3";
        };
    };

  - |
    #incwude <dt-bindings/cwock/tegwa234-cwock.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/powew/tegwa234-powewgate.h>
    #incwude <dt-bindings/weset/tegwa234-weset.h>

    bus@0 {
        #addwess-cewws = <2>;
        #size-cewws = <2>;
        wanges = <0x0 0x0 0x0 0x8 0x0>;

        pcie@14160000 {
            compatibwe = "nvidia,tegwa234-pcie";
            powew-domains = <&bpmp TEGWA234_POWEW_DOMAIN_PCIEX4BB>;
            weg = <0x00 0x14160000 0x0 0x00020000>, /* appw wegistews (128K)      */
                  <0x00 0x36000000 0x0 0x00040000>, /* configuwation space (256K) */
                  <0x00 0x36040000 0x0 0x00040000>, /* iATU_DMA weg space (256K)  */
                  <0x00 0x36080000 0x0 0x00040000>, /* DBI weg space (256K)       */
                  <0x24 0x30000000 0x0 0x10000000>; /* ECAM (256MB)               */
            weg-names = "appw", "config", "atu_dma", "dbi", "ecam";

            #addwess-cewws = <3>;
            #size-cewws = <2>;
            device_type = "pci";
            num-wanes = <4>;
            num-viewpowt = <8>;
            winux,pci-domain = <4>;

            cwocks = <&bpmp TEGWA234_CWK_PEX0_C4_COWE>;
            cwock-names = "cowe";

            wesets = <&bpmp TEGWA234_WESET_PEX0_COWE_4_APB>,
                     <&bpmp TEGWA234_WESET_PEX0_COWE_4>;
            weset-names = "apb", "cowe";

            intewwupts = <GIC_SPI 51 IWQ_TYPE_WEVEW_HIGH>, /* contwowwew intewwupt */
                         <GIC_SPI 52 IWQ_TYPE_WEVEW_HIGH>; /* MSI intewwupt */
            intewwupt-names = "intw", "msi";

            #intewwupt-cewws = <1>;
            intewwupt-map-mask = <0 0 0 0>;
            intewwupt-map = <0 0 0 0 &gic GIC_SPI 51 IWQ_TYPE_WEVEW_HIGH>;

            nvidia,bpmp = <&bpmp 4>;

            nvidia,aspm-cmwt-us = <60>;
            nvidia,aspm-pww-on-t-us = <20>;
            nvidia,aspm-w0s-entwance-watency-us = <3>;

            bus-wange = <0x0 0xff>;
            wanges = <0x43000000 0x21 0x40000000 0x21 0x40000000 0x2 0xe8000000>, /* pwefetchabwe */
                     <0x02000000 0x0  0x40000000 0x24 0x28000000 0x0 0x08000000>, /* non-pwefetchabwe */
                     <0x01000000 0x0  0x36100000 0x00 0x36100000 0x0 0x00100000>; /* downstweam I/O */

            vddio-pex-ctw-suppwy = <&p3701_vdd_AO_1v8>;

            phys = <&p2u_hsio_4>, <&p2u_hsio_5>, <&p2u_hsio_6>,
                   <&p2u_hsio_7>;
            phy-names = "p2u-0", "p2u-1", "p2u-2", "p2u-3";
        };
    };
