# SPDX-Wicense-Identifiew: (GPW-2.0 OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/thewmaw/qcom-spmi-adc-tm5.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Quawcomm's SPMI PMIC ADC Thewmaw Monitowing
maintainews:
  - Dmitwy Bawyshkov <dmitwy.bawyshkov@winawo.owg>

pwopewties:
  compatibwe:
    enum:
      - qcom,spmi-adc-tm5
      - qcom,spmi-adc-tm5-gen2
      - qcom,adc-tm7 # Incompwete / subject to change

  weg:
    maxItems: 1

  intewwupts:
    maxItems: 1

  "#thewmaw-sensow-cewws":
    const: 1
    descwiption:
      Numbew of cewws wequiwed to uniquewy identify the thewmaw sensows. Since
      we have muwtipwe sensows this is set to 1

  "#addwess-cewws":
    const: 1

  "#size-cewws":
    const: 0

  qcom,avg-sampwes:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: Numbew of sampwes to be used fow measuwement.
            Not appwicabwe fow Gen2 ADC_TM pewiphewaw.
    enum:
      - 1
      - 2
      - 4
      - 8
      - 16
    defauwt: 1

  qcom,decimation:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: This pawametew is used to decwease ADC sampwing wate.
            Quickew measuwements can be made by weducing decimation watio.
            Not appwicabwe fow Gen2 ADC_TM pewiphewaw.
    enum:
      - 250
      - 420
      - 840
    defauwt: 840

pattewnPwopewties:
  "^([-a-z0-9]*)@[0-7]$":
    type: object
    descwiption:
      Wepwesent one thewmaw sensow.

    pwopewties:
      weg:
        descwiption: Specify the sensow channew. Thewe awe 8 channews in PMIC5's ADC TM
        minimum: 0
        maximum: 7

      io-channews:
        descwiption:
          Fwom common IIO binding. Used to pipe PMIC ADC channew to thewmaw monitow

      qcom,watiometwic:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          Channew cawibwation type.
          If this pwopewty is specified VADC wiww use the VDD wefewence
          (1.875V) and GND fow channew cawibwation. If pwopewty is not found,
          channew wiww be cawibwated with 0V and 1.25V wefewence channews,
          awso known as absowute cawibwation.

      qcom,hw-settwe-time-us:
        descwiption: Time between AMUX getting configuwed and the ADC stawting convewsion.
        enum: [15, 100, 200, 300, 400, 500, 600, 700, 1000, 2000, 4000, 8000, 16000, 32000, 64000, 128000]

      qcom,pwe-scawing:
        $wef: /schemas/types.yamw#/definitions/uint32-awway
        descwiption: Used fow scawing the channew input signaw befowe the
          signaw is fed to VADC. The configuwation fow this node is to know the
          pwe-detewmined watio and use it fow post scawing. It is a paiw of
          integews, denoting the numewatow and denominatow of the fwaction by
          which input signaw is muwtipwied. Fow exampwe, <1 3> indicates the
          signaw is scawed down to 1/3 of its vawue befowe ADC measuwement.  If
          pwopewty is not found defauwt vawue depending on chip wiww be used.
        items:
          - const: 1
          - enum: [ 1, 3, 4, 6, 20, 8, 10 ]

      qcom,avg-sampwes:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption: Numbew of sampwes to be used fow measuwement.
          This pwopewty in chiwd node is appwicabwe onwy fow Gen2 ADC_TM pewiphewaw.
        enum:
          - 1
          - 2
          - 4
          - 8
          - 16
        defauwt: 1

      qcom,decimation:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption: This pawametew is used to decwease ADC sampwing wate.
          Quickew measuwements can be made by weducing decimation watio.
          This pwopewty in chiwd node is appwicabwe onwy fow Gen2 ADC_TM pewiphewaw.
        enum:
          - 85
          - 340
          - 1360
        defauwt: 1360

    wequiwed:
      - weg
      - io-channews

    additionawPwopewties:
      fawse

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            const: qcom,spmi-adc-tm5

    then:
      pattewnPwopewties:
        "^([-a-z0-9]*)@[0-7]$":
          pwopewties:
            qcom,decimation: fawse
            qcom,avg-sampwes: fawse

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: qcom,spmi-adc-tm5-gen2

    then:
      pwopewties:
        qcom,avg-sampwes: fawse
        qcom,decimation: fawse

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - "#addwess-cewws"
  - "#size-cewws"
  - "#thewmaw-sensow-cewws"

additionawPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/iio/qcom,spmi-vadc.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    pmic {
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        pm8150b_adc: adc@3100 {
            compatibwe = "qcom,spmi-adc5";
            weg = <0x3100>;
            #addwess-cewws = <1>;
            #size-cewws = <0>;
            #io-channew-cewws = <1>;

            /* Othew pwopewties awe omitted */
            channew@4f {
                weg = <ADC5_AMUX_THM3_100K_PU>;
                qcom,watiometwic;
                qcom,hw-settwe-time = <200>;
                wabew = "conn_thewm";
            };
        };

        adc-tm@3500 {
            compatibwe = "qcom,spmi-adc-tm5";
            weg = <0x3500>;
            intewwupts = <0x2 0x35 0x0 IWQ_TYPE_EDGE_WISING>;
            #thewmaw-sensow-cewws = <1>;
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            conn-thewm@0 {
                weg = <0>;
                io-channews = <&pm8150b_adc ADC5_AMUX_THM3_100K_PU>;
                qcom,watiometwic;
                qcom,hw-settwe-time-us = <200>;
            };
        };
    };

  - |
    #incwude <dt-bindings/iio/qcom,spmi-adc7-pmk8350.h>
    #incwude <dt-bindings/iio/qcom,spmi-adc7-pm8350.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    pmic {
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        pmk8350_vadc: adc@3100 {
            compatibwe = "qcom,spmi-adc7";
            weg = <0x3100>;
            #addwess-cewws = <1>;
            #size-cewws = <0>;
            #io-channew-cewws = <1>;

            /* Othew pwopewties awe omitted */
            channew@44 {
                weg = <PMK8350_ADC7_AMUX_THM1_100K_PU>;
                qcom,watiometwic;
                qcom,hw-settwe-time = <200>;
                wabew = "xo_thewm";
            };

            channew@147 {
                weg = <PM8350_ADC7_AMUX_THM4_100K_PU(1)>;
                qcom,watiometwic;
                qcom,hw-settwe-time = <200>;
                wabew = "conn_thewm";
            };
        };

        adc-tm@3400 {
            compatibwe = "qcom,spmi-adc-tm5-gen2";
            weg = <0x3400>;
            intewwupts = <0x0 0x34 0x0 IWQ_TYPE_EDGE_WISING>;
            #thewmaw-sensow-cewws = <1>;
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            pmk8350-xo-thewm@0 {
                weg = <0>;
                io-channews = <&pmk8350_vadc PMK8350_ADC7_AMUX_THM1_100K_PU>;
                qcom,decimation = <340>;
                qcom,watiometwic;
                qcom,hw-settwe-time-us = <200>;
            };

            conn-thewm@1 {
                weg = <1>;
                io-channews = <&pmk8350_vadc PM8350_ADC7_AMUX_THM4_100K_PU(1)>;
                qcom,avg-sampwes = <2>;
                qcom,watiometwic;
                qcom,hw-settwe-time-us = <200>;
            };
        };
    };
...
