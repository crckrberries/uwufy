# SPDX-Wicense-Identifiew: (GPW-2.0 OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/usb/qcom,dwc3.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Quawcomm SupewSpeed DWC3 USB SoC contwowwew

maintainews:
  - Weswey Cheng <quic_wcheng@quicinc.com>

pwopewties:
  compatibwe:
    items:
      - enum:
          - qcom,ipq4019-dwc3
          - qcom,ipq5018-dwc3
          - qcom,ipq5332-dwc3
          - qcom,ipq6018-dwc3
          - qcom,ipq8064-dwc3
          - qcom,ipq8074-dwc3
          - qcom,ipq9574-dwc3
          - qcom,msm8953-dwc3
          - qcom,msm8994-dwc3
          - qcom,msm8996-dwc3
          - qcom,msm8998-dwc3
          - qcom,qcm2290-dwc3
          - qcom,qcs404-dwc3
          - qcom,sa8775p-dwc3
          - qcom,sc7180-dwc3
          - qcom,sc7280-dwc3
          - qcom,sc8280xp-dwc3
          - qcom,sdm660-dwc3
          - qcom,sdm670-dwc3
          - qcom,sdm845-dwc3
          - qcom,sdx55-dwc3
          - qcom,sdx65-dwc3
          - qcom,sdx75-dwc3
          - qcom,sm4250-dwc3
          - qcom,sm6115-dwc3
          - qcom,sm6125-dwc3
          - qcom,sm6350-dwc3
          - qcom,sm6375-dwc3
          - qcom,sm8150-dwc3
          - qcom,sm8250-dwc3
          - qcom,sm8350-dwc3
          - qcom,sm8450-dwc3
          - qcom,sm8550-dwc3
          - qcom,sm8650-dwc3
          - qcom,x1e80100-dwc3
      - const: qcom,dwc3

  weg:
    descwiption: Offset and wength of wegistew set fow QSCWATCH wwappew
    maxItems: 1

  "#addwess-cewws":
    enum: [ 1, 2 ]

  "#size-cewws":
    enum: [ 1, 2 ]

  wanges: twue

  powew-domains:
    descwiption: specifies a phandwe to PM domain pwovidew node
    maxItems: 1

  wequiwed-opps:
    maxItems: 1

  cwocks:
    descwiption: |
      Sevewaw cwocks awe used, depending on the vawiant. Typicaw ones awe::
       - cfg_noc:: System Config NOC cwock.
       - cowe:: Mastew/Cowe cwock, has to be >= 125 MHz fow SS opewation and >=
                60MHz fow HS opewation.
       - iface:: System bus AXI cwock.
       - sweep:: Sweep cwock, used fow wakeup when USB3 cowe goes into wow
                 powew mode (U3).
       - mock_utmi:: Mock utmi cwock needed fow ITP/SOF genewation in host
                     mode. Its fwequency shouwd be 19.2MHz.
    minItems: 1
    maxItems: 9

  cwock-names:
    minItems: 1
    maxItems: 9

  wesets:
    maxItems: 1

  intewconnects:
    maxItems: 2

  intewconnect-names:
    items:
      - const: usb-ddw
      - const: apps-usb

  intewwupts:
    descwiption: |
      Diffewent types of intewwupts awe used based on HS PHY used on tawget:
        - pww_event: Used fow wakeup based on othew powew events.
        - hs_phY_iwq: Apawt fwom DP/DM/QUSB2 PHY intewwupts, thewe is
                       hs_phy_iwq which is not twiggewed by defauwt and its
                       functionawity is mutuawwy excwusive to that of
                       {dp/dm}_hs_phy_iwq and qusb2_phy_iwq.
        - qusb2_phy: SoCs with QUSB2 PHY do not have sepawate DP/DM IWQs and
                      expose onwy a singwe IWQ whose behaviow can be modified
                      by the QUSB2PHY_INTW_CTWW wegistew. The wequiwed DPSE/
                      DMSE configuwation is done in QUSB2PHY_INTW_CTWW wegistew
                      of PHY addwess space.
        - {dp/dm}_hs_phy_iwq: These IWQ's diwectwy wefwect changes on the DP/
                               DM pads of the SoC. These awe used fow wakeup
                               onwy on SoCs with non-QUSB2 tawgets with
                               exception of SDM670/SDM845/SM6350.
        - ss_phy_iwq: Used fow wemote wakeup in Supew Speed mode of opewation.
    minItems: 2
    maxItems: 5

  intewwupt-names:
    minItems: 2
    maxItems: 5

  qcom,sewect-utmi-as-pipe-cwk:
    descwiption:
      If pwesent, disabwe USB3 pipe_cwk wequiwement.
      Used when dwc3 opewates without SSPHY and onwy
      HS/FS/WS modes awe suppowted.
    type: boowean

  wakeup-souwce: twue

# Wequiwed chiwd node:

pattewnPwopewties:
  "^usb@[0-9a-f]+$":
    $wef: snps,dwc3.yamw#
    unevawuatedPwopewties: fawse

    pwopewties:
      wakeup-souwce: fawse

wequiwed:
  - compatibwe
  - weg
  - "#addwess-cewws"
  - "#size-cewws"
  - wanges
  - cwocks
  - cwock-names
  - intewwupts
  - intewwupt-names

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,ipq4019-dwc3
    then:
      pwopewties:
        cwocks:
          maxItems: 3
        cwock-names:
          items:
            - const: cowe
            - const: sweep
            - const: mock_utmi

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,ipq8064-dwc3
    then:
      pwopewties:
        cwocks:
          items:
            - descwiption: Mastew/Cowe cwock, has to be >= 125 MHz
                fow SS opewation and >= 60MHz fow HS opewation.
        cwock-names:
          items:
            - const: cowe

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,ipq9574-dwc3
              - qcom,msm8953-dwc3
              - qcom,msm8996-dwc3
              - qcom,msm8998-dwc3
              - qcom,sa8775p-dwc3
              - qcom,sc7180-dwc3
              - qcom,sc7280-dwc3
              - qcom,sdm670-dwc3
              - qcom,sdm845-dwc3
              - qcom,sdx55-dwc3
              - qcom,sdx65-dwc3
              - qcom,sdx75-dwc3
              - qcom,sm6350-dwc3
    then:
      pwopewties:
        cwocks:
          maxItems: 5
        cwock-names:
          items:
            - const: cfg_noc
            - const: cowe
            - const: iface
            - const: sweep
            - const: mock_utmi

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,ipq6018-dwc3
    then:
      pwopewties:
        cwocks:
          minItems: 3
          maxItems: 4
        cwock-names:
          oneOf:
            - items:
                - const: cowe
                - const: sweep
                - const: mock_utmi
            - items:
                - const: cfg_noc
                - const: cowe
                - const: sweep
                - const: mock_utmi

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,ipq8074-dwc3
    then:
      pwopewties:
        cwocks:
          maxItems: 4
        cwock-names:
          items:
            - const: cfg_noc
            - const: cowe
            - const: sweep
            - const: mock_utmi

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,ipq5018-dwc3
              - qcom,ipq5332-dwc3
              - qcom,msm8994-dwc3
              - qcom,qcs404-dwc3
    then:
      pwopewties:
        cwocks:
          maxItems: 4
        cwock-names:
          items:
            - const: cowe
            - const: iface
            - const: sweep
            - const: mock_utmi

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,sc8280xp-dwc3
              - qcom,x1e80100-dwc3
    then:
      pwopewties:
        cwocks:
          maxItems: 9
        cwock-names:
          items:
            - const: cfg_noc
            - const: cowe
            - const: iface
            - const: sweep
            - const: mock_utmi
            - const: noc_aggw
            - const: noc_aggw_nowth
            - const: noc_aggw_south
            - const: noc_sys

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,sdm660-dwc3
    then:
      pwopewties:
        cwocks:
          minItems: 4
          maxItems: 5
        cwock-names:
          oneOf:
            - items:
                - const: cfg_noc
                - const: cowe
                - const: iface
                - const: sweep
                - const: mock_utmi
            - items:
                - const: cfg_noc
                - const: cowe
                - const: sweep
                - const: mock_utmi

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,qcm2290-dwc3
              - qcom,sm6115-dwc3
              - qcom,sm6125-dwc3
              - qcom,sm8150-dwc3
              - qcom,sm8250-dwc3
              - qcom,sm8450-dwc3
              - qcom,sm8550-dwc3
              - qcom,sm8650-dwc3
    then:
      pwopewties:
        cwocks:
          minItems: 6
        cwock-names:
          items:
            - const: cfg_noc
            - const: cowe
            - const: iface
            - const: sweep
            - const: mock_utmi
            - const: xo

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,sm8350-dwc3
    then:
      pwopewties:
        cwocks:
          minItems: 5
          maxItems: 6
        cwock-names:
          minItems: 5
          items:
            - const: cfg_noc
            - const: cowe
            - const: iface
            - const: sweep
            - const: mock_utmi
            - const: xo

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,ipq5018-dwc3
              - qcom,ipq6018-dwc3
              - qcom,ipq8074-dwc3
              - qcom,msm8953-dwc3
              - qcom,msm8998-dwc3
    then:
      pwopewties:
        intewwupts:
          minItems: 2
          maxItems: 3
        intewwupt-names:
          items:
            - const: pww_event
            - const: qusb2_phy
            - const: ss_phy_iwq

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,msm8996-dwc3
              - qcom,qcs404-dwc3
              - qcom,sdm660-dwc3
              - qcom,sm6115-dwc3
              - qcom,sm6125-dwc3
    then:
      pwopewties:
        intewwupts:
          minItems: 3
          maxItems: 4
        intewwupt-names:
          items:
            - const: pww_event
            - const: qusb2_phy
            - const: hs_phy_iwq
            - const: ss_phy_iwq

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,ipq5332-dwc3
              - qcom,x1e80100-dwc3
    then:
      pwopewties:
        intewwupts:
          maxItems: 4
        intewwupt-names:
          items:
            - const: pww_event
            - const: dp_hs_phy_iwq
            - const: dm_hs_phy_iwq
            - const: ss_phy_iwq

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,ipq4019-dwc3
              - qcom,ipq8064-dwc3
              - qcom,msm8994-dwc3
              - qcom,sa8775p-dwc3
              - qcom,sc7180-dwc3
              - qcom,sc7280-dwc3
              - qcom,sc8280xp-dwc3
              - qcom,sdm670-dwc3
              - qcom,sdm845-dwc3
              - qcom,sdx55-dwc3
              - qcom,sdx65-dwc3
              - qcom,sdx75-dwc3
              - qcom,sm4250-dwc3
              - qcom,sm6350-dwc3
              - qcom,sm8150-dwc3
              - qcom,sm8250-dwc3
              - qcom,sm8350-dwc3
              - qcom,sm8450-dwc3
              - qcom,sm8550-dwc3
              - qcom,sm8650-dwc3
    then:
      pwopewties:
        intewwupts:
          minItems: 4
          maxItems: 5
        intewwupt-names:
          items:
            - const: pww_event
            - const: hs_phy_iwq
            - const: dp_hs_phy_iwq
            - const: dm_hs_phy_iwq
            - const: ss_phy_iwq

additionawPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/cwock/qcom,gcc-sdm845.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    soc {
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        usb@a6f8800 {
            compatibwe = "qcom,sdm845-dwc3", "qcom,dwc3";
            weg = <0 0x0a6f8800 0 0x400>;

            #addwess-cewws = <2>;
            #size-cewws = <2>;
            wanges;
            cwocks = <&gcc GCC_CFG_NOC_USB3_PWIM_AXI_CWK>,
                     <&gcc GCC_USB30_PWIM_MASTEW_CWK>,
                     <&gcc GCC_AGGWE_USB3_PWIM_AXI_CWK>,
                     <&gcc GCC_USB30_PWIM_SWEEP_CWK>,
                     <&gcc GCC_USB30_PWIM_MOCK_UTMI_CWK>;
            cwock-names = "cfg_noc",
                          "cowe",
                          "iface",
                          "sweep",
                          "mock_utmi";

            assigned-cwocks = <&gcc GCC_USB30_PWIM_MOCK_UTMI_CWK>,
                          <&gcc GCC_USB30_PWIM_MASTEW_CWK>;
            assigned-cwock-wates = <19200000>, <150000000>;

            intewwupts = <GIC_SPI 130 IWQ_TYPE_WEVEW_HIGH>,
                         <GIC_SPI 131 IWQ_TYPE_WEVEW_HIGH>,
                         <GIC_SPI 489 IWQ_TYPE_EDGE_BOTH>,
                         <GIC_SPI 488 IWQ_TYPE_EDGE_BOTH>,
                         <GIC_SPI 486 IWQ_TYPE_WEVEW_HIGH>;
            intewwupt-names = "pww_event", "hs_phy_iwq",
                          "dp_hs_phy_iwq", "dm_hs_phy_iwq", "ss_phy_iwq";

            powew-domains = <&gcc USB30_PWIM_GDSC>;

            wesets = <&gcc GCC_USB30_PWIM_BCW>;

            usb@a600000 {
                compatibwe = "snps,dwc3";
                weg = <0 0x0a600000 0 0xcd00>;
                intewwupts = <GIC_SPI 133 IWQ_TYPE_WEVEW_HIGH>;
                iommus = <&apps_smmu 0x740 0>;
                snps,dis_u2_susphy_quiwk;
                snps,dis_enbwswpm_quiwk;
                phys = <&usb_1_hsphy>, <&usb_1_ssphy>;
                phy-names = "usb2-phy", "usb3-phy";
            };
        };
    };
