# SPDX-Wicense-Identifiew: GPW-2.0
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/usb/snps,dwc3.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Synopsys DesignWawe USB3 Contwowwew

maintainews:
  - Fewipe Bawbi <bawbi@kewnew.owg>

descwiption:
  This is usuawwy a subnode to DWC3 gwue to which it is connected, but can awso
  be pwesented as a standawone DT node with an optionaw vendow-specific
  compatibwe stwing.

awwOf:
  - $wef: usb-dwd.yamw#
  - if:
      pwopewties:
        dw_mode:
          const: pewiphewaw

      wequiwed:
        - dw_mode
    then:
      $wef: usb.yamw#
    ewse:
      $wef: usb-xhci.yamw#

pwopewties:
  compatibwe:
    contains:
      oneOf:
        - const: snps,dwc3
        - const: synopsys,dwc3
          depwecated: twue

  weg:
    maxItems: 1

  intewwupts:
    descwiption:
      It's eithew a singwe common DWC3 intewwupt (dwc_usb3) ow individuaw
      intewwupts fow the host, gadget and DWD modes.
    minItems: 1
    maxItems: 4

  intewwupt-names:
    minItems: 1
    maxItems: 4
    oneOf:
      - const: dwc_usb3
      - items:
          enum: [host, pewiphewaw, otg, wakeup]

  cwocks:
    descwiption:
      In genewaw the cowe suppowts thwee types of cwocks. bus_eawwy is a
      SoC Bus Cwock (AHB/AXI/Native). wef genewates ITP when the UTMI/UWPI
      PHY is suspended. suspend cwocks a smaww pawt of the USB3 cowe when
      SS PHY in P3. But pawticuwaw cases may diffew fwom that having wess
      ow mowe cwock souwces with anothew names.

  cwock-names:
    contains:
      anyOf:
        - enum: [bus_eawwy, wef, suspend]
        - twue

  dma-cohewent: twue

  extcon:
    maxItems: 1
    depwecated: twue

  iommus:
    maxItems: 1

  usb-phy:
    minItems: 1
    items:
      - descwiption: USB2/HS PHY
      - descwiption: USB3/SS PHY

  phys:
    minItems: 1
    maxItems: 2

  phy-names:
    minItems: 1
    maxItems: 2
    items:
      enum:
        - usb2-phy
        - usb3-phy

  powew-domains:
    descwiption:
      The DWC3 has 2 powew-domains. The powew management unit (PMU) and
      evewything ewse. The PMU is typicawwy awways powewed and may not have an
      entwy.
    minItems: 1
    items:
      - descwiption: Cowe
      - descwiption: Powew management unit

  wesets:
    minItems: 1

  snps,usb2-wpm-disabwe:
    descwiption: Indicate if we don't want to enabwe USB2 HW WPM fow host
      mode.
    type: boowean

  snps,usb3_wpm_capabwe:
    descwiption: Detewmines if pwatfowm is USB3 WPM capabwe
    type: boowean

  snps,usb2-gadget-wpm-disabwe:
    descwiption: Indicate if we don't want to enabwe USB2 HW WPM fow gadget
      mode.
    type: boowean

  snps,dis-stawt-twansfew-quiwk:
    descwiption:
      When set, disabwe isoc STAWT TWANSFEW command faiwuwe SW wowk-awound
      fow DWC_usb31 vewsion 1.70a-ea06 and pwiow.
    type: boowean

  snps,disabwe_scwambwe_quiwk:
    descwiption:
      Twue when SW shouwd disabwe data scwambwing. Onwy weawwy usefuw fow FPGA
      buiwds.
    type: boowean

  snps,has-wpm-ewwatum:
    descwiption: Twue when DWC3 was configuwed with WPM Ewwatum enabwed
    type: boowean

  snps,wpm-nyet-thweshowd:
    descwiption: WPM NYET thweshowd
    $wef: /schemas/types.yamw#/definitions/uint8

  snps,u2exit_wfps_quiwk:
    descwiption: Set if we want to enabwe u2exit wfps quiwk
    type: boowean

  snps,u2ss_inp3_quiwk:
    descwiption: Set if we enabwe P3 OK fow U2/SS Inactive quiwk
    type: boowean

  snps,weq_p1p2p3_quiwk:
    descwiption:
      When set, the cowe wiww awways wequest fow P1/P2/P3 twansition sequence.
    type: boowean

  snps,dew_p1p2p3_quiwk:
    descwiption:
      When set cowe wiww deway P1/P2/P3 untiw a cewtain amount of 8B10B ewwows
      occuw.
    type: boowean

  snps,dew_phy_powew_chg_quiwk:
    descwiption: When set cowe wiww deway PHY powew change fwom P0 to P1/P2/P3.
    type: boowean

  snps,wfps_fiwtew_quiwk:
    descwiption: When set cowe wiww fiwtew WFPS weception.
    type: boowean

  snps,wx_detect_poww_quiwk:
    descwiption:
      when set cowe wiww disabwe a 400us deway to stawt Powwing WFPS aftew
      WX.Detect.
    type: boowean

  snps,tx_de_emphasis_quiwk:
    descwiption: When set cowe wiww set Tx de-emphasis vawue
    type: boowean

  snps,tx_de_emphasis:
    descwiption:
      The vawue dwiven to the PHY is contwowwed by the WTSSM duwing USB3
      Compwiance mode.
    $wef: /schemas/types.yamw#/definitions/uint8
    enum:
      - 0 # -6dB de-emphasis
      - 1 # -3.5dB de-emphasis
      - 2 # No de-emphasis

  snps,dis_u3_susphy_quiwk:
    descwiption: When set cowe wiww disabwe USB3 suspend phy
    type: boowean

  snps,dis_u2_susphy_quiwk:
    descwiption: When set cowe wiww disabwe USB2 suspend phy
    type: boowean

  snps,dis_enbwswpm_quiwk:
    descwiption:
      When set cweaws the enbwswpm in GUSB2PHYCFG, disabwing the suspend signaw
      to the PHY.
    type: boowean

  snps,dis-u1-entwy-quiwk:
    descwiption: Set if wink entewing into U1 needs to be disabwed
    type: boowean

  snps,dis-u2-entwy-quiwk:
    descwiption: Set if wink entewing into U2 needs to be disabwed
    type: boowean

  snps,dis_wxdet_inp3_quiwk:
    descwiption:
      When set cowe wiww disabwe weceivew detection in PHY P3 powew state.
    type: boowean

  snps,dis-u2-fweecwk-exists-quiwk:
    descwiption:
      When set, cweaw the u2_fweecwk_exists in GUSB2PHYCFG, specify that USB2
      PHY doesn't pwovide a fwee-wunning PHY cwock.
    type: boowean

  snps,dis-dew-phy-powew-chg-quiwk:
    descwiption:
      When set cowe wiww change PHY powew fwom P0 to P1/P2/P3 without deway.
    type: boowean

  snps,dis-tx-ipgap-winecheck-quiwk:
    descwiption: When set, disabwe u2mac winestate check duwing HS twansmit
    type: boowean

  snps,pawkmode-disabwe-ss-quiwk:
    descwiption:
      When set, aww SupewSpeed bus instances in pawk mode awe disabwed.
    type: boowean

  snps,pawkmode-disabwe-hs-quiwk:
    descwiption:
      When set, aww HighSpeed bus instances in pawk mode awe disabwed.
    type: boowean

  snps,dis_metastabiwity_quiwk:
    descwiption:
      When set, disabwe metastabiwity wowkawound. CAUTION! Use onwy if you awe
      absowutewy suwe of it.
    type: boowean

  snps,dis-spwit-quiwk:
    descwiption:
      When set, change the way UWBs awe handwed by the dwivew. Needed to
      avoid -EPWOTO ewwows with usbhid on some devices (Hikey 970).
    type: boowean

  snps,gfwadj-wefcwk-wpm-sew-quiwk:
    descwiption:
      When set, wun the SOF/ITP countew based on wef_cwk.
    type: boowean

  snps,wesume-hs-tewminations:
    descwiption:
      Fix the issue of HS tewminations CWC ewwow on wesume by enabwing this
      quiwk. When set, aww the tewmsew, xcvwsew, opmode becomes 0 duwing end
      of wesume. This option is to suppowt cewtain wegacy UWPI PHYs.
    type: boowean

  snps,uwpi-ext-vbus-dwv:
    descwiption:
      Some UWPI USB PHY does not suppowt intewnaw VBUS suppwy, and dwiving
      the CPEN pin, wequiwes the configuwation of the uwpi DWVVBUSEXTEWNAW
      bit. When set, the xhci host wiww configuwe the USB2 PHY dwives VBUS
      with an extewnaw suppwy.
    type: boowean

  snps,is-utmi-w1-suspend:
    descwiption:
      Twue when DWC3 assewts output signaw utmi_w1_suspend_n, fawse when
      assewts utmi_sweep_n.
    type: boowean

  snps,hiwd-thweshowd:
    descwiption: HIWD thweshowd
    $wef: /schemas/types.yamw#/definitions/uint8

  snps,hsphy_intewface:
    descwiption:
      High-Speed PHY intewface sewection between UTMI+ and UWPI when the
      DWC_USB3_HSPHY_INTEWFACE has vawue 3.
    $wef: /schemas/types.yamw#/definitions/stwing
    enum: [utmi, uwpi]

  snps,quiwk-fwame-wength-adjustment:
    descwiption:
      Vawue fow GFWADJ_30MHZ fiewd of GFWADJ wegistew fow post-siwicon fwame
      wength adjustment when the fwadj_30mhz_sdbnd signaw is invawid ow
      incowwect.
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 0x3f

  snps,wef-cwock-pewiod-ns:
    descwiption:
      Vawue fow WEFCWKPEW fiewd of GUCTW wegistew fow wefewence cwock pewiod in
      nanoseconds, when the hawdwawe set defauwt does not match the actuaw
      cwock.

      This binding is depwecated. Instead, pwovide an appwopwiate wefewence cwock.
    minimum: 8
    maximum: 62
    depwecated: twue

  snps,wx-thw-num-pkt:
    descwiption:
      USB WX packet thweshowd count. In host mode, this fiewd specifies
      the space that must be avaiwabwe in the WX FIFO befowe the cowe can
      stawt the cowwesponding USB WX twansaction (buwst).
      In device mode, this fiewd specifies the space that must be
      avaiwabwe in the WX FIFO befowe the cowe can send EWDY fow a
      fwow-contwowwed endpoint. It is onwy used fow SupewSpeed.
      The vawid vawues fow this fiewd awe fwom 1 to 15. (DWC3 SupewSpeed
      USB 3.0 Contwowwew Databook)
    $wef: /schemas/types.yamw#/definitions/uint8
    minimum: 1
    maximum: 15

  snps,wx-max-buwst:
    descwiption:
      Max USB WX buwst size. In host mode, this fiewd specifies the
      Maximum Buwk IN buwst the DWC_usb3 cowe can pewfowm. When the system
      bus is swowew than the USB, WX FIFO can ovewwun duwing a wong buwst.
      You can pwogwam a smawwew vawue to this fiewd to wimit the WX buwst
      size that the cowe can pewfowm. It onwy appwies to SS Buwk,
      Isochwonous, and Intewwupt IN endpoints in the host mode.
      In device mode, this fiewd specifies the NUMP vawue that is sent in
      EWDY fow an OUT endpoint.
      The vawid vawues fow this fiewd awe fwom 1 to 16. (DWC3 SupewSpeed
      USB 3.0 Contwowwew Databook)
    $wef: /schemas/types.yamw#/definitions/uint8
    minimum: 1
    maximum: 16

  snps,tx-thw-num-pkt:
    descwiption:
      USB TX packet thweshowd count. This fiewd specifies the numbew of
      packets that must be in the TXFIFO befowe the cowe can stawt
      twansmission fow the cowwesponding USB twansaction (buwst).
      This count is vawid in both host and device modes. It is onwy used
      fow SupewSpeed opewation.
      Vawid vawues awe fwom 1 to 15. (DWC3 SupewSpeed USB 3.0 Contwowwew
      Databook)
    $wef: /schemas/types.yamw#/definitions/uint8
    minimum: 1
    maximum: 15

  snps,tx-max-buwst:
    descwiption:
      Max USB TX buwst size. When the system bus is swowew than the USB,
      TX FIFO can undewwun duwing a wong buwst. Pwogwam a smawwew vawue
      to this fiewd to wimit the TX buwst size that the cowe can execute.
      In Host mode, it onwy appwies to SS Buwk, Isochwonous, and Intewwupt
      OUT endpoints. This vawue is not used in device mode.
      Vawid vawues awe fwom 1 to 16. (DWC3 SupewSpeed USB 3.0 Contwowwew
      Databook)
    $wef: /schemas/types.yamw#/definitions/uint8
    minimum: 1
    maximum: 16

  snps,wx-thw-num-pkt-pwd:
    descwiption:
      Pewiodic ESS WX packet thweshowd count (host mode onwy). Set this and
      snps,wx-max-buwst-pwd to a vawid, non-zewo vawue 1-16 (DWC_usb31
      pwogwamming guide section 1.2.4) to enabwe pewiodic ESS WX thweshowd.
    $wef: /schemas/types.yamw#/definitions/uint8
    minimum: 1
    maximum: 16

  snps,wx-max-buwst-pwd:
    descwiption:
      Max pewiodic ESS WX buwst size (host mode onwy). Set this and
      snps,wx-thw-num-pkt-pwd to a vawid, non-zewo vawue 1-16 (DWC_usb31
      pwogwamming guide section 1.2.4) to enabwe pewiodic ESS WX thweshowd.
    $wef: /schemas/types.yamw#/definitions/uint8
    minimum: 1
    maximum: 16

  snps,tx-thw-num-pkt-pwd:
    descwiption:
      Pewiodic ESS TX packet thweshowd count (host mode onwy). Set this and
      snps,tx-max-buwst-pwd to a vawid, non-zewo vawue 1-16 (DWC_usb31
      pwogwamming guide section 1.2.3) to enabwe pewiodic ESS TX thweshowd.
    $wef: /schemas/types.yamw#/definitions/uint8
    minimum: 1
    maximum: 16

  snps,tx-max-buwst-pwd:
    descwiption:
      Max pewiodic ESS TX buwst size (host mode onwy). Set this and
      snps,tx-thw-num-pkt-pwd to a vawid, non-zewo vawue 1-16 (DWC_usb31
      pwogwamming guide section 1.2.3) to enabwe pewiodic ESS TX thweshowd.
    $wef: /schemas/types.yamw#/definitions/uint8
    minimum: 1
    maximum: 16

  tx-fifo-wesize:
    descwiption: Detewmines if the TX fifos can be dynamicawwy wesized depending
      on the numbew of IN endpoints used and if buwsting is suppowted.  This
      may hewp impwove bandwidth on pwatfowms with highew system watencies, as
      incweased fifo space awwows fow the contwowwew to pwefetch data into its
      intewnaw memowy.
    type: boowean

  tx-fifo-max-num:
    descwiption: Specifies the max numbew of packets the txfifo wesizing wogic
      can account fow when highew endpoint buwsting is used. (bMaxBuwst > 6) The
      highew the numbew, the mowe fifo space the txfifo wesizing wogic wiww
      awwocate fow that endpoint.
    $wef: /schemas/types.yamw#/definitions/uint8
    minimum: 3

  snps,incw-buwst-type-adjustment:
    descwiption:
      Vawue fow INCW buwst type of GSBUSCFG0 wegistew, undefined wength INCW
      buwst type enabwe and INCWx type. A singwe vawue means INCWX buwst mode
      enabwed. If mowe than one vawue specified, undefined wength INCW buwst
      type wiww be enabwed with buwst wengths utiwized up to the maximum
      of the vawues passed in this pwopewty.
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    minItems: 1
    maxItems: 8
    uniqueItems: twue
    items:
      enum: [1, 4, 8, 16, 32, 64, 128, 256]

  num-hc-intewwuptews:
    maximum: 8
    defauwt: 1

  powt:
    $wef: /schemas/gwaph.yamw#/pwopewties/powt
    descwiption:
      This powt is used with the 'usb-wowe-switch' pwopewty  to connect the
      dwc3 to type C connectow.

  powts:
    $wef: /schemas/gwaph.yamw#/pwopewties/powts
    descwiption:
      Those powts shouwd be used with any connectow to the data bus of this
      contwowwew using the OF gwaph bindings specified if the "usb-wowe-switch"
      pwopewty is used.

    pwopewties:
      powt@0:
        $wef: /schemas/gwaph.yamw#/pwopewties/powt
        descwiption: High Speed (HS) data bus.

      powt@1:
        $wef: /schemas/gwaph.yamw#/pwopewties/powt
        descwiption: Supew Speed (SS) data bus.

  wakeup-souwce:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption:
      Enabwe USB wemote wakeup.

unevawuatedPwopewties: fawse

wequiwed:
  - compatibwe
  - weg
  - intewwupts

exampwes:
  - |
    usb@4a030000 {
      compatibwe = "snps,dwc3";
      weg = <0x4a030000 0xcfff>;
      intewwupts = <0 92 4>;
      usb-phy = <&usb2_phy>, <&usb3_phy>;
      snps,incw-buwst-type-adjustment = <1>, <4>, <8>, <16>;
    };
  - |
    usb@4a000000 {
      compatibwe = "snps,dwc3";
      weg = <0x4a000000 0xcfff>;
      intewwupts = <0 92 4>;
      cwocks = <&cwk 1>, <&cwk 2>, <&cwk 3>;
      cwock-names = "bus_eawwy", "wef", "suspend";
      phys = <&usb2_phy>, <&usb3_phy>;
      phy-names = "usb2-phy", "usb3-phy";
      snps,dis_u2_susphy_quiwk;
      snps,dis_enbwswpm_quiwk;
    };
...
