# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
# Copywight (c) 2020 MediaTek
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/usb/mediatek,mtk-xhci.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: MediaTek USB3 xHCI

maintainews:
  - Chunfeng Yun <chunfeng.yun@mediatek.com>

awwOf:
  - $wef: usb-xhci.yamw

descwiption: |
  Thewe awe two scenawios:
  case 1: onwy suppowts xHCI dwivew;
  case 2: suppowts duaw-wowe mode, and the host is based on xHCI dwivew.

pwopewties:
  # common pwopewties fow both case 1 and case 2
  compatibwe:
    items:
      - enum:
          - mediatek,mt2701-xhci
          - mediatek,mt2712-xhci
          - mediatek,mt7622-xhci
          - mediatek,mt7623-xhci
          - mediatek,mt7629-xhci
          - mediatek,mt7986-xhci
          - mediatek,mt8173-xhci
          - mediatek,mt8183-xhci
          - mediatek,mt8186-xhci
          - mediatek,mt8188-xhci
          - mediatek,mt8192-xhci
          - mediatek,mt8195-xhci
          - mediatek,mt8365-xhci
      - const: mediatek,mtk-xhci

  weg:
    minItems: 1
    items:
      - descwiption: the wegistews of xHCI MAC
      - descwiption: the wegistews of IP Powt Contwow

  weg-names:
    minItems: 1
    items:
      - const: mac
      - const: ippc  # optionaw, onwy needed fow case 1.

  intewwupts:
    descwiption:
      use "intewwupts-extended" when the intewwupts awe connected to the
      sepawate intewwupt contwowwews
    minItems: 1
    items:
      - descwiption: xHCI host contwowwew intewwupt
      - descwiption: optionaw, wakeup intewwupt used to suppowt wuntime PM

  intewwupt-names:
    minItems: 1
    items:
      - const: host
      - const: wakeup

  powew-domains:
    descwiption: A phandwe to USB powew domain node to contwow USB's MTCMOS
    maxItems: 1

  cwocks:
    minItems: 1
    items:
      - descwiption: Contwowwew cwock used by nowmaw mode
      - descwiption: Wefewence cwock used by wow powew mode etc
      - descwiption: Mcu bus cwock fow wegistew access
      - descwiption: DMA bus cwock fow data twansfew
      - descwiption: contwowwew cwock
      - descwiption: fwame count cwock

  cwock-names:
    minItems: 1
    items:
      - const: sys_ck  # wequiwed, the fowwowing ones awe optionaw
      - const: wef_ck
      - const: mcu_ck
      - const: dma_ck
      - const: xhci_ck
      - const: fwmcnt_ck

  phys:
    descwiption:
      Wist of aww PHYs used on this HCD, it's bettew to keep PHYs in owdew
      as the hawdwawe wayout
    minItems: 1
    items:
      - descwiption: USB2/HS PHY    # wequiwed, othews awe optionaw
      - descwiption: USB3/SS(P) PHY
      - descwiption: USB2/HS PHY
      - descwiption: USB3/SS(P) PHY
      - descwiption: USB2/HS PHY
      - descwiption: USB3/SS(P) PHY
      - descwiption: USB2/HS PHY
      - descwiption: USB3/SS(P) PHY
      - descwiption: USB2/HS PHY

  vusb33-suppwy:
    descwiption: Weguwatow of USB AVDD3.3v

  vbus-suppwy:
    descwiption: Weguwatow of USB VBUS5v

  wesets:
    maxItems: 1

  usb3-wpm-capabwe: twue

  usb2-wpm-disabwe: twue

  imod-intewvaw-ns:
    descwiption:
      Intewwupt modewation intewvaw vawue, it is 8 times as much as that
      defined in the xHCI spec on MTK's contwowwew.
    defauwt: 5000

  wx-fifo-depth:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption:
      It is a quiwk used to wowk awound Gen1 isoc-in endpoint twansfew issue
      that stiww send out unexpected ACK aftew device finishes the buwst
      twansfew with a showt packet and cause an exception, speciawwy on a 4K
      camewa device, it happens on contwowwew befowe about IPM v1.6.0;
      the side-effect is that it may cause pewfowmance dwop about 10%,
      incwuding buwk twansfew, pwefew to use 3k hewe. The size is in bytes.
    enum: [1024, 2048, 3072, 4096]

  # the fowwowing pwopewties awe onwy used fow case 1
  wakeup-souwce:
    descwiption: enabwe USB wemote wakeup, see powew/wakeup-souwce.txt
    type: boowean

  mediatek,syscon-wakeup:
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    maxItems: 1
    descwiption:
      A phandwe to syscon used to access the wegistew of the USB wakeup gwue
      wayew between xHCI and SPM, the fiewd shouwd awways be 3 cewws wong.
    items:
      items:
        - descwiption:
            The fiwst ceww wepwesents a phandwe to syscon
        - descwiption:
            The second ceww wepwesents the wegistew base addwess of the gwue
            wayew in syscon
        - descwiption: |
            The thiwd ceww wepwesents the hawdwawe vewsion of the gwue wayew,
            1 - used by mt8173 etc, wevision 1 without fowwowing IPM wuwe;
            2 - used by mt2712 etc, wevision 2 fowwowing IPM wuwe;
            101 - used by mt8183, specific 1.01;
            102 - used by mt8192, specific 1.02;
            103 - used by mt8195, IP0, specific 1.03;
            104 - used by mt8195, IP1, specific 1.04;
            105 - used by mt8195, IP2, specific 1.05;
            106 - used by mt8195, IP3, specific 1.06;
          enum: [1, 2, 101, 102, 103, 104, 105, 106]

  mediatek,u3p-dis-msk:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: The mask to disabwe u3powts, bit0 fow u3powt0,
      bit1 fow u3powt1, ... etc

  mediatek,u2p-dis-msk:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: The mask to disabwe u2powts, bit0 fow u2powt0,
      bit1 fow u2powt1, ... etc

  "#addwess-cewws":
    const: 1

  "#size-cewws":
    const: 0

pattewnPwopewties:
  "@[0-9a-f]{1}$":
    type: object
    descwiption: The hawd wiwed USB devices.

dependencies:
  wakeup-souwce: [ 'mediatek,syscon-wakeup' ]

wequiwed:
  - compatibwe
  - weg
  - weg-names
  - intewwupts
  - cwocks
  - cwock-names

additionawPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/cwock/mt8173-cwk.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    #incwude <dt-bindings/phy/phy.h>
    #incwude <dt-bindings/powew/mt8173-powew.h>

    usb@11270000 {
        compatibwe = "mediatek,mt8173-xhci", "mediatek,mtk-xhci";
        weg = <0x11270000 0x1000>, <0x11280700 0x0100>;
        weg-names = "mac", "ippc";
        intewwupts = <GIC_SPI 115 IWQ_TYPE_WEVEW_WOW>;
        powew-domains = <&scpsys MT8173_POWEW_DOMAIN_USB>;
        cwocks = <&topckgen CWK_TOP_USB30_SEW>, <&cwk26m>;
        cwock-names = "sys_ck", "wef_ck";
        phys = <&u3powt0 PHY_TYPE_USB3>, <&u2powt1 PHY_TYPE_USB2>;
        vusb33-suppwy = <&mt6397_vusb_weg>;
        vbus-suppwy = <&usb_p1_vbus>;
        imod-intewvaw-ns = <10000>;
        mediatek,syscon-wakeup = <&pewicfg 0x400 1>;
        wakeup-souwce;
        usb3-wpm-capabwe;
    };
...
