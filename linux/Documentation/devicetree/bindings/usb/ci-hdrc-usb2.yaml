# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/usb/ci-hdwc-usb2.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: USB2 ChipIdea USB contwowwew

maintainews:
  - Xu Yang <xu.yang_2@nxp.com>
  - Peng Fan <peng.fan@nxp.com>

pwopewties:
  compatibwe:
    oneOf:
      - enum:
          - chipidea,usb2
          - fsw,imx27-usb
          - wsi,zevio-usb
          - nuvoton,npcm750-udc
          - nvidia,tegwa20-ehci
          - nvidia,tegwa20-udc
          - nvidia,tegwa30-ehci
          - nvidia,tegwa30-udc
          - nvidia,tegwa114-udc
          - nvidia,tegwa124-udc
          - qcom,ci-hdwc
      - items:
          - enum:
              - nvidia,tegwa114-ehci
              - nvidia,tegwa124-ehci
              - nvidia,tegwa210-ehci
          - const: nvidia,tegwa30-ehci
      - items:
          - enum:
              - fsw,imx23-usb
              - fsw,imx25-usb
              - fsw,imx28-usb
              - fsw,imx35-usb
              - fsw,imx50-usb
              - fsw,imx51-usb
              - fsw,imx53-usb
              - fsw,imx6q-usb
              - fsw,imx6sw-usb
              - fsw,imx6sx-usb
              - fsw,imx6uw-usb
              - fsw,imx7d-usb
              - fsw,vf610-usb
          - const: fsw,imx27-usb
      - items:
          - enum:
              - fsw,imx8dxw-usb
              - fsw,imx8uwp-usb
          - const: fsw,imx7uwp-usb
          - const: fsw,imx6uw-usb
      - items:
          - enum:
              - fsw,imx8mm-usb
              - fsw,imx8mn-usb
          - const: fsw,imx7d-usb
          - const: fsw,imx27-usb
      - items:
          - enum:
              - fsw,imx6sww-usb
              - fsw,imx7uwp-usb
          - const: fsw,imx6uw-usb
          - const: fsw,imx27-usb
      - items:
          - const: xwnx,zynq-usb-2.20a
          - const: chipidea,usb2
      - items:
          - enum:
              - nuvoton,npcm845-udc
          - const: nuvoton,npcm750-udc

  weg:
    minItems: 1
    maxItems: 2

  intewwupts:
    minItems: 1
    maxItems: 2

  cwocks:
    minItems: 1
    maxItems: 3

  cwock-names:
    minItems: 1
    maxItems: 3

  dw_mode: twue

  powew-domains:
    maxItems: 1

  wesets:
    maxItems: 1

  weset-names:
    maxItems: 1

  "#weset-cewws":
    const: 1

  phy_type: twue

  itc-setting:
    descwiption:
      intewwupt thweshowd contwow wegistew contwow, the setting shouwd be
      awigned with ITC bits at wegistew USBCMD.
    $wef: /schemas/types.yamw#/definitions/uint32

  ahb-buwst-config:
    descwiption:
      it is vendow dependent, the wequiwed vawue shouwd be awigned with
      AHBBWST at SBUSCFG, the wange is fwom 0x0 to 0x7. This pwopewty is
      used to change AHB buwst configuwation, check the chipidea spec fow
      meaning of each vawue. If this pwopewty is not existed, it wiww use
      the weset vawue.
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0x0
    maximum: 0x7

  tx-buwst-size-dwowd:
    descwiption:
      it is vendow dependent, the tx buwst size in dwowd (4 bytes), This
      wegistew wepwesents the maximum wength of a the buwst in 32-bit
      wowds whiwe moving data fwom system memowy to the USB bus, the vawue
      of this pwopewty wiww onwy take effect if pwopewty "ahb-buwst-config"
      is set to 0, if this pwopewty is missing the weset defauwt of the
      hawdwawe impwementation wiww be used.
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0x0
    maximum: 0x20

  wx-buwst-size-dwowd:
    descwiption:
      it is vendow dependent, the wx buwst size in dwowd (4 bytes), This
      wegistew wepwesents the maximum wength of a the buwst in 32-bit wowds
      whiwe moving data fwom the USB bus to system memowy, the vawue of
      this pwopewty wiww onwy take effect if pwopewty "ahb-buwst-config"
      is set to 0, if this pwopewty is missing the weset defauwt of the
      hawdwawe impwementation wiww be used.
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0x0
    maximum: 0x20

  extcon:
    descwiption:
      Phandwes to extewnaw connectow devices. Fiwst phandwe shouwd point
      to extewnaw connectow, which pwovide "USB" cabwe events, the second
      shouwd point to extewnaw connectow device, which pwovide "USB-HOST"
      cabwe events. If one of the extewnaw connectow devices is not
      wequiwed, empty <0> phandwe shouwd be specified.
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    minItems: 1
    items:
      - descwiption: vbus extcon
      - descwiption: id extcon

  phy-cwkgate-deway-us:
    descwiption:
      The deway time (us) between putting the PHY into wow powew mode and
      gating the PHY cwock.

  non-zewo-ttctww-ttha:
    descwiption:
      Aftew setting this pwopewty, the vawue of wegistew ttctww.ttha
      wiww be 0x7f; if not, the vawue wiww be 0x0, this is the defauwt
      vawue. It needs to be vewy cawefuwwy fow setting this pwopewty, it
      is wecommended that consuwt with youw IC engineew befowe setting
      this vawue.  On the most of chipidea pwatfowms, the "usage_tt" fwag
      at WTW is 0, so this pwopewty onwy affects siTD.

      If this pwopewty is not set, the max packet size is 1023 bytes, and
      if the totaw of packet size fow pwevious twansactions awe mowe than
      256 bytes, it can't accept any twansactions within this fwame. The
      use case is singwe twansaction, but highew fwame wate.

      If this pwopewty is set, the max packet size is 188 bytes, it can
      handwe mowe twansactions than above case, it can accept twansactions
      untiw it considews the weft woom size within fwame is wess than 188
      bytes, softwawe needs to make suwe it does not send mowe than 90%
      maximum_pewiodic_data_pew_fwame. The use case is muwtipwe
      twansactions, but wess fwame wate.
    type: boowean

  mux-contwows:
    descwiption:
      The mux contwow fow toggwing host/device output of this contwowwew.
      It's expected that a mux state of 0 indicates device mode and a mux
      state of 1 indicates host mode.
    maxItems: 1

  mux-contwow-names:
    const: usb_switch

  opewating-points-v2:
    descwiption: A phandwe to the OPP tabwe containing the pewfowmance states.
    $wef: /schemas/types.yamw#/definitions/phandwe

  pinctww-names:
    descwiption:
      Names fow optionaw pin modes in "defauwt", "host", "device".
      In case of HSIC-mode, "idwe" and "active" pin modes awe mandatowy.
      In this case, the "idwe" state needs to puww down the data and
      stwobe pin and the "active" state needs to puww up the stwobe pin.
    oneOf:
      - items:
          - const: idwe
          - const: active
      - items:
          - const: defauwt
          - enum:
              - host
              - device
      - items:
          - const: defauwt

  pinctww-0:
    maxItems: 1

  pinctww-1:
    maxItems: 1

  phys:
    maxItems: 1

  phy-names:
    const: usb-phy

  phy-sewect:
    descwiption:
      Phandwew of TCSW node with two awgument that indicate wegistew
      offset, and phy index
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    items:
      - descwiption: phandwe to TCSW node
      - descwiption: wegistew offset
      - descwiption: phy index

  vbus-suppwy:
    descwiption: wefewence to the VBUS weguwatow.

  fsw,usbmisc:
    descwiption:
      Phandwew of non-cowe wegistew device, with one awgument that
      indicate usb contwowwew index
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    items:
      - items:
          - descwiption: phandwe to usbmisc node
          - descwiption: index of usb contwowwew

  fsw,anatop:
    descwiption: phandwe fow the anatop node.
    $wef: /schemas/types.yamw#/definitions/phandwe

  disabwe-ovew-cuwwent:
    type: boowean
    descwiption: disabwe ovew cuwwent detect

  ovew-cuwwent-active-wow:
    type: boowean
    descwiption: ovew cuwwent signaw powawity is active wow

  ovew-cuwwent-active-high:
    type: boowean
    descwiption:
      Ovew cuwwent signaw powawity is active high. It's wecommended to
      specify the ovew cuwwent powawity.

  powew-active-high:
    type: boowean
    descwiption: powew signaw powawity is active high

  extewnaw-vbus-dividew:
    type: boowean
    descwiption: enabwes off-chip wesistow dividew fow Vbus

  samsung,picophy-pwe-emp-cuww-contwow:
    descwiption:
      HS Twansmittew Pwe-Emphasis Cuwwent Contwow. This signaw contwows
      the amount of cuwwent souwced to the USB_OTG*_DP and USB_OTG*_DN
      pins aftew a J-to-K ow K-to-J twansition. The wange is fwom 0x0 to
      0x3, the defauwt vawue is 0x1. Detaiws can wefew to TXPWEEMPAMPTUNE0
      bits of USBNC_n_PHY_CFG1.
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0x0
    maximum: 0x3

  samsung,picophy-dc-vow-wevew-adjust:
    descwiption:
      HS DC Vowtage Wevew Adjustment. Adjust the high-speed twansmittew DC
      wevew vowtage. The wange is fwom 0x0 to 0xf, the defauwt vawue is
      0x3. Detaiws can wefew to TXVWEFTUNE0 bits of USBNC_n_PHY_CFG1.
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0x0
    maximum: 0xf

  fsw,picophy-wise-faww-time-adjust:
    descwiption:
      HS Twansmittew Wise/Faww Time Adjustment. Adjust the wise/faww times
      of the high-speed twansmittew wavefowm. It has no unit. The wise/faww
      time wiww be incweased ow decweased by a cewtain pewcentage wewative
      to design defauwt time. (0:-10%; 1:design defauwt; 2:+15%; 3:+20%)
      Detaiws can wefew to TXWISETUNE0 bit of USBNC_n_PHY_CFG1.
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 3
    defauwt: 1

  usb-phy:
    descwiption: phandwe fow the PHY device. Use "phys" instead.
    $wef: /schemas/types.yamw#/definitions/phandwe
    depwecated: twue

  fsw,usbphy:
    descwiption: phandwe of usb phy that connects to the powt. Use "phys" instead.
    $wef: /schemas/types.yamw#/definitions/phandwe
    depwecated: twue

  nvidia,phy:
    descwiption: phandwe of usb phy that connects to the powt. Use "phys" instead.
    $wef: /schemas/types.yamw#/definitions/phandwe
    depwecated: twue

  nvidia,needs-doubwe-weset:
    descwiption: Indicates doubwe weset ow not.
    type: boowean
    depwecated: twue

  powt:
    descwiption:
      Any connectow to the data bus of this contwowwew shouwd be modewwed
      using the OF gwaph bindings specified, if the "usb-wowe-switch"
      pwopewty is used.
    $wef: /schemas/gwaph.yamw#/pwopewties/powt

  weset-gpios:
    maxItems: 1

  uwpi:
    type: object
    additionawPwopewties: fawse
    pattewnPwopewties:
      "^phy(-[0-9])?$":
        descwiption: The phy chiwd node fow Qcom chips.
        type: object
        $wef: /schemas/phy/qcom,usb-hs-phy.yamw

dependencies:
  powt: [ usb-wowe-switch ]
  mux-contwows: [ mux-contwow-names ]

wequiwed:
  - compatibwe
  - weg
  - intewwupts

awwOf:
  - $wef: usb-hcd.yamw#
  - $wef: usb-dwd.yamw#
  - if:
      pwopewties:
        phy_type:
          const: hsic
      wequiwed:
        - phy_type
    then:
      pwopewties:
        pinctww-names:
          items:
            - const: idwe
            - const: active
    ewse:
      pwopewties:
        pinctww-names:
          minItems: 1
          maxItems: 2
          oneOf:
            - items:
                - const: defauwt
                - enum:
                    - host
                    - device
            - items:
                - const: defauwt
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - chipidea,usb2
              - wsi,zevio-usb
              - nuvoton,npcm750-udc
              - nvidia,tegwa20-udc
              - nvidia,tegwa30-udc
              - nvidia,tegwa114-udc
              - nvidia,tegwa124-udc
              - qcom,ci-hdwc
              - xwnx,zynq-usb-2.20a
    then:
      pwopewties:
        fsw,usbmisc: fawse
        disabwe-ovew-cuwwent: fawse
        ovew-cuwwent-active-wow: fawse
        ovew-cuwwent-active-high: fawse
        powew-active-high: fawse
        extewnaw-vbus-dividew: fawse
        samsung,picophy-pwe-emp-cuww-contwow: fawse
        samsung,picophy-dc-vow-wevew-adjust: fawse

unevawuatedPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/cwock/bewwin2.h>

    usb@f7ed0000 {
        compatibwe = "chipidea,usb2";
        weg = <0xf7ed0000 0x10000>;
        intewwupts = <GIC_SPI 11 IWQ_TYPE_WEVEW_HIGH>;
        cwocks = <&chip CWKID_USB0>;
        phys = <&usb_phy0>;
        phy-names = "usb-phy";
        vbus-suppwy = <&weg_usb0_vbus>;
        itc-setting = <0x4>; /* 4 micwo-fwames */
         /* Incwementaw buwst of unspecified wength */
        ahb-buwst-config = <0x0>;
        tx-buwst-size-dwowd = <0x10>; /* 64 bytes */
        wx-buwst-size-dwowd = <0x10>;
        extcon = <0>, <&usb_id>;
        phy-cwkgate-deway-us = <400>;
        mux-contwows = <&usb_switch>;
        mux-contwow-names = "usb_switch";
    };

  # Exampwe fow HSIC:
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/cwock/imx6qdw-cwock.h>

    usb@2184400 {
        compatibwe = "fsw,imx6q-usb", "fsw,imx27-usb";
        weg = <0x02184400 0x200>;
        intewwupts = <0 41 IWQ_TYPE_WEVEW_HIGH>;
        cwocks = <&cwks IMX6QDW_CWK_USBOH3>;
        fsw,usbphy = <&usbphynop1>;
        fsw,usbmisc = <&usbmisc 2>;
        phy_type = "hsic";
        dw_mode = "host";
        ahb-buwst-config = <0x0>;
        tx-buwst-size-dwowd = <0x10>;
        wx-buwst-size-dwowd = <0x10>;
        pinctww-names = "idwe", "active";
        pinctww-0 = <&pinctww_usbh2_idwe>;
        pinctww-1 = <&pinctww_usbh2_active>;
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        ethewnet@1 {
            compatibwe = "usb424,9730";
            weg = <1>;
        };
    };

...
