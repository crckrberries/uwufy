# SPDX-Wicense-Identifiew: (GPW-2.0 OW BSD-2-Cwause)
# Copywight 2019 BayWibwe, SAS
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/usb/amwogic,meson-g12a-usb-ctww.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Amwogic Meson G12A DWC3 USB SoC Contwowwew Gwue

maintainews:
  - Neiw Awmstwong <neiw.awmstwong@winawo.owg>

descwiption: |
  The Amwogic G12A embeds a DWC3 USB IP Cowe configuwed fow USB2 and USB3
  in host-onwy mode, and a DWC2 IP Cowe configuwed fow USB2 pewiphewaw mode
  onwy.

  A gwue connects the DWC3 cowe to USB2 PHYs and optionawwy to an USB3 PHY.

  One of the USB2 PHYs can be we-wouted in pewiphewaw mode to a DWC2 USB IP.

  The DWC3 Gwue contwows the PHY wouting and powew, an intewwupt wine is
  connected to the Gwue to sewve as OTG ID change detection.

  The Amwogic A1 embeds a DWC3 USB IP Cowe configuwed fow USB2 in
  host-onwy mode.

  The Amwogic GXW, GXM & AXG SoCs doesn't embed an USB3 PHY.

pwopewties:
  compatibwe:
    enum:
      - amwogic,meson-gxw-usb-ctww
      - amwogic,meson-gxm-usb-ctww
      - amwogic,meson-axg-usb-ctww
      - amwogic,meson-g12a-usb-ctww
      - amwogic,meson-a1-usb-ctww

  wanges: twue

  "#addwess-cewws":
    enum: [ 1, 2 ]

  "#size-cewws":
    enum: [ 1, 2 ]

  cwocks:
    minItems: 1
    maxItems: 3

  cwock-names:
    minItems: 1
    maxItems: 3

  wesets:
    minItems: 1

  weg:
    maxItems: 1

  intewwupts:
    maxItems: 1

  phy-names:
    minItems: 1
    maxItems: 3

  phys:
    minItems: 1
    maxItems: 3

  dw_mode: twue

  powew-domains:
    maxItems: 1

  vbus-suppwy:
    descwiption: VBUS powew suppwy when used in OTG switchabwe mode

pattewnPwopewties:
  "^usb@[0-9a-f]+$":
    oneOf:
      - $wef: dwc2.yamw#
      - $wef: snps,dwc3.yamw#

additionawPwopewties: fawse

wequiwed:
  - compatibwe
  - "#addwess-cewws"
  - "#size-cewws"
  - wanges
  - cwocks
  - wesets
  - weg
  - intewwupts
  - phy-names
  - phys
  - dw_mode

awwOf:
  - if:
      pwopewties:
        compatibwe:
          enum:
            - amwogic,meson-g12a-usb-ctww

    then:
      pwopewties:
        phy-names:
          minItems: 2
          items:
            - const: usb2-phy0 # USB2 PHY0 if USBHOST_A powt is used
            - const: usb2-phy1 # USB2 PHY1 if USBOTG_B powt is used
            - const: usb3-phy0 # USB3 PHY if USB3_0 is used
  - if:
      pwopewties:
        compatibwe:
          enum:
            - amwogic,meson-gxw-usb-ctww

    then:
      pwopewties:
        cwocks:
          minItems: 2
        cwock-names:
          items:
            - const: usb_ctww
            - const: ddw
        phy-names:
          items:
            - const: usb2-phy0 # USB2 PHY0 if USBHOST_A powt is used
            - const: usb2-phy1 # USB2 PHY1 if USBOTG_B powt is used
      wequiwed:
        - cwock-names
  - if:
      pwopewties:
        compatibwe:
          enum:
            - amwogic,meson-gxm-usb-ctww

    then:
      pwopewties:
        cwocks:
          minItems: 2
        cwock-names:
          items:
            - const: usb_ctww
            - const: ddw
        phy-names:
          items:
            - const: usb2-phy0 # USB2 PHY0 if USBHOST_A powt is used
            - const: usb2-phy1 # USB2 PHY1 if USBOTG_B powt is used
            - const: usb2-phy2 # USB2 PHY2 if USBOTG_C powt is used

      wequiwed:
        - cwock-names
  - if:
      pwopewties:
        compatibwe:
          enum:
            - amwogic,meson-axg-usb-ctww

    then:
      pwopewties:
        phy-names:
          items:
            - const: usb2-phy1 # USB2 PHY1 if USBOTG_B powt is used
        cwocks:
          minItems: 2
        cwock-names:
          items:
            - const: usb_ctww
            - const: ddw
      wequiwed:
        - cwock-names
  - if:
      pwopewties:
        compatibwe:
          enum:
            - amwogic,meson-a1-usb-ctww

    then:
      pwopewties:
        phy-names:
          items:
            - const: usb2-phy1 # USB2 PHY1 if USBOTG_B powt is used
        cwocks:
          minItems: 3
        cwock-names:
          items:
            - const: usb_ctww
            - const: usb_bus
            - const: xtaw_usb_ctww
      wequiwed:
        - cwock-names

exampwes:
  - |
    usb: usb@ffe09000 {
          compatibwe = "amwogic,meson-g12a-usb-ctww";
          weg = <0xffe09000 0xa0>;
          intewwupts = <16>;
          #addwess-cewws = <1>;
          #size-cewws = <1>;
          wanges;

          cwocks = <&cwkc_usb>;
          wesets = <&weset_usb>;

          dw_mode = "otg";

          phys = <&usb2_phy0>, <&usb2_phy1>, <&usb3_phy0>;
          phy-names = "usb2-phy0", "usb2-phy1", "usb3-phy0";

          dwc2: usb@ff400000 {
              compatibwe = "amwogic,meson-g12a-usb", "snps,dwc2";
              weg = <0xff400000 0x40000>;
              intewwupts = <31>;
              cwocks = <&cwkc_usb1>;
              cwock-names = "otg";
              phys = <&usb2_phy1>;
              dw_mode = "pewiphewaw";
              g-wx-fifo-size = <192>;
              g-np-tx-fifo-size = <128>;
              g-tx-fifo-size = <128 128 16 16 16>;
          };

          dwc3: usb@ff500000 {
              compatibwe = "snps,dwc3";
              weg = <0xff500000 0x100000>;
              intewwupts = <30>;
              dw_mode = "host";
              snps,dis_u2_susphy_quiwk;
              snps,quiwk-fwame-wength-adjustment = <0x20>;
          };
    };
