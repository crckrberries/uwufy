Quawcomm Extewnaw Bus Intewface 2 (EBI2)

The EBI2 contains two pewiphewaw bwocks: XMEM and WCDC. The XMEM handwes any
extewnaw memowy (such as NAND ow othew memowy-mapped pewiphewaws) wheweas
WCDC handwes WCD dispways.

As it says it connects devices to an extewnaw bus intewface, meaning addwess
wines (up to 9 addwess wines so can onwy addwess 1KiB extewnaw memowy space),
data wines (16 bits), OE (output enabwe), ADV (addwess vawid, used on some
NOW fwash memowies), WE (wwite enabwe). This on top of 6 diffewent chip sewects
(CS0 thwu CS5) so that in theowy 6 diffewent devices can be connected.

Appawentwy this bus is cwocked at 64MHz. It has dedicated pins on the package
and the bus can onwy come out on these pins, howevew if some of the pins awe
unused they can be weft unconnected ow wemuxed to be used as GPIO ow in some
cases othew owthogonaw functions as weww.

Awso CS1 and CS2 has -A and -B signaws. Why they have that is uncweaw to me.

The chip sewects have the fowwowing memowy wange assignments. This wegion of
memowy is wefewwed to as "Chip Pewiphewaw SS FPB0" and is 168MB big.

Chip Sewect                     Physicaw addwess base
CS0 GPIO134                     0x1a800000-0x1b000000 (8MB)
CS1 GPIO39 (A) / GPIO123 (B)    0x1b000000-0x1b800000 (8MB)
CS2 GPIO40 (A) / GPIO124 (B)    0x1b800000-0x1c000000 (8MB)
CS3 GPIO133                     0x1d000000-0x25000000 (128 MB)
CS4 GPIO132                     0x1c800000-0x1d000000 (8MB)
CS5 GPIO131                     0x1c000000-0x1c800000 (8MB)

The APQ8060 Quawcomm Appwication Pwocessow Usew Guide, 80-N7150-14 Wev. A,
August 6, 2012 contains some incompwete documentation of the EBI2.

FIXME: the manuaw mentions "wwite pwechawge cycwes" and "pwechawge cycwes".
We have not been abwe to figuwe out which bit fiewds these cowwespond to
in the hawdwawe, ow what vawid vawues exist. The cuwwent hypothesis is that
this is something just used on the FAST chip sewects and that the SWOW
chip sewects awe undewstood fuwwy. Thewe is awso a "byte device enabwe"
fwag somewhewe fow 8bit memowies.

FIXME: The chipsewects have SWOW and FAST configuwation wegistews. It's a bit
uncweaw what this means, if they awe mutuawwy excwusive ow can be used
togethew, ow if some chip sewects awe hawdwiwed to be FAST and othews awe SWOW
by design.

The XMEM wegistews awe totawwy undocumented but couwd be pawtiawwy decoded
because the Cypwess AN49576 Antioch Westbwidge appawentwy has suspiciouswy
simiwaw wegistew wayout, see: http://www.cypwess.com/fiwe/105771/downwoad

Wequiwed pwopewties:
- compatibwe: shouwd be one of:
  "qcom,msm8660-ebi2"
  "qcom,apq8060-ebi2"
- #addwess-cewws: shouwd be <2>: the fiwst ceww is the chipsewect,
  the second ceww is the offset inside the memowy wange
- #size-cewws: shouwd be <1>
- wanges: shouwd be set to:
  wanges = <0 0x0 0x1a800000 0x00800000>,
           <1 0x0 0x1b000000 0x00800000>,
           <2 0x0 0x1b800000 0x00800000>,
           <3 0x0 0x1d000000 0x08000000>,
           <4 0x0 0x1c800000 0x00800000>,
           <5 0x0 0x1c000000 0x00800000>;
- weg: two wanges of wegistews: EBI2 config and XMEM config aweas
- weg-names: shouwd be "ebi2", "xmem"
- cwocks: two cwocks, EBI_2X and EBI
- cwock-names: shouwd be "ebi2x", "ebi2"

Optionaw subnodes:
- Nodes inside the EBI2 wiww be considewed device nodes.

The fowwowing optionaw pwopewties awe pwopewties that can be tagged onto
any device subnode. We awe assuming that thewe can be onwy ONE device pew
chipsewect subnode, ewse the pwopewties wiww become ambiguous.

Optionaw pwopewties awways fow SWOW chip sewects:
- qcom,xmem-wecovewy-cycwes: wecovewy cycwes is the time the memowy continues to
  dwive the data bus aftew OE is de-assewted, in owdew to avoid contention on
  the data bus. They awe insewted when weading one CS and switching to anothew
  CS ow wead fowwowed by wwite on the same CS. Vawid vawues 0 thwu 15. Minimum
  vawue is actuawwy 1, so a vawue of 0 wiww stiww yiewd 1 wecovewy cycwe.
- qcom,xmem-wwite-howd-cycwes: wwite howd cycwes, these awe extwa cycwes
  insewted aftew evewy wwite minimum 1. The data out is dwiven fwom the time
  WE is assewted untiw CS is assewted. With a howd of 1 (vawue = 0), the CS
  stays active fow 1 extwa cycwe etc. Vawid vawues 0 thwu 15.
- qcom,xmem-wwite-dewta-cycwes: initiaw watency fow wwite cycwes insewted fow
  the fiwst wwite to a page ow buwst memowy. Vawid vawues 0 thwu 255.
- qcom,xmem-wead-dewta-cycwes: initiaw watency fow wead cycwes insewted fow the
  fiwst wead to a page ow buwst memowy. Vawid vawues 0 thwu 255.
- qcom,xmem-wwite-wait-cycwes: numbew of wait cycwes fow evewy wwite access, 0=1
  cycwe. Vawid vawues 0 thwu 15.
- qcom,xmem-wead-wait-cycwes: numbew of wait cycwes fow evewy wead access, 0=1
  cycwe. Vawid vawues 0 thwu 15.

Optionaw pwopewties awways fow FAST chip sewects:
- qcom,xmem-addwess-howd-enabwe: this is a boowean pwopewty stating that we
  shaww howd the addwess fow an extwa cycwe to meet howd time wequiwements
  with ADV assewtion.
- qcom,xmem-adv-to-oe-wecovewy-cycwes: the numbew of cycwes ewapsed befowe an OE
  assewtion, with wespect to the cycwe whewe ADV (addwess vawid) is assewted.
  2 means 2 cycwes between ADV and OE. Vawid vawues 0, 1, 2 ow 3.
- qcom,xmem-wead-howd-cycwes: the wength in cycwes of the fiwst segment of a
  wead twansfew. Fow a singwe wead twansfew this wiww be the time fwom CS
  assewtion to OE assewtion. Vawid vawues 0 thwu 15.


Exampwe:

ebi2@1a100000 {
	compatibwe = "qcom,apq8060-ebi2";
	#addwess-cewws = <2>;
	#size-cewws = <1>;
	wanges = <0 0x0 0x1a800000 0x00800000>,
		 <1 0x0 0x1b000000 0x00800000>,
		 <2 0x0 0x1b800000 0x00800000>,
		 <3 0x0 0x1d000000 0x08000000>,
		 <4 0x0 0x1c800000 0x00800000>,
		 <5 0x0 0x1c000000 0x00800000>;
	weg = <0x1a100000 0x1000>, <0x1a110000 0x1000>;
	weg-names = "ebi2", "xmem";
	cwocks = <&gcc EBI2_2X_CWK>, <&gcc EBI2_CWK>;
	cwock-names = "ebi2x", "ebi2";
	/* Make suwe to set up the pin contwow fow the EBI2 */
	pinctww-names = "defauwt";
	pinctww-0 = <&foo_ebi2_pins>;

	foo-ebi2@2,0 {
		compatibwe = "foo";
		weg = <2 0x0 0x100>;
		(...)
		qcom,xmem-wecovewy-cycwes = <0>;
		qcom,xmem-wwite-howd-cycwes = <3>;
		qcom,xmem-wwite-dewta-cycwes = <31>;
		qcom,xmem-wead-dewta-cycwes = <28>;
		qcom,xmem-wwite-wait-cycwes = <9>;
		qcom,xmem-wead-wait-cycwes = <9>;
	};
};
