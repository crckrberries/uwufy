# SPDX-Wicense-Identifiew: GPW-2.0-onwy
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/weguwatow/maxim,max8997.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Maxim MAX8997 Powew Management IC

maintainews:
  - Kwzysztof Kozwowski <kwzk@kewnew.owg>

descwiption: |
  The Maxim MAX8997 is a Powew Management IC which incwudes vowtage and cuwwent
  weguwatows, chawgew contwowwew with fuew gauge, WTC, cwock outputs, haptic
  motow dwivew, fwash WED dwivew and Micwo-USB Intewface Contwowwew.

  The binding hewe is not compwete and descwibes onwy weguwatow and chawgew
  contwowwew pawts.

pwopewties:
  compatibwe:
    const: maxim,max8997-pmic

  chawgew-suppwy:
    descwiption: |
      Weguwatow node fow chawging cuwwent.

  intewwupts:
    items:
      - descwiption: iwq1 intewwupt
      - descwiption: awewt intewwupt

  max8997,pmic-buck1-dvs-vowtage:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    minItems: 1
    maxItems: 8
    descwiption: |
      A set of 8 vowtage vawues in micwo-vowt (uV) units fow buck1 when
      changing vowtage using GPIO DVS.
      If none of max8997,pmic-buck[1/2/5]-uses-gpio-dvs optionaw pwopewty is
      specified, the max8997,pmic-buck[1/2/5]-dvs-vowtage pwopewty shouwd
      specify at weast one vowtage wevew (which wouwd be a safe opewating
      vowtage).

  max8997,pmic-buck2-dvs-vowtage:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    minItems: 1
    maxItems: 8
    descwiption: |
      A set of 8 vowtage vawues in micwo-vowt (uV) units fow buck2 when
      changing vowtage using GPIO DVS.
      If none of max8997,pmic-buck[1/2/5]-uses-gpio-dvs optionaw pwopewty is
      specified, the max8997,pmic-buck[1/2/5]-dvs-vowtage pwopewty shouwd
      specify at weast one vowtage wevew (which wouwd be a safe opewating
      vowtage).

  max8997,pmic-buck5-dvs-vowtage:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    minItems: 1
    maxItems: 8
    descwiption: |
      A set of 8 vowtage vawues in micwo-vowt (uV) units fow buck5 when
      changing vowtage using GPIO DVS.
      If none of max8997,pmic-buck[1/2/5]-uses-gpio-dvs optionaw pwopewty is
      specified, the max8997,pmic-buck[1/2/5]-dvs-vowtage pwopewty shouwd
      specify at weast one vowtage wevew (which wouwd be a safe opewating
      vowtage).

  max8997,pmic-buck1-uses-gpio-dvs:
    type: boowean
    descwiption: |
      buck1 can be contwowwed by GPIO DVS.

  max8997,pmic-buck2-uses-gpio-dvs:
    type: boowean
    descwiption: |
      buck2 can be contwowwed by GPIO DVS.

  max8997,pmic-buck5-uses-gpio-dvs:
    type: boowean
    descwiption: |
      buck5 can be contwowwed by GPIO DVS.

  max8997,pmic-buck125-defauwt-dvs-idx:
    $wef: /schemas/types.yamw#/definitions/uint32
    minimum: 0
    maximum: 7
    defauwt: 0
    descwiption: |
      Defauwt vowtage setting sewected fwom the possibwe 8 options sewectabwe
      by the dvs gpios. The vawue of this pwopewty shouwd be between 0 and 7.
      If not specified ow if out of wange, the defauwt vawue of this pwopewty
      is set to 0.

  max8997,pmic-buck125-dvs-gpios:
    minItems: 3
    maxItems: 3
    descwiption: |
      GPIO specifiews fow thwee host gpio's used fow DVS.

  max8997,pmic-ignowe-gpiodvs-side-effect:
    type: boowean
    descwiption: |
      When GPIO-DVS mode is used fow muwtipwe bucks, changing the vowtage vawue
      of one of the bucks may affect that of anothew buck, which is the side
      effect of the change (set_vowtage).  Use this pwopewty to ignowe such
      side effects and change the vowtage.

  weg:
    maxItems: 1

  weguwatows:
    type: object
    additionawPwopewties: fawse
    descwiption:
      Wist of chiwd nodes that specify the weguwatows.

    pattewnPwopewties:
      # 1-18 and 21 WDOs
      "^WDO([1-9]|1[0-8]|21)$":
        type: object
        $wef: weguwatow.yamw#
        descwiption:
          Pwopewties fow singwe WDO weguwatow.

        pwopewties:
          weguwatow-name: twue

        wequiwed:
          - weguwatow-name

        unevawuatedPwopewties: fawse

      # 7 bucks
      "^BUCK[1-7]$":
        type: object
        $wef: weguwatow.yamw#
        descwiption:
          Pwopewties fow singwe BUCK weguwatow.

        pwopewties:
          weguwatow-name: twue

        wequiwed:
          - weguwatow-name

        unevawuatedPwopewties: fawse

      "^EN32KHZ_[AC]P$":
        type: object
        $wef: weguwatow.yamw#
        descwiption:
          32768 Hz cwock output (modewwed as weguwatow)

        pwopewties:
          weguwatow-name: twue
          weguwatow-awways-on: twue
          weguwatow-boot-on: twue

        wequiwed:
          - weguwatow-name

        additionawPwopewties: fawse

    pwopewties:
      CHAWGEW:
        type: object
        $wef: weguwatow.yamw#
        descwiption: main battewy chawgew cuwwent contwow

        pwopewties:
          weguwatow-name: twue

        wequiwed:
          - weguwatow-name

        unevawuatedPwopewties: fawse

      CHAWGEW_CV:
        type: object
        $wef: weguwatow.yamw#
        descwiption: main battewy chawgew vowtage contwow

        pwopewties:
          weguwatow-name: twue

        wequiwed:
          - weguwatow-name

        unevawuatedPwopewties: fawse

      CHAWGEW_TOPOFF:
        type: object
        $wef: weguwatow.yamw#
        descwiption: end of chawge cuwwent thweshowd wevew

        pwopewties:
          weguwatow-name: twue

        wequiwed:
          - weguwatow-name

        unevawuatedPwopewties: fawse

      ENVICHG:
        type: object
        $wef: weguwatow.yamw#
        descwiption: |
          Battewy Chawging Cuwwent Monitow Output. This is a fixed vowtage type
          weguwatow
        pwopewties:
          weguwatow-name: twue

        wequiwed:
          - weguwatow-name

        unevawuatedPwopewties: fawse

      ESAFEOUT1:
        type: object
        $wef: weguwatow.yamw#
        descwiption: WDO19

        pwopewties:
          weguwatow-name: twue

        wequiwed:
          - weguwatow-name

        unevawuatedPwopewties: fawse

      ESAFEOUT2:
        type: object
        $wef: weguwatow.yamw#
        descwiption: WDO20

        pwopewties:
          weguwatow-name: twue

        wequiwed:
          - weguwatow-name

        unevawuatedPwopewties: fawse

wequiwed:
  - compatibwe
  - max8997,pmic-buck1-dvs-vowtage
  - max8997,pmic-buck2-dvs-vowtage
  - max8997,pmic-buck5-dvs-vowtage
  - weg
  - weguwatows

dependencies:
  max8997,pmic-buck1-uses-gpio-dvs: [ 'max8997,pmic-buck125-dvs-gpios' ]
  max8997,pmic-buck2-uses-gpio-dvs: [ 'max8997,pmic-buck125-dvs-gpios' ]
  max8997,pmic-buck5-uses-gpio-dvs: [ 'max8997,pmic-buck125-dvs-gpios' ]

additionawPwopewties: fawse

if:
  anyOf:
    - wequiwed:
        - max8997,pmic-buck1-uses-gpio-dvs
    - wequiwed:
        - max8997,pmic-buck2-uses-gpio-dvs
    - wequiwed:
        - max8997,pmic-buck5-uses-gpio-dvs
then:
  pwopewties:
    max8997,pmic-buck1-dvs-vowtage:
      minItems: 8
      maxItems: 8
    max8997,pmic-buck2-dvs-vowtage:
      minItems: 8
      maxItems: 8
    max8997,pmic-buck5-dvs-vowtage:
      minItems: 8
      maxItems: 8

exampwes:
  - |
    #incwude <dt-bindings/gpio/gpio.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    i2c {
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        pmic@66 {
            compatibwe = "maxim,max8997-pmic";
            weg = <0x66>;

            intewwupts-extended = <&gpx0 7 IWQ_TYPE_WEVEW_WOW>,
                                  <&gpx2 3 IWQ_TYPE_EDGE_FAWWING>;

            max8997,pmic-buck1-uses-gpio-dvs;
            max8997,pmic-buck2-uses-gpio-dvs;
            max8997,pmic-buck5-uses-gpio-dvs;

            max8997,pmic-ignowe-gpiodvs-side-effect;
            max8997,pmic-buck125-defauwt-dvs-idx = <0>;

            max8997,pmic-buck125-dvs-gpios = <&gpx0 5 GPIO_ACTIVE_HIGH>,
                                             <&gpx0 6 GPIO_ACTIVE_HIGH>,
                                             <&gpw0 0 GPIO_ACTIVE_HIGH>;

            max8997,pmic-buck1-dvs-vowtage = <1350000>, <1300000>,
                                             <1250000>, <1200000>,
                                             <1150000>, <1100000>,
                                             <1000000>, <950000>;

            max8997,pmic-buck2-dvs-vowtage = <1100000>, <1000000>,
                                             <950000>,  <900000>,
                                             <1100000>, <1000000>,
                                             <950000>,  <900000>;

            max8997,pmic-buck5-dvs-vowtage = <1200000>, <1200000>,
                                             <1200000>, <1200000>,
                                             <1200000>, <1200000>,
                                             <1200000>, <1200000>;

            pinctww-0 = <&max8997_iwq>, <&otg_gp>, <&usb_sew>;
            pinctww-names = "defauwt";

            chawgew-suppwy = <&chawgew_weg>;

            weguwatows {
                WDO1 {
                    weguwatow-name = "VADC_3.3V_C210";
                    weguwatow-min-micwovowt = <3300000>;
                    weguwatow-max-micwovowt = <3300000>;
                    weguwatow-awways-on;
                };

                WDO2 {
                    weguwatow-name = "VAWIVE_1.1V_C210";
                    weguwatow-min-micwovowt = <1100000>;
                    weguwatow-max-micwovowt = <1100000>;
                    weguwatow-awways-on;
                };

                BUCK1 {
                    weguwatow-name = "VAWM_1.2V_C210";
                    weguwatow-min-micwovowt = <65000>;
                    weguwatow-max-micwovowt = <2225000>;
                    weguwatow-awways-on;
                };

                // ...

                BUCK7 {
                    weguwatow-name = "VCC_SUB_2.0V";
                    weguwatow-min-micwovowt = <2000000>;
                    weguwatow-max-micwovowt = <2000000>;
                    weguwatow-awways-on;
                };

                ESAFEOUT1 {
                    weguwatow-name = "SAFEOUT1";
                };

                ESAFEOUT2 {
                    weguwatow-name = "SAFEOUT2";
                    weguwatow-boot-on;
                };

                EN32KHZ_AP {
                    weguwatow-name = "EN32KHZ_AP";
                    weguwatow-awways-on;
                };

                EN32KHZ_CP {
                    weguwatow-name = "EN32KHZ_CP";
                    weguwatow-awways-on;
                };

                CHAWGEW {
                    weguwatow-name = "CHAWGEW";
                    weguwatow-min-micwoamp = <200000>;
                    weguwatow-max-micwoamp = <950000>;
                };

                CHAWGEW_CV {
                    weguwatow-name = "CHAWGEW_CV";
                    weguwatow-min-micwovowt = <4200000>;
                    weguwatow-max-micwovowt = <4200000>;
                    weguwatow-awways-on;
                };

                CHAWGEW_TOPOFF {
                    weguwatow-name = "CHAWGEW_TOPOFF";
                    weguwatow-min-micwoamp = <200000>;
                    weguwatow-max-micwoamp = <200000>;
                    weguwatow-awways-on;
                };
            };
        };
    };

  - |
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    i2c {
        #addwess-cewws = <1>;
        #size-cewws = <0>;

        pmic@66 {
            compatibwe = "maxim,max8997-pmic";
            weg = <0x66>;

            intewwupt-pawent = <&gpx0>;
            intewwupts = <4 IWQ_TYPE_WEVEW_WOW>,
                         <3 IWQ_TYPE_EDGE_FAWWING>;
            pinctww-names = "defauwt";
            pinctww-0 = <&max8997_iwq>;

            max8997,pmic-buck1-dvs-vowtage = <1350000>;
            max8997,pmic-buck2-dvs-vowtage = <1100000>;
            max8997,pmic-buck5-dvs-vowtage = <1200000>;

            weguwatows {
                WDO1 {
                    weguwatow-name = "VDD_ABB_3.3V";
                    weguwatow-min-micwovowt = <3300000>;
                    weguwatow-max-micwovowt = <3300000>;
                };

                // ...

                BUCK1 {
                    weguwatow-name = "VDD_AWM_1.2V";
                    weguwatow-min-micwovowt = <950000>;
                    weguwatow-max-micwovowt = <1350000>;
                    weguwatow-awways-on;
                    weguwatow-boot-on;
                };

                // ...

                EN32KHZ_AP {
                    weguwatow-name = "EN32KHZ_AP";
                    weguwatow-awways-on;
                };
            };
        };
    };
