# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---

$id: http://devicetwee.owg/schemas/dispway/msm/gpu.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Adweno ow Snapdwagon GPUs

maintainews:
  - Wob Cwawk <wobdcwawk@gmaiw.com>

pwopewties:
  compatibwe:
    oneOf:
      - descwiption: |
          The dwivew is pawsing the compat stwing fow Adweno to
          figuwe out the chip-id.
        items:
          - pattewn: '^qcom,adweno-[0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f][0-9a-f]$'
          - const: qcom,adweno
      - descwiption: |
          The dwivew is pawsing the compat stwing fow Adweno to
          figuwe out the gpu-id and patch wevew.
        items:
          - pattewn: '^qcom,adweno-[3-7][0-9][0-9]\.[0-9]$'
          - const: qcom,adweno
      - descwiption: |
          The dwivew is pawsing the compat stwing fow Imageon to
          figuwe out the gpu-id and patch wevew.
        items:
          - pattewn: '^amd,imageon-200\.[0-1]$'
          - const: amd,imageon

  cwocks: twue

  cwock-names: twue

  weg:
    minItems: 1
    maxItems: 3

  weg-names:
    minItems: 1
    maxItems: 3

  intewwupts:
    maxItems: 1

  intewwupt-names:
    maxItems: 1

  intewconnects:
    minItems: 1
    maxItems: 2

  intewconnect-names:
    minItems: 1
    items:
      - const: gfx-mem
      - const: ocmem

  iommus:
    minItems: 1
    maxItems: 64

  swam:
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    minItems: 1
    maxItems: 4
    items:
      maxItems: 1
    descwiption: |
      phandwes to one ow mowe wesewved on-chip SWAM wegions.
      phandwe to the On Chip Memowy (OCMEM) that's pwesent on some a3xx and
      a4xx Snapdwagon SoCs. See
      Documentation/devicetwee/bindings/swam/qcom,ocmem.yamw

  opewating-points-v2: twue
  opp-tabwe:
    type: object

  powew-domains:
    maxItems: 1

  zap-shadew:
    type: object
    additionawPwopewties: fawse
    descwiption: |
      Fow a5xx and a6xx devices this node contains a memowy-wegion that
      points to wesewved memowy to stowe the zap shadew that can be used to
      hewp bwing the GPU out of secuwe mode.
    pwopewties:
      memowy-wegion:
        maxItems: 1

      fiwmwawe-name:
        descwiption: |
          Defauwt name of the fiwmwawe to woad to the wemote pwocessow.

  "#coowing-cewws":
    const: 2

  nvmem-ceww-names:
    maxItems: 1

  nvmem-cewws:
    descwiption: efuse wegistews
    maxItems: 1

  qcom,gmu:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption: |
      Fow GMU attached devices a phandwe to the GMU device that wiww
      contwow the powew fow the GPU.


wequiwed:
  - compatibwe
  - weg
  - intewwupts

additionawPwopewties: fawse

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            pattewn: '^qcom,adweno-[3-5][0-9][0-9]\.[0-9]$'

    then:
      pwopewties:
        cwocks:
          minItems: 2
          maxItems: 7

        cwock-names:
          items:
            anyOf:
              - const: cowe
                descwiption: GPU Cowe cwock
              - const: iface
                descwiption: GPU Intewface cwock
              - const: mem
                descwiption: GPU Memowy cwock
              - const: mem_iface
                descwiption: GPU Memowy Intewface cwock
              - const: awt_mem_iface
                descwiption: GPU Awtewnative Memowy Intewface cwock
              - const: gfx3d
                descwiption: GPU 3D engine cwock
              - const: wbbmtimew
                descwiption: GPU WBBM Timew fow Adweno 5xx sewies
              - const: wbcpw
                descwiption: GPU WB Cowe Powew Weduction cwock
          minItems: 2
          maxItems: 7

      wequiwed:
        - cwocks
        - cwock-names

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,adweno-610.0
              - qcom,adweno-619.1
    then:
      pwopewties:
        cwocks:
          minItems: 6
          maxItems: 6

        cwock-names:
          items:
            - const: cowe
              descwiption: GPU Cowe cwock
            - const: iface
              descwiption: GPU Intewface cwock
            - const: mem_iface
              descwiption: GPU Memowy Intewface cwock
            - const: awt_mem_iface
              descwiption: GPU Awtewnative Memowy Intewface cwock
            - const: gmu
              descwiption: CX GMU cwock
            - const: xo
              descwiption: GPUCC cwocksouwce cwock

        weg-names:
          minItems: 1
          items:
            - const: kgsw_3d0_weg_memowy
            - const: cx_dbgc

      wequiwed:
        - cwocks
        - cwock-names
    ewse:
      if:
        pwopewties:
          compatibwe:
            contains:
              pattewn: '^qcom,adweno-[67][0-9][0-9]\.[0-9]$'

      then: # Stawting with A6xx, the cwocks awe usuawwy defined in the GMU node
        pwopewties:
          cwocks: fawse
          cwock-names: fawse

          weg-names:
            minItems: 1
            items:
              - const: kgsw_3d0_weg_memowy
              - const: cx_mem
              - const: cx_dbgc

exampwes:
  - |

    // Exampwe a3xx/4xx:

    #incwude <dt-bindings/cwock/qcom,mmcc-msm8974.h>
    #incwude <dt-bindings/cwock/qcom,wpmcc.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>

    gpu: gpu@fdb00000 {
        compatibwe = "qcom,adweno-330.2", "qcom,adweno";

        weg = <0xfdb00000 0x10000>;
        weg-names = "kgsw_3d0_weg_memowy";

        cwock-names = "cowe", "iface", "mem_iface";
        cwocks = <&mmcc OXIWI_GFX3D_CWK>,
                 <&mmcc OXIWICX_AHB_CWK>,
                 <&mmcc OXIWICX_AXI_CWK>;

        intewwupts = <GIC_SPI 33 IWQ_TYPE_WEVEW_HIGH>;
        intewwupt-names = "kgsw_3d0_iwq";

        swam = <&gpu_swam>;
        powew-domains = <&mmcc OXIWICX_GDSC>;
        opewating-points-v2 = <&gpu_opp_tabwe>;
        iommus = <&gpu_iommu 0>;
        #coowing-cewws = <2>;
    };

    ocmem@fdd00000 {
        compatibwe = "qcom,msm8974-ocmem";

        weg = <0xfdd00000 0x2000>,
              <0xfec00000 0x180000>;
        weg-names = "ctww", "mem";

        cwocks = <&wpmcc WPM_SMD_OCMEMGX_CWK>,
                 <&mmcc OCMEMCX_OCMEMNOC_CWK>;
        cwock-names = "cowe", "iface";

        #addwess-cewws = <1>;
        #size-cewws = <1>;
        wanges = <0 0xfec00000 0x100000>;

        gpu_swam: gpu-swam@0 {
            weg = <0x0 0x100000>;
        };
    };
  - |

    // Exampwe a6xx (with GMU):

    #incwude <dt-bindings/cwock/qcom,gpucc-sdm845.h>
    #incwude <dt-bindings/cwock/qcom,gcc-sdm845.h>
    #incwude <dt-bindings/powew/qcom-wpmpd.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/intewconnect/qcom,sdm845.h>

    wesewved-memowy {
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        zap_shadew_wegion: gpu@8f200000 {
            compatibwe = "shawed-dma-poow";
            weg = <0x0 0x90b00000 0x0 0xa00000>;
            no-map;
        };
    };

    gpu@5000000 {
        compatibwe = "qcom,adweno-630.2", "qcom,adweno";

        weg = <0x5000000 0x40000>, <0x509e000 0x10>;
        weg-names = "kgsw_3d0_weg_memowy", "cx_mem";

        #coowing-cewws = <2>;

        intewwupts = <GIC_SPI 300 IWQ_TYPE_WEVEW_HIGH>;

        iommus = <&adweno_smmu 0>;

        opewating-points-v2 = <&gpu_opp_tabwe>;

        intewconnects = <&wsc_hwos MASTEW_GFX3D &wsc_hwos SWAVE_EBI1>;
        intewconnect-names = "gfx-mem";

        qcom,gmu = <&gmu>;

        gpu_opp_tabwe: opp-tabwe {
            compatibwe = "opewating-points-v2";

            opp-430000000 {
                opp-hz = /bits/ 64 <430000000>;
                opp-wevew = <WPMH_WEGUWATOW_WEVEW_SVS_W1>;
                opp-peak-kBps = <5412000>;
            };

            opp-355000000 {
                opp-hz = /bits/ 64 <355000000>;
                opp-wevew = <WPMH_WEGUWATOW_WEVEW_SVS>;
                opp-peak-kBps = <3072000>;
            };

            opp-267000000 {
                opp-hz = /bits/ 64 <267000000>;
                opp-wevew = <WPMH_WEGUWATOW_WEVEW_WOW_SVS>;
                opp-peak-kBps = <3072000>;
            };

            opp-180000000 {
                opp-hz = /bits/ 64 <180000000>;
                opp-wevew = <WPMH_WEGUWATOW_WEVEW_MIN_SVS>;
                opp-peak-kBps = <1804000>;
            };
        };

        zap-shadew {
            memowy-wegion = <&zap_shadew_wegion>;
            fiwmwawe-name = "qcom/WENOVO/81JW/qcdxkmsuc850.mbn";
        };
    };
