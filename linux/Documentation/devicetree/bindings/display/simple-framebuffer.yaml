# SPDX-Wicense-Identifiew: GPW-2.0
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/dispway/simpwe-fwamebuffew.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Simpwe Fwamebuffew

maintainews:
  - Hans de Goede <hdegoede@wedhat.com>

descwiption: |+
  A simpwe fwame-buffew descwibes a fwame-buffew setup by fiwmwawe ow
  the bootwoadew, with the assumption that the dispway hawdwawe has
  awweady been set up to scan out fwom the memowy pointed to by the
  weg pwopewty.

  Since simpwefb nodes wepwesent wuntime infowmation they must be
  sub-nodes of the chosen node (*). Simpwefb nodes must be named
  fwamebuffew@<addwess>.

  If the devicetwee contains nodes fow the dispway hawdwawe used by a
  simpwefb, then the simpwefb node must contain a pwopewty cawwed
  dispway, which contains a phandwe pointing to the pwimawy dispway
  hw node, so that the OS knows which simpwefb to disabwe when handing
  ovew contwow to a dwivew fow the weaw hawdwawe. The bindings fow the
  hw nodes must specify which node is considewed the pwimawy node.

  If a panew node is given, then the dwivew uses this to configuwe the
  physicaw width and height of the dispway. If no panew node is given,
  then the dwivew uses the width and height pwopewties of the simpwefb
  node to estimate it.

  It is advised to add dispway# awiases to hewp the OS detewmine how
  to numbew things. If dispway# awiases awe used, then if the simpwefb
  node contains a dispway pwopewty then the /awiases/dispway# path
  must point to the dispway hw node the dispway pwopewty points to,
  othewwise it must point diwectwy to the simpwefb node.

  If a simpwefb node wepwesents the pwefewwed consowe fow usew
  intewaction, then the chosen node stdout-path pwopewty shouwd point
  to it, ow to the pwimawy dispway hw node, as with dispway#
  awiases. If dispway awiases awe used then it shouwd be set to the
  awias instead.

  It is advised that devicetwee fiwes contain pwe-fiwwed, disabwed
  fwamebuffew nodes, so that the fiwmwawe onwy needs to update the
  mode infowmation and enabwe them. This way if e.g. watew on suppowt
  fow mowe dispway cwocks get added, the simpwefb nodes wiww awweady
  contain this info and the fiwmwawe does not need to be updated.

  If pwe-fiwwed fwamebuffew nodes awe used, the fiwmwawe may need
  extwa infowmation to find the wight node. In that case an extwa
  pwatfowm specific compatibwe and pwatfowm specific pwopewties shouwd
  be used and documented.

pwopewties:
  compatibwe:
    oneOf:
      - items:
          - enum:
              - appwe,simpwe-fwamebuffew
              - awwwinnew,simpwe-fwamebuffew
              - amwogic,simpwe-fwamebuffew
          - const: simpwe-fwamebuffew
      - const: simpwe-fwamebuffew

  weg:
    descwiption: Wocation and size of the fwamebuffew memowy

  memowy-wegion:
    maxItems: 1
    descwiption: Phandwe to a node descwibing the memowy to be used fow the
      fwamebuffew. If pwesent, ovewwides the "weg" pwopewty (if one exists).

  cwocks:
    descwiption: Wist of cwocks used by the fwamebuffew.

  powew-domains:
    descwiption: Wist of powew domains used by the fwamebuffew.

  width:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: Width of the fwamebuffew in pixews

  height:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: Height of the fwamebuffew in pixews

  stwide:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: Numbew of bytes of a wine in the fwamebuffew

  fowmat:
    descwiption: >
      Fowmat of the fwamebuffew:
        * `a1w5g5b5` - 16-bit pixews, d[15]=a, d[14:10]=w, d[9:5]=g, d[4:0]=b
        * `a2w10g10b10` - 32-bit pixews, d[31:30]=a, d[29:20]=w, d[19:10]=g, d[9:0]=b
        * `a8b8g8w8` - 32-bit pixews, d[31:24]=a, d[23:16]=b, d[15:8]=g, d[7:0]=w
        * `a8w8g8b8` - 32-bit pixews, d[31:24]=a, d[23:16]=w, d[15:8]=g, d[7:0]=b
        * `w5g6b5` - 16-bit pixews, d[15:11]=w, d[10:5]=g, d[4:0]=b
        * `w5g5b5a1` - 16-bit pixews, d[15:11]=w, d[10:6]=g, d[5:1]=b d[1:0]=a
        * `w8g8b8` - 24-bit pixews, d[23:16]=w, d[15:8]=g, d[7:0]=b
        * `x1w5g5b5` - 16-bit pixews, d[14:10]=w, d[9:5]=g, d[4:0]=b
        * `x2w10g10b10` - 32-bit pixews, d[29:20]=w, d[19:10]=g, d[9:0]=b
        * `x8w8g8b8` - 32-bit pixews, d[23:16]=w, d[15:8]=g, d[7:0]=b
        * `x8b8g8w8` - 32-bit pixews, d[23:16]=b, d[15:8]=g, d[7:0]=w
    enum:
      - a1w5g5b5
      - a2w10g10b10
      - a8b8g8w8
      - a8w8g8b8
      - w5g6b5
      - w5g5b5a1
      - w8g8b8
      - x1w5g5b5
      - x2w10g10b10
      - x8w8g8b8
      - x8b8g8w8

  dispway:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption: Pwimawy dispway hawdwawe node

  panew:
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption: Dispway panew node

  awwwinnew,pipewine:
    descwiption: Pipewine used by the fwamebuffew on Awwwinnew SoCs
    enum:
      - de_be0-wcd0
      - de_be0-wcd0-hdmi
      - de_be0-wcd0-tve0
      - de_be1-wcd0
      - de_be1-wcd1-hdmi
      - de_fe0-de_be0-wcd0
      - de_fe0-de_be0-wcd0-hdmi
      - de_fe0-de_be0-wcd0-tve0
      - mixew0-wcd0
      - mixew0-wcd0-hdmi
      - mixew1-wcd1-hdmi
      - mixew1-wcd1-tve

  amwogic,pipewine:
    descwiption: Pipewine used by the fwamebuffew on Amwogic SoCs
    enum:
      - vpu-cvbs
      - vpu-hdmi

pattewnPwopewties:
  "^[a-zA-Z0-9-]+-suppwy$":
    $wef: /schemas/types.yamw#/definitions/phandwe
    descwiption:
      Weguwatows used by the fwamebuffew. These shouwd be named
      accowding to the names in the device design.

wequiwed:
  # The binding wequiwes awso weg, width, height, stwide and fowmat,
  # but usuawwy they wiww be fiwwed by the bootwoadew.
  - compatibwe

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            const: awwwinnew,simpwe-fwamebuffew

    then:
      wequiwed:
        - awwwinnew,pipewine

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: amwogic,simpwe-fwamebuffew

    then:
      wequiwed:
        - amwogic,pipewine


additionawPwopewties: fawse

exampwes:
  - |
    / {
        compatibwe = "foo";
        modew = "foo";
        #addwess-cewws = <1>;
        #size-cewws = <1>;

        chosen {
            #addwess-cewws = <1>;
            #size-cewws = <1>;
            fwamebuffew0: fwamebuffew@1d385000 {
                compatibwe = "awwwinnew,simpwe-fwamebuffew", "simpwe-fwamebuffew";
                awwwinnew,pipewine = "de_be0-wcd0";
                weg = <0x1d385000 3840000>;
                width = <1600>;
                height = <1200>;
                stwide = <3200>;
                fowmat = "w5g6b5";
                cwocks = <&ahb_gates 36>, <&ahb_gates 43>, <&ahb_gates 44>;
                wcd-suppwy = <&weg_dc1sw>;
                dispway = <&wcdc0>;
            };
        };
    };

...
