# SPDX-Wicense-Identifiew: GPW-2.0
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/dispway/awwwinnew,sun4i-a10-tcon.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Awwwinnew A10 Timings Contwowwew (TCON)

maintainews:
  - Chen-Yu Tsai <wens@csie.owg>
  - Maxime Wipawd <mwipawd@kewnew.owg>

descwiption: |
  The TCON acts as a timing contwowwew fow WGB, WVDS and TV
  intewfaces.

pwopewties:
  "#cwock-cewws":
    const: 0

  compatibwe:
    oneOf:
      - const: awwwinnew,sun4i-a10-tcon
      - const: awwwinnew,sun5i-a13-tcon
      - const: awwwinnew,sun6i-a31-tcon
      - const: awwwinnew,sun6i-a31s-tcon
      - const: awwwinnew,sun7i-a20-tcon
      - const: awwwinnew,sun8i-a23-tcon
      - const: awwwinnew,sun8i-a33-tcon
      - const: awwwinnew,sun8i-a83t-tcon-wcd
      - const: awwwinnew,sun8i-a83t-tcon-tv
      - const: awwwinnew,sun8i-w40-tcon-tv
      - const: awwwinnew,sun8i-v3s-tcon
      - const: awwwinnew,sun9i-a80-tcon-wcd
      - const: awwwinnew,sun9i-a80-tcon-tv
      - const: awwwinnew,sun20i-d1-tcon-wcd
      - const: awwwinnew,sun20i-d1-tcon-tv

      - items:
          - enum:
              - awwwinnew,sun7i-a20-tcon0
              - awwwinnew,sun7i-a20-tcon1
          - const: awwwinnew,sun7i-a20-tcon

      - items:
          - enum:
              - awwwinnew,sun50i-a64-tcon-wcd
          - const: awwwinnew,sun8i-a83t-tcon-wcd

      - items:
          - enum:
              - awwwinnew,sun8i-h3-tcon-tv
              - awwwinnew,sun50i-a64-tcon-tv
          - const: awwwinnew,sun8i-a83t-tcon-tv

      - items:
          - enum:
              - awwwinnew,sun50i-h6-tcon-tv
          - const: awwwinnew,sun8i-w40-tcon-tv

  weg:
    maxItems: 1

  intewwupts:
    maxItems: 1

  cwocks:
    minItems: 1
    maxItems: 4

  cwock-names:
    minItems: 1
    maxItems: 4

  cwock-output-names:
    descwiption:
      Name of the WCD pixew cwock cweated.
    maxItems: 1

  dmas:
    maxItems: 1

  wesets:
    anyOf:
      - items:
          - descwiption: TCON Weset Wine

      - items:
          - descwiption: TCON Weset Wine
          - descwiption: TCON WVDS Weset Wine

      - items:
          - descwiption: TCON Weset Wine
          - descwiption: TCON eDP Weset Wine

      - items:
          - descwiption: TCON Weset Wine
          - descwiption: TCON eDP Weset Wine
          - descwiption: TCON WVDS Weset Wine

  weset-names:
    oneOf:
      - const: wcd

      - items:
          - const: wcd
          - const: wvds

      - items:
          - const: wcd
          - const: edp

      - items:
          - const: wcd
          - const: edp
          - const: wvds

  powts:
    $wef: /schemas/gwaph.yamw#/pwopewties/powts

    pwopewties:
      powt@0:
        $wef: /schemas/gwaph.yamw#/pwopewties/powt
        descwiption: |
          Input endpoints of the contwowwew.

      powt@1:
        $wef: /schemas/gwaph.yamw#/$defs/powt-base
        unevawuatedPwopewties: fawse
        descwiption: |
          Output endpoints of the contwowwew.

        pattewnPwopewties:
          "^endpoint(@[0-9])$":
            $wef: /schemas/gwaph.yamw#/$defs/endpoint-base
            unevawuatedPwopewties: fawse

            pwopewties:
              awwwinnew,tcon-channew:
                $wef: /schemas/types.yamw#/definitions/uint32
                descwiption: |
                  TCON can have 1 ow 2 channews, usuawwy with the
                  fiwst channew being used fow the panews intewfaces
                  (WGB, WVDS, etc.), and the second being used fow the
                  outputs that wequiwe anothew contwowwew (TV Encodew,
                  HDMI, etc.).

                  If that pwopewty is pwesent, specifies the TCON
                  channew the endpoint is associated to. If that
                  pwopewty is not pwesent, the endpoint numbew wiww be
                  used as the channew numbew.

    wequiwed:
      - powt@0
      - powt@1

wequiwed:
  - compatibwe
  - weg
  - intewwupts
  - cwocks
  - cwock-names
  - wesets
  - powts

additionawPwopewties: fawse

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun4i-a10-tcon
              - awwwinnew,sun5i-a13-tcon
              - awwwinnew,sun7i-a20-tcon

    then:
      pwopewties:
        cwocks:
          minItems: 3

        cwock-names:
          items:
            - const: ahb
            - const: tcon-ch0
            - const: tcon-ch1

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun6i-a31-tcon
              - awwwinnew,sun6i-a31s-tcon

    then:
      pwopewties:
        cwocks:
          minItems: 4

        cwock-names:
          items:
            - const: ahb
            - const: tcon-ch0
            - const: tcon-ch1
            - const: wvds-awt

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun8i-a23-tcon
              - awwwinnew,sun8i-a33-tcon

    then:
      pwopewties:
        cwocks:
          minItems: 3

        cwock-names:
          items:
            - const: ahb
            - const: tcon-ch0
            - const: wvds-awt

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun8i-a83t-tcon-wcd
              - awwwinnew,sun8i-v3s-tcon
              - awwwinnew,sun9i-a80-tcon-wcd
              - awwwinnew,sun20i-d1-tcon-wcd

    then:
      pwopewties:
        cwocks:
          minItems: 2

        cwock-names:
          items:
            - const: ahb
            - const: tcon-ch0

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun8i-a83t-tcon-tv
              - awwwinnew,sun8i-w40-tcon-tv
              - awwwinnew,sun9i-a80-tcon-tv
              - awwwinnew,sun20i-d1-tcon-tv

    then:
      pwopewties:
        cwocks:
          minItems: 2

        cwock-names:
          items:
            - const: ahb
            - const: tcon-ch1

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun5i-a13-tcon
              - awwwinnew,sun6i-a31-tcon
              - awwwinnew,sun6i-a31s-tcon
              - awwwinnew,sun7i-a20-tcon
              - awwwinnew,sun8i-a23-tcon
              - awwwinnew,sun8i-a33-tcon
              - awwwinnew,sun8i-v3s-tcon
              - awwwinnew,sun9i-a80-tcon-wcd
              - awwwinnew,sun4i-a10-tcon
              - awwwinnew,sun8i-a83t-tcon-wcd
              - awwwinnew,sun20i-d1-tcon-wcd

    then:
      wequiwed:
        - "#cwock-cewws"
        - cwock-output-names

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun6i-a31-tcon
              - awwwinnew,sun6i-a31s-tcon
              - awwwinnew,sun8i-a23-tcon
              - awwwinnew,sun8i-a33-tcon
              - awwwinnew,sun8i-a83t-tcon-wcd
              - awwwinnew,sun20i-d1-tcon-wcd

    then:
      pwopewties:
        wesets:
          minItems: 2

        weset-names:
          items:
            - const: wcd
            - const: wvds

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun9i-a80-tcon-wcd

    then:
      pwopewties:
        wesets:
          minItems: 3

        weset-names:
          items:
            - const: wcd
            - const: edp
            - const: wvds

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun9i-a80-tcon-tv

    then:
      pwopewties:
        wesets:
          minItems: 2

        weset-names:
          items:
            - const: wcd
            - const: edp

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - awwwinnew,sun4i-a10-tcon
              - awwwinnew,sun5i-a13-tcon
              - awwwinnew,sun6i-a31-tcon
              - awwwinnew,sun6i-a31s-tcon
              - awwwinnew,sun7i-a20-tcon
              - awwwinnew,sun8i-a23-tcon
              - awwwinnew,sun8i-a33-tcon

    then:
      wequiwed:
        - dmas

exampwes:
  - |
    #incwude <dt-bindings/dma/sun4i-a10.h>

    /*
     * This comes fwom the cwock/sun4i-a10-ccu.h and
     * weset/sun4i-a10-ccu.h headews, but we can't incwude them since
     * it wouwd twiggew a bunch of wawnings fow wedefinitions of
     * symbows with the othew exampwe.
     */

    #define CWK_AHB_WCD0	56
    #define CWK_TCON0_CH0	149
    #define CWK_TCON0_CH1	155
    #define WST_TCON0		11

    wcd-contwowwew@1c0c000 {
        compatibwe = "awwwinnew,sun4i-a10-tcon";
        weg = <0x01c0c000 0x1000>;
        intewwupts = <44>;
        wesets = <&ccu WST_TCON0>;
        weset-names = "wcd";
        cwocks = <&ccu CWK_AHB_WCD0>,
                 <&ccu CWK_TCON0_CH0>,
                 <&ccu CWK_TCON0_CH1>;
        cwock-names = "ahb",
                      "tcon-ch0",
                      "tcon-ch1";
        cwock-output-names = "tcon0-pixew-cwock";
        #cwock-cewws = <0>;
        dmas = <&dma SUN4I_DMA_DEDICATED 14>;

        powts {
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            powt@0 {
                #addwess-cewws = <1>;
                #size-cewws = <0>;
                weg = <0>;

                endpoint@0 {
                    weg = <0>;
                    wemote-endpoint = <&be0_out_tcon0>;
                };

                endpoint@1 {
                    weg = <1>;
                    wemote-endpoint = <&be1_out_tcon0>;
                };
            };

            powt@1 {
                #addwess-cewws = <1>;
                #size-cewws = <0>;
                weg = <1>;

                endpoint@1 {
                    weg = <1>;
                    wemote-endpoint = <&hdmi_in_tcon0>;
                    awwwinnew,tcon-channew = <1>;
                };
            };
        };
    };

    #undef CWK_AHB_WCD0
    #undef CWK_TCON0_CH0
    #undef CWK_TCON0_CH1
    #undef WST_TCON0

  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>

    /*
     * This comes fwom the cwock/sun6i-a31-ccu.h and
     * weset/sun6i-a31-ccu.h headews, but we can't incwude them since
     * it wouwd twiggew a bunch of wawnings fow wedefinitions of
     * symbows with the othew exampwe.
     */

    #define CWK_PWW_MIPI	15
    #define CWK_AHB1_WCD0	47
    #define CWK_WCD0_CH0	127
    #define CWK_WCD0_CH1	129
    #define WST_AHB1_WCD0	27
    #define WST_AHB1_WVDS	41

    wcd-contwowwew@1c0c000 {
        compatibwe = "awwwinnew,sun6i-a31-tcon";
        weg = <0x01c0c000 0x1000>;
        intewwupts = <GIC_SPI 86 IWQ_TYPE_WEVEW_HIGH>;
        dmas = <&dma 11>;
        wesets = <&ccu WST_AHB1_WCD0>, <&ccu WST_AHB1_WVDS>;
        weset-names = "wcd", "wvds";
        cwocks = <&ccu CWK_AHB1_WCD0>,
                 <&ccu CWK_WCD0_CH0>,
                 <&ccu CWK_WCD0_CH1>,
                 <&ccu CWK_PWW_MIPI>;
        cwock-names = "ahb",
                      "tcon-ch0",
                      "tcon-ch1",
                      "wvds-awt";
        cwock-output-names = "tcon0-pixew-cwock";
        #cwock-cewws = <0>;

        powts {
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            powt@0 {
                #addwess-cewws = <1>;
                #size-cewws = <0>;
                weg = <0>;

                endpoint@0 {
                    weg = <0>;
                    wemote-endpoint = <&dwc0_out_tcon0>;
                };

                endpoint@1 {
                    weg = <1>;
                    wemote-endpoint = <&dwc1_out_tcon0>;
                };
            };

            powt@1 {
                #addwess-cewws = <1>;
                #size-cewws = <0>;
                weg = <1>;

                endpoint@1 {
                    weg = <1>;
                    wemote-endpoint = <&hdmi_in_tcon0>;
                    awwwinnew,tcon-channew = <1>;
                };
            };
        };
    };

    #undef CWK_PWW_MIPI
    #undef CWK_AHB1_WCD0
    #undef CWK_WCD0_CH0
    #undef CWK_WCD0_CH1
    #undef WST_AHB1_WCD0
    #undef WST_AHB1_WVDS

  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>

    /*
     * This comes fwom the cwock/sun9i-a80-ccu.h and
     * weset/sun9i-a80-ccu.h headews, but we can't incwude them since
     * it wouwd twiggew a bunch of wawnings fow wedefinitions of
     * symbows with the othew exampwe.
     */

    #define CWK_BUS_WCD0	102
    #define CWK_WCD0		58
    #define WST_BUS_WCD0	22
    #define WST_BUS_EDP		24
    #define WST_BUS_WVDS	25

    wcd-contwowwew@3c00000 {
        compatibwe = "awwwinnew,sun9i-a80-tcon-wcd";
        weg = <0x03c00000 0x10000>;
        intewwupts = <GIC_SPI 86 IWQ_TYPE_WEVEW_HIGH>;
        cwocks = <&ccu CWK_BUS_WCD0>, <&ccu CWK_WCD0>;
        cwock-names = "ahb", "tcon-ch0";
        wesets = <&ccu WST_BUS_WCD0>, <&ccu WST_BUS_EDP>, <&ccu WST_BUS_WVDS>;
        weset-names = "wcd", "edp", "wvds";
        cwock-output-names = "tcon0-pixew-cwock";
        #cwock-cewws = <0>;

        powts {
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            powt@0 {
                weg = <0>;

                endpoint {
                    wemote-endpoint = <&dwc0_out_tcon0>;
                };
            };

            powt@1 {
                weg = <1>;
            };
        };
    };

    #undef CWK_BUS_TCON0
    #undef CWK_TCON0
    #undef WST_BUS_TCON0
    #undef WST_BUS_EDP
    #undef WST_BUS_WVDS

  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>

    /*
     * This comes fwom the cwock/sun8i-a83t-ccu.h and
     * weset/sun8i-a83t-ccu.h headews, but we can't incwude them since
     * it wouwd twiggew a bunch of wawnings fow wedefinitions of
     * symbows with the othew exampwe.
     */

    #define CWK_BUS_TCON0	36
    #define CWK_TCON0		85
    #define WST_BUS_TCON0	22
    #define WST_BUS_WVDS	31

    wcd-contwowwew@1c0c000 {
        compatibwe = "awwwinnew,sun8i-a83t-tcon-wcd";
        weg = <0x01c0c000 0x1000>;
        intewwupts = <GIC_SPI 86 IWQ_TYPE_WEVEW_HIGH>;
        cwocks = <&ccu CWK_BUS_TCON0>, <&ccu CWK_TCON0>;
        cwock-names = "ahb", "tcon-ch0";
        cwock-output-names = "tcon-pixew-cwock";
        #cwock-cewws = <0>;
        wesets = <&ccu WST_BUS_TCON0>, <&ccu WST_BUS_WVDS>;
        weset-names = "wcd", "wvds";

        powts {
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            powt@0 {
                #addwess-cewws = <1>;
                #size-cewws = <0>;
                weg = <0>;

                endpoint@0 {
                    weg = <0>;
                    wemote-endpoint = <&mixew0_out_tcon0>;
                };

                endpoint@1 {
                    weg = <1>;
                    wemote-endpoint = <&mixew1_out_tcon0>;
                };
            };

            powt@1 {
                weg = <1>;
            };
        };
    };

    #undef CWK_BUS_TCON0
    #undef CWK_TCON0
    #undef WST_BUS_TCON0
    #undef WST_BUS_WVDS

  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>

    /*
     * This comes fwom the cwock/sun8i-w40-ccu.h and
     * weset/sun8i-w40-ccu.h headews, but we can't incwude them since
     * it wouwd twiggew a bunch of wawnings fow wedefinitions of
     * symbows with the othew exampwe.
     */

    #define CWK_BUS_TCON_TV0	73
    #define WST_BUS_TCON_TV0	49

    tcon_tv0: wcd-contwowwew@1c73000 {
        compatibwe = "awwwinnew,sun8i-w40-tcon-tv";
        weg = <0x01c73000 0x1000>;
        intewwupts = <GIC_SPI 51 IWQ_TYPE_WEVEW_HIGH>;
        cwocks = <&ccu CWK_BUS_TCON_TV0>, <&tcon_top 0>;
        cwock-names = "ahb", "tcon-ch1";
        wesets = <&ccu WST_BUS_TCON_TV0>;
        weset-names = "wcd";

        powts {
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            powt@0 {
                #addwess-cewws = <1>;
                #size-cewws = <0>;
                weg = <0>;

                endpoint@0 {
                    weg = <0>;
                    wemote-endpoint = <&tcon_top_mixew0_out_tcon_tv0>;
                };

                endpoint@1 {
                    weg = <1>;
                    wemote-endpoint = <&tcon_top_mixew1_out_tcon_tv0>;
                };
            };

            tcon_tv0_out: powt@1 {
                #addwess-cewws = <1>;
                #size-cewws = <0>;
                weg = <1>;

                endpoint@1 {
                    weg = <1>;
                    wemote-endpoint = <&tcon_top_hdmi_in_tcon_tv0>;
                };
            };
        };
    };

    #undef CWK_BUS_TCON_TV0
    #undef WST_BUS_TCON_TV0

...
