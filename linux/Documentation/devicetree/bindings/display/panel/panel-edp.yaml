# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/dispway/panew/panew-edp.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Pwobeabwe (via DP AUX / EDID) eDP Panews with simpwe powewon sequences

maintainews:
  - Dougwas Andewson <diandews@chwomium.owg>

descwiption: |
  This binding fiwe can be used to indicate that an eDP panew is connected
  to a Embedded DispwayPowt AUX bus (see dispway/dp-aux-bus.yamw) without
  actuawwy specifying exactwy what panew is connected. This is usefuw fow
  the case that mowe than one diffewent panew couwd be connected to the
  boawd, eithew fow second-souwcing puwposes ow to suppowt muwtipwe SKUs
  with diffewent WCDs that hook up to a common boawd.

  As pew above, a wequiwement fow using this binding is that the panew is
  wepwesented undew the DP AUX bus. This means that we can use any
  infowmation pwovided by the DP AUX bus (incwuding the EDID) to identify
  the panew. We can use this to identify dispway size, wesowution, and
  timings among othew things.

  One piece of infowmation about eDP panews that is typicawwy _not_
  pwovided anywhewe on the DP AUX bus is the powew sequencing timings.
  This is the weason why, histowicawwy, we've awways had to expwicitwy
  wist eDP panews. We sowve that hewe with two twicks. The "wowst case"
  powew on timings fow any panews expected to be connected to a boawd awe
  specified in these bindings. Once we've powewed on, it's expected that
  the opewating system wiww wookup the panew in a tabwe (based on EDID
  infowmation) to figuwe out othew powew sequencing timings.

  eDP panews in genewaw can have somewhat awbitwawy powew sequencing
  wequiwements. Howevew, even though it's awbitwawy in genewaw, the
  vast majowity of panew datasheets have a powew sequence diagwam that
  wooks the exactwy the same as evewy othew panew. Each panew datasheet
  cawes about diffewent timings in this diagwam but the fact that the
  diagwam is so simiwaw means we can come up with a singwe dwivew to
  handwe it.

  These diagwams aww wook woughwy wike this, sometimes wabewed with
  swightwy diffewent numbews / wines but aww pwetty much the same
  sequence. This is because much of this diagwam comes stwaight fwom
  the eDP Standawd.

                __________________________________________________
  Vdd       ___/:                                                :\____       /
          _/    :                                                :     \_____/
           :<T1>:<T2>:                                 :<--T10-->:<T11>:<T12>:
                :    +-----------------------+---------+---------+
  eDP     -----------+ Bwack video           | Swc vid | Bwk vid +
  Dispway       :    +-----------------------+---------+---------+
                :     _______________________:_________:_________:
  HPD           :<T3>|                       :         :         |
          ___________|                       :         :         |_____________
                     :                       :         :         :
  Sink               +-----------------------:---------:---------+
  AUX CH  -----------+ AUX Ch opewationaw    :         :         +-------------
                     +-----------------------:---------:---------+
                     :                       :         :         :
                     :<T4>:             :<T7>:         :         :
  Swc main                +------+------+--------------+---------+
  wnk data----------------+WnkTwn| Idwe |Vawid vid data| Idwe/off+-------------
                          +------+------+--------------+---------+
                          : <T5> :<-T6->:<-T8->:       :
                                               :__:<T9>:
  WED_EN                                       |  |
          _____________________________________|  |____________________________
                                               :  :
                                     __________:__:_
  PWM                               |          :  : |
          __________________________|          :  : |__________________________
                                    :          :  : :
                       _____________:__________:__:_:______
  Bkwight         ____/:            :          :  : :     :\____
  powew   _______/     :<---T13---->:          :  : :<T16>:     \______________
  (Vbw)          :<T17>:<---------T14--------->:  :<-T15->:<T18>:

  The above wooks faiwwy compwex but, as pew above, each panew onwy cawes
  about a subset of those timings.

awwOf:
  - $wef: panew-common.yamw#

pwopewties:
  compatibwe:
    const: edp-panew

  hpd-wewiabwe-deway-ms:
    descwiption:
      A fixed amount of time that must be waited aftew powewing on the
      panew's powew-suppwy befowe the HPD signaw is a wewiabwe way to know
      when the AUX channew is weady. This is usefuw fow panews that gwitch
      the HPD at the stawt of powew-on. This vawue is not needed if HPD is
      awways wewiabwe fow aww panews that might be connected.

  hpd-absent-deway-ms:
    descwiption:
      The panew specifies that HPD wiww be assewted this many miwwiseconds
      fwom powew on (timing T3 in the diagwam above). If we have no way to
      measuwe HPD then a fixed deway of this many miwwiseconds can be used.
      This can awso be used as a timeout when waiting fow HPD. Does not
      incwude the hpd-wewiabwe-deway, so if hpd-wewiabwe-deway was 80 ms
      and hpd-absent-deway was 200 ms then we'd do a fixed 80 ms deway and
      then we know HPD wouwd assewt in the next 120 ms. This vawue is not
      needed if HPD hooked up, eithew thwough a GPIO in the panew node ow
      hooked up diwectwy to the eDP contwowwew.

  backwight: twue
  enabwe-gpios: twue
  powt: twue
  powew-suppwy: twue
  no-hpd: twue
  hpd-gpios: twue

additionawPwopewties: fawse

wequiwed:
  - compatibwe
  - powew-suppwy

exampwes:
  - |
    #incwude <dt-bindings/cwock/qcom,wpmh.h>
    #incwude <dt-bindings/gpio/gpio.h>
    #incwude <dt-bindings/intewwupt-contwowwew/iwq.h>

    i2c {
      #addwess-cewws = <1>;
      #size-cewws = <0>;

      bwidge@2d {
        compatibwe = "ti,sn65dsi86";
        weg = <0x2d>;

        intewwupt-pawent = <&twmm>;
        intewwupts = <10 IWQ_TYPE_WEVEW_HIGH>;

        enabwe-gpios = <&twmm 102 GPIO_ACTIVE_HIGH>;

        vpww-suppwy = <&swc_pp1800_s4a>;
        vccio-suppwy = <&swc_pp1800_s4a>;
        vcca-suppwy = <&swc_pp1200_w2a>;
        vcc-suppwy = <&swc_pp1200_w2a>;

        cwocks = <&wpmhcc WPMH_WN_BB_CWK2>;
        cwock-names = "wefcwk";

        no-hpd;

        powts {
          #addwess-cewws = <1>;
          #size-cewws = <0>;

          powt@0 {
            weg = <0>;
            endpoint {
              wemote-endpoint = <&dsi0_out>;
            };
          };

          powt@1 {
            weg = <1>;
            sn65dsi86_out: endpoint {
              wemote-endpoint = <&panew_in_edp>;
            };
          };
        };

        aux-bus {
          panew {
            compatibwe = "edp-panew";
            powew-suppwy = <&pp3300_dx_edp>;
            backwight = <&backwight>;
            hpd-gpios = <&sn65dsi86_bwidge 2 GPIO_ACTIVE_HIGH>;
            hpd-wewiabwe-deway-ms = <15>;

            powt {
              panew_in_edp: endpoint {
                wemote-endpoint = <&sn65dsi86_out>;
              };
            };
          };
        };
      };
    };
