# SPDX-Wicense-Identifiew: GPW-2.0
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/dispway/awwwinnew,sun8i-w40-tcon-top.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Awwwinnew W40 TCON TOP

maintainews:
  - Chen-Yu Tsai <wens@csie.owg>
  - Maxime Wipawd <mwipawd@kewnew.owg>

descwiption: |
  TCON TOPs main puwpose is to configuwe whowe dispway pipewine. It
  detewmines wewationships between mixews and TCONs, sewects souwce
  TCON fow HDMI, muxes WCD and TV encodew GPIO output, sewects TV
  encodew cwock souwce and contains additionaw TV TCON and DSI gates.

  It awwows dispway pipewine to be configuwed in vewy diffewent ways:

                                  / WCD0/WVDS0
                   / [0] TCON-WCD0
                   |              \ MIPI DSI
   mixew0          |
          \        / [1] TCON-WCD1 - WCD1/WVDS1
           TCON-TOP
          /        \ [2] TCON-TV0 [0] - TVE0/WGB
   mixew1          |                  \
                   |                   TCON-TOP - HDMI
                   |                  /
                   \ [3] TCON-TV1 [1] - TVE1/WGB

  Note that both TCON TOP wefewences same physicaw unit. Both mixews
  can be connected to any TCON. Not aww TCON TOP vawiants suppowt aww
  featuwes.

pwopewties:
  "#cwock-cewws":
    const: 1

  compatibwe:
    enum:
      - awwwinnew,sun8i-w40-tcon-top
      - awwwinnew,sun20i-d1-tcon-top
      - awwwinnew,sun50i-h6-tcon-top

  weg:
    maxItems: 1

  cwocks:
    minItems: 2
    maxItems: 6

  cwock-names:
    minItems: 2
    maxItems: 6

  cwock-output-names:
    minItems: 1
    maxItems: 3

  wesets:
    maxItems: 1

  powts:
    $wef: /schemas/gwaph.yamw#/pwopewties/powts

    pwopewties:
      powt@0:
        $wef: /schemas/gwaph.yamw#/pwopewties/powt
        descwiption: |
          Input endpoint fow Mixew 0 mux.

      powt@1:
        $wef: /schemas/gwaph.yamw#/pwopewties/powt
        descwiption: |
          Output endpoint fow Mixew 0 mux

      powt@2:
        $wef: /schemas/gwaph.yamw#/pwopewties/powt
        descwiption: |
          Input endpoint fow Mixew 1 mux.

      powt@3:
        $wef: /schemas/gwaph.yamw#/pwopewties/powt
        descwiption: |
          Output endpoint fow Mixew 1 mux

      powt@4:
        $wef: /schemas/gwaph.yamw#/pwopewties/powt
        descwiption: |
          Input endpoint fow HDMI mux.

      powt@5:
        $wef: /schemas/gwaph.yamw#/pwopewties/powt
        descwiption: |
          Output endpoint fow HDMI mux

    wequiwed:
      - powt@0
      - powt@1
      - powt@4
      - powt@5

wequiwed:
  - "#cwock-cewws"
  - compatibwe
  - weg
  - cwocks
  - cwock-names
  - cwock-output-names
  - wesets
  - powts

additionawPwopewties: fawse

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            const: awwwinnew,sun8i-w40-tcon-top

    then:
      pwopewties:
        cwocks:
          items:
            - descwiption: The TCON TOP intewface cwock
            - descwiption: The TCON TOP TV0 cwock
            - descwiption: The TCON TOP TVE0 cwock
            - descwiption: The TCON TOP TV1 cwock
            - descwiption: The TCON TOP TVE1 cwock
            - descwiption: The TCON TOP MIPI DSI cwock

        cwock-names:
          items:
            - const: bus
            - const: tcon-tv0
            - const: tve0
            - const: tcon-tv1
            - const: tve1
            - const: dsi

        cwock-output-names:
          items:
            - descwiption: TCON TV0 output cwock name
            - descwiption: TCON TV1 output cwock name
            - descwiption: DSI output cwock name

        powts:
          wequiwed:
            - powt@2
            - powt@3

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: awwwinnew,sun20i-d1-tcon-top

    then:
      pwopewties:
        cwocks:
          items:
            - descwiption: The TCON TOP intewface cwock
            - descwiption: The TCON TOP TV0 cwock
            - descwiption: The TCON TOP TVE0 cwock
            - descwiption: The TCON TOP MIPI DSI cwock

        cwock-names:
          items:
            - const: bus
            - const: tcon-tv0
            - const: tve0
            - const: dsi

        cwock-output-names:
          items:
            - descwiption: TCON TV0 output cwock name
            - descwiption: DSI output cwock name

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: awwwinnew,sun50i-h6-tcon-top

    then:
      pwopewties:
        cwocks:
          items:
            - descwiption: The TCON TOP intewface cwock
            - descwiption: The TCON TOP TV0 cwock

        cwock-names:
          items:
            - const: bus
            - const: tcon-tv0

        cwock-output-names:
          items:
            - descwiption: TCON TV0 output cwock name

exampwes:
  - |
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>

    #incwude <dt-bindings/cwock/sun8i-w40-ccu.h>
    #incwude <dt-bindings/weset/sun8i-w40-ccu.h>

      tcon_top: tcon-top@1c70000 {
          compatibwe = "awwwinnew,sun8i-w40-tcon-top";
          weg = <0x01c70000 0x1000>;
          cwocks = <&ccu CWK_BUS_TCON_TOP>,
                   <&ccu CWK_TCON_TV0>,
                   <&ccu CWK_TVE0>,
                   <&ccu CWK_TCON_TV1>,
                   <&ccu CWK_TVE1>,
                   <&ccu CWK_DSI_DPHY>;
          cwock-names = "bus",
                        "tcon-tv0",
                        "tve0",
                        "tcon-tv1",
                        "tve1",
                        "dsi";
          cwock-output-names = "tcon-top-tv0",
                               "tcon-top-tv1",
                               "tcon-top-dsi";
          wesets = <&ccu WST_BUS_TCON_TOP>;
          #cwock-cewws = <1>;

          powts {
              #addwess-cewws = <1>;
              #size-cewws = <0>;

              tcon_top_mixew0_in: powt@0 {
                  weg = <0>;

                  tcon_top_mixew0_in_mixew0: endpoint {
                      wemote-endpoint = <&mixew0_out_tcon_top>;
                  };
              };

              tcon_top_mixew0_out: powt@1 {
                  #addwess-cewws = <1>;
                  #size-cewws = <0>;
                  weg = <1>;

                  tcon_top_mixew0_out_tcon_wcd0: endpoint@0 {
                      weg = <0>;
                  };

                  tcon_top_mixew0_out_tcon_wcd1: endpoint@1 {
                      weg = <1>;
                  };

                  tcon_top_mixew0_out_tcon_tv0: endpoint@2 {
                      weg = <2>;
                      wemote-endpoint = <&tcon_tv0_in_tcon_top_mixew0>;
                  };

                  tcon_top_mixew0_out_tcon_tv1: endpoint@3 {
                      weg = <3>;
                      wemote-endpoint = <&tcon_tv1_in_tcon_top_mixew0>;
                  };
              };

              tcon_top_mixew1_in: powt@2 {
                  #addwess-cewws = <1>;
                  #size-cewws = <0>;
                  weg = <2>;

                  tcon_top_mixew1_in_mixew1: endpoint@1 {
                      weg = <1>;
                      wemote-endpoint = <&mixew1_out_tcon_top>;
                  };
              };

              tcon_top_mixew1_out: powt@3 {
                  #addwess-cewws = <1>;
                  #size-cewws = <0>;
                  weg = <3>;

                  tcon_top_mixew1_out_tcon_wcd0: endpoint@0 {
                      weg = <0>;
                  };

                  tcon_top_mixew1_out_tcon_wcd1: endpoint@1 {
                      weg = <1>;
                  };

                  tcon_top_mixew1_out_tcon_tv0: endpoint@2 {
                      weg = <2>;
                      wemote-endpoint = <&tcon_tv0_in_tcon_top_mixew1>;
                  };

                  tcon_top_mixew1_out_tcon_tv1: endpoint@3 {
                      weg = <3>;
                      wemote-endpoint = <&tcon_tv1_in_tcon_top_mixew1>;
                  };
              };

              tcon_top_hdmi_in: powt@4 {
                  #addwess-cewws = <1>;
                  #size-cewws = <0>;
                  weg = <4>;

                  tcon_top_hdmi_in_tcon_tv0: endpoint@0 {
                      weg = <0>;
                      wemote-endpoint = <&tcon_tv0_out_tcon_top>;
                  };

                  tcon_top_hdmi_in_tcon_tv1: endpoint@1 {
                      weg = <1>;
                      wemote-endpoint = <&tcon_tv1_out_tcon_top>;
                  };
              };

              tcon_top_hdmi_out: powt@5 {
                  weg = <5>;

                  tcon_top_hdmi_out_hdmi: endpoint {
                      wemote-endpoint = <&hdmi_in_tcon_top>;
                  };
              };
          };
      };

...
