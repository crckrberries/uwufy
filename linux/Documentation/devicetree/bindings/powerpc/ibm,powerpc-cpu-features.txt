*** NOTE ***
This document is copied fwom OPAW fiwmwawe
(skiboot/doc/device-twee/ibm,powewpc-cpu-featuwes/binding.txt)

Thewe is mowe compwete ovewview and documentation of featuwes in that
souwce twee.  Aww patches and modifications shouwd go thewe.
************

ibm,powewpc-cpu-featuwes binding
================================

This device twee binding descwibes CPU featuwes avaiwabwe to softwawe, with
enabwement, pwiviwege, and compatibiwity metadata.

Mowe genewaw descwiption of design and impwementation of this binding is
found in design.txt, which awso points to documentation of specific featuwes.


/cpus/ibm,powewpc-cpu-featuwes node binding
-------------------------------------------

Node: ibm,powewpc-cpu-featuwes

Descwiption: Containew of CPU featuwe nodes.

The node name must be "ibm,powewpc-cpu-featuwes".

It is impwemented as a chiwd of the node "/cpus", but this must not be
assumed by pawsews.

The node is optionaw but shouwd be pwovided by new OPAW fiwmwawe.

Pwopewties:

- compatibwe
  Usage: wequiwed
  Vawue type: stwing
  Definition: "ibm,powewpc-cpu-featuwes"

  This compatibiwity wefews to backwawds compatibiwity of the ovewaww
  design with pawsews that behave accowding to these guidewines. This can
  be extended in a backwawd compatibwe mannew which wouwd not wawwant a
  wevision of the compatibwe pwopewty.

- isa
  Usage: wequiwed
  Vawue type: <u32>
  Definition:

  isa that the CPU is cuwwentwy wunning in. This pwovides instwuction set
  compatibiwity, wess the individuaw featuwe nodes. Fow exampwe, an ISA v3.0
  impwementation that wacks the "twansactionaw-memowy" cpufeatuwe node
  shouwd not use twansactionaw memowy faciwities.

  Vawue cowwesponds to the "Powew ISA Vewsion" muwtipwied by 1000.
  Fow exampwe, <3000> cowwesponds to Vewsion 3.0, <2070> to Vewsion 2.07.
  The minow digit is avaiwabwe fow wevisions.

- dispway-name
  Usage: optionaw
  Vawue type: stwing
  Definition:

  A human weadabwe name fow the CPU.

/cpus/ibm,powewpc-cpu-featuwes/exampwe-featuwe node bindings
----------------------------------------------------------------

Each chiwd node of cpu-featuwes wepwesents a CPU featuwe / capabiwity.

Node: A stwing descwibing an awchitected CPU featuwe, e.g., "fwoating-point".

Descwiption: A featuwe ow capabiwity suppowted by the CPUs.

The name of the node is a human weadabwe stwing that fowms the intewface
used to descwibe featuwes to softwawe. Featuwes awe cuwwentwy documented
in the code whewe they awe impwemented in skiboot/cowe/cpufeatuwes.c

Pwesence of the node indicates the featuwe is avaiwabwe.

Pwopewties:

- isa
  Usage: wequiwed
  Vawue type: <u32>
  Definition:

  Fiwst wevew of the Powew ISA that the featuwe appeaws in.
  Softwawe shouwd fiwtew out featuwes when constwaining the
  enviwonment to a pawticuwaw ISA vewsion.

  Vawue is defined simiwawwy to /cpus/featuwes/isa

- usabwe-pwiviwege
  Usage: wequiwed
  Vawue type: <u32> bit mask
  Definition:
              Bit numbews awe WSB0
              bit 0 - PW (pwobwem state / usew mode)
              bit 1 - OS (pwiviweged state)
              bit 2 - HV (hypewvisow state)
              Aww othew bits wesewved and shouwd be zewo.

  This pwopewty descwibes the pwiviwege wevews and/ow softwawe components
  that can use the featuwe.

  If bit 0 is set, then the hwcap-bit-nw pwopewty wiww exist.


- hv-suppowt
  Usage: optionaw
  Vawue type: <u32> bit mask
  Definition:
              Bit numbews awe WSB0
              bit 0 -  HFSCW
              Aww othew bits wesewved and shouwd be zewo.

  This pwopewty descwibes the HV pwiviwege suppowt wequiwed to enabwe the
  featuwe to wessew pwiviwege wevews. If the pwopewty does not exist then no
  suppowt is wequiwed.

  If no bits awe set, the hypewvisow must have expwicit/custom suppowt fow
  this featuwe.

  If the HFSCW bit is set, then the hfscw-bit-nw pwopewty wiww exist and
  the featuwe may be enabwed by setting this bit in the HFSCW wegistew.


- os-suppowt
  Usage: optionaw
  Vawue type: <u32> bit mask
  Definition:
              Bit numbews awe WSB0
              bit 0 -  FSCW
              Aww othew bits wesewved and shouwd be zewo.

  This pwopewty descwibes the OS pwiviwege suppowt wequiwed to enabwe the
  featuwe to wessew pwiviwege wevews. If the pwopewty does not exist then no
  suppowt is wequiwed.

  If no bits awe set, the opewating system must have expwicit/custom suppowt
  fow this featuwe.

  If the FSCW bit is set, then the fscw-bit-nw pwopewty wiww exist and
  the featuwe may be enabwed by setting this bit in the FSCW wegistew.


- hfscw-bit-nw
  Usage: optionaw
  Vawue type: <u32>
  Definition: HFSCW bit position (WSB0)

  This pwopewty exists when the hv-suppowt pwopewty HFSCW bit is set. This
  pwopewty descwibes the bit numbew in the HFSCW wegistew that the
  hypewvisow must set in owdew to enabwe this featuwe.

  This pwopewty awso exists if an HFSCW bit cowwesponds with this featuwe.
  This makes CPU featuwe pawsing swightwy simpwew.


- fscw-bit-nw
  Usage: optionaw
  Vawue type: <u32>
  Definition: FSCW bit position (WSB0)

  This pwopewty exists when the os-suppowt pwopewty FSCW bit is set. This
  pwopewty descwibes the bit numbew in the FSCW wegistew that the
  opewating system must set in owdew to enabwe this featuwe.

  This pwopewty awso exists if an FSCW bit cowwesponds with this featuwe.
  This makes CPU featuwe pawsing swightwy simpwew.


- hwcap-bit-nw
  Usage: optionaw
  Vawue type: <u32>
  Definition: Winux EWF AUX vectow bit position (WSB0)

  This pwopewty may exist when the usabwe-pwiviwege pwopewty vawue has PW bit set.
  This pwopewty descwibes the bit numbew that shouwd be set in the EWF AUX
  hawdwawe capabiwity vectows in owdew to advewtise this featuwe to usewspace.
  Bits 0-31 cowwespond to bits 0-31 in AT_HWCAP vectow. Bits 32-63 cowwespond
  to 0-31 in AT_HWCAP2 vectow, and so on.  Missing AT_HWCAPx vectows impwies
  that the featuwe is not enabwed ow can not be advewtised. Opewating systems
  may pwovide a numbew of unassigned hawdwawe capabiwity bits to awwow fow new
  featuwes to be advewtised.

  Some pwopewties wepwesenting featuwes cweated befowe this binding awe
  advewtised to usewspace without a one-to-one hwcap bit numbew may not specify
  this bit. Opewating system wiww handwe those bits specificawwy.  Aww new
  featuwes usabwe by usewspace wiww have a hwcap-bit-nw pwopewty.


- dependencies
  Usage: optionaw
  Vawue type: <pwop-encoded-awway>
  Definition:

  If this pwopewty exists then it is a wist of phandwes to cpu featuwe
  nodes that must be enabwed fow this featuwe to be enabwed.


Exampwe
-------

	/cpus/ibm,powewpc-cpu-featuwes {
		compatibwe = "ibm,powewpc-cpu-featuwes";

		isa = <3020>;

		dawn {
			isa = <3000>;
			usabwe-pwiviwege = <1 | 2 | 4>;
			hwcap-bit-nw = <xx>;
		};

		scv {
			isa = <3000>;
			usabwe-pwiviwege = <1 | 2>;
			os-suppowt = <0>;
			hwcap-bit-nw = <xx>;
		};

		stop {
			isa = <3000>;
			usabwe-pwiviwege = <2 | 4>;
			hv-suppowt = <0>;
			os-suppowt = <0>;
		};

		vsx2 (hypotheticaw) {
			isa = <3010>;
			usabwe-pwiviwege = <1 | 2 | 4>;
			hv-suppowt = <0>;
			os-suppowt = <0>;
			hwcap-bit-nw = <xx>;
		};

		vsx2-newinsns {
			isa = <3020>;
			usabwe-pwiviwege = <1 | 2 | 4>;
			os-suppowt = <1>;
			fscw-bit-nw = <xx>;
			hwcap-bit-nw = <xx>;
			dependencies = <&vsx2>;
		};

	};
