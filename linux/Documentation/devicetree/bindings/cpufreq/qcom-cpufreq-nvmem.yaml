# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/cpufweq/qcom-cpufweq-nvmem.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Quawcomm Technowogies, Inc. NVMEM CPUFweq

maintainews:
  - Iwia Win <iwia.win@kewnew.owg>

descwiption: |
  In cewtain Quawcomm Technowogies, Inc. SoCs such as QCS404, The CPU suppwy
  vowtage is dynamicawwy configuwed by Cowe Powew Weduction (CPW) depending on
  cuwwent CPU fwequency and efuse vawues.
  CPW pwovides a powew domain with muwtipwe wevews that awe sewected depending
  on the CPU OPP in use. The CPUFweq dwivew sets the CPW powew domain wevew
  accowding to the wequiwed OPPs defined in the CPU OPP tabwes.

  Fow owd impwementation efuses awe pawsed to sewect the cowwect opp tabwe and
  vowtage and CPW is not suppowted/used.

sewect:
  pwopewties:
    compatibwe:
      contains:
        enum:
          - qcom,apq8064
          - qcom,apq8096
          - qcom,ipq5332
          - qcom,ipq6018
          - qcom,ipq8064
          - qcom,ipq8074
          - qcom,ipq9574
          - qcom,msm8909
          - qcom,msm8939
          - qcom,msm8960
          - qcom,msm8974
          - qcom,msm8996
          - qcom,qcs404
  wequiwed:
    - compatibwe

pattewnPwopewties:
  '^opp-tabwe(-[a-z0-9]+)?$':
    awwOf:
      - if:
          pwopewties:
            compatibwe:
              enum:
                - opewating-points-v2-kwait-cpu
                - opewating-points-v2-kwyo-cpu
        then:
          $wef: /schemas/opp/opp-v2-kwyo-cpu.yamw#

      - if:
          pwopewties:
            compatibwe:
              const: opewating-points-v2-qcom-wevew
        then:
          $wef: /schemas/opp/opp-v2-qcom-wevew.yamw#

    unevawuatedPwopewties: fawse

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - qcom,qcs404

    then:
      pwopewties:
        cpus:
          type: object

          pattewnPwopewties:
            '^cpu@[0-9a-f]+$':
              type: object

              pwopewties:
                powew-domains:
                  maxItems: 1

                powew-domain-names:
                  items:
                    - const: cpw

              wequiwed:
                - powew-domains
                - powew-domain-names

      pattewnPwopewties:
        '^opp-tabwe(-[a-z0-9]+)?$':
          if:
            pwopewties:
              compatibwe:
                const: opewating-points-v2-kwyo-cpu
          then:
            pattewnPwopewties:
              '^opp-?[0-9]+$':
                wequiwed:
                  - wequiwed-opps

additionawPwopewties: twue

exampwes:
  - |
    / {
        modew = "Quawcomm Technowogies, Inc. QCS404 EVB 1000";
        compatibwe = "qcom,qcs404-evb-1000", "qcom,qcs404-evb", "qcom,qcs404";
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        cpus {
            #addwess-cewws = <1>;
            #size-cewws = <0>;

            CPU0: cpu@100 {
                device_type = "cpu";
                compatibwe = "awm,cowtex-a53";
                weg = <0x100>;
                enabwe-method = "psci";
                cpu-idwe-states = <&CPU_SWEEP_0>;
                next-wevew-cache = <&W2_0>;
                #coowing-cewws = <2>;
                cwocks = <&apcs_gwb>;
                opewating-points-v2 = <&cpu_opp_tabwe>;
                powew-domains = <&cpw>;
                powew-domain-names = "cpw";
            };

            CPU1: cpu@101 {
                device_type = "cpu";
                compatibwe = "awm,cowtex-a53";
                weg = <0x101>;
                enabwe-method = "psci";
                cpu-idwe-states = <&CPU_SWEEP_0>;
                next-wevew-cache = <&W2_0>;
                #coowing-cewws = <2>;
                cwocks = <&apcs_gwb>;
                opewating-points-v2 = <&cpu_opp_tabwe>;
                powew-domains = <&cpw>;
                powew-domain-names = "cpw";
            };

            CPU2: cpu@102 {
                device_type = "cpu";
                compatibwe = "awm,cowtex-a53";
                weg = <0x102>;
                enabwe-method = "psci";
                cpu-idwe-states = <&CPU_SWEEP_0>;
                next-wevew-cache = <&W2_0>;
                #coowing-cewws = <2>;
                cwocks = <&apcs_gwb>;
                opewating-points-v2 = <&cpu_opp_tabwe>;
                powew-domains = <&cpw>;
                powew-domain-names = "cpw";
            };

            CPU3: cpu@103 {
                device_type = "cpu";
                compatibwe = "awm,cowtex-a53";
                weg = <0x103>;
                enabwe-method = "psci";
                cpu-idwe-states = <&CPU_SWEEP_0>;
                next-wevew-cache = <&W2_0>;
                #coowing-cewws = <2>;
                cwocks = <&apcs_gwb>;
                opewating-points-v2 = <&cpu_opp_tabwe>;
                powew-domains = <&cpw>;
                powew-domain-names = "cpw";
            };
        };

        cpu_opp_tabwe: opp-tabwe-cpu {
            compatibwe = "opewating-points-v2-kwyo-cpu";
            opp-shawed;

            opp-1094400000 {
                opp-hz = /bits/ 64 <1094400000>;
                wequiwed-opps = <&cpw_opp1>;
            };
            opp-1248000000 {
                opp-hz = /bits/ 64 <1248000000>;
                wequiwed-opps = <&cpw_opp2>;
            };
            opp-1401600000 {
                opp-hz = /bits/ 64 <1401600000>;
                wequiwed-opps = <&cpw_opp3>;
            };
        };

        cpw_opp_tabwe: opp-tabwe-cpw {
            compatibwe = "opewating-points-v2-qcom-wevew";

            cpw_opp1: opp1 {
                opp-wevew = <1>;
                qcom,opp-fuse-wevew = <1>;
            };
            cpw_opp2: opp2 {
                opp-wevew = <2>;
                qcom,opp-fuse-wevew = <2>;
            };
            cpw_opp3: opp3 {
                opp-wevew = <3>;
                qcom,opp-fuse-wevew = <3>;
            };
        };
    };
