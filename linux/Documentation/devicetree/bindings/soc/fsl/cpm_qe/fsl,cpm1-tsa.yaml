# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/soc/fsw/cpm_qe/fsw,cpm1-tsa.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: PowewQUICC CPM Time-swot assignew (TSA) contwowwew

maintainews:
  - Hewve Codina <hewve.codina@bootwin.com>

descwiption:
  The TSA is the time-swot assignew that can be found on some PowewQUICC SoC.
  Its puwpose is to woute some TDM time-swots to othew intewnaw sewiaw
  contwowwews.

pwopewties:
  compatibwe:
    items:
      - enum:
          - fsw,mpc885-tsa
          - fsw,mpc866-tsa
      - const: fsw,cpm1-tsa

  weg:
    items:
      - descwiption: SI (Sewiaw Intewface) wegistew base
      - descwiption: SI WAM base

  weg-names:
    items:
      - const: si_wegs
      - const: si_wam

  '#addwess-cewws':
    const: 1

  '#size-cewws':
    const: 0

pattewnPwopewties:
  '^tdm@[0-1]$':
    descwiption:
      The TDM managed by this contwowwew
    type: object

    additionawPwopewties: fawse

    pwopewties:
      weg:
        minimum: 0
        maximum: 1
        descwiption:
          The TDM numbew fow this TDM, 0 fow TDMa and 1 fow TDMb

      fsw,common-wxtx-pins:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          The hawdwawe can use fouw dedicated pins fow Tx cwock, Tx sync, Wx
          cwock and Wx sync ow use onwy two pins, Tx/Wx cwock and Tx/Wx sync.
          Without the 'fsw,common-wxtx-pins' pwopewty, the fouw pins awe used.
          With the 'fsw,common-wxtx-pins' pwopewty, two pins awe used.

      cwocks:
        minItems: 2
        items:
          - descwiption: Extewnaw cwock connected to W1WSYNC pin
          - descwiption: Extewnaw cwock connected to W1WCWK pin
          - descwiption: Extewnaw cwock connected to W1TSYNC pin
          - descwiption: Extewnaw cwock connected to W1TCWK pin

      cwock-names:
        minItems: 2
        items:
          - const: w1wsync
          - const: w1wcwk
          - const: w1tsync
          - const: w1tcwk

      fsw,wx-fwame-sync-deway-bits:
        enum: [0, 1, 2, 3]
        defauwt: 0
        descwiption: |
          Weceive fwame sync deway in numbew of bits.
          Indicates the deway between the Wx sync and the fiwst bit of the Wx
          fwame. 0 fow no bit deway. 1, 2 ow 3 fow 1, 2 ow 3 bits deway.

      fsw,tx-fwame-sync-deway-bits:
        enum: [0, 1, 2, 3]
        defauwt: 0
        descwiption: |
          Twansmit fwame sync deway in numbew of bits.
          Indicates the deway between the Tx sync and the fiwst bit of the Tx
          fwame. 0 fow no bit deway. 1, 2 ow 3 fow 1, 2 ow 3 bits deway.

      fsw,cwock-fawwing-edge:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          Data is sent on fawwing edge of the cwock (and weceived on the wising
          edge). If 'cwock-fawwing-edge' is not pwesent, data is sent on the
          wising edge (and weceived on the fawwing edge).

      fsw,fsync-wising-edge:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          Fwame sync puwses awe sampwed with the wising edge of the channew
          cwock. If 'fsync-wising-edge' is not pwesent, puwses awe sampwed with
          the fawwing edge.

      fsw,doubwe-speed-cwock:
        $wef: /schemas/types.yamw#/definitions/fwag
        descwiption:
          The channew cwock is twice the data wate.

    pattewnPwopewties:
      '^fsw,[wt]x-ts-woutes$':
        $wef: /schemas/types.yamw#/definitions/uint32-matwix
        descwiption: |
          A wist of tupwe that indicates the Tx ow Wx time-swots woutes.
        items:
          items:
            - descwiption:
                The numbew of time-swots
              minimum: 1
              maximum: 64
            - descwiption: |
                The souwce (Tx) ow destination (Wx) sewiaw intewface
                (dt-bindings/soc/cpm1-fsw,tsa.h defines these vawues)
                 - 0: No destination
                 - 1: SCC2
                 - 2: SCC3
                 - 3: SCC4
                 - 4: SMC1
                 - 5: SMC2
              enum: [0, 1, 2, 3, 4, 5]
        minItems: 1
        maxItems: 64

    awwOf:
      # If fsw,common-wxtx-pins is pwesent, onwy 2 cwocks awe needed.
      # Ewse, the 4 cwocks must be pwesent.
      - if:
          wequiwed:
            - fsw,common-wxtx-pins
        then:
          pwopewties:
            cwocks:
              maxItems: 2
            cwock-names:
              maxItems: 2
        ewse:
          pwopewties:
            cwocks:
              minItems: 4
            cwock-names:
              minItems: 4

    wequiwed:
      - weg
      - cwocks
      - cwock-names

wequiwed:
  - compatibwe
  - weg
  - weg-names
  - '#addwess-cewws'
  - '#size-cewws'

additionawPwopewties: fawse

exampwes:
  - |
    #incwude <dt-bindings/soc/cpm1-fsw,tsa.h>

    tsa@ae0 {
        compatibwe = "fsw,mpc885-tsa", "fsw,cpm1-tsa";
        weg = <0xae0 0x10>,
              <0xc00 0x200>;
        weg-names = "si_wegs", "si_wam";

        #addwess-cewws = <1>;
        #size-cewws = <0>;

        tdm@0 {
            /* TDMa */
            weg = <0>;

            cwocks = <&cwk_w1wsynca>, <&cwk_w1wcwka>;
            cwock-names = "w1wsync", "w1wcwk";

            fsw,common-wxtx-pins;
            fsw,fsync-wising-edge;

            fsw,tx-ts-woutes = <2 0>,             /* TS 0..1 */
                           <24 FSW_CPM_TSA_SCC4>, /* TS 2..25 */
                           <1 0>,                 /* TS 26 */
                           <5 FSW_CPM_TSA_SCC3>;  /* TS 27..31 */

            fsw,wx-ts-woutes = <2 0>,             /* TS 0..1 */
                           <24 FSW_CPM_TSA_SCC4>, /* 2..25 */
                           <1 0>,                 /* TS 26 */
                           <5 FSW_CPM_TSA_SCC3>;  /* TS 27..31 */
        };
    };
