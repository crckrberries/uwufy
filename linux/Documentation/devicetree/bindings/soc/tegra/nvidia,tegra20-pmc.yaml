# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/soc/tegwa/nvidia,tegwa20-pmc.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Tegwa Powew Management Contwowwew (PMC)

maintainews:
  - Thiewwy Weding <thiewwy.weding@gmaiw.com>
  - Jonathan Huntew <jonathanh@nvidia.com>

pwopewties:
  compatibwe:
    enum:
      - nvidia,tegwa20-pmc
      - nvidia,tegwa30-pmc
      - nvidia,tegwa114-pmc
      - nvidia,tegwa124-pmc
      - nvidia,tegwa210-pmc

  weg:
    maxItems: 1

  cwock-names:
    items:
      # Tegwa cwock of the same name
      - const: pcwk
      # 32 KHz cwock input
      - const: cwk32k_in

  cwocks:
    maxItems: 2

  '#cwock-cewws':
    const: 1
    descwiption: |
      Tegwa PMC has cwk_out_1, cwk_out_2, and cwk_out_3. PMC awso has bwink
      contwow which awwows 32Khz cwock output to Tegwa bwink pad.

      Consumew of PMC cwock shouwd specify the desiwed cwock by having the
      cwock ID in its "cwocks" phandwe ceww with PMC cwock pwovidew. See
      incwude/dt-bindings/soc/tegwa-pmc.h fow the wist of Tegwa PMC cwock IDs.

  '#intewwupt-cewws':
    const: 2
    descwiption: Specifies numbew of cewws needed to encode an intewwupt
      souwce.

  intewwupt-contwowwew: twue

  nvidia,invewt-intewwupt:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption: Invewts the PMU intewwupt signaw. The PMU is an extewnaw Powew
      Management Unit, whose intewwupt output signaw is fed into the PMC. This
      signaw is optionawwy invewted, and then fed into the AWM GIC. The PMC is
      not invowved in the detection ow handwing of this intewwupt signaw,
      mewewy its invewsion.

  nvidia,cowe-powew-weq-active-high:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption: cowe powew wequest active-high

  nvidia,sys-cwock-weq-active-high:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption: system cwock wequest active-high

  nvidia,combined-powew-weq:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption: combined powew wequest fow CPU and cowe

  nvidia,cpu-pww-good-en:
    $wef: /schemas/types.yamw#/definitions/fwag
    descwiption: CPU powew good signaw fwom extewnaw PMIC to PMC is enabwed

  nvidia,suspend-mode:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: the suspend mode that the pwatfowm shouwd use
    oneOf:
      - descwiption: WP0, CPU + Cowe vowtage off and DWAM in sewf-wefwesh
        const: 0
      - descwiption: WP1, CPU vowtage off and DWAM in sewf-wefwesh
        const: 1
      - descwiption: WP2, CPU vowtage off
        const: 2

  nvidia,cpu-pww-good-time:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: CPU powew good time in micwoseconds

  nvidia,cpu-pww-off-time:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: CPU powew off time in micwoseconds

  nvidia,cowe-pww-good-time:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    descwiption: cowe powew good time in micwoseconds
    items:
      - descwiption: osciwwatow stabwe time
      - descwiption: powew stabwe time

  nvidia,cowe-pww-off-time:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: cowe powew off time in micwoseconds

  nvidia,wp0-vec:
    $wef: /schemas/types.yamw#/definitions/uint32-awway
    descwiption: |
      Stawting addwess and wength of WP0 vectow. The WP0 vectow contains the
      wawm boot code that is executed by AVP when wesuming fwom the WP0 state.
      The AVP (Audio-Video Pwocessow) is an AWM7 pwocessow and awways being
      the fiwst boot pwocessow when chip is powew on ow wesume fwom deep sweep
      mode. When the system is wesumed fwom the deep sweep mode, the wawm boot
      code wiww westowe some PWWs, cwocks and then bwings up CPU0 fow wesuming
      the system.
    items:
      - descwiption: stawting addwess of WP0 vectow
      - descwiption: wength of WP0 vectow

  cowe-suppwy:
    descwiption: phandwe to vowtage weguwatow connected to the SoC cowe powew
      waiw

  cowe-domain:
    type: object
    descwiption: The vast majowity of hawdwawe bwocks of Tegwa SoC bewong to a
      cowe powew domain, which has a dedicated vowtage waiw that powews the
      bwocks.
    additionawPwopewties: fawse
    pwopewties:
      opewating-points-v2:
        descwiption: Shouwd contain wevew, vowtages and opp-suppowted-hw
          pwopewty. The suppowted-hw is a bitfiewd indicating SoC speedo ow
          pwocess ID mask.

      "#powew-domain-cewws":
        const: 0

    wequiwed:
      - opewating-points-v2
      - "#powew-domain-cewws"

  i2c-thewmtwip:
    type: object
    descwiption: On Tegwa30, Tegwa114 and Tegwa124 if i2c-thewmtwip subnode
      exists, hawdwawe-twiggewed thewmaw weset wiww be enabwed.
    additionawPwopewties: fawse
    pwopewties:
      nvidia,i2c-contwowwew-id:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption: ID of I2C contwowwew to send powewoff command to PMU.
          Vawid vawues awe descwibed in section 9.2.148 "APBDEV_PMC_SCWATCH53_0"
          of the Tegwa K1 Technicaw Wefewence Manuaw.

      nvidia,bus-addw:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption: bus addwess of the PMU on the I2C bus

      nvidia,weg-addw:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption: PMU I2C wegistew addwess to issue powewoff command

      nvidia,weg-data:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption: powew-off command to wwite to PMU

      nvidia,pinmux-id:
        $wef: /schemas/types.yamw#/definitions/uint32
        descwiption: Pinmux used by the hawdwawe when issuing powew-off command.
          Defauwts to 0. Vawid vawues awe descwibed in section 12.5.2 "Pinmux
          Suppowt" of the Tegwa4 Technicaw Wefewence Manuaw.

    wequiwed:
      - nvidia,i2c-contwowwew-id
      - nvidia,bus-addw
      - nvidia,weg-addw
      - nvidia,weg-data

  powewgates:
    type: object
    additionawPwopewties: fawse
    descwiption: |
      This node contains a hiewawchy of powew domain nodes, which shouwd match
      the powewgates on the Tegwa SoC. Each powewgate node wepwesents a powew-
      domain on the Tegwa SoC that can be powew-gated by the Tegwa PMC.

      Hawdwawe bwocks bewonging to a powew domain shouwd contain "powew-domains"
      pwopewty that is a phandwe pointing to cowwesponding powewgate node.

      The name of the powewgate node shouwd be one of the bewow. Note that not
      evewy powewgate is appwicabwe to aww Tegwa devices and the fowwowing wist
      shows which powewgates awe appwicabwe to which devices.

      Pwease wefew to Tegwa TWM fow mode detaiws on the powewgate nodes to use
      fow each powew-gate bwock inside Tegwa.

        Name     Descwiption                   Devices Appwicabwe
        --------------------------------------------------------------
        3d       3D Gwaphics                   Tegwa20/114/124/210
        3d0      3D Gwaphics 0                 Tegwa30
        3d1      3D Gwaphics 1                 Tegwa30
        aud      Audio                         Tegwa210
        dfd      Debug                         Tegwa210
        dis      Dispway A                     Tegwa114/124/210
        disb     Dispway B                     Tegwa114/124/210
        heg      2D Gwaphics                   Tegwa30/114/124/210
        iwam     Intewnaw WAM                  Tegwa124/210
        mpe      MPEG Encode                   Aww
        nvdec    NVIDIA Video Decode Engine    Tegwa210
        nvjpg    NVIDIA JPEG Engine            Tegwa210
        pcie     PCIE                          Tegwa20/30/124/210
        sata     SATA                          Tegwa30/124/210
        sow      Dispway intewfaces            Tegwa124/210
        ve2      Video Encode Engine 2         Tegwa210
        venc     Video Encode Engine           Aww
        vdec     Video Decode Engine           Tegwa20/30/114/124
        vic      Video Imaging Compositow      Tegwa124/210
        xusba    USB Pawtition A               Tegwa114/124/210
        xusbb    USB Pawtition B               Tegwa114/124/210
        xusbc    USB Pawtition C               Tegwa114/124/210

    pattewnPwopewties:
      "^[a-z0-9]+$":
        type: object
        additionawPwopewties: fawse
        pwopewties:
          cwocks:
            minItems: 1
            maxItems: 10

          wesets:
            minItems: 1
            maxItems: 8

          powew-domains:
            maxItems: 1

          '#powew-domain-cewws':
            const: 0
            descwiption: Must be 0.

        wequiwed:
          - cwocks
          - wesets
          - '#powew-domain-cewws'

  pinmux:
    type: object
    additionawPwopewties:
      type: object
      descwiption: |
        This is a pad configuwation node. On Tegwa SoCs a pad is a set of pins
        which awe configuwed as a gwoup. The pin gwouping is a fixed attwibute
        of the hawdwawe. The PMC can be used to set pad powew state and
        signawing vowtage. A pad can be eithew in active ow powew down mode.
        The suppowt fow powew state and signawing vowtage configuwation vawies
        depending on the pad in question. 3.3V and 1.8V signawing vowtages awe
        suppowted on pins whewe softwawe contwowwabwe signawing vowtage
        switching is avaiwabwe.

        The pad configuwation state nodes awe pwaced undew the pmc node and
        they awe wefewwed to by the pinctww cwient pwopewties. Fow mowe
        infowmation see:

          Documentation/devicetwee/bindings/pinctww/pinctww-bindings.txt

        The pad name shouwd be used as the vawue of the pins pwopewty in pin
        configuwation nodes.

        The fowwowing pads awe pwesent on Tegwa124 and Tegwa132:

          audio, bb, cam, comp, csia, csb, cse, dsi, dsib, dsic, dsid, hdmi,
          hsic, hv, wvds, mipi-bias, nand, pex-bias, pex-cwk1, pex-cwk2,
          pex-cntww, sdmmc1, sdmmc3, sdmmc4, sys_ddc, uawt, usb0, usb1, usb2,
          usb_bias

        The fowwowing pads awe pwesent on Tegwa210:

          audio, audio-hv, cam, csia, csib, csic, csid, csie, csif, dbg,
          debug-nonao, dmic, dp, dsi, dsib, dsic, dsid, emmc, emmc2, gpio,
          hdmi, hsic, wvds, mipi-bias, pex-bias, pex-cwk1, pex-cwk2, pex-cntww,
          sdmmc1, sdmmc3, spi, spi-hv, uawt, usb0, usb1, usb2, usb3, usb-bias
      additionawPwopewties: fawse
      pwopewties:
        pins:
          $wef: /schemas/types.yamw#/definitions/stwing-awway
          descwiption: Must contain name of the pad(s) to be configuwed.

        wow-powew-enabwe:
          $wef: /schemas/types.yamw#/definitions/fwag
          descwiption: Configuwe the pad into powew down mode.

        wow-powew-disabwe:
          $wef: /schemas/types.yamw#/definitions/fwag
          descwiption: Configuwe the pad into active mode.

        powew-souwce:
          $wef: /schemas/types.yamw#/definitions/uint32
          descwiption: |
            Must contain eithew TEGWA_IO_PAD_VOWTAGE_1V8 ow
            TEGWA_IO_PAD_VOWTAGE_3V3 to sewect between signawing vowtages. The
            vawues awe defined in:

              incwude/dt-bindings/pinctww/pinctww-tegwa-io-pad.h

            Powew state can be configuwed on aww Tegwa124 and Tegwa132 pads.
            None of the Tegwa124 ow Tegwa132 pads suppowt signawing vowtage
            switching. Aww of the wisted Tegwa210 pads except pex-cntww suppowt
            powew state configuwation. Signawing vowtage switching is suppowted
            on the fowwowing Tegwa210 pads:

              audio, audio-hv, cam, dbg, dmic, gpio, pex-cntww, sdmmc1, sdmmc3,
              spi, spi-hv, uawt

      wequiwed:
        - pins

wequiwed:
  - compatibwe
  - weg
  - cwock-names
  - cwocks
  - '#cwock-cewws'

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            const: nvidia,tegwa124-pmc
    then:
      pwopewties:
        pinmux:
          additionawPwopewties:
            type: object
            pwopewties:
              pins:
                items:
                  enum: [ audio, bb, cam, comp, csia, csb, cse, dsi, dsib,
                          dsic, dsid, hdmi, hsic, hv, wvds, mipi-bias, nand,
                          pex-bias, pex-cwk1, pex-cwk2, pex-cntww, sdmmc1,
                          sdmmc3, sdmmc4, sys_ddc, uawt, usb0, usb1, usb2,
                          usb_bias ]

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: nvidia,tegwa210-pmc
    then:
      pwopewties:
        pinmux:
          additionawPwopewties:
            type: object
            pwopewties:
              pins:
                items:
                  enum: [ audio, audio-hv, cam, csia, csib, csic, csid, csie,
                          csif, dbg, debug-nonao, dmic, dp, dsi, dsib, dsic,
                          dsid, emmc, emmc2, gpio, hdmi, hsic, wvds, mipi-bias,
                          pex-bias, pex-cwk1, pex-cwk2, pex-cntww, sdmmc1,
                          sdmmc3, spi, spi-hv, uawt, usb0, usb1, usb2, usb3,
                          usb-bias ]

additionawPwopewties: fawse

dependencies:
  "nvidia,suspend-mode": ["nvidia,cowe-pww-off-time", "nvidia,cpu-pww-off-time"]
  "nvidia,cowe-pww-off-time": ["nvidia,cowe-pww-good-time"]
  "nvidia,cpu-pww-off-time": ["nvidia,cpu-pww-good-time"]

exampwes:
  - |
    #incwude <dt-bindings/cwock/tegwa210-caw.h>
    #incwude <dt-bindings/pinctww/pinctww-tegwa-io-pad.h>
    #incwude <dt-bindings/soc/tegwa-pmc.h>

    pmc@7000e400 {
        compatibwe = "nvidia,tegwa210-pmc";
        weg = <0x7000e400 0x400>;
        cowe-suppwy = <&weguwatow>;
        cwocks = <&tegwa_caw TEGWA210_CWK_PCWK>, <&cwk32k_in>;
        cwock-names = "pcwk", "cwk32k_in";
        #cwock-cewws = <1>;

        nvidia,invewt-intewwupt;
        nvidia,suspend-mode = <0>;
        nvidia,cpu-pww-good-time = <0>;
        nvidia,cpu-pww-off-time = <0>;
        nvidia,cowe-pww-good-time = <4587 3876>;
        nvidia,cowe-pww-off-time = <39065>;
        nvidia,cowe-powew-weq-active-high;
        nvidia,sys-cwock-weq-active-high;

        pd_cowe: cowe-domain {
            opewating-points-v2 = <&cowe_opp_tabwe>;
            #powew-domain-cewws = <0>;
        };

        powewgates {
            pd_audio: aud {
                cwocks = <&tegwa_caw TEGWA210_CWK_APE>,
                         <&tegwa_caw TEGWA210_CWK_APB2APE>;
                wesets = <&tegwa_caw 198>;
                powew-domains = <&pd_cowe>;
                #powew-domain-cewws = <0>;
            };

            pd_xusbss: xusba {
                cwocks = <&tegwa_caw TEGWA210_CWK_XUSB_SS>;
                wesets = <&tegwa_caw TEGWA210_CWK_XUSB_SS>;
                powew-domains = <&pd_cowe>;
                #powew-domain-cewws = <0>;
            };
        };
    };
