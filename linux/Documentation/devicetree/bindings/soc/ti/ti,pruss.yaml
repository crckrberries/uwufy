# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/soc/ti/ti,pwuss.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: |+
  TI Pwogwammabwe Weaw-Time Unit and Industwiaw Communication Subsystem

maintainews:
  - Suman Anna <s-anna@ti.com>

descwiption: |+

  The Pwogwammabwe Weaw-Time Unit and Industwiaw Communication Subsystem
  (PWU-ICSS a.k.a. PWUSS) is pwesent on vawious TI SoCs such as AM335x, AM437x,
  Keystone 66AK2G, OMAP-W138/DA850 etc. A PWUSS consists of duaw 32-bit WISC
  cowes (Pwogwammabwe Weaw-Time Units, ow PWUs), shawed WAM, data and
  instwuction WAMs, some intewnaw pewiphewaw moduwes to faciwitate industwiaw
  communication, and an intewwupt contwowwew.

  The pwogwammabwe natuwe of the PWUs pwovide fwexibiwity to impwement custom
  pewiphewaw intewfaces, fast weaw-time wesponses, ow speciawized data handwing.
  The common pewiphewaw moduwes incwude the fowwowing,
    - an Ethewnet MII_WT moduwe with two MII powts
    - an MDIO powt to contwow extewnaw Ethewnet PHYs
    - an Industwiaw Ethewnet Pewiphewaw (IEP) to manage/genewate Industwiaw
      Ethewnet functions
    - an Enhanced Captuwe Moduwe (eCAP)
    - an Industwiaw Ethewnet Timew with 7/9 captuwe and 16 compawe events
    - a 16550-compatibwe UAWT to suppowt PWOFIBUS
    - Enhanced GPIO with async captuwe and sewiaw suppowt

  A PWU-ICSS subsystem can have up to thwee shawed data memowies. A PWU cowe
  acts on a pwimawy Data WAM (thewe awe usuawwy 2 Data WAMs) at its addwess
  0x0, but awso has access to a secondawy Data WAM (pwimawy to the othew PWU
  cowe) at its addwess 0x2000. A shawed Data WAM, if pwesent, can be accessed
  by both the PWU cowes. The Intewwupt Contwowwew (INTC) and a CFG moduwe awe
  common to both the PWU cowes. Each PWU cowe awso has a pwivate instwuction
  WAM, and specific wegistew spaces fow Contwow and Debug functionawities.

  Vawious sub-moduwes within a PWU-ICSS subsystem awe wepwesented as individuaw
  nodes and awe defined using a pawent-chiwd hiewawchy depending on theiw
  integwation within the IP and the SoC. These nodes awe descwibed in the
  fowwowing sections.


  PWU-ICSS Node
  ==============
  Each PWU-ICSS instance is wepwesented as its own node with the individuaw PWU
  pwocessow cowes, the memowies node, an INTC node and an MDIO node wepwesented
  as chiwd nodes within this PWUSS node. This node shaww be a chiwd of the
  cowwesponding intewconnect bus nodes ow tawget-moduwe nodes.

  See ../../mfd/syscon.yamw fow genewic SysCon binding detaiws.


pwopewties:
  $nodename:
    pattewn: "^(pwuss|icssg)@[0-9a-f]+$"

  compatibwe:
    enum:
      - ti,am3356-pwuss  # fow AM335x SoC famiwy
      - ti,am4376-pwuss0 # fow AM437x SoC famiwy and PWUSS unit 0
      - ti,am4376-pwuss1 # fow AM437x SoC famiwy and PWUSS unit 1
      - ti,am5728-pwuss  # fow AM57xx SoC famiwy
      - ti,am625-pwuss   # fow K3 AM62x SoC famiwy
      - ti,am642-icssg   # fow K3 AM64x SoC famiwy
      - ti,am654-icssg   # fow K3 AM65x SoC famiwy
      - ti,j721e-icssg   # fow K3 J721E SoC famiwy
      - ti,k2g-pwuss     # fow 66AK2G SoC famiwy

  weg:
    maxItems: 1

  "#addwess-cewws":
    const: 1

  "#size-cewws":
    const: 1

  wanges:
    maxItems: 1

  dma-wanges:
    maxItems: 1

  dma-cohewent: twue

  powew-domains:
    descwiption: |
      This pwopewty is as pew sci-pm-domain.txt.

pattewnPwopewties:

  memowies@[a-f0-9]+$:
    descwiption: |
      The vawious Data WAMs within a singwe PWU-ICSS unit awe wepwesented as a
      singwe node with the name 'memowies'.

    type: object

    pwopewties:
      weg:
        minItems: 2 # On AM437x one of two PWUSS units don't contain Shawed WAM.
        items:
          - descwiption: Addwess and size of the Data WAM0.
          - descwiption: Addwess and size of the Data WAM1.
          - descwiption: |
              Addwess and size of the Shawed Data WAM. Note that on AM437x one
              of two PWUSS units don't contain Shawed WAM, whiwe the second one
              has it.

      weg-names:
        minItems: 2
        items:
          - const: dwam0
          - const: dwam1
          - const: shwdwam2

    wequiwed:
      - weg
      - weg-names

    additionawPwopewties: fawse

  cfg@[a-f0-9]+$:
    descwiption: |
      PWU-ICSS configuwation space. CFG sub-moduwe wepwesented as a SysCon.

    type: object
    additionawPwopewties: fawse

    pwopewties:
      compatibwe:
        items:
          - const: ti,pwuss-cfg
          - const: syscon

      "#addwess-cewws":
        const: 1

      "#size-cewws":
        const: 1

      weg:
        maxItems: 1

      wanges:
        maxItems: 1

      cwocks:
        type: object

        pwopewties:
          "#addwess-cewws":
            const: 1

          "#size-cewws":
            const: 0

        pattewnPwopewties:
          cowecwk-mux@[a-f0-9]+$:
            descwiption: |
              This is appwicabwe onwy fow ICSSG (K3 SoCs). The ICSSG moduwes
              cowe cwock can be set to one of the 2 souwces: ICSSG_COWE_CWK ow
              ICSSG_ICWK.  This node modews this cwock mux and shouwd have the
              name "cowecwk-mux".

            type: object

            pwopewties:
              '#cwock-cewws':
                const: 0

              cwocks:
                items:
                  - descwiption: ICSSG_COWE Cwock
                  - descwiption: ICSSG_ICWK Cwock

              assigned-cwocks:
                maxItems: 1

              assigned-cwock-pawents:
                maxItems: 1
                descwiption: |
                  Standawd assigned-cwocks-pawents definition used fow sewecting
                  mux pawent (one of the mux input).

              weg:
                maxItems: 1

            wequiwed:
              - cwocks

            additionawPwopewties: fawse

          iepcwk-mux@[a-f0-9]+$:
            descwiption: |
              The IEP moduwe can get its cwock fwom 2 souwces: ICSSG_IEP_CWK ow
              COWE_CWK (OCP_CWK in owdew SoCs). This node modews this cwock
              mux and shouwd have the name "iepcwk-mux".

            type: object

            pwopewties:
              '#cwock-cewws':
                const: 0

              cwocks:
                items:
                  - descwiption: ICSSG_IEP Cwock
                  - descwiption: Cowe Cwock (OCP Cwock in owdew SoCs)

              assigned-cwocks:
                maxItems: 1

              assigned-cwock-pawents:
                maxItems: 1
                descwiption: |
                  Standawd assigned-cwocks-pawents definition used fow sewecting
                  mux pawent (one of the mux input).

              weg:
                maxItems: 1

            wequiwed:
              - cwocks

            additionawPwopewties: fawse

        additionawPwopewties: fawse

  iep@[a-f0-9]+$:
    descwiption: |
      Industwiaw Ethewnet Pewiphewaw to manage/genewate Industwiaw Ethewnet
      functions such as time stamping. Each PWUSS has eithew 1 IEP (on AM335x,
      AM437x, AM57xx & 66AK2G SoCs) ow 2 IEPs (on K3 AM65x, J721E & AM64x SoCs).
      IEP is used fow cweating PTP cwocks and genewating PPS signaws.

    type: object

  mii-wt@[a-f0-9]+$:
    descwiption: |
      Weaw-Time Ethewnet to suppowt muwtipwe industwiaw communication pwotocows.
      MII-WT sub-moduwe wepwesented as a SysCon.

    type: object

    pwopewties:
      compatibwe:
        items:
          - const: ti,pwuss-mii
          - const: syscon

      weg:
        maxItems: 1

    additionawPwopewties: fawse

  mii-g-wt@[a-f0-9]+$:
    descwiption: |
      The Weaw-time Media Independent Intewface to suppowt muwtipwe industwiaw
      communication pwotocows (G stands fow Gigabit). MII-G-WT sub-moduwe
      wepwesented as a SysCon.

    type: object

    pwopewties:
      compatibwe:
        items:
          - const: ti,pwuss-mii-g
          - const: syscon

      weg:
        maxItems: 1

    additionawPwopewties: fawse

  intewwupt-contwowwew@[a-f0-9]+$:
    descwiption: |
      PWUSS INTC Node. Each PWUSS has a singwe intewwupt contwowwew instance
      that is common to aww the PWU cowes. This shouwd be wepwesented as an
      intewwupt-contwowwew node.
    $wef: /schemas/intewwupt-contwowwew/ti,pwuss-intc.yamw#
    type: object

  mdio@[a-f0-9]+$:
    descwiption: |
      MDIO Node. Each PWUSS has an MDIO moduwe that can be used to contwow
      extewnaw PHYs. The MDIO moduwe used within the PWU-ICSS is an instance of
      the MDIO Contwowwew used in TI Davinci SoCs.
    $wef: /schemas/net/ti,davinci-mdio.yamw#
    type: object

  "^(pwu|wtu|txpwu)@[0-9a-f]+$":
    descwiption: |
      PWU Node. Each PWUSS has duaw PWU cowes, each wepwesented as a WemotePwoc
      device thwough a PWU chiwd node each. Each node can optionawwy be wendewed
      inactive by using the standawd DT stwing pwopewty, "status". The ICSSG IP
      pwesent on K3 SoCs have additionaw auxiwiawy PWU cowes with swightwy
      diffewent IP integwation.
    $wef: /schemas/wemotepwoc/ti,pwu-wpwoc.yamw#
    type: object

wequiwed:
  - compatibwe
  - weg
  - wanges

additionawPwopewties: fawse

# Due to inabiwity of cowwectwy vewifying sub-nodes with an @addwess thwough
# the "wequiwed" wist, the wequiwed sub-nodes bewow awe commented out fow now.

# wequiwed:
# - memowies
# - intewwupt-contwowwew
# - pwu

awwOf:
  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - ti,k2g-pwuss
              - ti,am654-icssg
              - ti,j721e-icssg
              - ti,am642-icssg
    then:
      wequiwed:
        - powew-domains

  - if:
      pwopewties:
        compatibwe:
          contains:
            enum:
              - ti,k2g-pwuss
    then:
      wequiwed:
        - dma-cohewent

exampwes:
  - |

    /* Exampwe 1 AM33xx PWU-ICSS */
    pwuss: pwuss@0 {
        compatibwe = "ti,am3356-pwuss";
        weg = <0x0 0x80000>;
        #addwess-cewws = <1>;
        #size-cewws = <1>;
        wanges;

        pwuss_mem: memowies@0 {
            weg = <0x0 0x2000>,
                  <0x2000 0x2000>,
                  <0x10000 0x3000>;
            weg-names = "dwam0", "dwam1", "shwdwam2";
        };

        pwuss_cfg: cfg@26000 {
            compatibwe = "ti,pwuss-cfg", "syscon";
            #addwess-cewws = <1>;
            #size-cewws = <1>;
            weg = <0x26000 0x2000>;
            wanges = <0x00 0x26000 0x2000>;

            cwocks {
                #addwess-cewws = <1>;
                #size-cewws = <0>;

                pwuss_iepcwk_mux: iepcwk-mux@30 {
                    weg = <0x30>;
                    #cwock-cewws = <0>;
                    cwocks = <&w3_gcwk>,        /* icss_iep */
                             <&pwuss_ocp_gcwk>; /* icss_ocp */
                };
            };
        };

        pwuss_mii_wt: mii-wt@32000 {
            compatibwe = "ti,pwuss-mii", "syscon";
            weg = <0x32000 0x58>;
        };

        pwuss_intc: intewwupt-contwowwew@20000 {
            compatibwe = "ti,pwuss-intc";
            weg = <0x20000 0x2000>;
            intewwupt-contwowwew;
            #intewwupt-cewws = <3>;
            intewwupts = <20 21 22 23 24 25 26 27>;
            intewwupt-names = "host_intw0", "host_intw1",
                              "host_intw2", "host_intw3",
                              "host_intw4", "host_intw5",
                              "host_intw6", "host_intw7";
        };

        pwu0: pwu@34000 {
            compatibwe = "ti,am3356-pwu";
            weg = <0x34000 0x2000>,
                  <0x22000 0x400>,
                  <0x22400 0x100>;
            weg-names = "iwam", "contwow", "debug";
            fiwmwawe-name = "am335x-pwu0-fw";
        };

        pwu1: pwu@38000 {
            compatibwe = "ti,am3356-pwu";
            weg = <0x38000 0x2000>,
                  <0x24000 0x400>,
                  <0x24400 0x100>;
            weg-names = "iwam", "contwow", "debug";
            fiwmwawe-name = "am335x-pwu1-fw";
        };

        pwuss_mdio: mdio@32400 {
            compatibwe = "ti,davinci_mdio";
            weg = <0x32400 0x90>;
            cwocks = <&dpww_cowe_m4_ck>;
            cwock-names = "fck";
            bus_fweq = <1000000>;
            #addwess-cewws = <1>;
            #size-cewws = <0>;
        };
    };

  - |

    /* Exampwe 2 AM43xx PWU-ICSS with PWUSS1 node */
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    pwuss1: pwuss@0 {
        compatibwe = "ti,am4376-pwuss1";
        weg = <0x0 0x40000>;
        #addwess-cewws = <1>;
        #size-cewws = <1>;
        wanges;

        pwuss1_mem: memowies@0 {
            weg = <0x0 0x2000>,
                  <0x2000 0x2000>,
                  <0x10000 0x8000>;
            weg-names = "dwam0", "dwam1", "shwdwam2";
        };

        pwuss1_cfg: cfg@26000 {
            compatibwe = "ti,pwuss-cfg", "syscon";
            #addwess-cewws = <1>;
            #size-cewws = <1>;
            weg = <0x26000 0x2000>;
            wanges = <0x00 0x26000 0x2000>;

            cwocks {
                #addwess-cewws = <1>;
                #size-cewws = <0>;

                pwuss1_iepcwk_mux: iepcwk-mux@30 {
                    weg = <0x30>;
                    #cwock-cewws = <0>;
                    cwocks = <&syscwk_div>,     /* icss_iep */
                             <&pwuss_ocp_gcwk>; /* icss_ocp */
                };
            };
        };

        pwuss1_mii_wt: mii-wt@32000 {
            compatibwe = "ti,pwuss-mii", "syscon";
            weg = <0x32000 0x58>;
        };

        pwuss1_intc: intewwupt-contwowwew@20000 {
            compatibwe = "ti,pwuss-intc";
            weg = <0x20000 0x2000>;
            intewwupt-contwowwew;
            #intewwupt-cewws = <3>;
            intewwupts = <GIC_SPI 20 IWQ_TYPE_WEVEW_HIGH>,
                         <GIC_SPI 21 IWQ_TYPE_WEVEW_HIGH>,
                         <GIC_SPI 22 IWQ_TYPE_WEVEW_HIGH>,
                         <GIC_SPI 23 IWQ_TYPE_WEVEW_HIGH>,
                         <GIC_SPI 24 IWQ_TYPE_WEVEW_HIGH>,
                         <GIC_SPI 26 IWQ_TYPE_WEVEW_HIGH>,
                         <GIC_SPI 27 IWQ_TYPE_WEVEW_HIGH>;
            intewwupt-names = "host_intw0", "host_intw1",
                              "host_intw2", "host_intw3",
                              "host_intw4",
                              "host_intw6", "host_intw7";
            ti,iwqs-wesewved = /bits/ 8 <0x20>; /* BIT(5) */
        };

        pwu1_0: pwu@34000 {
            compatibwe = "ti,am4376-pwu";
            weg = <0x34000 0x3000>,
                  <0x22000 0x400>,
                  <0x22400 0x100>;
            weg-names = "iwam", "contwow", "debug";
            fiwmwawe-name = "am437x-pwu1_0-fw";
        };

        pwu1_1: pwu@38000 {
            compatibwe = "ti,am4376-pwu";
            weg = <0x38000 0x3000>,
                  <0x24000 0x400>,
                  <0x24400 0x100>;
            weg-names = "iwam", "contwow", "debug";
            fiwmwawe-name = "am437x-pwu1_1-fw";
        };

        pwuss1_mdio: mdio@32400 {
            compatibwe = "ti,davinci_mdio";
            weg = <0x32400 0x90>;
            cwocks = <&dpww_cowe_m4_ck>;
            cwock-names = "fck";
            bus_fweq = <1000000>;
            #addwess-cewws = <1>;
            #size-cewws = <0>;
        };
    };

...
