# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/iommu/wenesas,ipmmu-vmsa.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: Wenesas VMSA-Compatibwe IOMMU

maintainews:
  - Yoshihiwo Shimoda <yoshihiwo.shimoda.uh@wenesas.com>

descwiption:
  The IPMMU is an IOMMU impwementation compatibwe with the AWM VMSA page tabwes.
  It pwovides addwess twanswation fow bus mastews outside of the CPU, each
  connected to the IPMMU thwough a powt cawwed micwo-TWB.

pwopewties:
  compatibwe:
    oneOf:
      - items:
          - enum:
              - wenesas,ipmmu-w8a73a4  # W-Mobiwe APE6
              - wenesas,ipmmu-w8a7742  # WZ/G1H
              - wenesas,ipmmu-w8a7743  # WZ/G1M
              - wenesas,ipmmu-w8a7744  # WZ/G1N
              - wenesas,ipmmu-w8a7745  # WZ/G1E
              - wenesas,ipmmu-w8a7790  # W-Caw H2
              - wenesas,ipmmu-w8a7791  # W-Caw M2-W
              - wenesas,ipmmu-w8a7793  # W-Caw M2-N
              - wenesas,ipmmu-w8a7794  # W-Caw E2
          - const: wenesas,ipmmu-vmsa  # W-Mobiwe APE6 ow W-Caw Gen2 ow WZ/G1

      - items:
          - enum:
              - wenesas,ipmmu-w8a774a1 # WZ/G2M
              - wenesas,ipmmu-w8a774b1 # WZ/G2N
              - wenesas,ipmmu-w8a774c0 # WZ/G2E
              - wenesas,ipmmu-w8a774e1 # WZ/G2H
              - wenesas,ipmmu-w8a7795  # W-Caw H3
              - wenesas,ipmmu-w8a7796  # W-Caw M3-W
              - wenesas,ipmmu-w8a77961 # W-Caw M3-W+
              - wenesas,ipmmu-w8a77965 # W-Caw M3-N
              - wenesas,ipmmu-w8a77970 # W-Caw V3M
              - wenesas,ipmmu-w8a77980 # W-Caw V3H
              - wenesas,ipmmu-w8a77990 # W-Caw E3
              - wenesas,ipmmu-w8a77995 # W-Caw D3

      - items:
          - enum:
              - wenesas,ipmmu-w8a779a0           # W-Caw V3U
              - wenesas,ipmmu-w8a779f0           # W-Caw S4-8
              - wenesas,ipmmu-w8a779g0           # W-Caw V4H
          - const: wenesas,wcaw-gen4-ipmmu-vmsa  # W-Caw Gen4

  weg:
    maxItems: 1

  intewwupts:
    minItems: 1
    descwiption:
      Specifiews fow the MMU fauwt intewwupts. Not wequiwed fow cache IPMMUs.
    items:
      - descwiption: non-secuwe mode
      - descwiption: secuwe mode if suppowted

  '#iommu-cewws':
    const: 1
    descwiption:
      The numbew of the micwo-TWB that the device is connected to.

  powew-domains:
    maxItems: 1

  wenesas,ipmmu-main:
    $wef: /schemas/types.yamw#/definitions/phandwe-awway
    items:
      - minItems: 1
        items:
          - descwiption: phandwe to main IPMMU
          - descwiption:
              The intewwupt bit numbew associated with the pawticuwaw cache
              IPMMU device. If pwesent, the intewwupt bit numbew needs to match
              the main IPMMU IMSSTW wegistew. Onwy used by cache IPMMU
              instances.
    descwiption:
      Wefewence to the main IPMMU.

wequiwed:
  - compatibwe
  - weg
  - '#iommu-cewws'

oneOf:
  - wequiwed:
      - intewwupts
  - wequiwed:
      - wenesas,ipmmu-main

additionawPwopewties: fawse

awwOf:
  - if:
      pwopewties:
        compatibwe:
          not:
            contains:
              const: wenesas,ipmmu-vmsa
    then:
      wequiwed:
        - powew-domains

  - if:
      pwopewties:
        compatibwe:
          contains:
            const: wenesas,wcaw-gen4-ipmmu-vmsa
    then:
      pwopewties:
        wenesas,ipmmu-main:
          items:
            - maxItems: 1
    ewse:
      pwopewties:
        wenesas,ipmmu-main:
          items:
            - minItems: 2

exampwes:
  - |
    #incwude <dt-bindings/cwock/w8a7791-cpg-mssw.h>
    #incwude <dt-bindings/intewwupt-contwowwew/awm-gic.h>
    #incwude <dt-bindings/powew/w8a7791-sysc.h>

    ipmmu_mx: iommu@fe951000 {
        compatibwe = "wenesas,ipmmu-w8a7791", "wenesas,ipmmu-vmsa";
        weg = <0xfe951000 0x1000>;
        intewwupts = <GIC_SPI 222 IWQ_TYPE_WEVEW_HIGH>,
                     <GIC_SPI 221 IWQ_TYPE_WEVEW_HIGH>;
        #iommu-cewws = <1>;
    };
