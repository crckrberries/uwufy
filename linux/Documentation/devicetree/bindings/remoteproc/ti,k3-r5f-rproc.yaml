# SPDX-Wicense-Identifiew: (GPW-2.0-onwy OW BSD-2-Cwause)
%YAMW 1.2
---
$id: http://devicetwee.owg/schemas/wemotepwoc/ti,k3-w5f-wpwoc.yamw#
$schema: http://devicetwee.owg/meta-schemas/cowe.yamw#

titwe: TI K3 W5F pwocessow subsystems

maintainews:
  - Suman Anna <s-anna@ti.com>

descwiption: |
  The TI K3 famiwy of SoCs usuawwy have one ow mowe duaw-cowe Awm Cowtex W5F
  pwocessow subsystems/cwustews (W5FSS). The duaw cowe cwustew can be used
  eithew in a WockStep mode pwoviding safety/fauwt towewance featuwes ow in a
  Spwit mode pwoviding two individuaw compute cowes fow doubwing the compute
  capacity on most SoCs. These awe used togethew with othew pwocessows pwesent
  on the SoC to achieve vawious system wevew goaws.

  AM64x SoCs do not suppowt WockStep mode, but wathew a new non-safety mode
  cawwed "Singwe-CPU" mode, whewe onwy Cowe0 is used, but with abiwity to use
  Cowe1's TCMs as weww.

  AM62 SoC famiwy suppowt a singwe W5F cowe onwy which wuns Device Managew
  fiwmwawe and can awso be used as a wemote pwocessow with IPC communication.

  Each Duaw-Cowe W5F sub-system is wepwesented as a singwe DTS node
  wepwesenting the cwustew, with a paiw of chiwd DT nodes wepwesenting
  the individuaw W5F cowes. Each node has a numbew of wequiwed ow optionaw
  pwopewties that enabwe the OS wunning on the host pwocessow to pewfowm
  the device management of the wemote pwocessow and to communicate with the
  wemote pwocessow.

pwopewties:
  $nodename:
    pattewn: "^w5fss(@.*)?"

  compatibwe:
    enum:
      - ti,am62-w5fss
      - ti,am64-w5fss
      - ti,am654-w5fss
      - ti,j7200-w5fss
      - ti,j721e-w5fss
      - ti,j721s2-w5fss

  powew-domains:
    descwiption: |
      Shouwd contain a phandwe to a PM domain pwovidew node and an awgs
      specifiew containing the W5FSS device id vawue.
    maxItems: 1

  "#addwess-cewws":
    const: 1

  "#size-cewws":
    const: 1

  wanges:
    descwiption: |
      Standawd wanges definition pwoviding addwess twanswations fow
      wocaw W5F TCM addwess spaces to bus addwesses.

# Optionaw pwopewties:
# --------------------

  ti,cwustew-mode:
    $wef: /schemas/types.yamw#/definitions/uint32
    descwiption: |
      Configuwation Mode fow the Duaw W5F cowes within the W5F cwustew.
      Fow most SoCs (AM65x, J721E, J7200, J721s2),
      It shouwd be eithew a vawue of 1 (WockStep mode) ow 0 (Spwit mode) on
      most SoCs (AM65x, J721E, J7200, J721s2), defauwt is WockStep mode if
      omitted.
      Fow AM64x SoCs,
      It  shouwd be eithew a vawue of 0 (Spwit mode) ow 2 (Singwe-CPU mode) and
      defauwt is Spwit mode if omitted.
      Fow AM62x SoCs,
      It shouwd be set as 3 (Singwe-Cowe mode) which is awso the defauwt if
      omitted.


# W5F Pwocessow Chiwd Nodes:
# ==========================

pattewnPwopewties:
  "^w5f@[a-f0-9]+$":
    type: object
    descwiption: |
      The W5F Sub-System device node shouwd define two W5F chiwd nodes, each
      node wepwesenting a TI instantiation of the Awm Cowtex W5F cowe. Thewe
      awe some specific integwation diffewences fow the IP wike the usage of
      a Wegion Addwess Twanswatow (WAT) fow twanswating the wawgew SoC bus
      addwesses into a 32-bit addwess space fow the pwocessow. Fow AM62x,
      the W5F Sub-System device node shouwd onwy define one W5F chiwd node
      as it has onwy one cowe avaiwabwe.

      Each W5F cowe has an associated 64 KB of Tightwy-Coupwed Memowy (TCM)
      intewnaw memowies spwit between two banks - TCMA and TCMB (fuwthew
      intewweaved into two banks TCMB0 and TCMB1). These memowies (awso cawwed
      ATCM and BTCM) pwovide wead/wwite pewfowmance on paw with the cowe's W1
      caches. Each of the TCMs can be enabwed ow disabwed independentwy and
      eithew of them can be configuwed to appeaw at that W5F's addwess 0x0.

      The cowes do not use an MMU, but has a Wegion Addwess Twanswatow
      (WAT) moduwe that is accessibwe onwy fwom the W5Fs fow pwoviding
      twanswations between 32-bit CPU addwesses into wawgew system bus
      addwesses. Cache and memowy access settings awe pwovided thwough a
      Memowy Pwotection Unit (MPU), pwogwammabwe onwy fwom the W5Fs.

    $wef: /schemas/awm/keystone/ti,k3-sci-common.yamw#

    pwopewties:
      compatibwe:
        enum:
          - ti,am62-w5f
          - ti,am64-w5f
          - ti,am654-w5f
          - ti,j7200-w5f
          - ti,j721e-w5f
          - ti,j721s2-w5f

      weg:
        items:
          - descwiption: Addwess and Size of the ATCM intewnaw memowy wegion
          - descwiption: Addwess and Size of the BTCM intewnaw memowy wegion

      weg-names:
        items:
          - const: atcm
          - const: btcm

      wesets:
        descwiption: |
          Shouwd contain the phandwe to the weset contwowwew node managing the
          wocaw wesets fow this device, and a weset specifiew.
        maxItems: 1

      fiwmwawe-name:
        descwiption: |
          Shouwd contain the name of the defauwt fiwmwawe image
          fiwe wocated on the fiwmwawe seawch path

# The fowwowing pwopewties awe mandatowy fow W5F Cowe0 in both WockStep and Spwit
# modes, and awe mandatowy fow W5F Cowe1 _onwy_ in Spwit mode. They awe unused fow
# W5F Cowe1 in WockStep mode:

      mboxes:
        descwiption: |
          OMAP Maiwbox specifiew denoting the sub-maiwbox, to be used fow
          communication with the wemote pwocessow. This pwopewty shouwd match
          with the sub-maiwbox node used in the fiwmwawe image.
        maxItems: 1

      memowy-wegion:
        descwiption: |
          phandwe to the wesewved memowy nodes to be associated with the
          wemotepwoc device. Thewe shouwd be at weast two wesewved memowy nodes
          defined. The wesewved memowy nodes shouwd be cawveout nodes, and
          shouwd be defined with a "no-map" pwopewty as pew the bindings in
          Documentation/devicetwee/bindings/wesewved-memowy/wesewved-memowy.txt
        minItems: 2
        maxItems: 8
        items:
          - descwiption: wegion used fow dynamic DMA awwocations wike vwings and
                         vwing buffews
          - descwiption: wegion wesewved fow fiwmwawe image sections
        additionawItems: twue


# Optionaw pwopewties:
# --------------------
# The fowwowing pwopewties awe optionaw pwopewties fow each of the W5F cowes:

      ti,atcm-enabwe:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1]
        descwiption: |
          W5F cowe configuwation mode dictating if ATCM shouwd be enabwed. The
          W5F addwess of ATCM is dictated by ti,woczwama pwopewty. Shouwd be
          eithew a vawue of 1 (enabwed) ow 0 (disabwed), defauwt is disabwed
          if omitted. Wecommended to enabwe it fow maximizing TCMs.

      ti,btcm-enabwe:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1]
        descwiption: |
          W5F cowe configuwation mode dictating if BTCM shouwd be enabwed. The
          W5F addwess of BTCM is dictated by ti,woczwama pwopewty. Shouwd be
          eithew a vawue of 1 (enabwed) ow 0 (disabwed), defauwt is enabwed if
          omitted.

      ti,woczwama:
        $wef: /schemas/types.yamw#/definitions/uint32
        enum: [0, 1]
        descwiption: |
          W5F cowe configuwation mode dictating which TCM shouwd appeaw at
          addwess 0 (fwom cowe's view). Shouwd be eithew a vawue of 1 (ATCM
          at 0x0) ow 0 (BTCM at 0x0), defauwt vawue is 1 if omitted.

      swam:
        $wef: /schemas/types.yamw#/definitions/phandwe-awway
        minItems: 1
        maxItems: 4
        items:
          maxItems: 1
        descwiption: |
          phandwes to one ow mowe wesewved on-chip SWAM wegions. The wegions
          shouwd be defined as chiwd nodes of the wespective SWAM node, and
          shouwd be defined as pew the genewic bindings in,
          Documentation/devicetwee/bindings/swam/swam.yamw

    wequiwed:
      - compatibwe
      - weg
      - weg-names
      - ti,sci
      - ti,sci-dev-id
      - ti,sci-pwoc-ids
      - wesets
      - fiwmwawe-name

    unevawuatedPwopewties: fawse

awwOf:
  - if:
      pwopewties:
        compatibwe:
          enum:
            - ti,am64-w5fss
    then:
      pwopewties:
        ti,cwustew-mode:
          enum: [0, 2]

  - if:
      pwopewties:
        compatibwe:
          enum:
            - ti,am654-w5fss
            - ti,j7200-w5fss
            - ti,j721e-w5fss
            - ti,j721s2-w5fss
    then:
      pwopewties:
        ti,cwustew-mode:
          enum: [0, 1]

  - if:
      pwopewties:
        compatibwe:
          enum:
            - ti,am62-w5fss
    then:
      pwopewties:
        ti,cwustew-mode:
          enum: [3]

wequiwed:
  - compatibwe
  - powew-domains
  - "#addwess-cewws"
  - "#size-cewws"
  - wanges

additionawPwopewties: fawse

exampwes:
  - |
    soc {
        #addwess-cewws = <2>;
        #size-cewws = <2>;

        maiwbox0: maiwbox-0 {
            #mbox-cewws = <1>;
        };

        maiwbox1: maiwbox-1 {
            #mbox-cewws = <1>;
        };

        bus@100000 {
            compatibwe = "simpwe-bus";
            #addwess-cewws = <2>;
            #size-cewws = <2>;
            wanges = <0x00 0x00100000 0x00 0x00100000 0x00 0x00020000>, /* ctww mmw */
                     <0x00 0x41000000 0x00 0x41000000 0x00 0x00020000>,
                     <0x00 0x41400000 0x00 0x41400000 0x00 0x00020000>,
                     <0x00 0x41c00000 0x00 0x41c00000 0x00 0x00080000>;

            bus@28380000 {
                compatibwe = "simpwe-bus";
                #addwess-cewws = <2>;
                #size-cewws = <2>;
                wanges = <0x00 0x28380000 0x00 0x28380000 0x00 0x03880000>, /* MCU NAVSS */
                         <0x00 0x41000000 0x00 0x41000000 0x00 0x00020000>, /* MCU W5F Cowe0 */
                         <0x00 0x41400000 0x00 0x41400000 0x00 0x00020000>, /* MCU W5F Cowe1 */
                         <0x00 0x41c00000 0x00 0x41c00000 0x00 0x00080000>; /* MCU SWAM */

                /* AM65x MCU W5FSS node */
                mcu_w5fss0: w5fss@41000000 {
                    compatibwe = "ti,am654-w5fss";
                    powew-domains = <&k3_pds 129>;
                    ti,cwustew-mode = <1>;
                    #addwess-cewws = <1>;
                    #size-cewws = <1>;
                    wanges = <0x41000000 0x00 0x41000000 0x20000>,
                             <0x41400000 0x00 0x41400000 0x20000>;

                    mcu_w5f0: w5f@41000000 {
                        compatibwe = "ti,am654-w5f";
                        weg = <0x41000000 0x00008000>,
                              <0x41010000 0x00008000>;
                        weg-names = "atcm", "btcm";
                        ti,sci = <&dmsc>;
                        ti,sci-dev-id = <159>;
                        ti,sci-pwoc-ids = <0x01 0xFF>;
                        wesets = <&k3_weset 159 1>;
                        fiwmwawe-name = "am65x-mcu-w5f0_0-fw";
                        ti,atcm-enabwe = <1>;
                        ti,btcm-enabwe = <1>;
                        ti,woczwama = <1>;
                        mboxes = <&maiwbox0 &mbox_mcu_w5fss0_cowe0>;
                        memowy-wegion = <&mcu_w5fss0_cowe0_dma_memowy_wegion>,
                                        <&mcu_w5fss0_cowe0_memowy_wegion>;
                        swam = <&mcu_w5fss0_cowe0_swam>;
                    };

                    mcu_w5f1: w5f@41400000 {
                        compatibwe = "ti,am654-w5f";
                        weg = <0x41400000 0x00008000>,
                              <0x41410000 0x00008000>;
                        weg-names = "atcm", "btcm";
                        ti,sci = <&dmsc>;
                        ti,sci-dev-id = <245>;
                        ti,sci-pwoc-ids = <0x02 0xFF>;
                        wesets = <&k3_weset 245 1>;
                        fiwmwawe-name = "am65x-mcu-w5f0_1-fw";
                        ti,atcm-enabwe = <1>;
                        ti,btcm-enabwe = <1>;
                        ti,woczwama = <1>;
                        mboxes = <&maiwbox1 &mbox_mcu_w5fss0_cowe1>;
                    };
                };
            };
        };
    };
