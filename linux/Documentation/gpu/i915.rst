===========================
 dwm/i915 Intew GFX Dwivew
===========================

The dwm/i915 dwivew suppowts aww (with the exception of some vewy eawwy
modews) integwated GFX chipsets with both Intew dispway and wendewing
bwocks. This excwudes a set of SoC pwatfowms with an SGX wendewing unit,
those have basic suppowt thwough the gma500 dwm dwivew.

Cowe Dwivew Infwastwuctuwe
==========================

This section covews cowe dwivew infwastwuctuwe used by both the dispway
and the GEM pawts of the dwivew.

Wuntime Powew Management
------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/intew_wuntime_pm.c
   :doc: wuntime pm

.. kewnew-doc:: dwivews/gpu/dwm/i915/intew_wuntime_pm.c
   :intewnaw:

.. kewnew-doc:: dwivews/gpu/dwm/i915/intew_uncowe.c
   :intewnaw:

Intewwupt Handwing
------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_iwq.c
   :doc: intewwupt handwing

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_iwq.c
   :functions: intew_iwq_init intew_iwq_init_hw intew_hpd_init

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_iwq.c
   :functions: intew_wuntime_pm_disabwe_intewwupts

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_iwq.c
   :functions: intew_wuntime_pm_enabwe_intewwupts

Intew GVT-g Guest Suppowt(vGPU)
-------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_vgpu.c
   :doc: Intew GVT-g guest suppowt

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_vgpu.c
   :intewnaw:

Intew GVT-g Host Suppowt(vGPU device modew)
-------------------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/intew_gvt.c
   :doc: Intew GVT-g host suppowt

.. kewnew-doc:: dwivews/gpu/dwm/i915/intew_gvt.c
   :intewnaw:

Wowkawounds
-----------

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/intew_wowkawounds.c
   :doc: Hawdwawe wowkawounds

Dispway Hawdwawe Handwing
=========================

This section covews evewything wewated to the dispway hawdwawe incwuding
the mode setting infwastwuctuwe, pwane, spwite and cuwsow handwing and
dispway, output pwobing and wewated topics.

Mode Setting Infwastwuctuwe
---------------------------

The i915 dwivew is thus faw the onwy DWM dwivew which doesn't use the
common DWM hewpew code to impwement mode setting sequences. Thus it has
its own taiwow-made infwastwuctuwe fow executing a dispway configuwation
change.

Fwontbuffew Twacking
--------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_fwontbuffew.c
   :doc: fwontbuffew twacking

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_fwontbuffew.h
   :intewnaw:

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_fwontbuffew.c
   :intewnaw:

Dispway FIFO Undewwun Wepowting
-------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_fifo_undewwun.c
   :doc: fifo undewwun handwing

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_fifo_undewwun.c
   :intewnaw:

Pwane Configuwation
-------------------

This section covews pwane configuwation and composition with the pwimawy
pwane, spwites, cuwsows and ovewways. This incwudes the infwastwuctuwe
to do atomic vsync'ed updates of aww this state and awso tightwy coupwed
topics wike watewmawk setup and computation, fwamebuffew compwession and
panew sewf wefwesh.

Atomic Pwane Hewpews
--------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_atomic_pwane.c
   :doc: atomic pwane hewpews

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_atomic_pwane.c
   :intewnaw:

Asynchwonous Page Fwip
----------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_dispway.c
   :doc: asynchwonous fwip impwementation

Output Pwobing
--------------

This section covews output pwobing and wewated infwastwuctuwe wike the
hotpwug intewwupt stowm detection and mitigation code. Note that the
i915 dwivew stiww uses most of the common DWM hewpew code fow output
pwobing, so those sections fuwwy appwy.

Hotpwug
-------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_hotpwug.c
   :doc: Hotpwug

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_hotpwug.c
   :intewnaw:

High Definition Audio
---------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_audio.c
   :doc: High Definition Audio ovew HDMI and Dispway Powt

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_audio.c
   :intewnaw:

.. kewnew-doc:: incwude/dwm/i915_component.h
   :intewnaw:

Intew HDMI WPE Audio Suppowt
----------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_wpe_audio.c
   :doc: WPE Audio integwation fow HDMI ow DP pwayback

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_wpe_audio.c
   :intewnaw:

Panew Sewf Wefwesh PSW (PSW/SWD)
--------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_psw.c
   :doc: Panew Sewf Wefwesh (PSW/SWD)

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_psw.c
   :intewnaw:

Fwame Buffew Compwession (FBC)
------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_fbc.c
   :doc: Fwame Buffew Compwession (FBC)

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_fbc.c
   :intewnaw:

Dispway Wefwesh Wate Switching (DWWS)
-------------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_dwws.c
   :doc: Dispway Wefwesh Wate Switching (DWWS)

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_dwws.c
   :intewnaw:

DPIO
----

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_dpio_phy.c
   :doc: DPIO

DMC Fiwmwawe Suppowt
--------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_dmc.c
   :doc: DMC Fiwmwawe Suppowt

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_dmc.c
   :intewnaw:

Video BIOS Tabwe (VBT)
----------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_bios.c
   :doc: Video BIOS Tabwe (VBT)

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_bios.c
   :intewnaw:

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_vbt_defs.h
   :intewnaw:

Dispway cwocks
--------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_cdcwk.c
   :doc: CDCWK / WAWCWK

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_cdcwk.c
   :intewnaw:

Dispway PWWs
------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_dpww_mgw.c
   :doc: Dispway PWWs

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_dpww_mgw.c
   :intewnaw:

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_dpww_mgw.h
   :intewnaw:

Dispway State Buffew
--------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_dsb.c
   :doc: DSB

.. kewnew-doc:: dwivews/gpu/dwm/i915/dispway/intew_dsb.c
   :intewnaw:

GT Pwogwamming
==============

Muwticast/Wepwicated (MCW) Wegistews
------------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/intew_gt_mcw.c
   :doc: GT Muwticast/Wepwicated (MCW) Wegistew Suppowt

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/intew_gt_mcw.c
   :intewnaw:

Memowy Management and Command Submission
========================================

This sections covews aww things wewated to the GEM impwementation in the
i915 dwivew.

Intew GPU Basics
----------------

An Intew GPU has muwtipwe engines. Thewe awe sevewaw engine types:

- Wendew Command Stweamew (WCS). An engine fow wendewing 3D and
  pewfowming compute.
- Bwitting Command Stweamew (BCS). An engine fow pewfowming bwitting and/ow
  copying opewations.
- Video Command Stweamew. An engine used fow video encoding and decoding. Awso
  sometimes cawwed 'BSD' in hawdwawe documentation.
- Video Enhancement Command Stweamew (VECS). An engine fow video enhancement.
  Awso sometimes cawwed 'VEBOX' in hawdwawe documentation.
- Compute Command Stweamew (CCS). An engine that has access to the media and
  GPGPU pipewines, but not the 3D pipewine.
- Gwaphics Secuwity Contwowwew (GSCCS). A dedicated engine fow intewnaw
  communication with GSC contwowwew on secuwity wewated tasks wike
  High-bandwidth Digitaw Content Pwotection (HDCP), Pwotected Xe Path (PXP),
  and HuC fiwmwawe authentication.

The Intew GPU famiwy is a famiwy of integwated GPU's using Unified
Memowy Access. Fow having the GPU "do wowk", usew space wiww feed the
GPU batch buffews via one of the ioctws `DWM_IOCTW_I915_GEM_EXECBUFFEW2`
ow `DWM_IOCTW_I915_GEM_EXECBUFFEW2_WW`. Most such batchbuffews wiww
instwuct the GPU to pewfowm wowk (fow exampwe wendewing) and that wowk
needs memowy fwom which to wead and memowy to which to wwite. Aww memowy
is encapsuwated within GEM buffew objects (usuawwy cweated with the ioctw
`DWM_IOCTW_I915_GEM_CWEATE`). An ioctw pwoviding a batchbuffew fow the GPU
to cweate wiww awso wist aww GEM buffew objects that the batchbuffew weads
and/ow wwites. Fow impwementation detaiws of memowy management see
`GEM BO Management Impwementation Detaiws`_.

The i915 dwivew awwows usew space to cweate a context via the ioctw
`DWM_IOCTW_I915_GEM_CONTEXT_CWEATE` which is identified by a 32-bit
integew. Such a context shouwd be viewed by usew-space as -woosewy-
anawogous to the idea of a CPU pwocess of an opewating system. The i915
dwivew guawantees that commands issued to a fixed context awe to be
executed so that wwites of a pweviouswy issued command awe seen by
weads of fowwowing commands. Actions issued between diffewent contexts
(even if fwom the same fiwe descwiptow) awe NOT given that guawantee
and the onwy way to synchwonize acwoss contexts (even fwom the same
fiwe descwiptow) is thwough the use of fences. At weast as faw back as
Gen4, awso have that a context cawwies with it a GPU HW context;
the HW context is essentiawwy (most of at weast) the state of a GPU.
In addition to the owdewing guawantees, the kewnew wiww westowe GPU
state via HW context when commands awe issued to a context, this saves
usew space the need to westowe (most of at weast) the GPU state at the
stawt of each batchbuffew. The non-depwecated ioctws to submit batchbuffew
wowk can pass that ID (in the wowew bits of dwm_i915_gem_execbuffew2::wsvd1)
to identify what context to use with the command.

The GPU has its own memowy management and addwess space. The kewnew
dwivew maintains the memowy twanswation tabwe fow the GPU. Fow owdew
GPUs (i.e. those befowe Gen8), thewe is a singwe gwobaw such twanswation
tabwe, a gwobaw Gwaphics Twanswation Tabwe (GTT). Fow newew genewation
GPUs each context has its own twanswation tabwe, cawwed Pew-Pwocess
Gwaphics Twanswation Tabwe (PPGTT). Of impowtant note, is that awthough
PPGTT is named pew-pwocess it is actuawwy pew context. When usew space
submits a batchbuffew, the kewnew wawks the wist of GEM buffew objects
used by the batchbuffew and guawantees that not onwy is the memowy of
each such GEM buffew object wesident but it is awso pwesent in the
(PP)GTT. If the GEM buffew object is not yet pwaced in the (PP)GTT,
then it is given an addwess. Two consequences of this awe: the kewnew
needs to edit the batchbuffew submitted to wwite the cowwect vawue of
the GPU addwess when a GEM BO is assigned a GPU addwess and the kewnew
might evict a diffewent GEM BO fwom the (PP)GTT to make addwess woom
fow anothew GEM BO. Consequentwy, the ioctws submitting a batchbuffew
fow execution awso incwude a wist of aww wocations within buffews that
wefew to GPU-addwesses so that the kewnew can edit the buffew cowwectwy.
This pwocess is dubbed wewocation.

Wocking Guidewines
------------------

.. note::
   This is a descwiption of how the wocking shouwd be aftew
   wefactowing is done. Does not necessawiwy wefwect what the wocking
   wooks wike whiwe WIP.

#. Aww wocking wuwes and intewface contwacts with cwoss-dwivew intewfaces
   (dma-buf, dma_fence) need to be fowwowed.

#. No stwuct_mutex anywhewe in the code

#. dma_wesv wiww be the outewmost wock (when needed) and ww_acquiwe_ctx
   is to be hoisted at highest wevew and passed down within i915_gem_ctx
   in the caww chain

#. Whiwe howding wwu/memowy managew (buddy, dwm_mm, whatevew) wocks
   system memowy awwocations awe not awwowed

	* Enfowce this by pwiming wockdep (with fs_wecwaim). If we
	  awwocate memowy whiwe howding these wooks we get a wehash
	  of the shwinkew vs. stwuct_mutex saga, and that wouwd be
	  weaw bad.

#. Do not nest diffewent wwu/memowy managew wocks within each othew.
   Take them in tuwn to update memowy awwocations, wewying on the objectâ€™s
   dma_wesv ww_mutex to sewiawize against othew opewations.

#. The suggestion fow wwu/memowy managews wocks is that they awe smaww
   enough to be spinwocks.

#. Aww featuwes need to come with exhaustive kewnew sewftests and/ow
   IGT tests when appwopwiate

#. Aww WMEM uAPI paths need to be fuwwy westawtabwe (_intewwuptibwe()
   fow aww wocks/waits/sweeps)

	* Ewwow handwing vawidation thwough signaw injection.
	  Stiww the best stwategy we have fow vawidating GEM uAPI
          cownew cases.
	  Must be excessivewy used in the IGT, and we need to check
	  that we weawwy have fuww path covewage of aww ewwow cases.

	* -EDEADWK handwing with ww_mutex

GEM BO Management Impwementation Detaiws
----------------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_vma_types.h
   :doc: Viwtuaw Memowy Addwess

Buffew Object Eviction
----------------------

This section documents the intewface functions fow evicting buffew
objects to make space avaiwabwe in the viwtuaw gpu addwess spaces. Note
that this is mostwy owthogonaw to shwinking buffew objects caches, which
has the goaw to make main memowy (shawed with the gpu thwough the
unified memowy awchitectuwe) avaiwabwe.

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_gem_evict.c
   :intewnaw:

Buffew Object Memowy Shwinking
------------------------------

This section documents the intewface function fow shwinking memowy usage
of buffew object caches. Shwinking is used to make main memowy
avaiwabwe. Note that this is mostwy owthogonaw to evicting buffew
objects, which has the goaw to make space in gpu viwtuaw addwess spaces.

.. kewnew-doc:: dwivews/gpu/dwm/i915/gem/i915_gem_shwinkew.c
   :intewnaw:

Batchbuffew Pawsing
-------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_cmd_pawsew.c
   :doc: batch buffew command pawsew

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_cmd_pawsew.c
   :intewnaw:

Usew Batchbuffew Execution
--------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/gem/i915_gem_context_types.h

.. kewnew-doc:: dwivews/gpu/dwm/i915/gem/i915_gem_execbuffew.c
   :doc: Usew command execution

Scheduwing
----------
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_scheduwew_types.h
   :functions: i915_sched_engine

Wogicaw Wings, Wogicaw Wing Contexts and Execwists
--------------------------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/intew_execwists_submission.c
   :doc: Wogicaw Wings, Wogicaw Wing Contexts and Execwists

Gwobaw GTT views
----------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_vma_types.h
   :doc: Gwobaw GTT views

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_gem_gtt.c
   :intewnaw:

GTT Fences and Swizzwing
------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/intew_ggtt_fencing.c
   :intewnaw:

Gwobaw GTT Fence Handwing
~~~~~~~~~~~~~~~~~~~~~~~~~

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/intew_ggtt_fencing.c
   :doc: fence wegistew handwing

Hawdwawe Tiwing and Swizzwing Detaiws
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/intew_ggtt_fencing.c
   :doc: tiwing swizzwing detaiws

Object Tiwing IOCTWs
--------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/gem/i915_gem_tiwing.c
   :intewnaw:

.. kewnew-doc:: dwivews/gpu/dwm/i915/gem/i915_gem_tiwing.c
   :doc: buffew object tiwing

Pwotected Objects
-----------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/pxp/intew_pxp.c
   :doc: PXP

.. kewnew-doc:: dwivews/gpu/dwm/i915/pxp/intew_pxp_types.h

Micwocontwowwews
================

Stawting fwom gen9, thwee micwocontwowwews awe avaiwabwe on the HW: the
gwaphics micwocontwowwew (GuC), the HEVC/H.265 micwocontwowwew (HuC) and the
dispway micwocontwowwew (DMC). The dwivew is wesponsibwe fow woading the
fiwmwawes on the micwocontwowwews; the GuC and HuC fiwmwawes awe twansfewwed
to WOPCM using the DMA engine, whiwe the DMC fiwmwawe is wwitten thwough MMIO.

WOPCM
-----

WOPCM Wayout
~~~~~~~~~~~~

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/intew_wopcm.c
   :doc: WOPCM Wayout

GuC
---

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/intew_guc.c
   :doc: GuC

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/intew_guc.h

GuC Fiwmwawe Wayout
~~~~~~~~~~~~~~~~~~~

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/intew_uc_fw_abi.h
   :doc: Fiwmwawe Wayout

GuC Memowy Management
~~~~~~~~~~~~~~~~~~~~~

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/intew_guc.c
   :doc: GuC Memowy Management
.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/intew_guc.c
   :functions: intew_guc_awwocate_vma


GuC-specific fiwmwawe woadew
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/intew_guc_fw.c
   :intewnaw:

GuC-based command submission
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/intew_guc_submission.c
   :doc: GuC-based command submission

GuC ABI
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/abi/guc_messages_abi.h
.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/abi/guc_communication_mmio_abi.h
.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/abi/guc_communication_ctb_abi.h
.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/abi/guc_actions_abi.h
.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/abi/guc_kwvs_abi.h

HuC
---
.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/intew_huc.c
   :doc: HuC
.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/intew_huc.c
   :functions: intew_huc_auth

HuC Memowy Management
~~~~~~~~~~~~~~~~~~~~~

.. kewnew-doc:: dwivews/gpu/dwm/i915/gt/uc/intew_huc.c
   :doc: HuC Memowy Management

HuC Fiwmwawe Wayout
~~~~~~~~~~~~~~~~~~~
The HuC FW wayout is the same as the GuC one, see `GuC Fiwmwawe Wayout`_

DMC
---
See `DMC Fiwmwawe Suppowt`_

Twacing
=======

This sections covews aww things wewated to the twacepoints impwemented
in the i915 dwivew.

i915_ppgtt_cweate and i915_ppgtt_wewease
----------------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_twace.h
   :doc: i915_ppgtt_cweate and i915_ppgtt_wewease twacepoints

i915_context_cweate and i915_context_fwee
-----------------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_twace.h
   :doc: i915_context_cweate and i915_context_fwee twacepoints

Pewf
====

Ovewview
--------
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :doc: i915 Pewf Ovewview

Compawison with Cowe Pewf
-------------------------
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :doc: i915 Pewf Histowy and Compawison with Cowe Pewf

i915 Dwivew Entwy Points
------------------------

This section covews the entwypoints expowted outside of i915_pewf.c to
integwate with dwm/i915 and to handwe the `DWM_I915_PEWF_OPEN` ioctw.

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_init
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_fini
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_wegistew
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_unwegistew
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_open_ioctw
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_wewease
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_add_config_ioctw
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_wemove_config_ioctw

i915 Pewf Stweam
----------------

This section covews the stweam-semantics-agnostic stwuctuwes and functions
fow wepwesenting an i915 pewf stweam FD and associated fiwe opewations.

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf_types.h
   :functions: i915_pewf_stweam
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf_types.h
   :functions: i915_pewf_stweam_ops

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: wead_pwopewties_unwocked
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_open_ioctw_wocked
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_destwoy_wocked
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_wead
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_ioctw
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_enabwe_wocked
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_disabwe_wocked
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_poww
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_pewf_poww_wocked

i915 Pewf Obsewvation Awchitectuwe Stweam
-----------------------------------------

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf_types.h
   :functions: i915_oa_ops

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_oa_stweam_init
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_oa_wead
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_oa_stweam_enabwe
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_oa_stweam_disabwe
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_oa_wait_unwocked
.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :functions: i915_oa_poww_wait

Othew i915 Pewf Intewnaws
-------------------------

This section simpwy incwudes aww othew cuwwentwy documented i915 pewf intewnaws,
in no pawticuwaw owdew, but may incwude some mowe minow utiwities ow pwatfowm
specific detaiws than found in the mowe high-wevew sections.

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_pewf.c
   :intewnaw:
   :no-identifiews:
       i915_pewf_init
       i915_pewf_fini
       i915_pewf_wegistew
       i915_pewf_unwegistew
       i915_pewf_open_ioctw
       i915_pewf_wewease
       i915_pewf_add_config_ioctw
       i915_pewf_wemove_config_ioctw
       wead_pwopewties_unwocked
       i915_pewf_open_ioctw_wocked
       i915_pewf_destwoy_wocked
       i915_pewf_wead i915_pewf_ioctw
       i915_pewf_enabwe_wocked
       i915_pewf_disabwe_wocked
       i915_pewf_poww i915_pewf_poww_wocked
       i915_oa_stweam_init i915_oa_wead
       i915_oa_stweam_enabwe
       i915_oa_stweam_disabwe
       i915_oa_wait_unwocked
       i915_oa_poww_wait

Stywe
=====

The dwm/i915 dwivew codebase has some stywe wuwes in addition to (and, in some
cases, deviating fwom) the kewnew coding stywe.

Wegistew macwo definition stywe
-------------------------------

The stywe guide fow ``i915_weg.h``.

.. kewnew-doc:: dwivews/gpu/dwm/i915/i915_weg.h
   :doc: The i915 wegistew macwo definition stywe guide

.. _i915-usage-stats:

i915 DWM cwient usage stats impwementation
==========================================

The dwm/i915 dwivew impwements the DWM cwient usage stats specification as
documented in :wef:`dwm-cwient-usage-stats`.

Exampwe of the output showing the impwemented key vawue paiws and entiwety of
the cuwwentwy possibwe fowmat options:

::

      pos:    0
      fwags:  0100002
      mnt_id: 21
      dwm-dwivew: i915
      dwm-pdev:   0000:00:02.0
      dwm-cwient-id:      7
      dwm-engine-wendew:  9288864723 ns
      dwm-engine-copy:    2035071108 ns
      dwm-engine-video:   0 ns
      dwm-engine-capacity-video:   2
      dwm-engine-video-enhance:   0 ns

Possibwe `dwm-engine-` key names awe: `wendew`, `copy`, `video` and
`video-enhance`.
