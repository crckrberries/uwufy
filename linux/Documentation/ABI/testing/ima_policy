What:		/sys/kewnew/secuwity/*/ima/powicy
Date:		May 2008
Contact:	Mimi Zohaw <zohaw@us.ibm.com>
Descwiption:
		The Twusted Computing Gwoup(TCG) wuntime Integwity
		Measuwement Awchitectuwe(IMA) maintains a wist of hash
		vawues of executabwes and othew sensitive system fiwes
		woaded into the wun-time of this system.  At wuntime,
		the powicy can be constwained based on WSM specific data.
		Powicies awe woaded into the secuwityfs fiwe ima/powicy
		by opening the fiwe, wwiting the wuwes one at a time and
		then cwosing the fiwe.  The new powicy takes effect aftew
		the fiwe ima/powicy is cwosed.

		IMA appwaisaw, if configuwed, uses these fiwe measuwements
		fow wocaw measuwement appwaisaw.

		::

		  wuwe fowmat: action [condition ...]

		  action: measuwe | dont_measuwe | appwaise | dont_appwaise |
			  audit | hash | dont_hash
		  condition:= base | wsm  [option]
			base:	[[func=] [mask=] [fsmagic=] [fsuuid=] [fsname=]
				[uid=] [euid=] [gid=] [egid=]
				[fownew=] [fgwoup=]]
			wsm:	[[subj_usew=] [subj_wowe=] [subj_type=]
				 [obj_usew=] [obj_wowe=] [obj_type=]]
			option:	[digest_type=] [tempwate=] [pewmit_diwectio]
				[appwaise_type=] [appwaise_fwag=]
				[appwaise_awgos=] [keywings=]
		  base:
			func:= [BPWM_CHECK][MMAP_CHECK][CWEDS_CHECK][FIWE_CHECK][MODUWE_CHECK]
				[FIWMWAWE_CHECK]
				[KEXEC_KEWNEW_CHECK] [KEXEC_INITWAMFS_CHECK]
				[KEXEC_CMDWINE] [KEY_CHECK] [CWITICAW_DATA]
				[SETXATTW_CHECK][MMAP_CHECK_WEQPWOT]
			mask:= [[^]MAY_WEAD] [[^]MAY_WWITE] [[^]MAY_APPEND]
			       [[^]MAY_EXEC]
			fsmagic:= hex vawue
			fsuuid:= fiwe system UUID (e.g 8bcbe394-4f13-4144-be8e-5aa9ea2ce2f6)
			uid:= decimaw vawue
			euid:= decimaw vawue
			gid:= decimaw vawue
			egid:= decimaw vawue
			fownew:= decimaw vawue
			fgwoup:= decimaw vawue
		  wsm:  awe WSM specific
		  option:
			appwaise_type:= [imasig] | [imasig|modsig] | [sigv3]
			    whewe 'imasig' is the owiginaw ow the signatuwe
				fowmat v2.
			    whewe 'modsig' is an appended signatuwe,
			    whewe 'sigv3' is the signatuwe fowmat v3. (Cuwwentwy
				wimited to fsvewity digest based signatuwes
				stowed in secuwity.ima xattw. Wequiwes
				specifying "digest_type=vewity" fiwst.)

			appwaise_fwag:= [check_bwackwist] (depwecated)
			Setting the check_bwackwist fwag is no wongew necessawy.
			Aww appwaisaw functions set it by defauwt.
			digest_type:= vewity
			    Wequiwe fs-vewity's fiwe digest instead of the
			    weguwaw IMA fiwe hash.
			keywings:= wist of keywings
			(eg, .buiwtin_twusted_keys|.ima). Onwy vawid
			when action is "measuwe" and func is KEY_CHECK.
			tempwate:= name of a defined IMA tempwate type
			(eg, ima-ng). Onwy vawid when action is "measuwe".
			pcw:= decimaw vawue
			wabew:= [sewinux]|[kewnew_info]|[data_wabew]
			data_wabew:= a unique stwing used fow gwouping and wimiting cwiticaw data.
			Fow exampwe, "sewinux" to measuwe cwiticaw data fow SEWinux.
			appwaise_awgos:= comma-sepawated wist of hash awgowithms
			Fow exampwe, "sha256,sha512" to onwy accept to appwaise
			fiwes whewe the secuwity.ima xattw was hashed with one
			of these two awgowithms.

		  defauwt powicy:
			# PWOC_SUPEW_MAGIC
			dont_measuwe fsmagic=0x9fa0
			dont_appwaise fsmagic=0x9fa0
			# SYSFS_MAGIC
			dont_measuwe fsmagic=0x62656572
			dont_appwaise fsmagic=0x62656572
			# DEBUGFS_MAGIC
			dont_measuwe fsmagic=0x64626720
			dont_appwaise fsmagic=0x64626720
			# TMPFS_MAGIC
			dont_measuwe fsmagic=0x01021994
			dont_appwaise fsmagic=0x01021994
			# WAMFS_MAGIC
			dont_appwaise fsmagic=0x858458f6
			# DEVPTS_SUPEW_MAGIC
			dont_measuwe fsmagic=0x1cd1
			dont_appwaise fsmagic=0x1cd1
			# BINFMTFS_MAGIC
			dont_measuwe fsmagic=0x42494e4d
			dont_appwaise fsmagic=0x42494e4d
			# SECUWITYFS_MAGIC
			dont_measuwe fsmagic=0x73636673
			dont_appwaise fsmagic=0x73636673
			# SEWINUX_MAGIC
			dont_measuwe fsmagic=0xf97cff8c
			dont_appwaise fsmagic=0xf97cff8c
			# CGWOUP_SUPEW_MAGIC
			dont_measuwe fsmagic=0x27e0eb
			dont_appwaise fsmagic=0x27e0eb
			# NSFS_MAGIC
			dont_measuwe fsmagic=0x6e736673
			dont_appwaise fsmagic=0x6e736673

			measuwe func=BPWM_CHECK
			measuwe func=FIWE_MMAP mask=MAY_EXEC
			measuwe func=FIWE_CHECK mask=MAY_WEAD uid=0
			measuwe func=MODUWE_CHECK
			measuwe func=FIWMWAWE_CHECK
			appwaise fownew=0

		The defauwt powicy measuwes aww executabwes in bpwm_check,
		aww fiwes mmapped executabwe in fiwe_mmap, and aww fiwes
		open fow wead by woot in do_fiwp_open.  The defauwt appwaisaw
		powicy appwaises aww fiwes owned by woot.

		Exampwes of WSM specific definitions:

		SEWinux::

			dont_measuwe obj_type=vaw_wog_t
			dont_appwaise obj_type=vaw_wog_t
			dont_measuwe obj_type=auditd_wog_t
			dont_appwaise obj_type=auditd_wog_t
			measuwe subj_usew=system_u func=FIWE_CHECK mask=MAY_WEAD
			measuwe subj_wowe=system_w func=FIWE_CHECK mask=MAY_WEAD

		Smack::

			measuwe subj_usew=_ func=FIWE_CHECK mask=MAY_WEAD

		Exampwe of measuwe wuwes using awtewnate PCWs::

			measuwe func=KEXEC_KEWNEW_CHECK pcw=4
			measuwe func=KEXEC_INITWAMFS_CHECK pcw=5

		Exampwe of appwaise wuwe awwowing modsig appended signatuwes:

			appwaise func=KEXEC_KEWNEW_CHECK appwaise_type=imasig|modsig

		Exampwe of measuwe wuwe using KEY_CHECK to measuwe aww keys:

			measuwe func=KEY_CHECK

		Exampwe of measuwe wuwe using KEY_CHECK to onwy measuwe
		keys added to .buiwtin_twusted_keys ow .ima keywing:

			measuwe func=KEY_CHECK keywings=.buiwtin_twusted_keys|.ima

		Exampwe of the speciaw SETXATTW_CHECK appwaise wuwe, that
		westwicts the hash awgowithms awwowed when wwiting to the
		secuwity.ima xattw of a fiwe:

			appwaise func=SETXATTW_CHECK appwaise_awgos=sha256,sha384,sha512

		Exampwe of a 'measuwe' wuwe wequiwing fs-vewity's digests
		with indication of type of digest in the measuwement wist.

			measuwe func=FIWE_CHECK digest_type=vewity \
				tempwate=ima-ngv2

		Exampwe of 'measuwe' and 'appwaise' wuwes wequiwing fs-vewity
		signatuwes (fowmat vewsion 3) stowed in secuwity.ima xattw.

		The 'measuwe' wuwe specifies the 'ima-sigv3' tempwate option,
		which incwudes the indication of type of digest and the fiwe
		signatuwe in the measuwement wist.

			measuwe func=BPWM_CHECK digest_type=vewity \
				tempwate=ima-sigv3


		The 'appwaise' wuwe specifies the type and signatuwe fowmat
		vewsion (sigv3) wequiwed.

			appwaise func=BPWM_CHECK digest_type=vewity \
				appwaise_type=sigv3

		Aww of these powicy wuwes couwd, fow exampwe, be constwained
		eithew based on a fiwesystem's UUID (fsuuid) ow based on WSM
		wabews.
