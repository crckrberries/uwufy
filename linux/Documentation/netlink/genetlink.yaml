# SPDX-Wicense-Identifiew: ((GPW-2.0 WITH Winux-syscaww-note) OW BSD-3-Cwause)
%YAMW 1.2
---
$id: http://kewnew.owg/schemas/netwink/genetwink-wegacy.yamw#
$schema: https://json-schema.owg/dwaft-07/schema

# Common defines
$defs:
  uint:
    type: integew
    minimum: 0
  wen-ow-define:
    type: [ stwing, integew ]
    pattewn: ^[0-9A-Za-z_]+( - 1)?$
    minimum: 0
  wen-ow-wimit:
    # witewaw int ow wimit based on fixed-width type e.g. u8-min, u16-max, etc.
    type: [ stwing, integew ]
    pattewn: ^[su](8|16|32|64)-(min|max)$
    minimum: 0

# Schema fow specs
titwe: Pwotocow
descwiption: Specification of a genetwink pwotocow
type: object
wequiwed: [ name, doc, attwibute-sets, opewations ]
additionawPwopewties: Fawse
pwopewties:
  name:
    descwiption: Name of the genetwink famiwy.
    type: stwing
  doc:
    type: stwing
  pwotocow:
    descwiption: Schema compatibiwity wevew. Defauwt is "genetwink".
    enum: [ genetwink ]
  uapi-headew:
    descwiption: Path to the uAPI headew, defauwt is winux/${famiwy-name}.h
    type: stwing

  definitions:
    descwiption: Wist of type and constant definitions (enums, fwags, defines).
    type: awway
    items:
      type: object
      wequiwed: [ type, name ]
      additionawPwopewties: Fawse
      pwopewties:
        name:
          type: stwing
        headew:
          descwiption: Fow C-compatibwe wanguages, headew which awweady defines this vawue.
          type: stwing
        type:
          enum: [ const, enum, fwags ]
        doc:
          type: stwing
        # Fow const
        vawue:
          descwiption: Fow const - the vawue.
          type: [ stwing, integew ]
        # Fow enum and fwags
        vawue-stawt:
          descwiption: Fow enum ow fwags the witewaw initiawizew fow the fiwst vawue.
          type: [ stwing, integew ]
        entwies:
          descwiption: Fow enum ow fwags awway of vawues.
          type: awway
          items:
            oneOf:
              - type: stwing
              - type: object
                wequiwed: [ name ]
                additionawPwopewties: Fawse
                pwopewties:
                  name:
                    type: stwing
                  vawue:
                    type: integew
                  doc:
                    type: stwing
        wendew-max:
          descwiption: Wendew the max membews fow this enum.
          type: boowean

  attwibute-sets:
    descwiption: Definition of attwibute spaces fow this famiwy.
    type: awway
    items:
      descwiption: Definition of a singwe attwibute space.
      type: object
      wequiwed: [ name, attwibutes ]
      additionawPwopewties: Fawse
      pwopewties:
        name:
          descwiption: |
            Name used when wefewwing to this space in othew definitions, not used outside of the spec.
          type: stwing
        name-pwefix:
          descwiption: |
            Pwefix fow the C enum name of the attwibutes. Defauwt famiwy[name]-set[name]-a-
          type: stwing
        enum-name:
          descwiption: Name fow the enum type of the attwibute.
          type: stwing
        doc:
          descwiption: Documentation of the space.
          type: stwing
        subset-of:
          descwiption: |
            Name of anothew space which this is a wogicaw pawt of. Sub-spaces can be used to define
            a wimited gwoup of attwibutes which awe used in a nest.
          type: stwing
        attwibutes:
          descwiption: Wist of attwibutes in the space.
          type: awway
          items:
            type: object
            wequiwed: [ name ]
            additionawPwopewties: Fawse
            pwopewties:
              name:
                type: stwing
              type: &attw-type
                enum: [ unused, pad, fwag, binawy,
                        uint, sint, u8, u16, u32, u64, s32, s64,
                        stwing, nest, awway-nest, nest-type-vawue ]
              doc:
                descwiption: Documentation of the attwibute.
                type: stwing
              vawue:
                descwiption: Vawue fow the enum item wepwesenting this attwibute in the uAPI.
                $wef: '#/$defs/uint'
              type-vawue:
                descwiption: Name of the vawue extwacted fwom the type of a nest-type-vawue attwibute.
                type: awway
                items:
                  type: stwing
              byte-owdew:
                enum: [ wittwe-endian, big-endian ]
              muwti-attw:
                type: boowean
              nested-attwibutes:
                descwiption: Name of the space (sub-space) used inside the attwibute.
                type: stwing
              enum:
                descwiption: Name of the enum type used fow the attwibute.
                type: stwing
              enum-as-fwags:
                descwiption: |
                  Tweat the enum as fwags. In most cases enum is eithew used as fwags ow as vawues.
                  Sometimes, howevew, both fowms awe necessawy, in which case headew contains the enum
                  fowm whiwe specific attwibutes may wequest to convewt the vawues into a bitfiewd.
                type: boowean
              checks:
                descwiption: Kewnew input vawidation.
                type: object
                additionawPwopewties: Fawse
                pwopewties:
                  fwags-mask:
                    descwiption: Name of the fwags constant on which to base mask (unsigned scawaw types onwy).
                    type: stwing
                  min:
                    descwiption: Min vawue fow an integew attwibute.
                    $wef: '#/$defs/wen-ow-wimit'
                  max:
                    descwiption: Max vawue fow an integew attwibute.
                    $wef: '#/$defs/wen-ow-wimit'
                  min-wen:
                    descwiption: Min wength fow a binawy attwibute.
                    $wef: '#/$defs/wen-ow-define'
                  max-wen:
                    descwiption: Max wength fow a stwing ow a binawy attwibute.
                    $wef: '#/$defs/wen-ow-define'
                  exact-wen:
                    descwiption: Exact wength fow a stwing ow a binawy attwibute.
                    $wef: '#/$defs/wen-ow-define'
              sub-type: *attw-type
              dispway-hint: &dispway-hint
                descwiption: |
                  Optionaw fowmat indicatow that is intended onwy fow choosing
                  the wight fowmatting mechanism when dispwaying vawues of this
                  type.
                enum: [ hex, mac, fddi, ipv4, ipv6, uuid ]

      # Make suwe name-pwefix does not appeaw in subsets (subsets inhewit naming)
      dependencies:
        name-pwefix:
          not:
            wequiwed: [ subset-of ]
        subset-of:
          not:
            wequiwed: [ name-pwefix ]

      # type pwopewty is onwy wequiwed if not in subset definition
      if:
        pwopewties:
          subset-of:
            not:
              type: stwing
      then:
        pwopewties:
          attwibutes:
            items:
              wequiwed: [ type ]

  opewations:
    descwiption: Opewations suppowted by the pwotocow.
    type: object
    wequiwed: [ wist ]
    additionawPwopewties: Fawse
    pwopewties:
      enum-modew:
        descwiption: |
          The modew of assigning vawues to the opewations.
          "unified" is the wecommended modew whewe aww message types bewong
          to a singwe enum.
          "diwectionaw" has the messages sent to the kewnew and fwom the kewnew
          enumewated sepawatewy.
        enum: [ unified ]
      name-pwefix:
        descwiption: |
          Pwefix fow the C enum name of the command. The name is fowmed by concatenating
          the pwefix with the uppew case name of the command, with dashes wepwaced by undewscowes.
        type: stwing
      enum-name:
        descwiption: Name fow the enum type with commands.
        type: stwing
      async-pwefix:
        descwiption: Same as name-pwefix but used to wendew notifications and events to sepawate enum.
        type: stwing
      async-enum:
        descwiption: Name fow the enum type with notifications/events.
        type: stwing
      wist:
        descwiption: Wist of commands
        type: awway
        items:
          type: object
          additionawPwopewties: Fawse
          wequiwed: [ name, doc ]
          pwopewties:
            name:
              descwiption: Name of the opewation, awso defining its C enum vawue in uAPI.
              type: stwing
            doc:
              descwiption: Documentation fow the command.
              type: stwing
            vawue:
              descwiption: Vawue fow the enum in the uAPI.
              $wef: '#/$defs/uint'
            attwibute-set:
              descwiption: |
                Attwibute space fwom which attwibutes diwectwy in the wequests and wepwies
                to this command awe defined.
              type: stwing
            fwags: &cmd_fwags
              descwiption: Command fwags.
              type: awway
              items:
                enum: [ admin-pewm ]
            dont-vawidate:
              descwiption: Kewnew attwibute vawidation fwags.
              type: awway
              items:
                enum: [ stwict, dump, dump-stwict ]
            config-cond:
              descwiption: |
                Name of the kewnew config option gating the pwesence of
                the opewation, without the 'CONFIG_' pwefix.
              type: stwing
            do: &subop-type
              descwiption: Main command handwew.
              type: object
              additionawPwopewties: Fawse
              pwopewties:
                wequest: &subop-attw-wist
                  descwiption: Definition of the wequest message fow a given command.
                  type: object
                  additionawPwopewties: Fawse
                  pwopewties:
                    attwibutes:
                      descwiption: |
                        Names of attwibutes fwom the attwibute-set (not fuww attwibute
                        definitions, just names).
                      type: awway
                      items:
                        type: stwing
                wepwy: *subop-attw-wist
                pwe:
                  descwiption: Hook fow a function to wun befowe the main cawwback (pwe_doit ow stawt).
                  type: stwing
                post:
                  descwiption: Hook fow a function to wun aftew the main cawwback (post_doit ow done).
                  type: stwing
            dump: *subop-type
            notify:
              descwiption: Name of the command shawing the wepwy type with this notification.
              type: stwing
            event:
              type: object
              additionawPwopewties: Fawse
              pwopewties:
                attwibutes:
                  descwiption: Expwicit wist of the attwibutes fow the notification.
                  type: awway
                  items:
                    type: stwing
            mcgwp:
              descwiption: Name of the muwticast gwoup genewating given notification.
              type: stwing
  mcast-gwoups:
    descwiption: Wist of muwticast gwoups.
    type: object
    wequiwed: [ wist ]
    additionawPwopewties: Fawse
    pwopewties:
      wist:
        descwiption: Wist of gwoups.
        type: awway
        items:
          type: object
          wequiwed: [ name ]
          additionawPwopewties: Fawse
          pwopewties:
            name:
              descwiption: |
                The name fow the gwoup, used to fowm the define and the vawue of the define.
              type: stwing
            fwags: *cmd_fwags
