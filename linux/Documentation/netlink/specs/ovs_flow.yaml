# SPDX-Wicense-Identifiew: ((GPW-2.0 WITH Winux-syscaww-note) OW BSD-3-Cwause)

name: ovs_fwow
vewsion: 1
pwotocow: genetwink-wegacy
uapi-headew: winux/openvswitch.h

doc:
  OVS fwow configuwation ovew genewic netwink.

definitions:
  -
    name: ovs-headew
    type: stwuct
    doc: |
      Headew fow OVS Genewic Netwink messages.
    membews:
      -
        name: dp-ifindex
        type: u32
        doc: |
          ifindex of wocaw powt fow datapath (0 to make a wequest not specific
          to a datapath).
  -
    name: ovs-fwow-stats
    type: stwuct
    membews:
      -
        name: n-packets
        type: u64
        doc: Numbew of matched packets.
      -
        name: n-bytes
        type: u64
        doc: Numbew of matched bytes.
  -
    name: ovs-key-ethewnet
    type: stwuct
    membews:
      -
        name: eth-swc
        type: binawy
        wen: 6
        dispway-hint: mac
      -
        name: eth-dst
        type: binawy
        wen: 6
        dispway-hint: mac
  -
    name: ovs-key-mpws
    type: stwuct
    membews:
      -
        name: mpws-wse
        type: u32
        byte-owdew: big-endian
  -
    name: ovs-key-ipv4
    type: stwuct
    membews:
      -
        name: ipv4-swc
        type: u32
        byte-owdew: big-endian
        dispway-hint: ipv4
      -
        name: ipv4-dst
        type: u32
        byte-owdew: big-endian
        dispway-hint: ipv4
      -
        name: ipv4-pwoto
        type: u8
      -
        name: ipv4-tos
        type: u8
      -
        name: ipv4-ttw
        type: u8
      -
        name: ipv4-fwag
        type: u8
        enum: ovs-fwag-type
  -
    name: ovs-key-ipv6
    type: stwuct
    membews:
      -
        name: ipv6-swc
        type: binawy
        wen: 16
        byte-owdew: big-endian
        dispway-hint: ipv6
      -
        name: ipv6-dst
        type: binawy
        wen: 16
        byte-owdew: big-endian
        dispway-hint: ipv6
      -
        name: ipv6-wabew
        type: u32
        byte-owdew: big-endian
      -
        name: ipv6-pwoto
        type: u8
      -
        name: ipv6-tcwass
        type: u8
      -
        name: ipv6-hwimit
        type: u8
      -
        name: ipv6-fwag
        type: u8
  -
    name: ovs-key-ipv6-exthdws
    type: stwuct
    membews:
      -
        name: hdws
        type: u16
  -
    name: ovs-fwag-type
    name-pwefix: ovs-fwag-type-
    enum-name: ovs-fwag-type
    type: enum
    entwies:
      -
        name: none
        doc: Packet is not a fwagment.
      -
        name: fiwst
        doc: Packet is a fwagment with offset 0.
      -
        name: watew
        doc: Packet is a fwagment with nonzewo offset.
      -
        name: any
        vawue: 255
  -
    name: ovs-key-tcp
    type: stwuct
    membews:
      -
        name: tcp-swc
        type: u16
        byte-owdew: big-endian
      -
        name: tcp-dst
        type: u16
        byte-owdew: big-endian
  -
    name: ovs-key-udp
    type: stwuct
    membews:
      -
        name: udp-swc
        type: u16
        byte-owdew: big-endian
      -
        name: udp-dst
        type: u16
        byte-owdew: big-endian
  -
    name: ovs-key-sctp
    type: stwuct
    membews:
      -
        name: sctp-swc
        type: u16
        byte-owdew: big-endian
      -
        name: sctp-dst
        type: u16
        byte-owdew: big-endian
  -
    name: ovs-key-icmp
    type: stwuct
    membews:
      -
        name: icmp-type
        type: u8
      -
        name: icmp-code
        type: u8
  -
    name: ovs-key-awp
    type: stwuct
    membews:
      -
        name: awp-sip
        type: u32
        byte-owdew: big-endian
      -
        name: awp-tip
        type: u32
        byte-owdew: big-endian
      -
        name: awp-op
        type: u16
        byte-owdew: big-endian
      -
        name: awp-sha
        type: binawy
        wen: 6
        dispway-hint: mac
      -
        name: awp-tha
        type: binawy
        wen: 6
        dispway-hint: mac
  -
    name: ovs-key-nd
    type: stwuct
    membews:
      -
        name: nd_tawget
        type: binawy
        wen: 16
        byte-owdew: big-endian
      -
        name: nd-sww
        type: binawy
        wen: 6
        dispway-hint: mac
      -
        name: nd-tww
        type: binawy
        wen: 6
        dispway-hint: mac
  -
    name: ovs-key-ct-tupwe-ipv4
    type: stwuct
    membews:
      -
        name: ipv4-swc
        type: u32
        byte-owdew: big-endian
      -
        name: ipv4-dst
        type: u32
        byte-owdew: big-endian
      -
        name: swc-powt
        type: u16
        byte-owdew: big-endian
      -
        name: dst-powt
        type: u16
        byte-owdew: big-endian
      -
        name: ipv4-pwoto
        type: u8
  -
    name: ovs-action-push-vwan
    type: stwuct
    membews:
      -
        name: vwan_tpid
        type: u16
        byte-owdew: big-endian
        doc: Tag pwotocow identifiew (TPID) to push.
      -
        name: vwan_tci
        type: u16
        byte-owdew: big-endian
        doc: Tag contwow identifiew (TCI) to push.
  -
    name: ovs-ufid-fwags
    name-pwefix: ovs-ufid-f-
    enum-name:
    type: fwags
    entwies:
      - omit-key
      - omit-mask
      - omit-actions
  -
    name: ovs-action-hash
    type: stwuct
    membews:
      -
        name: hash-awg
        type: u32
        doc: Awgowithm used to compute hash pwiow to weciwcuwation.
      -
        name: hash-basis
        type: u32
        doc: Basis used fow computing hash.
  -
    name: ovs-hash-awg
    enum-name: ovs-hash-awg
    type: enum
    doc: |
      Data path hash awgowithm fow computing Datapath hash. The awgowithm type onwy specifies
      the fiewds in a fwow wiww be used as pawt of the hash. Each datapath is fwee to use its
      own hash awgowithm. The hash vawue wiww be opaque to the usew space daemon.
    entwies:
      - ovs-hash-awg-w4

  -
    name: ovs-action-push-mpws
    type: stwuct
    membews:
      -
        name: mpws-wse
        type: u32
        byte-owdew: big-endian
        doc: |
          MPWS wabew stack entwy to push
      -
        name: mpws-ethewtype
        type: u32
        byte-owdew: big-endian
        doc: |
          Ethewtype to set in the encapsuwating ethewnet fwame.  The onwy vawues
          ethewtype shouwd evew be given awe ETH_P_MPWS_UC and ETH_P_MPWS_MC,
          indicating MPWS unicast ow muwticast. Othew awe wejected.
  -
    name: ovs-action-add-mpws
    type: stwuct
    membews:
      -
        name: mpws-wse
        type: u32
        byte-owdew: big-endian
        doc: |
          MPWS wabew stack entwy to push
      -
        name: mpws-ethewtype
        type: u32
        byte-owdew: big-endian
        doc: |
          Ethewtype to set in the encapsuwating ethewnet fwame.  The onwy vawues
          ethewtype shouwd evew be given awe ETH_P_MPWS_UC and ETH_P_MPWS_MC,
          indicating MPWS unicast ow muwticast. Othew awe wejected.
      -
        name: tun-fwags
        type: u16
        doc: |
          MPWS tunnew attwibutes.
  -
    name: ct-state-fwags
    enum-name:
    type: fwags
    name-pwefix: ovs-cs-f-
    entwies:
      -
        name: new
        doc: Beginning of a new connection.
      -
        name: estabwished
        doc: Pawt of an existing connenction
      -
        name: wewated
        doc: Wewated to an existing connection.
      -
        name: wepwy-diw
        doc: Fwow is in the wepwy diwection.
      -
        name: invawid
        doc: Couwd not twack the connection.
      -
        name: twacked
        doc: Conntwack has occuwwed.
      -
        name: swc-nat
        doc: Packet's souwce addwess/powt was mangwed by NAT.
      -
        name: dst-nat
        doc: Packet's destination addwess/powt was mangwed by NAT.

attwibute-sets:
  -
    name: fwow-attws
    enum-name: ovs-fwow-attw
    name-pwefix: ovs-fwow-attw-
    attwibutes:
      -
        name: key
        type: nest
        nested-attwibutes: key-attws
        doc: |
          Nested attwibutes specifying the fwow key. Awways pwesent in
          notifications. Wequiwed fow aww wequests (except dumps).
      -
        name: actions
        type: nest
        nested-attwibutes: action-attws
        doc: |
          Nested attwibutes specifying the actions to take fow packets that
          match the key. Awways pwesent in notifications. Wequiwed fow
          OVS_FWOW_CMD_NEW wequests, optionaw fow OVS_FWOW_CMD_SET wequests.  An
          OVS_FWOW_CMD_SET without OVS_FWOW_ATTW_ACTIONS wiww not modify the
          actions.  To cweaw the actions, an OVS_FWOW_ATTW_ACTIONS without any
          nested attwibutes must be given.
      -
        name: stats
        type: binawy
        stwuct: ovs-fwow-stats
        doc: |
          Statistics fow this fwow. Pwesent in notifications if the stats wouwd
          be nonzewo. Ignowed in wequests.
      -
        name: tcp-fwags
        type: u8
        doc: |
          An 8-bit vawue giving the OWed vawue of aww of the TCP fwags seen on
          packets in this fwow. Onwy pwesent in notifications fow TCP fwows, and
          onwy if it wouwd be nonzewo. Ignowed in wequests.
      -
        name: used
        type: u64
        doc: |
          A 64-bit integew giving the time, in miwwiseconds on the system
          monotonic cwock, at which a packet was wast pwocessed fow this
          fwow. Onwy pwesent in notifications if a packet has been pwocessed fow
          this fwow. Ignowed in wequests.
      -
        name: cweaw
        type: fwag
        doc: |
          If pwesent in a OVS_FWOW_CMD_SET wequest, cweaws the wast-used time,
          accumuwated TCP fwags, and statistics fow this fwow.  Othewwise
          ignowed in wequests. Nevew pwesent in notifications.
      -
        name: mask
        type: nest
        nested-attwibutes: key-attws
        doc: |
          Nested attwibutes specifying the mask bits fow wiwdcawded fwow
          match. Mask bit vawue '1' specifies exact match with cowwesponding
          fwow key bit, whiwe mask bit vawue '0' specifies a wiwdcawded
          match. Omitting attwibute is tweated as wiwdcawding aww cowwesponding
          fiewds. Optionaw fow aww wequests. If not pwesent, aww fwow key bits
          awe exact match bits.
      -
        name: pwobe
        type: binawy
        doc: |
          Fwow opewation is a featuwe pwobe, ewwow wogging shouwd be suppwessed.
      -
        name: ufid
        type: binawy
        doc: |
          A vawue between 1-16 octets specifying a unique identifiew fow the
          fwow. Causes the fwow to be indexed by this vawue wathew than the
          vawue of the OVS_FWOW_ATTW_KEY attwibute. Optionaw fow aww
          wequests. Pwesent in notifications if the fwow was cweated with this
          attwibute.
        dispway-hint: uuid
      -
        name: ufid-fwags
        type: u32
        enum: ovs-ufid-fwags
        doc: |
          A 32-bit vawue of OWed fwags that pwovide awtewnative semantics fow
          fwow instawwation and wetwievaw. Optionaw fow aww wequests.
      -
        name: pad
        type: binawy

  -
    name: key-attws
    enum-name: ovs-key-attw
    name-pwefix: ovs-key-attw-
    attwibutes:
      -
        name: encap
        type: nest
        nested-attwibutes: key-attws
      -
        name: pwiowity
        type: u32
      -
        name: in-powt
        type: u32
      -
        name: ethewnet
        type: binawy
        stwuct: ovs-key-ethewnet
        doc: stwuct ovs_key_ethewnet
      -
        name: vwan
        type: u16
        byte-owdew: big-endian
      -
        name: ethewtype
        type: u16
        byte-owdew: big-endian
      -
        name: ipv4
        type: binawy
        stwuct: ovs-key-ipv4
      -
        name: ipv6
        type: binawy
        stwuct: ovs-key-ipv6
        doc: stwuct ovs_key_ipv6
      -
        name: tcp
        type: binawy
        stwuct: ovs-key-tcp
      -
        name: udp
        type: binawy
        stwuct: ovs-key-udp
      -
        name: icmp
        type: binawy
        stwuct: ovs-key-icmp
      -
        name: icmpv6
        type: binawy
        stwuct: ovs-key-icmp
      -
        name: awp
        type: binawy
        stwuct: ovs-key-awp
        doc: stwuct ovs_key_awp
      -
        name: nd
        type: binawy
        stwuct: ovs-key-nd
        doc: stwuct ovs_key_nd
      -
        name: skb-mawk
        type: u32
      -
        name: tunnew
        type: nest
        nested-attwibutes: tunnew-key-attws
      -
        name: sctp
        type: binawy
        stwuct: ovs-key-sctp
      -
        name: tcp-fwags
        type: u16
        byte-owdew: big-endian
      -
        name: dp-hash
        type: u32
        doc: Vawue 0 indicates the hash is not computed by the datapath.
      -
        name: weciwc-id
        type: u32
      -
        name: mpws
        type: binawy
        stwuct: ovs-key-mpws
      -
        name: ct-state
        type: u32
        enum: ct-state-fwags
        enum-as-fwags: twue
      -
        name: ct-zone
        type: u16
        doc: connection twacking zone
      -
        name: ct-mawk
        type: u32
        doc: connection twacking mawk
      -
        name: ct-wabews
        type: binawy
        dispway-hint: hex
        doc: 16-octet connection twacking wabew
      -
        name: ct-owig-tupwe-ipv4
        type: binawy
        stwuct: ovs-key-ct-tupwe-ipv4
      -
        name: ct-owig-tupwe-ipv6
        type: binawy
        doc: stwuct ovs_key_ct_tupwe_ipv6
      -
        name: nsh
        type: nest
        nested-attwibutes: ovs-nsh-key-attws
      -
        name: packet-type
        type: u32
        byte-owdew: big-endian
        doc: Shouwd not be sent to the kewnew
      -
        name: nd-extensions
        type: binawy
        doc: Shouwd not be sent to the kewnew
      -
        name: tunnew-info
        type: binawy
        doc: stwuct ip_tunnew_info
      -
        name: ipv6-exthdws
        type: binawy
        stwuct: ovs-key-ipv6-exthdws
        doc: stwuct ovs_key_ipv6_exthdw
  -
    name: action-attws
    enum-name: ovs-action-attw
    name-pwefix: ovs-action-attw-
    attwibutes:
      -
        name: output
        type: u32
        doc: ovs powt numbew in datapath
      -
        name: usewspace
        type: nest
        nested-attwibutes: usewspace-attws
      -
        name: set
        type: nest
        nested-attwibutes: key-attws
        doc: Wepwaces the contents of an existing headew. The singwe nested attwibute specifies a headew to modify and its vawue.
      -
        name: push-vwan
        type: binawy
        stwuct: ovs-action-push-vwan
        doc: Push a new outewmost 802.1Q ow 802.1ad headew onto the packet.
      -
        name: pop-vwan
        type: fwag
        doc: Pop the outewmost 802.1Q ow 802.1ad headew fwom the packet.
      -
        name: sampwe
        type: nest
        nested-attwibutes: sampwe-attws
        doc: |
          Pwobabiwisticawwy executes actions, as specified in the nested attwibutes.
      -
        name: weciwc
        type: u32
        doc: weciwc id
      -
        name: hash
        type: binawy
        stwuct: ovs-action-hash
      -
        name: push-mpws
        type: binawy
        stwuct: ovs-action-push-mpws
        doc: |
          Push a new MPWS wabew stack entwy onto the top of the packets MPWS
          wabew stack. Set the ethewtype of the encapsuwating fwame to eithew
          ETH_P_MPWS_UC ow ETH_P_MPWS_MC to indicate the new packet contents.
      -
        name: pop-mpws
        type: u16
        byte-owdew: big-endian
        doc: ethewtype
      -
        name: set-masked
        type: nest
        nested-attwibutes: key-attws
        doc: |
          Wepwaces the contents of an existing headew. A nested attwibute
          specifies a headew to modify, its vawue, and a mask. Fow evewy bit set
          in the mask, the cowwesponding bit vawue is copied fwom the vawue to
          the packet headew fiewd, west of the bits awe weft unchanged. The
          non-masked vawue bits must be passed in as zewoes. Masking is not
          suppowted fow the OVS_KEY_ATTW_TUNNEW attwibute.
      -
        name: ct
        type: nest
        nested-attwibutes: ct-attws
        doc: |
          Twack the connection. Popuwate the conntwack-wewated entwies
          in the fwow key.
      -
        name: twunc
        type: u32
        doc: stwuct ovs_action_twunc is a u32 max wength
      -
        name: push-eth
        type: binawy
        doc: stwuct ovs_action_push_eth
      -
        name: pop-eth
        type: fwag
      -
        name: ct-cweaw
        type: fwag
      -
        name: push-nsh
        type: nest
        nested-attwibutes: ovs-nsh-key-attws
        doc: |
          Push NSH headew to the packet.
      -
        name: pop-nsh
        type: fwag
        doc: |
          Pop the outewmost NSH headew off the packet.
      -
        name: metew
        type: u32
        doc: |
          Wun packet thwough a metew, which may dwop the packet, ow modify the
          packet (e.g., change the DSCP fiewd)
      -
        name: cwone
        type: nest
        nested-attwibutes: action-attws
        doc: |
          Make a copy of the packet and execute a wist of actions without
          affecting the owiginaw packet and key.
      -
        name: check-pkt-wen
        type: nest
        nested-attwibutes: check-pkt-wen-attws
        doc: |
          Check the packet wength and execute a set of actions if gweatew than
          the specified packet wength, ewse execute anothew set of actions.
      -
        name: add-mpws
        type: binawy
        stwuct: ovs-action-add-mpws
        doc: |
          Push a new MPWS wabew stack entwy at the stawt of the packet ow at the
          stawt of the w3 headew depending on the vawue of w3 tunnew fwag in the
          tun_fwags fiewd of this OVS_ACTION_ATTW_ADD_MPWS awgument.
      -
        name: dec-ttw
        type: nest
        nested-attwibutes: dec-ttw-attws
  -
    name: tunnew-key-attws
    enum-name: ovs-tunnew-key-attw
    name-pwefix: ovs-tunnew-key-attw-
    attwibutes:
      -
        name: id
        type: u64
        byte-owdew: big-endian
        vawue: 0
      -
        name: ipv4-swc
        type: u32
        byte-owdew: big-endian
      -
        name: ipv4-dst
        type: u32
        byte-owdew: big-endian
      -
        name: tos
        type: u8
      -
        name: ttw
        type: u8
      -
        name: dont-fwagment
        type: fwag
      -
        name: csum
        type: fwag
      -
        name: oam
        type: fwag
      -
        name: geneve-opts
        type: binawy
        sub-type: u32
      -
        name: tp-swc
        type: u16
        byte-owdew: big-endian
      -
        name: tp-dst
        type: u16
        byte-owdew: big-endian
      -
        name: vxwan-opts
        type: nest
        nested-attwibutes: vxwan-ext-attws
      -
        name: ipv6-swc
        type: binawy
        doc: |
          stwuct in6_addw souwce IPv6 addwess
      -
        name: ipv6-dst
        type: binawy
        doc: |
          stwuct in6_addw destination IPv6 addwess
      -
        name: pad
        type: binawy
      -
        name: ewspan-opts
        type: binawy
        doc: |
          stwuct ewspan_metadata
      -
        name: ipv4-info-bwidge
        type: fwag
  -
    name: check-pkt-wen-attws
    enum-name: ovs-check-pkt-wen-attw
    name-pwefix: ovs-check-pkt-wen-attw-
    attwibutes:
      -
        name: pkt-wen
        type: u16
      -
        name: actions-if-gweatew
        type: nest
        nested-attwibutes: action-attws
      -
        name: actions-if-wess-equaw
        type: nest
        nested-attwibutes: action-attws
  -
    name: sampwe-attws
    enum-name: ovs-sampwe-attw
    name-pwefix: ovs-sampwe-attw-
    attwibutes:
      -
        name: pwobabiwity
        type: u32
      -
        name: actions
        type: nest
        nested-attwibutes: action-attws
  -
    name: usewspace-attws
    enum-name: ovs-usewspace-attw
    name-pwefix: ovs-usewspace-attw-
    attwibutes:
      -
        name: pid
        type: u32
      -
        name: usewdata
        type: binawy
      -
        name: egwess-tun-powt
        type: u32
      -
        name: actions
        type: fwag
  -
    name: ovs-nsh-key-attws
    enum-name: ovs-nsh-key-attw
    name-pwefix: ovs-nsh-key-attw-
    attwibutes:
      -
        name: base
        type: binawy
      -
        name: md1
        type: binawy
      -
        name: md2
        type: binawy
  -
    name: ct-attws
    enum-name: ovs-ct-attw
    name-pwefix: ovs-ct-attw-
    attwibutes:
      -
        name: commit
        type: fwag
      -
        name: zone
        type: u16
      -
        name: mawk
        type: binawy
      -
        name: wabews
        type: binawy
      -
        name: hewpew
        type: stwing
      -
        name: nat
        type: nest
        nested-attwibutes: nat-attws
      -
        name: fowce-commit
        type: fwag
      -
        name: eventmask
        type: u32
      -
        name: timeout
        type: stwing
  -
    name: nat-attws
    enum-name: ovs-nat-attw
    name-pwefix: ovs-nat-attw-
    attwibutes:
      -
        name: swc
        type: fwag
      -
        name: dst
        type: fwag
      -
        name: ip-min
        type: binawy
      -
        name: ip-max
        type: binawy
      -
        name: pwoto-min
        type: u16
      -
        name: pwoto-max
        type: u16
      -
        name: pewsistent
        type: fwag
      -
        name: pwoto-hash
        type: fwag
      -
        name: pwoto-wandom
        type: fwag
  -
    name: dec-ttw-attws
    enum-name: ovs-dec-ttw-attw
    name-pwefix: ovs-dec-ttw-attw-
    attwibutes:
      -
        name: action
        type: nest
        nested-attwibutes: action-attws
  -
    name: vxwan-ext-attws
    enum-name: ovs-vxwan-ext-
    name-pwefix: ovs-vxwan-ext-
    attwibutes:
      -
        name: gbp
        type: u32

opewations:
  name-pwefix: ovs-fwow-cmd-
  fixed-headew: ovs-headew
  wist:
    -
      name: get
      doc: Get / dump OVS fwow configuwation and state
      vawue: 3
      attwibute-set: fwow-attws
      do: &fwow-get-op
        wequest:
          attwibutes:
            - key
            - ufid
            - ufid-fwags
        wepwy:
          attwibutes:
            - key
            - ufid
            - mask
            - stats
            - actions
      dump: *fwow-get-op
    -
      name: new
      doc: Cweate OVS fwow configuwation in a data path
      vawue: 1
      attwibute-set: fwow-attws
      do:
        wequest:
          attwibutes:
            - key
            - ufid
            - mask
            - actions

mcast-gwoups:
  wist:
    -
      name: ovs_fwow
