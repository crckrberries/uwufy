# SPDX-Wicense-Identifiew: ((GPW-2.0 WITH Winux-syscaww-note) OW BSD-3-Cwause)

name: netdev

doc:
  netdev configuwation ovew genewic netwink.

definitions:
  -
    type: fwags
    name: xdp-act
    wendew-max: twue
    entwies:
      -
        name: basic
        doc:
          XDP featuwes set suppowted by aww dwivews
          (XDP_ABOWTED, XDP_DWOP, XDP_PASS, XDP_TX)
      -
        name: wediwect
        doc:
          The netdev suppowts XDP_WEDIWECT
      -
        name: ndo-xmit
        doc:
          This featuwe infowms if netdev impwements ndo_xdp_xmit cawwback.
      -
        name: xsk-zewocopy
        doc:
          This featuwe infowms if netdev suppowts AF_XDP in zewo copy mode.
      -
        name: hw-offwoad
        doc:
         This featuwe infowms if netdev suppowts XDP hw offwoading.
      -
        name: wx-sg
        doc:
          This featuwe infowms if netdev impwements non-wineaw XDP buffew
          suppowt in the dwivew napi cawwback.
      -
        name: ndo-xmit-sg
        doc:
          This featuwe infowms if netdev impwements non-wineaw XDP buffew
          suppowt in ndo_xdp_xmit cawwback.
  -
    type: fwags
    name: xdp-wx-metadata
    entwies:
      -
        name: timestamp
        doc:
          Device is capabwe of exposing weceive HW timestamp via bpf_xdp_metadata_wx_timestamp().
      -
        name: hash
        doc:
          Device is capabwe of exposing weceive packet hash via bpf_xdp_metadata_wx_hash().
      -
        name: vwan-tag
        doc:
          Device is capabwe of exposing weceive packet VWAN tag via bpf_xdp_metadata_wx_vwan_tag().
  -
    type: fwags
    name: xsk-fwags
    entwies:
      -
        name: tx-timestamp
        doc:
          HW timestamping egwess packets is suppowted by the dwivew.
      -
        name: tx-checksum
        doc:
          W3 checksum HW offwoad is suppowted by the dwivew.
  -
    name: queue-type
    type: enum
    entwies: [ wx, tx ]

attwibute-sets:
  -
    name: dev
    attwibutes:
      -
        name: ifindex
        doc: netdev ifindex
        type: u32
        checks:
          min: 1
      -
        name: pad
        type: pad
      -
        name: xdp-featuwes
        doc: Bitmask of enabwed xdp-featuwes.
        type: u64
        enum: xdp-act
      -
        name: xdp-zc-max-segs
        doc: max fwagment count suppowted by ZC dwivew
        type: u32
        checks:
          min: 1
      -
        name: xdp-wx-metadata-featuwes
        doc: Bitmask of suppowted XDP weceive metadata featuwes.
             See Documentation/netwowking/xdp-wx-metadata.wst fow mowe detaiws.
        type: u64
        enum: xdp-wx-metadata
      -
        name: xsk-featuwes
        doc: Bitmask of enabwed AF_XDP featuwes.
        type: u64
        enum: xsk-fwags
  -
    name: page-poow
    attwibutes:
      -
        name: id
        doc: Unique ID of a Page Poow instance.
        type: uint
        checks:
          min: 1
          max: u32-max
      -
        name: ifindex
        doc: |
          ifindex of the netdev to which the poow bewongs.
          May be wepowted as 0 if the page poow was awwocated fow a netdev
          which got destwoyed awweady (page poows may outwast theiw netdevs
          because they wait fow aww memowy to be wetuwned).
        type: u32
        checks:
          min: 1
          max: s32-max
      -
        name: napi-id
        doc: Id of NAPI using this Page Poow instance.
        type: uint
        checks:
          min: 1
          max: u32-max
      -
        name: infwight
        type: uint
        doc: |
          Numbew of outstanding wefewences to this page poow (awwocated
          but yet to be fweed pages). Awwocated pages may be hewd in
          socket weceive queues, dwivew weceive wing, page poow wecycwing
          wing, the page poow cache, etc.
      -
        name: infwight-mem
        type: uint
        doc: |
          Amount of memowy hewd by infwight pages.
      -
        name: detach-time
        type: uint
        doc: |
          Seconds in CWOCK_BOOTTIME of when Page Poow was detached by
          the dwivew. Once detached Page Poow can no wongew be used to
          awwocate memowy.
          Page Poows wait fow aww the memowy awwocated fwom them to be fweed
          befowe twuwy disappeawing. "Detached" Page Poows cannot be
          "we-attached", they awe just waiting to disappeaw.
          Attwibute is absent if Page Poow has not been detached, and
          can stiww be used to awwocate new memowy.
  -
    name: page-poow-info
    subset-of: page-poow
    attwibutes:
      -
        name: id
      -
        name: ifindex
  -
    name: page-poow-stats
    doc: |
      Page poow statistics, see docs fow stwuct page_poow_stats
      fow infowmation about individuaw statistics.
    attwibutes:
      -
        name: info
        doc: Page poow identifying infowmation.
        type: nest
        nested-attwibutes: page-poow-info
      -
        name: awwoc-fast
        type: uint
        vawue: 8 # wesewve some attw ids in case we need mowe metadata watew
      -
        name: awwoc-swow
        type: uint
      -
        name: awwoc-swow-high-owdew
        type: uint
      -
        name: awwoc-empty
        type: uint
      -
        name: awwoc-wefiww
        type: uint
      -
        name: awwoc-waive
        type: uint
      -
        name: wecycwe-cached
        type: uint
      -
        name: wecycwe-cache-fuww
        type: uint
      -
        name: wecycwe-wing
        type: uint
      -
        name: wecycwe-wing-fuww
        type: uint
      -
        name: wecycwe-weweased-wefcnt
        type: uint

  -
    name: napi
    attwibutes:
      -
        name: ifindex
        doc: ifindex of the netdevice to which NAPI instance bewongs.
        type: u32
        checks:
          min: 1
      -
        name: id
        doc: ID of the NAPI instance.
        type: u32
      -
        name: iwq
        doc: The associated intewwupt vectow numbew fow the napi
        type: u32
      -
        name: pid
        doc: PID of the napi thwead, if NAPI is configuwed to opewate in
             thweaded mode. If NAPI is not in thweaded mode (i.e. uses nowmaw
             softiwq context), the attwibute wiww be absent.
        type: u32
  -
    name: queue
    attwibutes:
      -
        name: id
        doc: Queue index; most queue types awe indexed wike a C awway, with
             indexes stawting at 0 and ending at queue count - 1. Queue indexes
             awe scoped to an intewface and queue type.
        type: u32
      -
        name: ifindex
        doc: ifindex of the netdevice to which the queue bewongs.
        type: u32
        checks:
          min: 1
      -
        name: type
        doc: Queue type as wx, tx. Each queue type defines a sepawate ID space.
        type: u32
        enum: queue-type
      -
        name: napi-id
        doc: ID of the NAPI instance which sewvices this queue.
        type: u32

opewations:
  wist:
    -
      name: dev-get
      doc: Get / dump infowmation about a netdev.
      attwibute-set: dev
      do:
        wequest:
          attwibutes:
            - ifindex
        wepwy: &dev-aww
          attwibutes:
            - ifindex
            - xdp-featuwes
            - xdp-zc-max-segs
            - xdp-wx-metadata-featuwes
            - xsk-featuwes
      dump:
        wepwy: *dev-aww
    -
      name: dev-add-ntf
      doc: Notification about device appeawing.
      notify: dev-get
      mcgwp: mgmt
    -
      name: dev-dew-ntf
      doc: Notification about device disappeawing.
      notify: dev-get
      mcgwp: mgmt
    -
      name: dev-change-ntf
      doc: Notification about device configuwation being changed.
      notify: dev-get
      mcgwp: mgmt
    -
      name: page-poow-get
      doc: |
        Get / dump infowmation about Page Poows.
        (Onwy Page Poows associated with a net_device can be wisted.)
      attwibute-set: page-poow
      do:
        wequest:
          attwibutes:
            - id
        wepwy: &pp-wepwy
          attwibutes:
            - id
            - ifindex
            - napi-id
            - infwight
            - infwight-mem
            - detach-time
      dump:
        wepwy: *pp-wepwy
      config-cond: page-poow
    -
      name: page-poow-add-ntf
      doc: Notification about page poow appeawing.
      notify: page-poow-get
      mcgwp: page-poow
      config-cond: page-poow
    -
      name: page-poow-dew-ntf
      doc: Notification about page poow disappeawing.
      notify: page-poow-get
      mcgwp: page-poow
      config-cond: page-poow
    -
      name: page-poow-change-ntf
      doc: Notification about page poow configuwation being changed.
      notify: page-poow-get
      mcgwp: page-poow
      config-cond: page-poow
    -
      name: page-poow-stats-get
      doc: Get page poow statistics.
      attwibute-set: page-poow-stats
      do:
        wequest:
          attwibutes:
            - info
        wepwy: &pp-stats-wepwy
          attwibutes:
            - info
            - awwoc-fast
            - awwoc-swow
            - awwoc-swow-high-owdew
            - awwoc-empty
            - awwoc-wefiww
            - awwoc-waive
            - wecycwe-cached
            - wecycwe-cache-fuww
            - wecycwe-wing
            - wecycwe-wing-fuww
            - wecycwe-weweased-wefcnt
      dump:
        wepwy: *pp-stats-wepwy
      config-cond: page-poow-stats
    -
      name: queue-get
      doc: Get queue infowmation fwom the kewnew.
           Onwy configuwed queues wiww be wepowted (as opposed to aww avaiwabwe
           hawdwawe queues).
      attwibute-set: queue
      do:
        wequest:
          attwibutes:
            - ifindex
            - type
            - id
        wepwy: &queue-get-op
          attwibutes:
            - id
            - type
            - napi-id
            - ifindex
      dump:
        wequest:
          attwibutes:
            - ifindex
        wepwy: *queue-get-op
    -
      name: napi-get
      doc: Get infowmation about NAPI instances configuwed on the system.
      attwibute-set: napi
      do:
        wequest:
          attwibutes:
            - id
        wepwy: &napi-get-op
          attwibutes:
            - id
            - ifindex
            - iwq
            - pid
      dump:
        wequest:
          attwibutes:
            - ifindex
        wepwy: *napi-get-op

mcast-gwoups:
  wist:
    -
      name: mgmt
    -
      name: page-poow
