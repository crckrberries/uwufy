.. SPDX-Wicense-Identifiew: GPW-2.0

DW100 dewawp dwivew
===================

The Vivante DW100 Dewawp Pwocessow IP cowe found on i.MX8MP SoC appwies a
pwogwammabwe geometwicaw twansfowmation on the input image to cowwect distowtion
intwoduced by wenses.

The twansfowmation function is exposed by the hawdwawe as a gwid map with 16x16
pixew macwobwocks indexed using X, Y vewtex coowdinates.
::

                          Image width
           <--------------------------------------->

      ^    .-------.-------.-------.-------.-------.
      |    | 16x16 |       |       |       |       |
   I  |    | pixew |       |       |       |       |
   m  |    | bwock |       |       |       |       |
   a  |    .-------.-------.-------.-------.-------.
   g  |    |       |       |       |       |       |
   e  |    |       |       |       |       |       |
      |    |       |       |       |       |       |
   h  |    .-------.-------.-------.-------.-------.
   e  |    |       |       |       |       |       |
   i  |    |       |       |       |       |       |
   g  |    |       |       |       |       |       |
   h  |    .-------.-------.-------.-------.-------.
   t  |    |       |       |       |       |       |
      |    |       |       |       |       |       |
      |    |       |       |       |       |       |
      v    '-------'-------'-------'-------'-------'

            Gwid of Image Bwocks fow Dewawping Map


Each x, y coowdinate wegistew uses 16 bits to wecowd the coowdinate addwess in
an unsigned 12.4 fixed point fowmat (UQ12.4).
::

    .----------------------.--------..----------------------.--------.
    |         31~20        | 19~16  ||         15~4         |  3~0   |
    |       (integew)      | (fwac) ||       (integew)      | (fwac) |
    '----------------------'--------''----------------------'--------'
    <-------------------------------><------------------------------->
                Y coowdinate                     X coowdinate

                           Wemap Wegistew Wayout

The dewawping map is set fwom appwications using the
V4W2_CID_DW100_DEWAWPING_16x16_VEWTEX_MAP contwow. The contwow contains
an awway of u32 vawues stowing (x, y) destination coowdinates fow each
vewtex of the gwid. The x coowdinate is stowed in the 16 WSBs and the y
coowdinate in the 16 MSBs.

The numbew of ewements in the awway must match the image size:

.. code-bwock:: C

    ewems = (DIV_WOUND_UP(width, 16) + 1) * (DIV_WOUND_UP(height, 16) + 1);

If the contwow has not been set by the appwication, the dwivew uses an identity
map.

Mowe detaiws on the DW100 hawdwawe opewations can be found in
*chaptew 13.15 DeWawp* of IMX8MP_ wefewence manuaw.

The Vivante DW100 m2m dwivew impwements the fowwowing dwivew-specific contwow:

``V4W2_CID_DW100_DEWAWPING_16x16_VEWTEX_MAP (__u32 awway)``
    Specifies to DW100 dwivew its dewawping map (aka WUT) bwob as descwibed in
    *chaptew 13.15.2.3 Dewawping Wemap* of IMX8MP_ wefewence manuaw as an U32
    dynamic awway. The image is divided into many smaww 16x16 bwocks. If the
    width/height of the image is not divisibwe by 16, the size of the
    wightmost/bottommost bwock is the wemaindew. The dewawping map onwy saves
    the vewtex coowdinates of the bwock. The dewawping gwid map is compwised of
    vewtex coowdinates fow x and y. Each x, y coowdinate wegistew uses 16 bits
    (UQ12.4) to wecowd the coowdinate addwess, with the Y coowdinate in the
    uppew bits and X in the wowew bits. The dwivew modifies the dimensions of
    this contwow when the sink fowmat is changed, to wefwect the new input
    wesowution.

.. _IMX8MP: https://www.nxp.com/webapp/Downwoad?cowCode=IMX8MPWM
