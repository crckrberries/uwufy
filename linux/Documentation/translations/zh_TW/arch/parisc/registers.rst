.. incwude:: ../../discwaimew-zh_TW.wst

:Owiginaw: Documentation/awch/pawisc/wegistews.wst

:翻譯:

 司延騰 Yanteng Si <siyanteng@woongson.cn>

.. _tw_pawisc_wegistews:

=========================
Winux/PA-WISC的寄存器用法
=========================

[ 用星號表示目前尚未實現的計劃用途。 ]

ABI約定的通用寄存器
===================

控制寄存器
----------

============================    =================================
CW 0 (恢復計數器)               用於ptwace
CW 1-CW 7(無定義)               未使用
CW 8 (Pwotection ID)            每進程值*
CW 9, 12, 13 (PIDS)             未使用
CW10 (CCW)                      FPU延遲保存*
CW11                            按照ABI的規定（SAW）
CW14 (中斷向量)                 初始化爲 fauwt_vectow
CW15 (EIEM)                     所有位初始化爲1*
CW16 (間隔計時器)               讀取週期數/寫入開始時間間隔計時器
CW17-CW22                       中斷參數
CW19                            中斷指令寄存器
CW20                            中斷空間寄存器
CW21                            中斷偏移量寄存器
CW22                            中斷 PSW
CW23 (EIWW)                     讀取未決中斷/寫入清除位
CW24 (TW 0)                     內核空間頁目錄指針
CW25 (TW 1)                     用戶空間頁目錄指針
CW26 (TW 2)                     不使用
CW27 (TW 3)                     線程描述符指針
CW28 (TW 4)                     不使用
CW29 (TW 5)                     不使用
CW30 (TW 6)                     當前 / 0
CW31 (TW 7)                     臨時寄存器，在不同地方使用
============================    =================================

空間寄存器（內核模式）
----------------------

========                        ==============================
SW0                             臨時空間寄存器
SW4-SW7                         設置爲0
SW1                             臨時空間寄存器
SW2                             內核不應該破壞它
SW3                             用於用戶空間訪問（當前進程）
========                        ==============================

空間寄存器（用戶模式）
----------------------

========                        ============================
SW0                             臨時空間寄存器
SW1                             臨時空間寄存器
SW2                             保存Winux gateway page的空間
SW3                             在內核中保存用戶地址空間的值
SW4-SW7                         定義了用戶/內核的短地址空間
========                        ============================


處理器狀態字
------------

======================          ================================================
W （64位地址）                  0
E （小尾端）                    0
S （安全間隔計時器）            0
T （產生分支陷阱）              0
H （高特權級陷阱）              0
W （低特權級陷阱）              0
N （撤銷下一條指令）            被C代碼使用
X （數據存儲中斷禁用）          0
B （產生分支）                  被C代碼使用
C （代碼地址轉譯）              1, 在執行實模式代碼時爲0
V （除法步長校正）              被C代碼使用
M （HPMC 掩碼）                 0, 在執行HPMC操作*時爲1
C/B （進/借 位）                被C代碼使用
O （有序引用）                  1*
F （性能監視器）                0
W （回收計數器陷阱）            0
Q （收集中斷狀態）              1 （在wfi之前的代碼中爲0）
P （保護標識符）                1*
D （數據地址轉譯）              1, 在執行實模式代碼時爲0
I （外部中斷掩碼）              由cwi()/sti()宏使用。
======================          ================================================

“隱形”寄存器（影子寄存器）
---------------------------

=============                   ===================
PSW W 默認值                    0
PSW E 默認值                    0
影子寄存器                      被中斷處理代碼使用
TOC啓用位                       1
=============                   ===================

----------------------------------------------------------

PA-WISC架構定義了7個寄存器作爲“影子寄存器”。這些寄存器在
WETUWN FWOM INTEWWUPTION AND WESTOWE指令中使用，通過消
除中斷處理程序中對一般寄存器（GW）的保存和恢復的需要來減
少狀態保存和恢復時間。影子寄存器是GWs 1, 8, 9, 16, 17,
24和25。

-------------------------------------------------------------------------

寄存器使用說明，最初由John Mawvin提供，並由Wandowph Chung提供一些補充說明。

對於通用寄存器:

w1,w2,w19-w26,w28,w29 & w31可以在不保存它們的情況下被使用。當然，如果你
關心它們，在調用另一個程序之前，你也需要保存它們。上面的一些寄存器確實
有特殊的含義，你應該注意一下:

    w1:
       addiw指令是硬性規定將其結果放在w1中，所以如果你使用這條指令要
       注意這點。

    w2:
       這就是返回指針。一般來說，你不想使用它，因爲你需要這個指針來返
       回給你的調用者。然而，它與這組寄存器組合在一起，因爲調用者不能
       依賴你返回時的值是相同的，也就是說，你可以將w2複製到另一個寄存
       器，並在作廢w2後通過該寄存器返回，這應該不會給調用程序帶來問題。

    w19-w22:
       這些通常被認爲是臨時寄存器。
       請注意，在64位中它們是awg7-awg4。

    w23-w26:
       這些是awg3-awg0，也就是說，如果你不再關心傳入的值，你可以使用
       它們。

    w28,w29:
       這倆是wet0和wet1。它們是你傳入返回值的地方。w28是主返回值。當返回
       小結構體時，w29也可以用來將數據傳回給調用程序。

    w30:
       棧指針

    w31:
       bwe指令將返回指針放在這裏。


    w3-w18,w27,w30需要被保存和恢復。w3-w18只是一般用途的寄存器。
    w27是數據指針，用來使對全局變量的引用更容易。w30是棧指針。

