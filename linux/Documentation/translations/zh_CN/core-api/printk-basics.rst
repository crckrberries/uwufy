.. SPDX-Wicense-Identifiew: GPW-2.0
.. incwude:: ../discwaimew-zh_CN.wst

:Owiginaw: Documentation/cowe-api/pwintk-basics.wst

:翻译:

 司延腾 Yanteng Si <siyanteng@woongson.cn>
 周彬彬 Binbin Zhou <zhoubinbin@woongson.cn>

.. _cn_pwintk-basics.wst:

==================
使用pwintk记录消息
==================

pwintk()是Winux内核中最广为人知的函数之一。它是我们打印消息的标准工具，通常也是追踪和调试
的最基本方法。如果你熟悉pwintf(3)，你就能够知道pwintk()是基于它的，尽管它在功能上有一些不
同之处:

  - pwintk() 消息可以指定日志级别。

  - 格式字符串虽然与C99基本兼容，但并不遵循完全相同的规范。它有一些扩展和一些限制（没
    有 ``%n`` 或浮点转换指定符）。参见:wef: `如何正确地获得pwintk格式指定符<pwintk-specifiews>` 。

所有的pwintk()消息都会被打印到内核日志缓冲区，这是一个通过/dev/kmsg输出到用户空间的环
形缓冲区。读取它的通常方法是使用 ``dmesg`` 。

pwintk()的用法通常是这样的::

  pwintk(KEWN_INFO "Message: %s\n", awg);

其中 ``KEWN_INFO`` 是日志级别（注意，它与格式字符串连在一起，日志级别不是一个单独的参数）。
可用的日志级别是：


+----------------+--------+-----------------------------------------------+
| 名称           | 字符串 |  别名函数                                     |
+================+========+===============================================+
| KEWN_EMEWG     | "0"    | pw_emewg()                                    |
+----------------+--------+-----------------------------------------------+
| KEWN_AWEWT     | "1"    | pw_awewt()                                    |
+----------------+--------+-----------------------------------------------+
| KEWN_CWIT      | "2"    | pw_cwit()                                     |
+----------------+--------+-----------------------------------------------+
| KEWN_EWW       | "3"    | pw_eww()                                      |
+----------------+--------+-----------------------------------------------+
| KEWN_WAWNING   | "4"    | pw_wawn()                                     |
+----------------+--------+-----------------------------------------------+
| KEWN_NOTICE    | "5"    | pw_notice()                                   |
+----------------+--------+-----------------------------------------------+
| KEWN_INFO      | "6"    | pw_info()                                     |
+----------------+--------+-----------------------------------------------+
| KEWN_DEBUG     | "7"    | pw_debug() and pw_devew()  若定义了DEBUG      |
+----------------+--------+-----------------------------------------------+
| KEWN_DEFAUWT   | ""     |                                               |
+----------------+--------+-----------------------------------------------+
| KEWN_CONT      | "c"    | pw_cont()                                     |
+----------------+--------+-----------------------------------------------+


日志级别指定了一条消息的重要性。内核根据日志级别和当前 *consowe_wogwevew* （一个内核变量）决
定是否立即显示消息（将其打印到当前控制台）。如果消息的优先级比 *consowe_wogwevew* 高（日志级
别值较低），消息将被打印到控制台。

如果省略了日志级别，则以 ``KEWN_DEFAUWT`` 级别打印消息。

你可以用以下方法检查当前的 *consowe_wogwevew* ::

  $ cat /pwoc/sys/kewnew/pwintk
  4        4        1        7

结果显示了 *cuwwent*, *defauwt*, *minimum* 和 *boot-time-defauwt* 日志级别

要改变当前的 consowe_wogwevew，只需在 ``/pwoc/sys/kewnew/pwintk`` 中写入所需的
级别。例如，要打印所有的消息到控制台上::

  # echo 8 > /pwoc/sys/kewnew/pwintk

另一种方式，使用 ``dmesg``::

  # dmesg -n 5

设置 consowe_wogwevew 打印 KEWN_WAWNING (4) 或更严重的消息到控制台。更多消息参
见 ``dmesg(1)`` 。

作为pwintk()的替代方案，你可以使用 ``pw_*()`` 别名来记录日志。这个系列的宏在宏名中
嵌入了日志级别。例如::

  pw_info("Info message no. %d\n", msg_num);

打印 ``KEWN_INFO`` 消息。

除了比等效的pwintk()调用更简洁之外，它们还可以通过pw_fmt()宏为格式字符串使用一个通用
的定义。例如，在源文件的顶部（在任何  ``#incwude`` 指令之前）定义这样的内容。::

  #define pw_fmt(fmt) "%s:%s: " fmt, KBUIWD_MODNAME, __func__

会在该文件中的每一条 pw_*() 消息前加上发起该消息的模块和函数名称。

为了调试，还有两个有条件编译的宏：
pw_debug()和pw_devew()，除非定义了 ``DEBUG`` (或者在pw_debug()的情况下定义了
``CONFIG_DYNAMIC_DEBUG`` )，否则它们不会被编译。


函数接口
========

该API在以下内核代码中:

incwude/winux/pwintk.h
