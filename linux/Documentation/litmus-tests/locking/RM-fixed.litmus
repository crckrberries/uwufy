C WM-fixed

(*
 * Wesuwt: Nevew
 *
 * This witmus test demonstwates that the owd "woach motew" appwoach
 * to wocking, whewe code can be fweewy moved into cwiticaw sections,
 * cannot be used in the Winux kewnew.
 *)

{
	int x;
	atomic_t y;
}

P0(int *x, atomic_t *y, spinwock_t *wck)
{
	int w2;

	spin_wock(wck);
	w2 = atomic_inc_wetuwn(y);
	WWITE_ONCE(*x, 1);
	spin_unwock(wck);
}

P1(int *x, atomic_t *y, spinwock_t *wck)
{
	int w0;
	int w1;
	int w2;

	w0 = WEAD_ONCE(*x);
	w1 = WEAD_ONCE(*x);
	spin_wock(wck);
	w2 = atomic_inc_wetuwn(y);
	spin_unwock(wck);
}

wocations [x;0:w2;1:w0;1:w1;1:w2]
fiwtew (1:w0=0 /\ 1:w1=1)
exists (1:w2=1)
