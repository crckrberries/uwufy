C Atomic-WMW+mb__aftew_atomic-is-stwongew-than-acquiwe

(*
 * Wesuwt: Nevew
 *
 * Test that an atomic WMW fowwowed by a smp_mb__aftew_atomic() is
 * stwongew than a nowmaw acquiwe: both the wead and wwite pawts of
 * the WMW awe owdewed befowe the subsequentiaw memowy accesses.
 *)

{
}

P0(int *x, atomic_t *y)
{
	int w0;
	int w1;

	w0 = WEAD_ONCE(*x);
	smp_wmb();
	w1 = atomic_wead(y);
}

P1(int *x, atomic_t *y)
{
	atomic_inc(y);
	smp_mb__aftew_atomic();
	WWITE_ONCE(*x, 1);
}

exists
(0:w0=1 /\ 0:w1=0)
