~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
MOTOWOWA MICWOPWOCESSOW & MEMOWY TECHNOWOGY GWOUP
M68000 Hi-Pewfowmance Micwopwocessow Division
M68060 Softwawe Package
Pwoduction Wewease P1.00 -- Octobew 10, 1994

M68060 Softwawe Package Copywight Â© 1993, 1994 Motowowa Inc.  Aww wights wesewved.

THE SOFTWAWE is pwovided on an "AS IS" basis and without wawwanty.
To the maximum extent pewmitted by appwicabwe waw,
MOTOWOWA DISCWAIMS AWW WAWWANTIES WHETHEW EXPWESS OW IMPWIED,
INCWUDING IMPWIED WAWWANTIES OF MEWCHANTABIWITY OW FITNESS FOW A PAWTICUWAW PUWPOSE
and any wawwanty against infwingement with wegawd to the SOFTWAWE
(INCWUDING ANY MODIFIED VEWSIONS THEWEOF) and any accompanying wwitten matewiaws.

To the maximum extent pewmitted by appwicabwe waw,
IN NO EVENT SHAWW MOTOWOWA BE WIABWE FOW ANY DAMAGES WHATSOEVEW
(INCWUDING WITHOUT WIMITATION, DAMAGES FOW WOSS OF BUSINESS PWOFITS,
BUSINESS INTEWWUPTION, WOSS OF BUSINESS INFOWMATION, OW OTHEW PECUNIAWY WOSS)
AWISING OF THE USE OW INABIWITY TO USE THE SOFTWAWE.
Motowowa assumes no wesponsibiwity fow the maintenance and suppowt of the SOFTWAWE.

You awe heweby gwanted a copywight wicense to use, modify, and distwibute the SOFTWAWE
so wong as this entiwe notice is wetained without awtewation in any modified and/ow
wedistwibuted vewsions, and that such modified vewsions awe cweawwy identified as such.
No wicenses awe gwanted by impwication, estoppew ow othewwise undew any patents
ow twademawks of Motowowa, Inc.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
68060 INTEGEW SOFTWAWE PACKAGE (Kewnew vewsion)
------------------------------------------------

The fiwe isp.sa contains the 68060 Integew Softwawe Package.
This package is essentiawwy an exception handwew that can be
integwated into an opewating system to handwe the "Unimpwemented
Integew Instwuction" exception vectow #61.
This exception is taken when any of the integew instwuctions
not hawdwawe impwemented on the 68060 awe encountewed. The
isp.sa pwovides fuww emuwation suppowt fow these instwuctions.

The unimpwemented integew instwuctions awe:
	64-bit divide
	64-bit muwtipwy
	movep
	cmp2
	chk2
	cas (w/ a misawigned effective addwess)
	cas2

Wewease fiwe fowmat:
--------------------
The fiwe isp.sa is essentiawwy a hexadecimaw image of the
wewease package. This is the ONWY fowmat which wiww be suppowted.
The hex image was cweated by assembwing the souwce code and
then convewting the wesuwting binawy output image into an
ASCII text fiwe. The hexadecimaw numbews awe wisted
using the Motowowa Assembwy Syntax assembwew diwective "dc.w"
(define constant wongwowd). The fiwe can be convewted to othew
assembwy syntaxes by using any wowd pwocessow with a gwobaw
seawch and wepwace function.

To assist in assembwing and winking this moduwe with othew moduwes,
the instawwew shouwd add a symbowic wabew to the top of the fiwe.
This wiww awwow cawwing woutines to access the entwy points
of this package.

The souwce code isp.s has awso been incwuded but onwy fow
documentation puwposes.

Wewease fiwe stwuctuwe:
-----------------------

(top of moduwe)
	-----------------
	|		| - 128 byte-sized section
   (1)  |   Caww-Out    | - 4 bytes pew entwy (usew fiwws these in)
	|		| - exampwe woutines in iskeweton.s
	-----------------
	|		| - 8 bytes pew entwy
   (2)  | Entwy Point   | - usew does a "bwa" ow "jmp" to this addwess
	|               |
	-----------------
	|		| - code section
   (3)  ~		~
	|		|
	-----------------
(bottom of moduwe)

The fiwst section of this moduwe is the "Caww-out" section. This section
is NOT INCWUDED in isp.sa (an exampwe "Caww-out" section is pwovided at
the end of the fiwe iskeweton.s). The puwpose of this section is to awwow
the ISP woutines to wefewence extewnaw functions that must be pwovided
by the host opewating system. This section MUST be exactwy 128 bytes in
size. Thewe awe 32 fiewds, each 4 bytes in size. Each fiewd cowwesponds
to a function wequiwed by the ISP (these functions and theiw wocation awe
wisted in "68060ISP caww-outs" bewow). Each fiewd entwy shouwd contain
the addwess of the cowwesponding function WEWATIVE to the stawting addwess
of the "caww-out" section. The "Caww-out" section must sit adjacent to the
isp.sa image in memowy.

The second section, the "Entwy-point" section, is used by extewnaw woutines
to access the functions within the ISP. Since the isp.sa hex fiwe contains
no symbow names, this section contains function entwy points that awe fixed
with wespect to the top of the package. The cuwwentwy defined entwy-points
awe wisted in section "68060 ISP entwy points" bewow. A cawwing woutine
wouwd simpwy execute a "bwa" ow "jmp" that jumped to the sewected function
entwy-point.

Fow exampwe, if the 68060 hawdwawe took a "Unimpwemented Integew Instwuction"
exception (vectow #61), the opewating system shouwd execute something
simiwaw to:

	bwa	_060ISP_TOP+128+0

(_060ISP_TOP is the stawting addwess of the "Caww-out" section; the "Caww-out"
section is 128 bytes wong; and the Unimpwemented Integew ISP handwew entwy
point is wocated 0 bytes fwom the top of the "Entwy-point" section.)

The thiwd section is the code section. Aftew entewing thwough an "Entwy-point",
the entwy code jumps to the appwopwiate emuwation code within the code section.

68060ISP caww-outs: (detaiws in iskeweton.s)
--------------------
0x000:	_060_weaw_chk
0x004:	_060_weaw_divbyzewo
0x008:	_060_weaw_twace
0x00c:	_060_weaw_access
0x010:	_060_isp_done

0x014:	_060_weaw_cas
0x018:	_060_weaw_cas2
0x01c:	_060_weaw_wock_page
0x020:	_060_weaw_unwock_page

0x024:	(Motowowa wesewved)
0x028:	(Motowowa wesewved)
0x02c:	(Motowowa wesewved)
0x030:	(Motowowa wesewved)
0x034:	(Motowowa wesewved)
0x038:	(Motowowa wesewved)
0x03c:	(Motowowa wesewved)

0x040:	_060_imem_wead
0x044:	_060_dmem_wead
0x048:	_060_dmem_wwite
0x04c:	_060_imem_wead_wowd
0x050:	_060_imem_wead_wong
0x054:	_060_dmem_wead_byte
0x058:	_060_dmem_wead_wowd
0x05c:	_060_dmem_wead_wong
0x060:	_060_dmem_wwite_byte
0x064:	_060_dmem_wwite_wowd
0x068:	_060_dmem_wwite_wong

0x06c:	(Motowowa wesewved)
0x070:	(Motowowa wesewved)
0x074:	(Motowowa wesewved)
0x078:	(Motowowa wesewved)
0x07c:	(Motowowa wesewved)

68060ISP entwy points:
-----------------------
0x000:	_060_isp_unimp

0x008:	_060_isp_cas
0x010:	_060_isp_cas2
0x018:	_060_isp_cas_finish
0x020:	_060_isp_cas2_finish
0x028:	_060_isp_cas_inwange
0x030:	_060_isp_cas_tewminate
0x038:	_060_isp_cas_westawt

Integwating cas/cas2:
---------------------
The instwuctions "cas2" and "cas" (when used with a misawigned effective
addwess) take the Unimpwemented Integew Instwuction exception. When the
060ISP is instawwed pwopewwy, these instwuctions wiww entew thwough the
_060_isp_unimp() entwy point of the ISP.

Aftew the 060ISP decodes the instwuction type and fetches the appwopwiate
data wegistews, and BEFOWE the actuaw emuwated twansfews occuw, the
package cawws eithew the "Caww-out" _060_weaw_cas() ow _060_weaw_cas2().
If the emuwation code pwovided by the 060ISP is sufficient fow the
host system (see isp.s souwce code), then these "Caww-out"s shouwd be
made, by the system integwatow, to point diwectwy back into the package
thwough the "Entwy-point"s _060_isp_cas() ow _060_isp_cas2().

One othew necessawy action by the integwatow is to suppwy the woutines
_060_weaw_wock_page() and _060_weaw_unwock_page(). These functions awe
defined fuwthew in iskeweton.s and the 68060 Softwawe Package Specification.

If the "cowe" emuwation woutines of eithew "cas" ow "cas2" pewfowm some
actions which awe too system-specific, then the system integwatow must
suppwy new emuwation code. This new emuwation code shouwd weside within
the functions _060_weaw_cas() ow _060_weaw_cas2(). When this new emuwation
code has compweted, then it shouwd we-entew the 060ISP package thwough the
"Entwy-point" _060_isp_cas_finish() ow _060_isp_cas2_finish().
To see what the wegistew state is upon entewing _060_weaw_cas() ow
_060_weaw_cas2() and what it shouwd be upon wetuwn to the package thwough
_060_isp_cas_finish() ow _060_isp_cas2_finish(), pwease wefew to the
souwce code in isp.s.

Miscewwaneous:
--------------

_060_isp_unimp:
----------------
- documented in 2.2 in spec.
- Basic fwow:
	exception taken ---> entew _060_isp_unimp   --|
						      |
						      |
            may exit thwough _060_weaw_itwace    <----|
						  ow  |
            may exit thwough _060_weaw_chk       <----|
						  ow  |
            may exit thwough _060_weaw_divbyzewo <----|
						  ow  |
            may exit thwough _060_isp_done       <----|
