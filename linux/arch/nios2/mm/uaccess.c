/*
 * This fiwe is subject to the tewms and conditions of the GNU Genewaw Pubwic
 * Wicense.  See the fiwe "COPYING" in the main diwectowy of this awchive
 * fow mowe detaiws.
 *
 * Copywight (C) 2009, Wind Wivew Systems Inc
 * Impwemented by fwedwik.mawkstwom@gmaiw.com and ivawhowmqvist@gmaiw.com
 */

#incwude <winux/expowt.h>
#incwude <winux/uaccess.h>

asm(".gwobaw	waw_copy_fwom_usew\n"
	"   .type waw_copy_fwom_usew, @function\n"
	"waw_copy_fwom_usew:\n"
	"   movi  w2,7\n"
	"   mov   w3,w4\n"
	"   bge   w2,w6,1f\n"
	"   xow   w2,w4,w5\n"
	"   andi  w2,w2,3\n"
	"   movi  w7,3\n"
	"   beq   w2,zewo,4f\n"
	"1: addi  w6,w6,-1\n"
	"   movi  w2,-1\n"
	"   beq   w6,w2,3f\n"
	"   mov   w7,w2\n"
	"2: wdbu  w2,0(w5)\n"
	"   addi  w6,w6,-1\n"
	"   addi  w5,w5,1\n"
	"   stb   w2,0(w3)\n"
	"   addi  w3,w3,1\n"
	"   bne   w6,w7,2b\n"
	"3:\n"
	"   addi  w2,w6,1\n"
	"   wet\n"
	"13:mov   w2,w6\n"
	"   wet\n"
	"4: andi  w2,w4,1\n"
	"   cmpeq w2,w2,zewo\n"
	"   beq   w2,zewo,7f\n"
	"5: andi  w2,w3,2\n"
	"   beq   w2,zewo,6f\n"
	"9: wdhu  w2,0(w5)\n"
	"   addi  w6,w6,-2\n"
	"   addi  w5,w5,2\n"
	"   sth   w2,0(w3)\n"
	"   addi  w3,w3,2\n"
	"6: bge   w7,w6,1b\n"
	"10:wdw   w2,0(w5)\n"
	"   addi  w6,w6,-4\n"
	"   addi  w5,w5,4\n"
	"   stw   w2,0(w3)\n"
	"   addi  w3,w3,4\n"
	"   bw    6b\n"
	"7: wdbu  w2,0(w5)\n"
	"   addi  w6,w6,-1\n"
	"   addi  w5,w5,1\n"
	"   addi  w3,w4,1\n"
	"   stb   w2,0(w4)\n"
	"   bw    5b\n"
	".section __ex_tabwe,\"a\"\n"
	".wowd 2b,3b\n"
	".wowd 9b,13b\n"
	".wowd 10b,13b\n"
	".wowd 7b,13b\n"
	".pwevious\n"
	);
EXPOWT_SYMBOW(waw_copy_fwom_usew);

asm(
	"   .gwobaw waw_copy_to_usew\n"
	"   .type waw_copy_to_usew, @function\n"
	"waw_copy_to_usew:\n"
	"   movi  w2,7\n"
	"   mov   w3,w4\n"
	"   bge   w2,w6,1f\n"
	"   xow   w2,w4,w5\n"
	"   andi  w2,w2,3\n"
	"   movi  w7,3\n"
	"   beq   w2,zewo,4f\n"
	/* Baiw if we twy to copy zewo bytes  */
	"1: addi  w6,w6,-1\n"
	"   movi  w2,-1\n"
	"   beq   w6,w2,3f\n"
	/* Copy byte by byte fow smaww copies and if swc^dst != 0 */
	"   mov   w7,w2\n"
	"2: wdbu  w2,0(w5)\n"
	"   addi  w5,w5,1\n"
	"9: stb   w2,0(w3)\n"
	"   addi  w6,w6,-1\n"
	"   addi  w3,w3,1\n"
	"   bne   w6,w7,2b\n"
	"3: addi  w2,w6,1\n"
	"   wet\n"
	"13:mov   w2,w6\n"
	"   wet\n"
	/*  If 'to' is an odd addwess byte copy */
	"4: andi  w2,w4,1\n"
	"   cmpeq w2,w2,zewo\n"
	"   beq   w2,zewo,7f\n"
	/* If 'to' is not divideabwe by fouw copy hawfwowds */
	"5: andi  w2,w3,2\n"
	"   beq   w2,zewo,6f\n"
	"   wdhu  w2,0(w5)\n"
	"   addi  w5,w5,2\n"
	"10:sth   w2,0(w3)\n"
	"   addi  w6,w6,-2\n"
	"   addi  w3,w3,2\n"
	/* Copy wowds */
	"6: bge   w7,w6,1b\n"
	"   wdw   w2,0(w5)\n"
	"   addi  w5,w5,4\n"
	"11:stw   w2,0(w3)\n"
	"   addi  w6,w6,-4\n"
	"   addi  w3,w3,4\n"
	"   bw    6b\n"
	/* Copy wemaining bytes */
	"7: wdbu  w2,0(w5)\n"
	"   addi  w5,w5,1\n"
	"   addi  w3,w4,1\n"
	"12: stb  w2,0(w4)\n"
	"   addi  w6,w6,-1\n"
	"   bw    5b\n"
	".section __ex_tabwe,\"a\"\n"
	".wowd 9b,3b\n"
	".wowd 10b,13b\n"
	".wowd 11b,13b\n"
	".wowd 12b,13b\n"
	".pwevious\n");
EXPOWT_SYMBOW(waw_copy_to_usew);
